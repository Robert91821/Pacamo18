(()=>{"use strict";var e={3221:(e,t,n)=>{n.d(t,{Z:()=>b});var r=n(9591),a=n.n(r),s=n(8765),i=n.n(s),o=n(7537),c=n.n(o),u=n(8779),l=n.n(u),p=n(1307),d=n.n(p),f=n(5828),_=n(2037),h=n(6653),E=n(1167),S=n(5002),v=n(5670),g=n(5717),T=n(3193),m=n(4434),y=n(9444),O=n(8963);function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return C(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}global.fetch=n(4809);var I=!1,R=n(7577),N={ENVIRONMENT:"Staging"===h.Z.getEnvironment().LABEL?"stage":"prod",ANALYTICS_API_KEY:h.Z.get("ANALYTICS_API_KEY"),ANALYTICS_X_PRODUCT:h.Z.get("ANALYTICS_X_PRODUCT"),ANALYTICS_PROJECT:h.Z.get("ANALYTICS_PROJECT"),ANALYTICS_INGEST_TYPE:h.Z.get("ANALYTICS_INGEST_TYPE"),ANALYTICS_MAX_QUEUED_EVENTS:h.Z.get("ANALYTICS_MAX_QUEUED_EVENTS"),ANALYTICS_DEBOUNCE:h.Z.get("ANALYTICS_DEBOUNCE"),ALLOW_NO_TOKEN:h.Z.get("ALLOW_NO_TOKEN")},k=i()(function e(){var t=this;c()(this,e),l()(this,"getAccessToken",function(e){if(I)return e();g.Z.getAccessToken().then(function(t){e(null,t)}).catch(function(n){t.log("Error getting access token - ".concat(n)),e()})}),l()(this,"log",function(e){D.disk(e)}),l()(this,"getAgent",function(e,t){var n=S.Z.stripPathFromURL(e);T.Z.getNodeTunnelOptionsForURL(n).then(function(e){delete e.agent,t(null,e)},function(e){t(e)})})}),P=new R(new k,N),L=new R(new k,N),D=new y.Z({prefix:"Ingest >"}),x=function(){return i()(function e(){var t=this;c()(this,e),l()(this,"NO_PARAMS",null),l()(this,"session_guid",f.v4()),l()(this,"event_session_tracker",f.v4()),l()(this,"_status",!1),l()(this,"_eventCount",0),l()(this,"_eventInterval",void 0),l()(this,"_macOsVersion_",void 0),l()(this,"_macOsBuildVersion_",void 0),l()(this,"setEventInterval",function(){v.Z.isDebugModeEnabled()&&(t._eventInterval&&t.clearEventInterval(),t._eventInterval=setInterval(function(){t.sendEventValidation(),t.resetEventCount(),t.resetEventSessionGuid()},h.Z.get("ANALYTICS_EVENT_VALIDATION_INTERVAL")))}),l()(this,"clearEventInterval",function(){clearInterval(t._eventInterval),t._eventInterval=void 0}),l()(this,"resetEventCount",function(){t._eventCount=-1}),l()(this,"incrementEventCount",function(){t._eventCount++}),l()(this,"checkIMS",function(e,t){return t["user.service_code"]="creative_cloud",t}),l()(this,"sendEventValidation",function(){v.Z.isDebugModeEnabled()&&D.context({payload:{"event.subcategory":"Metrics","event.subtype":"Ingest","event.value":t._eventCount,"ccxp.event_session_tracker":t.event_session_tracker}}).info("validation")}),l()(this,"resetEventInterval",function(){t.clearEventInterval(),g.Z.getUserId()&&(t.sendEventValidation(),t.resetEventCount(),t.resetEventSessionGuid(),t.setEventInterval())}),l()(this,"getIpAddress",v.Z.memoize(function(){var e=_.networkInterfaces(),t=Object.keys(e).map(function(t){return e[t].filter(function(e){return"IPv4"===e.family&&!e.internal})[0]}).filter(function(e){return e});return t.length>0?t[0].address:""})),l()(this,"resetEventSessionGuid",function(){t.event_session_tracker=f.v4(),D.disk("Updated Event Tracking Session GUID: ".concat(t.event_session_tracker))}),l()(this,"cleanPSDKParameters",function(e,t){return t&&(e["event.language"]=t.productLanguage,e["source.name"]=t.productCode,e["source.version"]=t.productVersion,e["source.device"]="Desktop",e["consumer.name"]="CCX Start",e["consumer.platform"]=v.Z.getOsPlatform(),e["consumer.os_version"]=v.Z.getOsVersion(),e["consumer.version"]=t.ccxVersion),e}),l()(this,"createPayload",function(){var e=a()(d().mark(function e(n,r,a){var s,i,o,c,u,l=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.length>3&&void 0!==l[3]&&l[3]||(s=g.Z.getUserId(),n["event.user_guid"]=s,n=t.checkIMS(s||"",n)),n["event.guid"]=f.v4(),n["event.session_guid"]=n["event.session_guid"]||t.session_guid,n["event.coll_dts"]=(new Date).toISOString(),n["event.dts_start"]=n["event.dts_start"]||(new Date).toISOString(),n["event.dts_end"]=n["event.dts_end"]||(new Date).toISOString(),n["event.workflow"]=n["event.workflow"]||h.Z.analytics.w_CCX_PROCESS,n["event.category"]=h.Z.analytics.c_DESKTOP,n["event.offline"]=E.Z.status===E.Z.OFFLINE,n["event.ip"]=t.getIpAddress(),c=n["event.language"]){e.next=2;break}return e.next=1,T.Z.getOSLocale();case 1:c=e.sent;case 2:if(n["event.language"]=c,n["event.device_guid"]=g.Z.getDeviceID(),n["env.com.name"]=h.Z.analytics.w_CCX_PROCESS,n["env.com.version"]=v.Z.getProcessVersion(),n["source.client_id"]=h.Z.getEnvironment().CLIENT_ID,n["source.platform"]=v.Z.getOsPlatform(),!v.Z.isWindows()){e.next=3;break}u=v.Z.getOsVersion(),e.next=5;break;case 3:return e.next=4,t.getMacOsVersion();case 4:u=e.sent;case 5:if(n["source.os_version"]=u,v.Z.isWindows()){e.next=7;break}return e.next=6,t.getMacOsBuildVersion();case 6:n["ccxp.os_build_version"]=e.sent;case 7:n["ccxp.event_session_tracker"]=n["ccxp.event_session_tracker"]||t.event_session_tracker,n["ccxp.gsdk_enabled"]=O.Z.isEnabled,n["ccxp.gsdk_initialized"]=O.Z.isInitialized;try{n["ccxp.country_code"]=(null===(i=g.Z.getUserInfo())||void 0===i?void 0:i.countryCode)||(null===(o=n["event.language"])||void 0===o?void 0:o.split("_")[1])}catch(e){}return r&&(n=t.cleanPSDKParameters(n,r)),a&&t.addSurfaceAnalytics(n,a),e.abrupt("return",n);case 8:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),l()(this,"reset",function(e){return t.clearEventInterval(),e&&(P=new R(new k,e)),P}),l()(this,"resetOperational",function(e){return t.clearEventInterval(),e&&(L=new R(new k,e)),L}),l()(this,"logProcessEvent",function(){var e=a()(d().mark(function e(n,r,a,s,i,o){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.createPayload(n,r,a,i);case 1:n=e.sent,s&&(s instanceof m.Z||(s=new m.Z(s)),n["event.error_desc"]=s.scrubStatus?t.limitMessageSize(s.description):t.limitMessageSize(v.Z.scrubStack(s.description)),n["event.error_type"]=s.scrubStatus?t.limitMessageSize(s.message):t.limitMessageSize(v.Z.scrubStack(s.message)),n["event.error_code"]=s.code,n["ccxp.underlying_error"]&&(n["ccxp.underlying_error"]=t.limitMessageSize(n["ccxp.underlying_error"]))),i?(I=!0,t.postEvent(n,o),t.flush(!0,function(){I=!1})):t.postEvent(n,o);case 2:case"end":return e.stop()}},e)}));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()),l()(this,"logPollingEvent",function(){var e=a()(d().mark(function e(n,r,a){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.createPayload(n);case 1:n=e.sent,r?(I=!0,t.operationalPostEvent(n,a),t.operationalFlush(!0,function(){I=!1})):t.operationalPostEvent(n,a);case 2:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),l()(this,"operationalPostEvent",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t.incrementEventCount(),L.postEvent(e,n)}),l()(this,"operationalFlush",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};L.flush(e,t)}),l()(this,"flush",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};P.flush(e,t)}),l()(this,"postEvent",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t.incrementEventCount(),P.postEvent(e,n)}),l()(this,"enable",function(e){t._status=e,P.enable(e),L.enable(!0)}),l()(this,"limitMessageSize",function(e){return"'"!==e[0]&&'"'!==e[0]||(e=e.substring(1)),"'"!==e[e.length-1]&&'"'!==e[e.length-1]||(e=e.substring(0,e.length-1)),e.substring(0,h.Z.get("ERR_MESSAGE_SIZE_LIMIT"))}),E.Z.on(E.Z.ONLINE,function(){t.getIpAddress.cache.clear()}),this.setEventInterval()},[{key:"getMacOsVersion",value:(t=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._macOsVersion_){e.next=2;break}return e.next=1,v.Z.getMacVersion();case 1:this._macOsVersion_=e.sent;case 2:return e.abrupt("return",this._macOsVersion_);case 3:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"getMacOsBuildVersion",value:(e=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._macOsBuildVersion_){e.next=2;break}return e.next=1,v.Z.getMacBuildVersion();case 1:this._macOsBuildVersion_=e.sent;case 2:return e.abrupt("return",this._macOsBuildVersion_);case 3:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"addSurfaceAnalytics",value:function(e,t){var n=function(t,n){n&&(e[t]=e[t]||"",e[t].toString().includes(n)||(e[t]+=(e[t].toString().length>0?", ":"")+n))};if(t){var r,a=A(t);try{for(a.s();!(r=a.n()).done;){var s=r.value;s.surface&&n("exp.surface_id",s.surface),s.campaignId&&n("exp.campaign_id",""+(0===s.campaignId?s.ajoCampaignid:s.campaignId)),s.variationId&&n("exp.variation_id",s.variationId),s.treatmentId&&n("exp.treatment_id",s.treatmentId),s.controlGroupId&&n("exp.control_group_id",s.controlGroupId),s.actionBlockId&&n("exp.action_block_id",s.actionBlockId),s.containerLabel&&n("exp.container_name",s.containerLabel),s.containerId&&n("exp.container_id",s.containerId),s.containerStatus&&n("exp.container_status",s.containerStatus)}}catch(e){a.e(e)}finally{a.f()}}return e}}]);var e,t}();const b=Object.assign(new x,h.Z.analytics)},5717:(e,t,n)=>{n.d(t,{Z:()=>x});var r=n(353),a=n.n(r),s=n(9591),i=n.n(s),o=n(7537),c=n.n(o),u=n(8765),l=n.n(u),p=n(9548),d=n.n(p),f=n(3761),_=n.n(f),h=n(5370),E=n.n(h),S=n(8779),v=n.n(S),g=n(1307),T=n.n(g),m=n(6653),y=n(9444),O=n(5670),A=n(989),C=n(1239),I=n(3221),R=n(4434),N=n(2037);function k(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(k=function(){return!!e})()}var P=n(6815),L=n(4147),D=m.Z.getEnvironment();const x=new(function(e){function t(){var e,n,r,a;return c()(this,t),n=this,r=t,r=_()(r),e=d()(n,k()?Reflect.construct(r,a||[],_()(n).constructor):r.apply(n,a)),v()(e,"log",void 0),v()(e,"init",O.Z.memoize(function(){return new Promise(function(t,n){var r=setTimeout(function(){e.log.error(new R.Z("NGL initialization timed out")),t()},m.Z.get("NGL_INITIALIZE_TIMEOUT")),a=P.InitializeProfileUpdates(e.nglConfig,function(){var n=i()(T().mark(function n(a,s){var i,o;return T().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(a&&(m.Z.get("NGL_ERRORS_TO_INFO_LOG").includes(a)?e.log.disk("".concat(m.Z.analytics.NGL_PROFILE_ERROR,": Ignoring ").concat(a," from NGL Library")):e.log.error(new R.Z("Error from NGL Library "+a,m.Z.analytics.NGL_PROFILE_ERROR,a))),i=e.getUserId(),e.setUserProfile(s),o=e.getUserId(),e.isInitialized){n.next=1;break}e.isInitialized=!0,clearTimeout(r),t(),n.next=4;break;case 1:if(!i||o){n.next=2;break}e.log.disk("Received Sign out event with error: ".concat(a)),e.log.context({authenticationDisabled:!1}).info(m.Z.analytics.t_SIGNOUT),I.Z.flush(!0,function(){e.log.disk("Flushed logs due to user sign out event"),e.reset(),e.emit("SIGN_OUT")}),n.next=4;break;case 2:if(o==i){n.next=4;break}return n.next=3,A.Z.updateBackOff({clear:!0,type:A.E.AUTH});case 3:e.log.context({authenticationDisabled:!1}).info(m.Z.analytics.t_SIGNIN),e.emit("SIGN_IN");case 4:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()),s=a.userProfile;e.setUserProfile(s)})},{timeout:-1})),v()(e,"isInitialized",!1),v()(e,"userProfile",void 0),v()(e,"nglforceRefresh",!1),v()(e,"getDeviceID",O.Z.memoize(function(){return Object.values(N.networkInterfaces()).map(function(e){return e[0].mac}).find(function(e){return"00:00:00:00:00:00"!=e})})),v()(e,"getAccessTokenExpiry",O.Z.memoize(function(t){try{var n=JSON.parse(Buffer.from(t.split(".")[1],"base64").toString("utf-8"));return new Date(parseInt(n.created_at)+parseInt(n.expires_in)-1e4)}catch(n){return t&&e.log.error(new R.Z("Failed parsing access token",n)),-1}})),v()(e,"getAccessToken",O.Z.memoize(function(){return new Promise(function(){var t=i()(T().mark(function t(n,r){var a,s,o;return T().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,e.init();case 1:if(a=e.getUserId()){t.next=2;break}return t.abrupt("return",r(new R.Z("Not Logged in").silence()));case 2:if(!A.Z.isWaitingForBackOff(A.E.AUTH)){t.next=3;break}return s="Access Token awaiting global Auth back-off ".concat(A.Z.backOffCause(A.E.AUTH)),e.log.disk(s),t.abrupt("return",r(new R.Z(s,m.Z.analytics.NGL_TOKEN_ERROR).silence()));case 3:(o=e.nglConfig).forceRefresh=e.nglforceRefresh,e.log.disk("Started NGL.GetImsAccessToken."),P.GetImsAccessToken(o,function(){var t=i()(T().mark(function t(s,i){var o,c,u,l,p,d,f,_,h;return T().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.log.disk("Finished NGL.GetImsAccessToken."),e.getUserId()==a){t.next=1;break}return t.abrupt("return",r(new R.Z("User changed").silence()));case 1:if(315!==s){t.next=3;break}return o=new R.Z("Services not provisioned",m.Z.analytics.NGL_TOKEN_ERROR,s.toString()),e.log.error(o),t.next=2,A.Z.updateBackOff({cause:o.message,type:A.E.AUTH});case 2:return t.abrupt("return",r(o));case 3:if(!s||i){t.next=5;break}return c=s.toString(),u="Error from NGL fetching access token: ".concat(s.toString()),l=new R.Z(u,m.Z.analytics.NGL_TOKEN_ERROR,c),e.log.error(l),t.next=4,A.Z.updateBackOff({cause:u,type:A.E.AUTH});case 4:return t.abrupt("return",r(l));case 5:p=0,s&&(p=s instanceof Error?s.code:parseInt(s.toString(),10)||void 0),d=s instanceof Error?s:s instanceof String?new Error(s.toString()):void 0,f={},t.prev=6,f=JSON.parse(i),t.next=9;break;case 7:return t.prev=7,t.catch(6),_=new R.Z("Cannot parse NGL access token response",d,p),e.log.error(_),t.next=8,A.Z.updateBackOff({cause:_.message,type:A.E.AUTH});case 8:return t.abrupt("return",r(_));case 9:if(f.access_token){t.next=11;break}return h="No access token",e.log.error(new R.Z(h,d,p)),t.next=10,A.Z.updateBackOff({cause:h,type:A.E.AUTH});case 10:return t.abrupt("return",r(new R.Z(h,d,p)));case 11:return s&&e.log.disk("Ignoring ".concat(s," from NGL Library while fetching access token")),O.Z.debuggingLogsEnabled()&&e.log.context({authenticationDisabled:!1}).info(m.Z.analytics.t_FETCH,"Successfully obtained access token"),t.next=12,A.Z.updateBackOff({clear:!0,type:A.E.AUTH});case 12:return t.abrupt("return",n(f.access_token));case 13:case"end":return t.stop()}},t,null,[[6,7]])}));return function(e,n){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())},{refresher:e.checkAccessTokenNeedsRefresh.bind(e),timeout:864e5})),e.log=new y.Z({prefix:"IMS > ",payload:{"event.subcategory":m.Z.analytics.sc_AUTH,"event.subtype":m.Z.analytics.st_TOKEN},authenticationDisabled:!0}),e.on("SIGN_IN",function(){I.Z.resetEventInterval()}),e.on("SIGN_OUT",function(){I.Z.resetEventInterval()}),e}return E()(t,e),l()(t,[{key:"nglConfig",get:function(){var e=L.version.split("."),t=a()(e,2),n=t[0],r=t[1];return{clientName:D.CLIENT_NAME,clientId:D.CLIENT_ID,clientSecret:D.VALUE,clientScope:m.Z.get("SCOPES"),clientVersion:"".concat(n,".").concat(r),clientLocale:"en_US",isStage:"Staging"===D.LABEL,forceRefresh:!1}}},{key:"setUserProfile",value:function(e){try{var t,n=this.getUserId();if(this.userProfile=JSON.parse(e),n!==this.getUserId())this.log.disk("Default User: ".concat(null===(t=this.getUserInfo())||void 0===t?void 0:t.userId))}catch(t){this.log.error(new R.Z("Unable to parse user profile from NGL "+JSON.stringify(e,function(e,t){if("enigmaData"!=e)return"UserProfile"==e?{accountType:t.accountType,countryCode:t.countryCode,userId:t.userId}:t},2)))}}},{key:"checkAccessTokenNeedsRefresh",value:function(e){var t=e.state,n=e.value;return"pending"!==t&&("resolved"!==t||!n||this.getAccessTokenExpiry(n)<new Date)}},{key:"getUserInfo",value:function(){var e;return null===(e=this.userProfile)||void 0===e?void 0:e.UserProfile}},{key:"getUserId",value:function(){var e;return null===(e=this.getUserInfo())||void 0===e?void 0:e.userId}},{key:"getFullProfile",value:function(){return this.userProfile}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.nglforceRefresh=e,this.log.info(m.Z.analytics.t_CLEAR),this.getAccessToken.cache&&this.getAccessToken.cache.clear()}},{key:"shutdown",value:function(){this.removeAllListeners(),P.Shutdown()}}])}(C.EventEmitter))},6653:(e,t,n)=>{n.d(t,{Z:()=>_});var r=n(7537),a=n.n(r),s=n(8765),i=n.n(s),o=n(8779),c=n.n(o),u=n(5828);const l=require("fs");var p=n(855),d=n(2669),f=function(){return i()(function e(){a()(this,e),c()(this,"config",{ENVIRONMENT:"production",SETTINGS_FILE:"settings.json",SETTINGS_FILE_VERSION:3,LOOKUP_MAP_FILE:"map.json",enable_gsdk_ghost_content:!1,debugging_logs:{enabled:!1},ccxp_gsdk_config:{min_supported_version:"1.2.0",shutdown_timeout:6e3,startup_timeout:8e3,login_timeout:8e3},GSDK_AEFT:{supported_version:"24.0"},GSDK_IDSN:{supported_version:"18.0"},GSDK_ILST:{supported_version:"26.0"},GSDK_PHXS:{supported_version:"25.0"},GSDK_PPRO:{supported_version:"24.0"},GSDK_SPRK:{supported_version:"54.0"},GSDK_APP_CODE_MAPPINGS:{PHXS:"PHSP"},GSDK_FLAG_PRODUCT_ALIAS:{AEFT:"AEFT",AEFTBETA:"AEFT",PHXS:"PHXS",PHSP:"PHXS",PHSPPR:"PHXS",PHSPBETA:"PHXS",PPRO:"PPRO",PPROBETA:"PPRO",IDSN:"IDSN",IDSNBETA:"IDSN",IDSNPR:"IDSN",ILST:"ILST",ILSTBETA:"ILST",ILSTPR:"ILST",SPRK:"SPRK",SPRKDV:"SPRK"},UPDATE_CONSUMER_THROTTLE:5e3,UPDATE_CONSUMERS_WAIT:5e3,CLIENT_SURFACE_MAPPING:{CCD_ALL_APPS_BANNERS:"CCD",CCD_APPS_CATALOG:"CCD",CCD_APP_SKELETON:"CCD",CCD_PMP:"CCD",CCD_USER_FEEDBACK:"CCD",CCD_HOME_SKELETON:"CCD",CCD_FRAMEWORK:"CCD",CCD_QUICK_ACTIONS:"CCD",payment_notification_banner:"CCD",CCD_APPS_SKELETON:"CCD",CCD_APPS_CUSTOM_CARDS:"CCD",CCD_GENESIS:"CCD",CCD_FFE:"CCD","CCX_Start_5.11_Stock":"COLLECTION_TEMPLATES",Discover_Panel:"DISCOVER_PANEL",DP_Tool_Techniques_v1:"DISCOVER_PANEL",in_app_contextual_notifications:"DISCOVER_PANEL","CCX_Start_4.0_Toast":"FIRST_MILE","CCX_Start_4.0_Home":"FIRST_MILE","CCX_Start_4.0_Whats_New":"FIRST_MILE","CCX_Start_4.0_View_Plans":"FIRST_MILE",PES_FEATURES:"FIRST_MILE",illustrator_workspace:"ILLUSTRATOR",illustrator_high_value_action:"ILLUSTRATOR",illustrator_feature_flags:"ILLUSTRATOR",PES_BROWSE_LEARN:"LEARN","CCX_Start_3.1_Tutorials":"LEARN",LCM_LEARN_PANEL:"LEARN",PES_ATLAS:"LEARN",PES_WHATS_NEW:"LEARN",Ps_Feature_Flag:"Photoshop",sensei_model:"SENSEI_MODELS",NPS_SURVEY:"SURVEY",GHOST_CCD_ALL_APPS_BANNERS:"GHOST",GHOST_CCD_APPS_CATALOG:"GHOST",GHOST_CCD_APP_SKELETON:"GHOST",GHOST_CCD_PMP:"GHOST",GHOST_CCD_USER_FEEDBACK:"GHOST",GHOST_CCD_HOME_SKELETON:"GHOST",GHOST_CCD_FRAMEWORK:"GHOST",GHOST_CCD_QUICK_ACTIONS:"GHOST",GHOST_payment_notification_banner:"GHOST",GHOST_CCD_APPS_SKELETON:"GHOST",GHOST_CCD_APPS_CUSTOM_CARDS:"GHOST",GHOST_CCD_GENESIS:"GHOST",GHOST_CCD_FFE:"GHOST","GHOST_CCX_Start_5.11_Stock":"GHOST",GHOST_Discover_Panel:"GHOST",GHOST_DP_Tool_Techniques_v1:"GHOST",GHOST_in_app_contextual_notifications:"GHOST","GHOST_CCX_Start_4.0_Toast":"GHOST","GHOST_CCX_Start_4.0_Home":"GHOST","GHOST_CCX_Start_4.0_Whats_New":"GHOST","GHOST_CCX_Start_4.0_View_Plans":"GHOST",GHOST_illustrator_workspace:"GHOST",GHOST_illustrator_high_value_action:"GHOST",GHOST_illustrator_feature_flags:"GHOST",GHOST_illustrator_workspace_config:"GHOST",GHOST_PES_BROWSE_LEARN:"GHOST",GHOST_PES_ATLAS:"GHOST",GHOST_PES_WHATS_NEW:"GHOST",GHOST_PES_FEATURES:"GHOST","GHOST_CCX_Start_3.1_Tutorials":"GHOST",GHOST_LCM_LEARN_PANEL:"GHOST",GHOST_Ps_Feature_Flag:"GHOST"},GSDK_CONTAINER_SCHEMA:{id:"/GSDK_CONTAINER_RESPONSE",type:"object",properties:{status:{type:"string"},source:{type:"string"},rootAssetMetadata:{type:"array",minItems:1},monitoringData:{type:"object"}},required:["rootAssetMetadata"]},FILE_ACCESSOR_WRITE_FOLDER:"clientLogs",FILE_ACCESSOR_FILE_COUNT_LIMIT:500,FILE_ACCESSOR_WRITE_VERSION:1,BPO_DEFAULT_LAUNCH_INTERVAL:864e5,BPO_SYNC_TRIGGERED_SET_LAUNCH_DELAY:6e4,BPO_NEXT_LAUNCH_THRESHOLD:18e5,BPO_QUIT_DISABLED_WINDOW:216e5,SUPPORTED_FILE_WRITE_VERSIONS:[1],FILE_ACCESS_MAP_FILE:"api.json",FILE_ACCESS_MAP_FILE_VERSION:1,FILE_ACCESS_RENAME_THROTTLE:36e5,BPO_MAX_RESTARTS:4,BPO_MINIMUM_RUN_TIME:18e5,BPO_RESET_BUFFER:6e5,BPO_LAUNCH_DIFFERENTIAL_WINDOW:6e5,BPO_SUMMARY_FUTURE_DATE:1728e5,BPO_RUNNING_APPS:[{appCode:"PHSP",minVersion:"21.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"PHXS",minVersion:"21.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"PHSPBETA",minVersion:"21.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"PHSPPR",minVersion:"21.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"SPRK",minVersion:"31.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"SPRKDV",minVersion:"31.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"ILST",minVersion:"24.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"ILSTBETA",minVersion:"24.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"ILSTPR",minVersion:"24.1",maxVersion:"999999999999",checkIfRunning:!1},{appCode:"IDSN",minVersion:"16.0",maxVersion:"17.4",checkIfRunning:!1},{appCode:"IDSNBETA",minVersion:"16.0",maxVersion:"17.4",checkIfRunning:!1},{appCode:"IDSNPR",minVersion:"16.0",maxVersion:"17.4",checkIfRunning:!1},{appCode:"AEFT",minVersion:"18.1",maxVersion:"22.5",checkIfRunning:!1},{appCode:"AEFTBETA",minVersion:"18.1",maxVersion:"22.5",checkIfRunning:!1},{appCode:"PPRO",minVersion:"14.5",maxVersion:"22.5",checkIfRunning:!1},{appCode:"PPROBETA",minVersion:"14.5",maxVersion:"22.5",checkIfRunning:!1}],UNSUPPORTED_MACOS_VERSIONS:22,ERR_MESSAGE_SIZE_LIMIT:1024,ASSETS_DIRNAME:"assets",CC_SETTINGS_FILE:"C3Config.xml",CONSOLE_LOGGING:!1,SCOPES:"openid,AdobeID,pps.read",FILE_ACCESSOR_WRITE_ENABLED:!1,FILEACCESSOR_WRITE_SLA:864e5,FILEACCESSOR_WRITE_TIME_BUFFER:3e5,MAX_ACCESSOR_FILE_SIZE:102400,SYNC_INITIAL_RETRY:24e4,KILLED_BEFORE_RESPONSE_INITIAL_RETRY:1e3,MAX_LOG_SIZE:5242880,PROXY_REQUEST_TIMEOUT:2e3,CLIENT_REQUEST_TIMEOUT:9e5,USER_ANALYTICS__REQUEST_TIMEOUT:2e3,GET_NOTIFICATION_DATA_TIMEOUT:2e3,NETWORK_STATUS_INTERVAL:1e3,NETWORK_MAX_LATENCY:3e3,NETWORK_MAX_SOCKETS:1,NETWORK_MAX_LATENCY_RETRIES:20,NETWORK_MINIMUM_PARTIAL_SIZE:524288,STOP_SYNCING_BEYOND:4284e5,CCXP_DEFAULT_STARTUP_TIME:0,MAX_STEP_DEFAULT_COMPLETION_TIME:0,MAX_STEP_DEFAULT_IMPACT:0,HEALTH_POLL_INTERVAL:864e5,INITIAL_HEALTH_MEASUREMENT_DELAY:18e4,FEATURE_FLAG_CONFIG_CHECK_INTERVAL:144e5,override_health_metrics_collection_frequency:{enabled:!1,CPU_COLLECTION_INTERVAL:6e4,CPU_ROLLING_AVERAGE_BUCKET:5,CPU_ROLLING_AVERAGE_THRESHOLD_PERCENTAGE:5},CCXP_FEATURE_FLAGS_LOCAL_OVERRIDE:!1,CPU_POLL_DURATION:6e4,DEFAULT_MEMOIZE_TIMEOUT:6e4,MAX_BACK_OFF:864e5,ON_DEMAND_ASSET_TIMEOUT:6e5,RETRYABLE_ERRORS:["ECONNRESET","ETIMEDOUT","ECONNREFUSED","LOCAL_RETRY","ERR_SSL_DECRYPTION_FAILED_OR_BAD_RECORD_MAC","ABORT_ERROR"],NGL_ERRORS_TO_INFO_LOG:[403,407,408],EMBARGO_BACK_OFF:20736e5,RETRYABLE_DEFAULT_ATTEMPTS:8,GLOBAL_BACKOFF_SYNC_THROTTLE:1e4,ONLINE_SYNC_THROTTLE:1e4,OFFLINE_SYNC_THROTTLE:1e4,LEARN_DEFAULT_EXPIRATION:2592e5,ASSET_DEFAULT_EXPIRATION:2592e5,KILLSWITCH_MEMOIZE_TIMEOUT:864e5,TEMP_KILL_SWITCH_REGISTRY_KEY:"\\SOFTWARE\\Policies\\Adobe\\CCXProcess",TEMP_KILL_SWITCH_PLIST_PATH:"/Library/Preferences/com.adobe.CCXProcess.plist",TEMP_DEFAULT_TEMPLATES_DOWNLOADED:100,TEMP_STOCK_TEMPLATE_DOWNLOAD_LIMIT_REGISTRY_SETTING:"TempStockDownloadLimit",TEMP_CCD_CONTENT_DOWNLOAD_REGISTRY_SETTING:"TempCCDContentDownloadDisabled",TEMP_CCD_CONTENT_DOWNLOAD_DISABLED:!1,TEMP_SENSEI_MODELS_CONTENT_DOWNLOAD_REGISTRY_SETTING:"TempSenseiModelContentDownloadDisabled",TEMP_SENSEI_MODELS_CONTENT_DOWNLOAD_DISABLED:!1,TEMP_NETWORK_STATUS_REGISTRY_SETTING:"TempNetworkStatusDisabled",TEMP_NETWORK_STATUS_DISABLED:!1,LAUNCH_AGENT:"".concat(process.env.HOME,"/Library/LaunchAgents/com.adobe.ccxprocess.plist"),LAUNCH_DIRECTORY:"".concat(process.env.HOME,"/Library/LaunchAgents/"),NGL_INITIALIZE_TIMEOUT:3e5,TIER_1_LOCALES:["en_US","fr_FR","de_DE","ja_JP","ko_KR"],SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","en_AE","en_GB","en_IL","es_ES","es_MX","fi_FI","fr_FR","fr_CA","fr_MA","hu_HU","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","tr_TR","uk_UA","zh_CN","zh_TW"],DOWNLOAD_ASSET_TIMEOUT:6e4,DNS_CACHE_DURATION:24e4,MAX_EPERM_RENAMES:10,NUM_CONCURRENT_REQUESTS:10,MIN_RANDOMIZED_TIME:1e3,MAX_RANDOMIZED_TIME:9e5,MAX_RANDOMIZED_TIME_SHORT:3e4,TIME_FOR_SHORT_RANDOMIZE:36e5,FILE_ACCESSOR_RETRY_FOR_EMPTY_LOOKUPMAP:864e5,MAX_TIMEOUT:Math.pow(2,31)-1,MIN_TIMEOUT:36e6,NETWORK_POLL_INTERVAL:36e5,DNS_RESOLVE_TIMEOUT:2e3,MIN_REFRESH:6e4,TRIAL_DAYS:7,USER_INTENT_DIALOG:"User Intent Dialog",USER_INTENT_SUPPORTED_PLAYLIST_TYPES:["playlist"],USER_INTENT_SUPPORTED_UTUT_TYPES:["helpUsing","inApp","helpLearn"],PRODUCT_LIST:["PHXS","PHSP","PHSPBETA","PHSPPR","IDSN","IDSNBETA","IDSNPR","PPRO","PPROBETA","ILST","ILSTBETA","ILSTPR","AEFT","AEFTBETA","SPRK","SPRKDV","CCXP"],IGNORED_FILES_REGEXP:"\\bassets|api|clientLogs|client_settings\\b",NODE_AID_RESPONSE_SCHEMA:{id:"NODE_AID_RESPONSE",type:"object",properties:{ProductsInfo:{type:"object",properties:{ProductInfo:{type:"array",minItems:1,items:{type:"object",properties:{SAPCode:{type:"array",items:{type:"string"}},CodexVersion:{type:"array",items:{type:"string"}},Platform:{type:"array",items:{type:"string"}},InstallerType:{type:"array",items:{type:"string"}},IsUWPProduct:{type:"array",items:{type:"string"}},InstallLanguage:{type:"array",items:{type:"string"}},DisplayName:{type:"array",items:{type:"string"}},BuildVersion:{type:"array",items:{type:"string"}},LaunchString:{type:"array",items:{type:"string"}}}}}},required:["ProductInfo"]}},required:["ProductsInfo"]},MAP_DATA_SCHEMA:{id:"MAP_DATA",type:"object",properties:{versionInfo:{type:"object"},metadata:{type:"object"},assetMetadata:{type:"object"},version:{type:"number"}},required:["versionInfo","metadata","assetMetadata","version"]},SOPHIA_RESPONSE_SCHEMA:{id:"/SOPHIA_RESPONSE",type:"object",properties:{analyticsData:{type:"object",properties:{responseGUID:{type:"string"}}},surfaces:{type:"object",additionalProperties:{type:"object",properties:{containers:{type:"array",items:{type:"object",properties:{data:{type:"string",dataType:"string"},containerAnalyticsData:{type:"object"}}}},surfaceAnalyticsData:{type:"object",properties:{surfaceId:{type:"string"}}}}}},expirationDTS:{type:"string"},version:{type:"number"}},required:["expirationDTS","surfaces"]},VULCAN_PREFIX:"vulcan.SuiteMessage.",VULCAN_STARTUP_MESSAGE:"ccxprocess.Initialized",VULCAN_PING_REQUEST:"ccxprocess.in.request.app.ping",VULCAN_PING_RESPONSE:"ccxprocess.out.response.app.ping",VULCAN_PSDK_FEED_REQUEST:"ccxprocess.PSDKFeedRequest",VULCAN_PSDK_FEED_RESPONSE:"ccxprocess.PSDKFeedResponse",VULCAN_PSDK_FEED_BROADCAST:"ccxprocess.PSDKFeedBroadcast",VULCAN_LEARN_REQUEST:"ccxprocess.LearnRequest",VULCAN_LEARN_RESPONSE:"ccxprocess.LearnResponse",VULCAN_LEARN_USAGE_MARKER:"ccxprocess.LearnUsageMarker",VULCAN_LEARN_BROADCAST:"ccxprocess.LearnBroadcast",VULCAN_GET_USER_REQUEST:"ccxprocess.GetUserRequest",VULCAN_GET_USER_RESPONSE:"ccxprocess.GetUserResponse",VULCAN_START_SETTINGS_REQUEST:"ccxprocess.StartSettingsRequest",VULCAN_START_SETTINGS_GET_REQUEST:"ccxprocess.StartSettingsGetRequest",VULCAN_START_SETTINGS_GET_RESPONSE:"ccxprocess.StartSettingsGetResponse",VULCAN_START_SETTINGS_PATCH_UPDATE:"ccxprocess.StartSettingsPatchUpdate",VULCAN_STOCK_REQUEST:"ccxprocess.StockTemplateRequest",VULCAN_STOCK_RESPONSE:"ccxprocess.StockTemplateResponse",VULCAN_CC_PHOTO_DOWNLOAD_REQUEST:"ccxprocess.CCPhotoDownloadRequest",VULCAN_CC_PHOTO_DOWNLOAD_RESPONSE:"ccxprocess.CCPhotoDownloadResponse",VULCAN_CC_PHOTO_DOWNLOAD_PROGRESS:"ccxprocess.CCPhotoDownloadProgress",VULCAN_CC_PHOTO_DOWNLOAD_ERROR:"ccxprocess.CCPhotoDownloadError",VULCAN_AVATAR_REQUEST:"ccxprocess.UserAvatarRequest",VULCAN_AVATAR_RESPONSE:"ccxprocess.UserAvatarResponse",VULCAN_AVATAR_REQUEST_V2:"ccxprocess.AvatarRequest",VULCAN_AVATAR_RESPONSE_V2:"ccxprocess.AvatarResponse",SKIP_LOGGING_MESSAGE_LIST:["ccxprocess.in.request.app.ping","ccxprocess.out.response.app.ping"],SKIP_LOGGING_MESSAGE_CONTENT:["ccxprocess.in.request.app.ping","ccxprocess.out.response.app.ping","adbproduct.app.UserContextDataResponse","accc.app.ProxySettingsResponse","any.accc.app.ProxySettingsChanged","any.accc.app.UserContextData"],NOTIFICATION_REQUEST:"accc.notifications",NOTIFICATION_PSDK_RESPONSE:"ccxprocess.notification.psdk",NOTIFICATION_STOCK_RESPONSE:"ccxprocess.notification.stock",NOTIFICATION_FORCE_REFRESH_RESPONSE:"ccxprocess.notification.force-refresh",NOTIFICATION_PSDK_QUERY_DATA_BY_ID_RESPONSE:"ccxprocess.notification.psdk.byID.data",NOTIFICATION_STOCK_QUERY_DATA_BY_ID_RESPONSE:"ccxprocess.notification.stock.byID.data",NOTIFICATION_PSDK_QUERY_DATA_BY_TIME_RESPONSE:"ccxprocess.notification.psdk.byTime.data",NOTIFICATION_STOCK_QUERY_DATA_BY_TIME_RESPONSE:"ccxprocess.notification.stock.byTime.data",NOTIFICATION_FORCE_REFRESH_QUERY_DATA_BY_TIME_RESPONSE:"ccxprocess.notification.force-refresh.byTime.data",ANS_PSDK_NOTIFICATION_TYPE:"com.adobe.psdk.v1",ANS_PSDK_NOTIFICATION_SUB_TYPE:"operational.profile.updated",ANS_STOCK_NOTIFICATION_TYPE:"com.adobe.stock",ANS_STOCK_NOTIFICATION_SUB_TYPE:"templates.update",ANS_FORCE_REFRESH_NOTIFICATION_TYPE:"com.adobe.accc.generic.v1",ANS_FORCE_REFRESH_NOTIFICATION_SUB_TYPE:"esdk.force.refresh",ANS_NUJ_REFRESH_NOTIFICATION_TYPE:"com.adobe.dunamis",ANS_NUJ_REFRESH_NOTIFICATION_SUB_TYPE:"profile.state.change",ANS_CCXP_LAUNCH_CONDITION:"true",USER_ANALYTICS_ENABLED:!1,ANALYTICS_INGEST_PATH:"/ingest",ANALYTICS_X_PRODUCT:"CCXStart/2.5",ANALYTICS_PROJECT:"ccx-process-service",ANALYTICS_INGEST_TYPE:"dunamis",ANALYTICS_API_KEY:"ccx-process-service",ANALYTICS_MAX_QUEUED_EVENTS:600,ANALYTICS_DEBOUNCE:1e4,ALLOW_NO_TOKEN:!0,ANALYTICS_EVENT_VALIDATION_INTERVAL:144e5,UNSUPPORTED_WINDOWS_UXP_APPS:["PHXS","PHSP","PHSPBETA","PHSPPR","ILST","ILSTBETA","ILSTPR","SPRK","SPRKDV","SPRKPR","IDSN","IDSNBETA","IDSNPR","PPRO","PPROPR","PPROBETA","AEFT","AEFTPR","AEFTBETA"],EARLIEST_SUPPORTED_WINDOWS_VERSION_UXP:"6.2",SUPPORTED_LEARN_THIRD_PARTY_START_MIN_VERSION:"2.7",PRODUCT_PRIORITY:{PHXS:9,ILST:8,IDSN:7,PPRO:6,AEFT:5,SPRK:4,DRWV:3,FLPR:2,MUSE:1},DEFAULT:{LOOKUP_MAP_FILE_VERSION:2,URL_STAGING:"https://p13n-stage.adobe.io/psdk/v2/content",URL_PRODUCTION:"https://p13n.adobe.io/psdk/v2/content",SUPPORTED_PRODUCTS:{},LOOKUP_COLLECTION_FILE_VERSION:1,PRIORITY_CHANNEL:d.NU.Unknown,HTTP_STATUS_HEAD_CHECK_URL:"https://odin.adobe.com/content/odin/home.html",DNS_RESOLVE_STATUS_CHECK_URL:"https://p13n.adobe.io"},OZ:{LOG_PREFIX:"Oz"},ANALYTICS:{w_CCX_PROCESS:"CCX Process",w_NOTIFICATION:"Notification",w_INTERNAL:"Internal",c_DESKTOP:"DESKTOP",SOPHIA_CARDS:"Sophia Cards",UTUTS:"Ututs",GSDK:"GSDK",sc_CONFIG_SETTINGS:"Config Settings",sc_CUSTOM_HOOK:"CustomHook.ts",sc_PROCESS:"Process",sc_APP_LIFECYCLE_MANAGER:"Lifecycle",sc_SOPHIA:"Sophia",sc_STOCK:"Stock",sc_LEARN:"Learn",sc_CCX_START:"CCX Start",sc_CC_PHOTO:"CC Photo",sc_LR_CONTENT:"Lightroom Content",sc_CC_SEARCH:"CC Search",sc_OZ:"Oz",sc_CC_SEARCH_STORAGE:"CC Storage",sc_UTUTS:"Ututs",sc_LCM:"LCM",sc_RECOMMMENDATIONS:"Recommendations",sc_USER_INTENT_RECOMMENDATIONS:"UserIntentRecommendations",sc_AUTH:"Auth",sc_AVATAR:"Avatar",sc_FORCE_REFRESH:"Force Refresh",sc_CCX_FILE_DOWNLOAD:"CCX Start File Download",sc_PULSE:"Pulse",sc_Network:"Network",sc_Proxy:"Proxy",sc_METRICS:"Metrics",sc_GSDK:"GSDK",t_INSTALL:"install",t_UNINSTALL:"uninstall",t_UPDATE:"update",t_INIT:"init",t_START:"start",t_REQUEST:"request",t_RESPONSE:"response",t_SIGNOUT:"signout",t_SIGNIN:"signin",t_FETCH:"fetch",t_CLEAR:"clear",t_PERFORMANCE:"performance",t_APP:"app",t_INFO:"info",t_WARNING:"warning",t_SUMMARY:"summary",t_QUIT:"quit",st_PROCESS:"process",st_API:"api",st_ANS:"ans",st_CC_PHOTOS:"cc photos",st_NETWORK:"network",st_CLIENT:"client",st_TOKEN:"token",st_RECEIVED:"received",st_FINISHED:"finished",st_RUNNING:"running",st_STATUS:"status",st_SETTINGS:"settings",st_DEBUG:"debug",st_ACCESSOR:"file accessor",st_PROFILING:"ccxp profiler",st_AID:"aid",st_GSDK_GENERAL:"gsdk",st_GSDK_START:"gsdk-startup",st_GSDK_SHUTDOWN:"gsdk-shutdown",st_GSDK_LOGIN:"gsdk-login",st_GSDK_LOGOUT:"gsdk-logout",st_GSDK_CONTENT_REQUEST:"gsdk-request",st_GSDK_UPDATE:"gsdk-update",LOOKUP_MAP_ERROR:"Lookup Map Save",ACCESSOR_WRITE_SUCCESS:"File Accessor Write API Success",ERROR:"error",NO_ERROR:null,AGGREGATE_ERROR:"Aggregate Error",AGGREGATE_ERROR_DESCRIPTION:" aggregation error.",GSDK_AGGREGATE_ERROR:"GSDK Aggregate Error",PARAM_VALIDATION_ERR:"Param Validation Error",PAYLOAD_PARSE_FAIL:"Fail to parse payload",UNEXPECTED_ANS_MSG:"Received unexpected ANS message",PARSE_MSG_FAIL:"Fail to parse message",GET_NOTIFICATION_DATA:"Get Notification Data By ID",DATA_VALIDATION_ERR:"Data Validation Error",GC_ERROR:"GC Error",NETWORK_ERR:"Network Error",IO_ERR:"I/O Error",ACCESSOR_WRITE_FILE_ERROR_TYPE:"write_client",ACCESSOR_CLIENT_ERROR_TYPE:"client_input",ACCESSOR_WRITE_ERROR_NO_PARAMS_CODE:"X_ACCESSOR_NO_PARAMS",ACCESSOR_WRITE_ERROR_NO_CONTENT:"X_ACCESSOR_NO_CONTENT",ACCESSOR_WRITE_ERROR_CREATING_DIR_CODE:"X_ACCESSOR_CREATING_DIR",ACCESSOR_WRITE_ERROR_READING_DIR_CODE:"X_ACCESSOR_READING_DIR",ACCESSOR_WRITE_ERROR_INVALID_VERSION_CODE:"X_ACCESSOR_INVALID_VERSION",ACCESSOR_WRITE_ERROR_INVALID_TIMESTAMP_CODE:"X_ACCESSOR_INVALID_TIMESTAMP",ACCESSOR_WRITE_ERROR_TIMESTAMP_FUTURE_CODE:"X_ACCESSOR_INVALID_TIMESTAMP_FUTURE",ACCESSOR_WRITE_ERROR_TIMESTAMP_OLDER_CODE:"X_ACCESSOR_TIMESTAMP_OLDER",ACCESSOR_WRITE_ERROR_NO_USER_CODE:"X_ACCESSOR_WRITE_NO_USER",ACCESSOR_WRITE_ERROR_NO_PATH_DESCRIPTION_CODE:"X_ACCESSOR_WRITE_NO_PATH_DESCRIPTION",ACCESSOR_WRITE_ERROR_FILE_TYPE_CODE:"X_ACCESSOR_WRITE_FILE_TYPE",ACCESSOR_WRITE_ERROR_FILE_SIZE_CODE:"X_ACCESSOR_WRITE_FILE_SIZE",ACCESSOR_WRITE_ERROR_FILE_INVALID_JSON_CODE:"X_ACCESSOR_WRITE_INVALID_JSON",ACCESSOR_READ_ERROR_CODE:"X_ACCESSOR_READ_SAVE",ACCESSOR_WRITE_DISPLAY_ID_NOT_FOUND_CODE:"X_ACCESSOR_DISPLAY_ID_NOT_FOUND",ACCESSOR_READ_RENAME_ERROR_CODE:"X_ACCESSOR_READ_RENAME",ACCESSOR_ERROR_TYPE:"File_Accessor_Save",LR_PHOTO_DOWNLOAD_ERR:"Lightroom Photo Download Error",NO_DATA:"No data to save",NO_STOCK_PARAMS:"No Stock Params",MISSING_DATA:"Missing Data",SIGNED_OUT:"User Signed Out",OFFLINE_ERROR:"Offline",INVALID_JSON:"Invalid JSON",NGL_PROFILE_ERROR:"NGL Profile",NGL_TOKEN_ERROR:"NGL Token",AID_GET_INSTALLED_APPS_ERROR:"AID Installed App Sync DB Error",AID_APP_RUNNING_ERROR:"Get App Running",ONLINE_SYNC_ERROR:"Online Sync Error",FLOODGATE_RESPONSE_INVALID_JSON:"Invalid Json from Floodgate",FLOODGATE_RESPONSE_INVALID_JSON_CODE:"X_FLOODGATE_RESPONSE_INVALID_JSON",FLOODGATE_RESPONSE_INVALID_JSON_CACHE:"Invalid Json from FG Cache",FLOODGATE_RESPONSE_INVALID_JSON_CACHE_CODE:"X_FLOODGATE_RESPONSE_INVALID_JSON_CACHE",FLOODGATE_FAILURE_PROCESSING_JSON:"Failure to save & process FG JSON to settings file",FLOODGATE_FAILURE_PROCESSING_JSON_CODE:"X_FLOODGATE_FAILURE_PROCESSING_JSON_CODE",INVALID_COLLECTION:"Invalid Collection Data",READ_ASSET_FAILURE:"READ_CACHED_ASSET_FAILURE",DEBUG_INTERFACE:"DEBUG Interface",SCHEDULER_WRITE_FILE_ERROR_TYPE:"Scheduler write",SCHEDULER_WRITE_ERROR_CREATING_DIR_CODE:"X_SCHEDULER_CREATING_DIR",SCHEDULER_WRITE_ERROR_WRITING_FILE:"X_SCHEDULER_WRITING_FILE",SCHEDULER_EXEC_ERROR_TYPE:"Scheduler exec",SCHEDULER_EXEC_ERROR_JOB_SCHEDULING:"X_SCHEDULER_JOB_SCHEDULING",GSDK_EMPTY_CACHED_CONTENT_ERROR:"GSDK_EMPTY_CACHED_CONTENT_ERROR",GSDK_CACHED_CONTENT_FAILURE:"GSDK_CACHED_CONTENT_FAILURE",GSDK_SYNC_FAILURE:"GSDK_SYNC_FAILURE",GSDK_PENDING_CONTENT:"GSDK_PENDING_CONTENT",GSDK_LOGIN_USER_FAILURE:"GSDK_LOGIN_USER_FAILURE",GSDK_LOGOUT_USER_FAILURE:"GSDK_LOGOUT_USER_FAILURE",GSDK_SHUTDOWN_FAILURE:"GSDK_SHUTDOWN_FAILURE",GSDK_STARTUP_FAILURE:"GSDK_STARTUP_FAILURE",GSDK_LOGIN_FAILURE:"GSDK_LOGIN_FAILURE",GSDK_CONTENT_UPDATE_FAILURE:"GSDK_CONTENT_UPDATE_FAILURE",GSDK_SAVE_CACHED_ASSET_FAILURE:"GSDK_SAVE_CACHED_ASSET_FAILURE",GSDK_READ_CACHED_ASSET_FAILURE:"GSDK_READ_CACHED_ASSET_FAILURE",GSDK_SCHEMA_VALIDATION_ERROR:"GSDK_SCHEMA_VALIDATION_ERROR",GSDK_UPDATE_CONTENT_FAILURE:"GSDK_UPDATE_CONTENT_FAILURE",GSDK_URL_MISSING_ERROR:"GSDK_URL_MISSING_ERROR",GSDK_NO_TARGETING_CAMPAIGN:"GSDK_NO_TARGETING_CAMPAIGN",GSDK_NO_ERROR_OBJECT_IN_FAILED_CONTAINER:"GSDK_NO_ERROR_OBJECT_IN_FAILED_CONTAINER",GSDK_NO_ERROR_CODE_IN_FAILED_CONTAINER:"GSDK_NO_ERROR_CODE_IN_FAILED_CONTAINER",USER_ID_MISMATCH:"GSDK_USER_MISMATCH",GSDK_USER_LOGGED_IN:"GSDK_IN_CCXP_OUT",GSDK_USER_LOGGED_OUT:"GSDK_OUT_CCXP_IN",CCXP_USER_DIFFERENT:"USER_MISMATCH",GSDK_ERROR_PREFIX:"GSDK_"},ON_DEMAND_REQUEST_SCHEMA:{id:"/ON_DEMAND_REQUEST_SCHEMA",type:"object",properties:{params:{type:"object"},requestId:{type:"string"},version:{type:"integer",maximum:1,minimum:1},force:{type:"object",properties:{type:{type:"string",pattern:"stale|always|none"},depth:{type:"integer",minimum:0,maximum:2}}},analytics:{type:"object"},required:["version","params","requestId"]}},ON_DEMAND_LIST_REQUEST_SCHEMA:{id:"/ON_DEMAND_LIST_REQUEST_SCHEMA",type:"object",properties:{params:{type:"object"},requestId:{type:"string"},version:{type:"integer",maximum:1,minimum:1},required:["version","params","requestId"]}},SERVICE_REQUEST_SCHEMA:{id:"/SERVICE_REQUEST_SCHEMA",type:"object",properties:{params:{type:"object",properties:{productCode:{type:"string"},productLanguage:{type:"string"},productVersion:{type:"string"}},required:["productCode","productLanguage","productVersion"]},requestId:{type:"string"},version:{type:"integer",maximum:1,minimum:1},displayed:{type:"string"},urgent:{type:"boolean"},updateLastUseTime:{type:"boolean"},force:{type:"object",properties:{type:{type:"string",pattern:"stale|always|none"},depth:{type:"integer",minimum:0,maximum:2}}},analytics:{type:"object"},required:["version","params","requestId"]}},FORCE_REFRESH_SCHEMA:{id:"/FORCE_REFRESH_SCHEMA",type:"object",properties:{expire:{type:"object",properties:{AVATAR:{type:["boolean","array"]},CCD:{type:["boolean","array"]},DISCOVER_PANEL:{type:["boolean","array"]},FIRST_MILE:{type:["boolean","array"]},LEARN:{type:["boolean","array"]},SENSEI_MODELS:{type:["boolean","array"]},STOCK:{type:["boolean","array"]},Photoshop:{type:["boolean","array"]},ILLUSTRATOR_FLAGS:{type:["boolean","array"]},ILLUSTRATOR:{type:["boolean","array"]}}},force:{type:"object",properties:{type:{enum:["stale","always","none"]},depth:{type:"integer",minimum:0,maximum:2}},required:["type"]}},required:["expire"]},CC_DIR:"",ROOT_DIR:"",LOG_DIR:"",DOWNLOAD_TMP_EXTENSION:"",PROGRESS_THROTTLE_INTERVAL:0,TMP_PHOTOS_DOWNLOAD_DIRECTORY:"",FILE_FOLDER_SUMMARY_FILE:"ClientFolderSummary.json",STOCK_API_PATH:"",STOCK_API_ROOT:"",CC_SEARCH_IDENTIFIER:"ccsearch-component-service",CC_TOUT_DOWNLOAD_IDENTIFIER:"ccxstart-download-file",UTUTS_SERVICE:{URL_STAGING:"https://utut-service.adobe.com/api/ututs",URL_PRODUCTION:"https://utut-service.adobe.com/api/ututs"},PLAYLIST_SERVICE:{URL_STAGING:"https://learnplaylistservice.adobe.com/playlists",URL_PRODUCTION:"https://learnplaylistservice.adobe.com/playlists"}}),c()(this,"environments",{staging:{LABEL:"Staging",CLIENT_NAME:"CCXProcess1",CLIENT_ID:"CCXProcess_v7_0",VALUE:"s8e--s3CbmUXCWBHWceH3_b8sS_FmkJaY08U",LPS_CLIENT_ID:"CCXProcess_v7_0"},production:{LABEL:"Production",CLIENT_NAME:"CCXProcess1",CLIENT_ID:"CCXProcess_v7_0",VALUE:"p8e-iWO6aOzTeoVfe6QbSixl8A7BmV7aB-y0",LPS_CLIENT_ID:"CCXProcess_v7_0"}}),c()(this,"settings",{SETTINGS_FILE_VERSION:this.config.SETTINGS_FILE_VERSION}),c()(this,"currentDiskState",void 0),c()(this,"analytics",this.get("ANALYTICS")),this.init()},[{key:"init",value:function(){var e=this;if(this.isPlatformWindows()){var t=process.env.USERPROFILE.replace(/\\/g,"/");this.config.ROOT_DIR="".concat(t,"/AppData/Roaming/"),this.config.LOG_DIR="".concat(process.env.TEMP.replace(/\\/g,"/"),"/CreativeCloud/CCX Welcome/");var n="".concat(this.isArm()?process.env.ProgramFiles:process.env["ProgramFiles(x86)"]).replace(/\\/g,"/");this.config.CC_DIR="".concat(n,"/Adobe/Adobe Creative Cloud/")}else this.config.ROOT_DIR="".concat(process.env.HOME,"/Library/Caches/"),this.config.LOG_DIR="".concat(process.env.HOME,"/Library/Logs/CreativeCloud/CCX Welcome/"),this.config.CC_DIR="/Applications/Utilities/Adobe Creative Cloud/";var r=!1;this.isStagingRedirectInEffect()&&(this.config.ENVIRONMENT="staging",r=!0),this.config.ROOT_DIR+="Adobe/CCX Welcome/"+(r?"stage/":""),this.config.LOG_DIR+=r?"stage/":"",this.config.STOCK_API_ROOT="/Rest/Media/".concat(this.config.STOCK_API_VERSION),this.config.STOCK_API_PATH="".concat(this.config.STOCK_API_ROOT,"/Search/Templates"),this.config.TMP_PHOTOS_DOWNLOAD_DIRECTORY="com.adobe.ccx.start.lrphotos/",this.config.PROGRESS_THROTTLE_INTERVAL=250,this.config.DOWNLOAD_TMP_EXTENSION=".tmp",this.loadSettings(),process.argv.forEach(function(t){"--debug"===t&&(e.config.CONSOLE_LOGGING=!0)}),this.config.CONSOLE_LOGGING||global.test||(console.log("Outputting logs to: ".concat(this.config.LOG_DIR)),console.log("To view log messages on the console, use the --debug argument"))}},{key:"isPlatformWindows",value:function(){return 0===process.platform.indexOf("win")}},{key:"isArm",value:function(){return 0===process.arch.indexOf("arm")}},{key:"get",value:function(e,t){return t?this.settings[t]&&void 0!==this.settings[t][e]?this.settings[t][e]:this.config[t]&&this.config[t][e]:void 0!==this.settings[e]?this.settings[e]:this.config[e]}},{key:"set",value:function(e,t,n){return n?(this.settings[n]=this.settings[n]||{},this.settings[n][e]=t):this.settings[e]=t,this.saveSettings()}},{key:"remove",value:function(e,t){if(t){if(this.settings[t]&&void 0!==this.settings[t][e])return delete this.settings[t][e],this.saveSettings()}else if(void 0!==this.settings[e])return delete this.settings[e],this.saveSettings()}},{key:"default",value:function(e){var t=e.LABEL.toLowerCase().replace(/^\w/,function(e){return e.toUpperCase()});return e.ANALYTICS_SUBCATEGORY=e.ANALYTICS_SUBCATEGORY||t,e.LOG_PREFIX=e.LOG_PREFIX||t,e.DIR=e.DIR||t.toLowerCase()+"/",e.VULCAN_TYPE=e.VULCAN_TYPE||t,e.AGGREGATE_TYPE=e.AGGREGATE_TYPE||t,e}},{key:"patch",value:function(e,t){this.config[e]=this.config[e]||{};var n=Object.assign({},this.config[e]);Object.assign(this.config[e],this.config.DEFAULT,n,t),this.default(this.config[e])}},{key:"getEnvironment",value:function(){var e=this.get("ENVIRONMENT");return this.environments[e]||this.environments[this.config.ENVIRONMENT]}},{key:"isStagingRedirectInEffect",value:function(){var e=!1;try{var t=l.readFileSync(this.config.CC_DIR+this.config.CC_SETTINGS_FILE,"utf8");new p.Parser({async:!1}).parseString(t,function(t,n){t||n.C3Config.config[0].namespace.forEach(function(t){t&&t.$&&t.$.name&&"accc.container"===t.$.name&&t.property.forEach(function(t){t&&t.$&&t.$.name&&"IMS_ENV"===t.$.name&&"STG"===t._&&(e=!0)})})})}catch(e){}return e}},{key:"loadSettings",value:function(){try{this.currentDiskState=l.readFileSync(this.config.ROOT_DIR+this.config.SETTINGS_FILE,"utf8");var e=JSON.parse(this.currentDiskState);this.settings.SETTINGS_FILE_VERSION===e.SETTINGS_FILE_VERSION&&(this.settings=e)}catch(e){}}},{key:"saveSettings",value:function(){var e=JSON.stringify(this.settings,void 0,2);if(e===this.currentDiskState)return!1;try{var t="".concat(this.config.SETTINGS_FILE,".TEMP_").concat(u.v4());l.writeFileSync(this.config.ROOT_DIR+t,e),l.renameSync(this.config.ROOT_DIR+t,this.config.ROOT_DIR+this.config.SETTINGS_FILE),this.currentDiskState=e}catch(e){}return!0}}])}();const _=new f},8963:(e,t,n)=>{n.d(t,{Z:()=>y});var r=n(9591),a=n.n(r),s=n(7537),i=n.n(s),o=n(8765),c=n.n(o),u=n(8779),l=n.n(u),p=n(1307),d=n.n(p),f=n(9444),_=n(6653),h=n(1415),E=n(4434),S=n(5717),v=n(5002),g=n(3221),T=n(3193),m=n(5670);const y=new(function(){return c()(function e(){i()(this,e),l()(this,"log",void 0),l()(this,"wasInitialized",void 0),l()(this,"wasStartupAttempted",void 0),l()(this,"maps",void 0),this.log=new f.Z({prefix:"GrowthSDK > ",payload:{"event.subtype":_.Z.analytics.st_GSDK_GENERAL,"event.subcategory":_.Z.analytics.sc_GSDK}}),this.wasInitialized=!1,this.wasStartupAttempted=!1,this.maps=[]},[{key:"setMaps",value:function(e){this.maps=e}},{key:"startUpConfig",get:function(){var e,t,n=this;return{aepAppIds:{Development:"d4d114c60e50/95c1112c4260/launch-c24f1b17adb4-development",Staging:"d4d114c60e50/95c1112c4260/launch-d19e0cf671d2-staging",Production:"d4d114c60e50/95c1112c4260/launch-7a943cdfe2f5"},application:{code:"CCXP",name:"CCX Process",version:this.processVersion,language:"en-US"},ingestConfig:{dependencies:{getAccessToken:(t=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,S.Z.getAccessToken().then(function(e){t(void 0,e)}).catch(function(e){t(e)});case 1:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),getAgent:(e=a()(d().mark(function e(t,n){var r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=v.Z.stripPathFromURL(t),T.Z.getNodeTunnelOptionsForURL(r).then(function(e){delete e.agent,n(null,e)},function(e){n(e)});case 1:case"end":return e.stop()}},e)})),function(t,n){return e.apply(this,arguments)}),log:function(e){m.Z.isDebugModeEnabled()&&n.log.disk(e)}},getPayload:function(){return{"event.device_guid":S.Z.getDeviceID(),"event.session_guid":g.Z.session_guid,"event.user_guid":S.Z.getUserId(),"source.client_id":_.Z.getEnvironment().CLIENT_ID,"user.service_code":"creative_cloud"}},getPiiOptIn:function(){return g.Z._status}}}}},{key:"noTargetingCampaignValue",get:function(){return h.CampaignState.NoTargetingCampaign}},{key:"syncingStatus",get:function(){return h.IncompleteContent.SyncStatus.syncing}},{key:"anonymousContentMarker",get:function(){return h.Content.Status.beforeLogin}},{key:"processVersion",get:function(){return m.Z.getProcessVersion().replace("-",".").replace("dev","9999")}},{key:"saveCachedAsset",value:(y=a()(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,h.content.saveCachedAsset(new h.SaveAssetOptions({asset:n,file:t}));case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(e,t){return y.apply(this,arguments)})},{key:"getUserIdFromGsdk",value:(p=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,h.identity.getAdobeId();case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(){return p.apply(this,arguments)})},{key:"configSettings",get:function(){return _.Z.get("ccxp_gsdk_config")}},{key:"shutdownTimeout",get:function(){return this.configSettings.shutdown_timeout||6e3}},{key:"startupTimeout",get:function(){return this.configSettings.startup_timeout||8e3}},{key:"loginTimeout",get:function(){return this.configSettings.login_timeout||8e3}},{key:"queueTimeout",get:function(){return this.configSettings.queue_timeout||3e4}},{key:"isEnabled",get:function(){return!!this.minSupportedGSDKVersion&&!!m.Z.getGSDKVersion()&&m.Z.compareMajorMinorVersions(m.Z.getGSDKVersion(),this.minSupportedGSDKVersion,!0)<1}},{key:"minSupportedGSDKVersion",get:function(){return this.configSettings.min_supported_version}},{key:"isInitialized",get:function(){return!!this.wasInitialized}},{key:"startupAttempted",get:function(){return!!this.wasStartupAttempted}},{key:"isClientSupported",value:function(e,t){var n,r=_.Z.get("GSDK_FLAG_PRODUCT_ALIAS")[e.productCode],a=null===(n=_.Z.get("GSDK_".concat(r)))||void 0===n?void 0:n.supported_version;return!!_.Z.get("AJO_SUPPORTED",t.type)&&a&&m.Z.compareMajorMinorVersions(a,e.productVersion,t.patchEnabledClient(e))>=0}},{key:"createConsumer",value:function(e){return{code:m.Z.getGSDKProductCodeMapping(e.sapCode||e.productCode),version:e.productVersion,language:m.Z.getGSDKLanguage(e.productLanguage)}}},{key:"getCachedContentForConsumer",value:(u=a()(d().mark(function e(t,n){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized){e.next=1;break}throw new E.Z("GSDK not initialized","Cannot get cached content",_.Z.analytics.GSDK_CACHED_CONTENT_FAILURE).removeStack();case 1:return e.next=2,h.content.getCachedContent(new h.CachedContentRequest({contentRequestTarget:{targetType:h.ContentRequestTarget.TargetType.tag,target:t}}),n).catch(function(e){var r=n.code,s=n.version,i=n.language;throw a.log.context({params:{productCode:r,productVersion:s,productLanguage:i}}).disk("Failed getting cached content for tag ".concat(t)),e});case 2:return r=e.sent,e.abrupt("return",r);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"startup",value:(o=a()(d().mark(function e(){var t,n,r,s,i,o,c=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.startupAttempted){e.next=4;break}return this.wasStartupAttempted=!0,n=this.log.context({payload:{"event.subtype":_.Z.analytics.st_GSDK_START}}),r=Promise,s=new Promise(function(e,r){t=setTimeout(function(){c.wasInitialized=!1,n.error(new E.Z("Timeout.","Startup timed out at ".concat(c.startupTimeout,"s"),_.Z.analytics.GSDK_STARTUP_FAILURE).removeStack()),e()},c.startupTimeout)}),e.next=1,h.core.startup(this.startUpConfig).then(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.disk("Successfully launched GrowthSDK"),c.wasInitialized=!0;case 1:case"end":return e.stop()}},e)}))).catch(function(){var e=a()(d().mark(function e(t){var r,a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.disk("Failure to launch GrowthSDK"),c.wasInitialized=!1,r=t.code?"".concat(_.Z.analytics.GSDK_ERROR_PREFIX).concat(t.code):_.Z.analytics.GSDK_STARTUP_FAILURE,a=t.message?t.message:"No Error Message from GSDK for Startup Failure",s=t.underlyingError,i=a,s&&(i="".concat(a,":").concat(JSON.stringify(s))),o=new E.Z("Startup failure",i,r).removeStack(),n.error(o);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return i=e.sent,o=[s,i],e.next=2,r.race.call(r,o);case 2:if(t&&clearTimeout(t),!this.isInitialized){e.next=3;break}return this.onAnyContentUpdate(),e.next=3,this.login();case 3:e.next=5;break;case 4:this.log.disk("GSDK is already initialzed. Not running startup again.");case 5:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"login",value:(s=a()(d().mark(function e(){var t,n,r,a,s,i,o,c,u=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitialized){e.next=4;break}if(n=this.log.context({payload:{"event.subtype":_.Z.analytics.st_GSDK_LOGIN}}),r=S.Z.getFullProfile(),a=S.Z.getUserId(),!r){e.next=2;break}return n.disk("Attempting user login to GSDK: ".concat(a)),s=Promise,i=new Promise(function(e,r){t=setTimeout(function(){u.wasInitialized=!1,n.error(new E.Z("Timeout.","Login timed out at ".concat(u.loginTimeout,"s"),_.Z.analytics.GSDK_LOGIN_USER_FAILURE).removeStack()),e()},u.loginTimeout)}),e.next=1,h.identity.updateLicenseProfile(r).then(function(){n.disk("User ".concat(a," successfully logged into GSDK."))}).catch(function(e){n.error(new E.Z("Login user failed",e,_.Z.analytics.GSDK_LOGIN_USER_FAILURE).removeStack())});case 1:o=e.sent,c=[i,o],s.race.call(s,c),e.next=3;break;case 2:n.disk("No user profile found to send to GSDK");case 3:t&&clearTimeout(t),e.next=5;break;case 4:this.log.disk("GSDK Disabled - Skipping login call");case 5:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"logout",value:(r=a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=S.Z.getFullProfile())){e.next=1;break}return this.log.disk("Sending logout profile to GSDK."),e.next=1,h.identity.updateLicenseProfile(t);case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"logoutGSDK",value:(n=a()(d().mark(function e(){var t=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitialized){e.next=2;break}return e.next=1,this.logout().then(function(){t.log.disk("User logged out of GSDK")}).catch(function(e){t.log.context({payload:{"event.subtype":_.Z.analytics.st_GSDK_LOGOUT}}).error(new E.Z("Logout user failed",e,_.Z.analytics.GSDK_LOGOUT_USER_FAILURE))});case 1:e.next=3;break;case 2:this.log.disk("GSDK Disabled - Skipping logout call");case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"updateConsumerActivity",value:function(e,t){if(this.isInitialized)return this.log.disk('Updating GSDK consumers activity "'.concat(t,'" with consumer ').concat(JSON.stringify(e))),void h.content.updateConsumerActivity(new h.Consumer(e),t)}},{key:"updateContent",value:(t=a()(d().mark(function e(t,n){var r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized){e.next=1;break}throw new E.Z("GSDK not initialized","Cannot call updateContent",_.Z.analytics.GSDK_CACHED_CONTENT_FAILURE).removeStack();case 1:return e.prev=1,r={targetType:h.ContentRequestTarget.TargetType.tag,target:t},e.next=2,h.content.updateContent(r,n);case 2:e.next=4;break;case 3:throw e.prev=3,s=e.catch(1),a=new E.Z("Update content failure",s,_.Z.analytics.GSDK_UPDATE_CONTENT_FAILURE),this.log.error(a),a;case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e,n){return t.apply(this,arguments)})},{key:"onAnyContentUpdate",value:function(){var e=this,t=_.Z.get("CLIENT_SURFACE_MAPPING");this.log.disk("Starting content update listener."),h.content.onAnyContentUpdate(function(n){var r,a=n.consumer,s=n.tags,i=e.maps.find(function(n){return(s||[]).find(function(s){return r=s,t[s]===n.type&&e.isClientSupported({productCode:a.code,productVersion:a.version},n)})});i?(e.log.disk("*** Received update for SUPPORTED consumer: ".concat(JSON.stringify(n.consumer)," with tags ").concat(n.tags," and monitoringData ").concat(JSON.stringify(n.monitoringData)," from container ").concat(JSON.stringify(n.container)).concat(m.Z.isDebugModeEnabled()?"\n with content:\n ".concat(JSON.stringify(n)):"")),null==i||i.emit("queueGSDKUpdate",{productCode:a.code,productVersion:a.version,productLanguage:m.Z.getSophiaLanguage(a.language),surfaceId:[r],sapCode:a.code},"update")):e.log.disk("*** Received update for UNSUPPORTED consumer: ".concat(JSON.stringify(n.consumer)," with tags ").concat(n.tags," and monitoringData ").concat(JSON.stringify(n.monitoringData)," from container ").concat(JSON.stringify(n.container)).concat(m.Z.isDebugModeEnabled()?"\n with content:\n ".concat(JSON.stringify(n)):""))})}},{key:"shutdown",value:(e=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitialized){e.next=2;break}return this.log.disk("Beginning GSDK shutdown sequence."),this.wasInitialized=!1,e.next=1,Promise.race([new Promise(function(e,r){t=setTimeout(function(){n.log.disk("Shutdown has timed out"),n.log.context({payload:{"event.subtype":_.Z.analytics.st_GSDK_SHUTDOWN}}).error(new E.Z("Timeout.","Shutdown timed out at ".concat(n.shutdownTimeout,"s"),_.Z.analytics.GSDK_SHUTDOWN_FAILURE).removeStack()),e()},n.shutdownTimeout)}),h.core.shutdown().then(function(){n.log.disk("GSDK shutdown completed.")}).catch(function(e){n.log.context({payload:{"event.subtype":_.Z.analytics.st_GSDK_SHUTDOWN}}).error(new E.Z("GSDK shutdown failure",e,_.Z.analytics.GSDK_SHUTDOWN_FAILURE).removeStack())}).finally(function(){t&&clearTimeout(t)})]);case 1:e.next=3;break;case 2:this.log.disk("GSDK not initialized - Skipping shutdown call");case 3:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})}]);var e,t,n,r,s,o,u,p,y}())},3193:(e,t,n)=>{n.d(t,{Z:()=>x});var r=n(9591),a=n.n(r),s=n(7537),i=n.n(s),o=n(8765),c=n.n(o),u=n(9548),l=n.n(u),p=n(3761),d=n.n(p),f=n(5370),_=n.n(f),h=n(8779),E=n.n(h),S=n(1307),v=n.n(S),g=n(9444),T=n(1239),m=n(3837),y=n(5670),O=n(4434),A=n(6653);function C(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(C=function(){return!!e})()}var I=new g.Z({prefix:"Proxy > ",payload:{"event.subcategory":A.Z.analytics.sc_Network}}),R=n(5687),N=n(3685),k=n(5687).globalAgent,P={},L=n(6785)(function(e,t){I.disk(t)}),D={getRootCA:m.promisify(L.getRootCA),resolve:m.promisify(L.resolve),getOSLocale:m.promisify(L.getOSLocale)};const x=new(function(e){function t(){var e,r,s,o;return i()(this,t),r=this,s=t,s=d()(s),e=l()(r,C()?Reflect.construct(s,o||[],d()(r).constructor):s.apply(r,o)),E()(e,"_lastCredentials",new Map),E()(e,"_ca",void 0),E()(e,"proxyUser",void 0),E()(e,"proxyPassword",void 0),E()(e,"proxyResolver",{getRootCA:m.promisify(L.getRootCA),resolve:m.promisify(L.resolve),getOSLocale:m.promisify(L.getOSLocale)}),E()(e,"getOSLocale",y.Z.memoize(D.getOSLocale,{timeout:-1})),E()(e,"getNodeTunnelOptionsForURL",y.Z.memoize(e._getNodeTunnelOptionsForURL,{destructor:function(e,t){var n=t.value.agent;return!(!n||!n.isAvailable||0!==Object.values(n.sockets).map(function(e){return e.length}).reduce(function(e,t){},0))&&(n.destroy(),n.isAvailable=!1,!0)}})),E()(e,"init",y.Z.memoize(a()(v().mark(function t(){var r,a,s,i;return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return L.setAuthenticationCallback(function(t,n){var r=e._lastCredentials.get(t.proxy.host+t.proxy.port)||{};if(r.username===e.proxyUser&&r.password===e.proxyPassword)n(new O.Z("No new credentials for ".concat(t.proxy.host,":").concat(t.proxy.port),void 0,"PROXY"));else if(e.proxyUser){var a;r.username=e.proxyUser,r.password=e.proxyPassword,n(null,r),e._lastCredentials.set((null==t||null===(a=t.proxy)||void 0===a?void 0:a.host)+t.proxy.port,r)}else{n(new O.Z("No credentials present for ".concat(t.proxy.host,":").concat(t.proxy.port),void 0,"PROXY"))}}),L.on("change",function(){I.disk("System proxy settings changed"),e.getNodeTunnelOptionsForURL.cache.clear(),e.emit("change",!0)}),t.next=1,e.proxyResolver.getRootCA().catch(function(e){I.error(e,"Error getting Root CA")});case 1:return e._ca=t.sent,k.options.ca=e._ca,r=n(9106).Z,t.next=2,r.getProxyCredentials();case 2:a=t.sent,s=a.user,i=a.password,e.setProxyCredentials(s,i);case 3:case"end":return t.stop()}},t)})),{timeout:-1})),e}return _()(t,e),c()(t,[{key:"_getNodeTunnelOptionsForURL",value:(r=a()(v().mark(function e(t){var n,r,a,s,i,o,c;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,D.resolve(t).catch(function(e){I.error(e,"Error getting proxy settings")});case 1:if(r=(r=e.sent)&&r[0],a=r&&r.agentClass||(t.startsWith("https")?R.Agent:N.Agent),s=r&&r.agentOptions||{},i={},s.ca=this._ca,s.keepAlive=!0,s.keepAliveMsecs=1e3,s.maxFreeSockets=5,o=s.proxy?s.proxy.host+s.proxy.port:t.startsWith("https")?"https":"http",P[o]=null!==(n=P[o])&&void 0!==n&&n.isAvailable?P[o]:new a(s),P[o].isAvailable=!0,i.agent=P[o],!r.agent){e.next=3;break}return e.next=2,this.init();case 2:c="".concat(r.hostname,":").concat(r.port).concat(this.proxyUser?" with":" without"," authentication"),I.disk("Setting proxy for ".concat(t,": ").concat(c)),i.details=c,e.next=4;break;case 3:I.disk("No proxy (direct connection) for ".concat(t)),i.details="No Proxy";case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"setProxyCredentials",value:function(e,t){this.proxyUser===e&&this.proxyPassword===t||(I.disk("Setting proxy username and password"),this.proxyUser=e,this.proxyPassword=t,this.getNodeTunnelOptionsForURL.cache.clear(),this.emit("change",!1))}},{key:"getProxyCredentials",value:function(){return{user:this.proxyUser,password:this.proxyPassword}}},{key:"clearCache",value:function(){this.getNodeTunnelOptionsForURL.cache&&this.getNodeTunnelOptionsForURL.cache.clear(),this.proxyUser=void 0,this.proxyPassword=void 0,this._lastCredentials.clear()}}]);var r}(T.EventEmitter))},9106:(e,t,n)=>{n.d(t,{Z:()=>R});var r=n(7537),a=n.n(r),s=n(8765),i=n.n(s),o=n(9548),c=n.n(o),u=n(3761),l=n.n(u),p=n(5370),d=n.n(p);function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(f=function(){return!!e})()}var _=n(5828),h=n(855),E=n(1858).Z,S=n(6653).Z,v=n(1239),g=n(9444).Z,T=n(4434).Z,m=n(3221).Z,y=n(5717).Z,O="accc.app.ProxySettingsResponse",A="adbproduct.app.UserContextDataResponse",C=new h.Parser,I=new(function(e){function t(){var e,n,r,s;return a()(this,t),n=this,r=t,r=l()(r),(e=c()(n,f()?Reflect.construct(r,s||[],l()(n).constructor):r.apply(n,s))).log=new g({prefix:"CCNotifications > ",payload:{"event.subcategory":S.analytics.sc_PROCESS,"event.subtype":S.analytics.st_ANS}}),e.events={SIGN_IN:"signIn",SIGN_OUT:"signOut",PROXY_SETTINGS_CHANGED:"proxySettingsChanged",PROFILE_UPDATED:"profileUpdated",INSTALL_APPLICATION:"installApplication",UNINSTALL_APPLICATION:"uninstallApplication",UPDATE_APPLICATION:"updateApplication",SUBSCRIPTION_STATUS_CHANGED:"subscriptionStatusChanged",UPDATE_STOCK:"updateStock",UPDATE_APPLICATION_COMPONENTS:"updateApplicationComponents",USER_ANALYTICS_CHANGED:"userAnalyticsChanged",FORCE_REFRESH:"forceRefresh"},e.getProxyCredentials=e._getProxyCredentials,e.getUserAnalyticsEnabledFlag=e._getUserAnalyticsEnabledFlag,e.handlePayload=e._handlePayload,e.registerANSNotifications=e._registerANSNotifications,e.addListeners(),e}return d()(t,e),i()(t,[{key:"getMessageValue",value:function(e,t){var n=null;if(e){var r=new RegExp("<".concat(t,"[^<>]*>([^<>]*)</").concat(t,">"),""),a=e.match(r);n=a&&a[1]}return n}},{key:"constructMessage",value:function(e,t){var n=e;return Object.keys(t).forEach(function(e){n=n.replace(e,t[e])}),n}},{key:"addListeners",value:function(){var e=this;E.addListener("accc.localapps.panel.refresh.ssoevent",function(t){var n=e.getMessageValue(t,"event_type");e.log.disk("ACCC Sign-on State: ".concat(n)),"signin_success"===n?e.emit(e.events.SIGN_IN):"signout_success"===n&&e.emit(e.events.SIGN_OUT)}),E.addListener("accc.any.NoListenerAvailable",function(t){e.log.error("No Listener Available: ".concat(t))}),E.addListener("com.adobe.aam.AAMIMSStatus",function(t){var n=e.getMessageValue(t,"Status");e.log.disk("AAM Sign-on State: ".concat(n)),"USER_AUTH_SUCCESS"===n&&e.emit(e.events.SIGN_IN)}),E.addListener("com.adobe.aam.AAMSIGNOUTStatus",function(t){e.emit(e.events.SIGN_OUT),e.log.disk("AAM Sign-on State: signOut")}),E.addListener("any.accc.app.UserContextData",function(t){var n=S.get(y.getUserId(),"USER_ANALYTICS_ENABLED")||!1;if(!t)return e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to receive user analytics message on sign in")),void m.enable(n);C.parseString(t,function(t,r){if(t||!r)return e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to parse user analytics flag on update, err=".concat(t))),void m.enable(n);if(r.response&&r.response.error)return e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Error in user analytics flag on update, err=".concat(JSON.stringify(r.response.error)))),void m.enable(n);var a=r["feature-response"]&&r["feature-response"]["feature-entry"]&&r["feature-response"]["feature-entry"].find(function(e,t){return"com.adobe.oobe.acc.v1.piip.user.status"===e.$.id});if(a&&a.$){e.log.disk("GetUserAnalyticsFlag - Successfully updated user analytics enabled flag: ".concat(a.$.state));var s="OptedIn"===a.$.state;return m.enable(s),void S.set(y.getUserId(),s,"USER_ANALYTICS_ENABLED")}return e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to parse userAnalyticsStatus, userAnalyticsStatus=".concat(a))),void m.enable(n)})}),E.addListener("any.accc.app.ProxySettingsChanged",function(t){var n=e.getMessageValue(t,"proxyuser"),r=e.getMessageValue(t,"proxypassword");null!==n&&null!==r&&e.emit(e.events.PROXY_SETTINGS_CHANGED,n,r)}),E.addListener("any.accc.app.ProductDeploymentEvent",function(n){var r={productCode:e.getMessageValue(n,"productCode"),productVersion:e.getMessageValue(n,"productVersion"),productLanguage:e.getMessageValue(n,"productLanguage"),countryCode:e.getMessageValue(n,"countryCode")};if(S.get("PRODUCT_LIST").includes(r.productCode)){var a=e.getMessageValue(n,"eventType");switch(a){case"Install":case"Install-Start":case"Install-Progress":e.emit(e.events.INSTALL_APPLICATION,r,a);break;case"Uninstall":e.emit(e.events.UNINSTALL_APPLICATION,r,a);break;case"Update":case"Update-Start":case"Update-Progress":e.emit(e.events.UPDATE_APPLICATION,r,a);break;case"UpdateComponents":0!==t.listenerCount(e.events.UPDATE_APPLICATION_COMPONENTS)&&e.emit(e.events.UPDATE_APPLICATION_COMPONENTS,r)}}}),E.addListener(S.get("NOTIFICATION_PSDK_RESPONSE"),function(t){e.handleNotificationResponse(t,S.get("ANS_PSDK_NOTIFICATION_TYPE"),S.get("NOTIFICATION_PSDK_QUERY_DATA_BY_ID_RESPONSE"))}),E.addListener(S.get("NOTIFICATION_STOCK_RESPONSE"),function(t){e.handleNotificationResponse(t,S.get("ANS_STOCK_NOTIFICATION_TYPE"),S.get("NOTIFICATION_STOCK_QUERY_DATA_BY_ID_RESPONSE"))}),E.addListener(S.get("NOTIFICATION_FORCE_REFRESH_RESPONSE"),function(t){e.handleNotificationResponse(t,S.get("ANS_FORCE_REFRESH_NOTIFICATION_TYPE"),S.get("ANS_FORCE_REFRESH_NOTIFICATION_SUB_TYPE"))}),E.addListener(S.get("NOTIFICATION_FORCE_REFRESH_RESPONSE"),function(t){e.handleNotificationResponse(t,S.get("ANS_NUJ_REFRESH_NOTIFICATION_TYPE"),S.get("ANS_NUJ_REFRESH_NOTIFICATION_SUB_TYPE"))})}},{key:"_handlePayload",value:function(e,t){var n=this,r={};C.parseString(e,function(e,a){if(e)n.log.error(new T(e,"Fail to parse message"));else{var s=a["notification-error"];if(s){var i=s.error&&s.error[0],o=i&&i.$&&i.$.desc||"Unknown notification error";n.log.disk(o)}else{var c,u=a&&a.notifications&&a.notifications.notification||[];n.log.disk("Received ".concat(u.length," ANS notifications.")),u.forEach(function(e){var a=e.type[0],s=e["sub-type"][0],i=parseInt(e.timestamp[0],10),o=e.payload;(!t||i>t)&&(c=!c||i>c?i:c,function(e,t,a){if(e===S.get("ANS_PSDK_NOTIFICATION_TYPE")&&t===S.get("ANS_PSDK_NOTIFICATION_SUB_TYPE")){var s;n.log.disk("Handle ANS message: type=".concat(e,", subtype=").concat(t,", payload=").concat(a));try{s=a&&JSON.parse(a)}catch(e){return n.log.error(new T(S.analytics.PAYLOAD_PARSE_FAIL,"Fail to parse payload: ".concat(a)))}switch(s&&s.eventType){case"HVA_COMMUNICATION":case"HVA_COMPLETED":case"SEGMENT_CHANGE":case"EXPERIENCE_CHANGE":case"APS_COMMUNICATION":case"APPLAUNCH_BUCKET_CHANGE":case"PERSONA_SEGMENT_CHANGE":case"ENTITLEMENT_CHANGE":case"ENGAGEMENT_CLICK_EVENT":r.profileUpdated=!0;break;case"MEMBERSHIP_CHANGE":r.subscriptionStatusChanged=!0}}else if(e===S.get("ANS_STOCK_NOTIFICATION_TYPE")&&t===S.get("ANS_STOCK_NOTIFICATION_SUB_TYPE"))r.updateStock=!0;else if(e===S.get("ANS_FORCE_REFRESH_NOTIFICATION_TYPE")&&t===S.get("ANS_FORCE_REFRESH_NOTIFICATION_SUB_TYPE"))try{r[n.events.FORCE_REFRESH]=JSON.parse(a).payload}catch(r){n.log.error(new T(S.analytics.UNEXPECTED_ANS_MSG,"Unable to parse ANS message payload, type=".concat(e,", subType=").concat(t,", payload=").concat(a)))}else if(e===S.get("ANS_NUJ_REFRESH_NOTIFICATION_TYPE")&&t===S.get("ANS_NUJ_REFRESH_NOTIFICATION_SUB_TYPE"))try{r[n.events.FORCE_REFRESH]=JSON.parse(a[0])}catch(r){n.log.error(new T(S.analytics.UNEXPECTED_ANS_MSG,"Unable to parse ANS message payload, type=".concat(e,", subType=").concat(t,", payload=").concat(a)))}}(a,s,o))}),Object.keys(r).forEach(function(e){n.emit(e,c||(new Date).getTime(),r[e]||null)})}}})}},{key:"_queryANSNotificationsByTime",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=_.v4(),i=function(e){clearTimeout(r),E.removeListener(t,i),n(null,e)};E.addListener(t,i);var o={"{{TIME_STAMP}}":(new Date).getTime(),"{{NOTIFICATION_TYPE}}":e,"{{NOTIFICATION_COUNT}}":"10","{{uuid}}":s,"{{requestor-namespace}}":t};a&&(o["{{NOTIFNOTIFICATION_SUB_TYPE}}"]=a),E.sendMessage(S.get("NOTIFICATION_REQUEST"),this.constructMessage('<?xml version="1.0" encoding="utf-8"?><NEMessage action="GetDataByTime"><timestamp>{{TIME_STAMP}}</timestamp><type>{{NOTIFICATION_TYPE}}</type><notifications-count-limit>{{NOTIFICATION_COUNT}}</notifications-count-limit><request-context>{{uuid}}</request-context><requestor-namespace>{{requestor-namespace}}</requestor-namespace></NEMessage>',o),"ADCS",""),r=setTimeout(function(){E.removeListener(t,i),n(new Error("GetNotificationDataByTime timeout"))},S.get("GET_NOTIFICATION_DATA_TIMEOUT"))}},{key:"_getUserAnalyticsEnabledFlag",value:function(){var e=this;return new Promise(function(t){var n,r,a=S.get(y.getUserId(),"USER_ANALYTICS_ENABLED")||!1,s=function(i){if(E.removeListener(A,s),clearTimeout(n),!i)return e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to receive user analytics message on sign in.")),void t({enabled:a});C.parseString(i,function(n,s){if(n||!s)return e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to receive user analytics flag on sign in, err=".concat(n))),void t({enabled:a});if(s.response&&s.response.error){var i=s.response.error;return i[0]&&"SignInPending"===i[0].$.id?(e.log.disk("User sign in pending. Analytics flag not received yet."),void t({enabled:a})):(e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to parse user analytics flag on sign in, err=".concat(JSON.stringify(s.response.error)))),void t({enabled:a}))}var o=s.response&&s.response.UserfeatureXML&&s.response.UserfeatureXML[0];C.parseString(o,function(n,s){if(n||!s)return e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to parse UserfeatureXML, err=".concat(n))),void t({enabled:a});if((r=s["feature-response"]&&s["feature-response"]["feature-entry"]&&s["feature-response"]["feature-entry"].find(function(e,t){return e&&e.$&&"com.adobe.oobe.acc.v1.piip.user.status"===e.$.id}))&&r.$){e.log.disk("GetUserAnalyticsFlag - Successfully obtained user analytics enabled flag: ".concat(r.$.state));var i="OptedIn"===r.$.state;return t({enabled:i}),void S.set(y.getUserId(),i,"USER_ANALYTICS_ENABLED")}return e.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to parse userAnalyticsStatus, userAnalyticsStatus=".concat(r))),void t({enabled:a})})})};E.addListener(A,s),E.sendMessage("accc.app.UserContextDataRequest",e.constructMessage('<?xml version= "1.0" encoding= "utf-8"?><request><request-id>{{uuid}}</request-id></request>',{"{{uuid}}":_.v4()}),"ADCS",""),n=setTimeout(function(){E.removeListener(A,s),e.log.disk("GetUserAnalyticsFlag - Error: timed out getting user analytics enabled flag"),t({enabled:a})},S.get("USER_ANALYTICS__REQUEST_TIMEOUT"))})}},{key:"_getProxyCredentials",value:function(){var e=this;return new Promise(function(t){var n,r=function(a){E.removeListener(O,r),clearTimeout(n);var s=e.getMessageValue(a,"proxyuser"),i=e.getMessageValue(a,"proxypassword");e.log.disk("GetProxySettings - Successfully obtained username/password"),t({user:s,password:i})};E.addListener(O,r),E.sendMessage("accc.app.ProxySettingsRequest",e.constructMessage('<?xml version="1.0" encoding="utf-8"?><request><type>accc.app.ProxySettingsRequest</type><request_id>{{uuid}}</request_id></request>',{"{{uuid}}":_.v4()}),"ADCS",""),n=setTimeout(function(){E.removeListener(O,r),e.log.disk("GetProxySettings - Error: timed out getting proxy settings"),t({})},S.get("PROXY_REQUEST_TIMEOUT"))})}},{key:"_registerANSNotifications",value:function(){var e=this;[{"{{NOTIFICATION_TYPE}}":S.get("ANS_PSDK_NOTIFICATION_TYPE"),"{{LAUNCH_CCXP_CONDITION}}":S.get("ANS_CCXP_LAUNCH_CONDITION"),"{{NOTIFICATION_SUB_TYPE}}":S.get("ANS_PSDK_NOTIFICATION_SUB_TYPE"),"{{observer-namespace}}":S.get("NOTIFICATION_PSDK_RESPONSE")},{"{{NOTIFICATION_TYPE}}":S.get("ANS_STOCK_NOTIFICATION_TYPE"),"{{LAUNCH_CCXP_CONDITION}}":S.get("ANS_CCXP_LAUNCH_CONDITION"),"{{NOTIFICATION_SUB_TYPE}}":S.get("ANS_STOCK_NOTIFICATION_SUB_TYPE"),"{{observer-namespace}}":S.get("NOTIFICATION_STOCK_RESPONSE")},{"{{NOTIFICATION_TYPE}}":S.get("ANS_FORCE_REFRESH_NOTIFICATION_TYPE"),"{{LAUNCH_CCXP_CONDITION}}":S.get("ANS_CCXP_LAUNCH_CONDITION"),"{{NOTIFICATION_SUB_TYPE}}":S.get("ANS_FORCE_REFRESH_NOTIFICATION_SUB_TYPE"),"{{observer-namespace}}":S.get("NOTIFICATION_FORCE_REFRESH_RESPONSE")},{"{{NOTIFICATION_TYPE}}":S.get("ANS_NUJ_REFRESH_NOTIFICATION_TYPE"),"{{LAUNCH_CCXP_CONDITION}}":S.get("ANS_CCXP_LAUNCH_CONDITION"),"{{NOTIFICATION_SUB_TYPE}}":S.get("ANS_NUJ_REFRESH_NOTIFICATION_SUB_TYPE"),"{{observer-namespace}}":S.get("NOTIFICATION_FORCE_REFRESH_RESPONSE")}].forEach(function(t){E.sendMessage(S.get("NOTIFICATION_REQUEST"),e.constructMessage('<?xml version="1.0" encoding="utf-8"?><NEMessage action="RegisterObserver"><type>{{NOTIFICATION_TYPE}}</type><conditions><launch>{{LAUNCH_CCXP_CONDITION}}</launch></conditions><sub-type>{{NOTIFICATION_SUB_TYPE}}</sub-type><observer-namespace>{{observer-namespace}}</observer-namespace></NEMessage>',t),"ADCS","")})}},{key:"getNotificationDataByIDs",value:function(e,t,n,r){var a=this;if(0!==Object.keys(e).length){var s,i=_.v4(),o=function(e){E.removeListener(n,o),clearTimeout(s),r(null,e)};E.addListener(n,o);var c="";Object.keys(e).forEach(function(e){c+="<notification-id>".concat(e,"</notification-id>")});var u={"{{NOTIFICATION_TYPE}}":t,"{{NOTIFICATION_IDS}}":c,"{{uuid}}":i,"{{requestor-namespace}}":n};E.sendMessage(S.get("NOTIFICATION_REQUEST"),this.constructMessage('<?xml version="1.0" encoding="utf-8"?><NEMessage action="GetDataByID"><notification-ids>{{NOTIFICATION_IDS}}</notification-ids><request-context>{{uuid}}</request-context><requestor-namespace>{{requestor-namespace}}</requestor-namespace></NEMessage>',u),"ADCS",""),s=setTimeout(function(){E.removeListener(n,o);var e=new T(S.analytics.GET_NOTIFICATION_DATA,"GetNotificationDataByID - Error: timed out getting notification data");a.log.error(e),r(e)},S.get("GET_NOTIFICATION_DATA_TIMEOUT"))}else r(new Error("No notification id"))}},{key:"handleNotificationResponse",value:function(e,t,n){var r=this,a={};C.parseString(e,function(s,i){if(s)r.log.error(new T(S.analytics.PARSE_MSG_FAIL,"Fail to parse message, message=".concat(e)));else{var o=i&&i["notifications-signal"],c=o&&o["notification-signal"];(c&&c[0]&&c[0]["notification-info"]||[]).forEach(function(e){var t=e&&e["notification-ids"]&&e["notification-ids"][0];(t&&t["notification-id"]||[]).forEach(function(e){a[e]=!0})}),r.getNotificationDataByIDs(a,t,n,function(e,t){e?r.log.disk(e):r.handlePayload(t)})}})}},{key:"checkForMissedNotifications",value:function(e,t,n){var r=this;[{type:S.get("ANS_PSDK_NOTIFICATION_TYPE"),requestNamespace:S.get("NOTIFICATION_PSDK_QUERY_DATA_BY_TIME_RESPONSE"),lastTimeOfNotification:e},{type:S.get("ANS_STOCK_NOTIFICATION_TYPE"),requestNamespace:S.get("NOTIFICATION_STOCK_QUERY_DATA_BY_TIME_RESPONSE"),lastTimeOfNotification:t},{type:S.get("ANS_FORCE_REFRESH_NOTIFICATION_TYPE"),subtype:S.get("ANS_FORCE_REFRESH_NOTIFICATION_SUB_TYPE"),requestNamespace:S.get("NOTIFICATION_FORCE_REFRESH_QUERY_DATA_BY_TIME_RESPONSE"),lastTimeOfNotification:n},{type:S.get("ANS_NUJ_REFRESH_NOTIFICATION_TYPE"),subtype:S.get("ANS_NUJ_REFRESH_NOTIFICATION_SUB_TYPE"),requestNamespace:S.get("NOTIFICATION_FORCE_REFRESH_QUERY_DATA_BY_TIME_RESPONSE"),lastTimeOfNotification:n}].forEach(function(e){var t=e.lastTimeOfNotification;r.queryANSNotificationsByTime(e,function(e,n){e?r.log.disk(e):r.handlePayload(n,t)})})}},{key:"queryANSNotificationsByTime",value:function(e,t){this._queryANSNotificationsByTime(e.type,e.requestNamespace,t,e.subtype)}}])}(v));I.setMaxListeners(20);const R=I},1858:(e,t,n)=>{n.d(t,{Z:()=>L});var r=n(9591),a=n.n(r),s=n(7537),i=n.n(s),o=n(8765),c=n.n(o),u=n(9548),l=n.n(u),p=n(3761),d=n.n(p),f=n(5370),_=n.n(f),h=n(8779),E=n.n(h),S=n(1307),v=n.n(S),g=n(6653),T=n(1239),m=n(9444),y=n(5670),O=n(3221),A=n(4434);function C(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(C=function(){return!!e})()}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach(function(t){E()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var N=n(5006),k=function(e){return Object.keys(e).reduce(function(t,n){return R(R({},t),{},E()({},n,e[n][0]))},{})},P=new(function(e){function t(){var e,r,s,o;i()(this,t),r=this,s=t,s=d()(s),e=l()(r,C()?Reflect.construct(s,o||[],d()(r).constructor):s.apply(r,o)),E()(e,"log",new m.Z({prefix:"VulcanWrapper > ",payload:{"event.workflow":g.Z.analytics.w_CCX_PROCESS,"event.subcategory":g.Z.analytics.sc_PROCESS,"event.subtype":g.Z.analytics.st_AID}})),E()(e,"vulcan",void 0),E()(e,"control",void 0),E()(e,"installedApps",{}),E()(e,"aidFetched",!1),E()(e,"instanceReleased",!1),E()(e,"getInstalledApps",y.Z.memoize(a()(v().mark(function t(){var n,r,s,i,o,c,u;return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.aidFetched){t.next=1;break}return t.abrupt("return",e.installedApps);case 1:return t.next=2,new Promise(function(){var e=a()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",N.getAllInstalledApps(!1,function(e,r){e?n(new A.Z(g.Z.analytics.AID_GET_INSTALLED_APPS_ERROR,e)):t(r)}));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 2:return n=t.sent,t.next=3,y.Z.parseXml(n);case 3:if(r=t.sent,!(s=y.Z.validateDataFields(r,g.Z.get("NODE_AID_RESPONSE_SCHEMA")))){t.next=4;break}throw new A.Z(O.Z.DATA_VALIDATION_ERR,"Invalid data: ".concat(JSON.stringify(null===(i=s[0])||void 0===i?void 0:i.message)));case 4:return o=r.ProductsInfo.ProductInfo,e.installedApps=o.reduce(function(e,t){var n=k(t);return R(R({},e),{},E()({},n.SAPCode,R(R({},e[n.SAPCode]),{},E()({},n.CodexVersion,n))))},{}),g.Z.get("enable_gsdk_ghost_content")&&(e.log.disk("Setting GHST to  be installed via AID"),e.installedApps.GHST={"2.0.0":{SAPCode:"GHST",CodexVersion:"2.0.0",Platform:"fake",InstallerType:"CCXP-GHOST",IsUWPProduct:"false",DisplayName:"Ghost Product",BuildVersion:"2.0.0.0",LaunchString:""}}),e.aidFetched=!0,c=g.Z.get("PRODUCT_LIST"),Object.keys(e.installedApps).forEach(function(t){Object.keys(e.installedApps[t]).forEach(function(n){if(c.includes(t)){var r;e.installedApps[t][n].RawInstallLanguage=e.installedApps[t][n].InstallLanguage;var a=e.installedApps[t][n].InstallLanguage;if((!a||null!==(r=a)&&void 0!==r&&r.includes("mul"))&&(e.log.context({params:{productCode:t,productVersion:n}}).error(new A.Z("AID_LOCALE_ERROR","Found Locales: ".concat(a),"MISSING_OR_MUL_LOCALE").removeStack()),a="en_US"),"CCXP"===t&&(a="en_US"),e.installedApps[t][n].InstallLanguage=a,y.Z.isDebugModeEnabled()){var s=e.installedApps[t][n];e.log.disk("Installed app: ".concat(t," -- BuildVersion: ").concat(s.BuildVersion," -- CodexVersion: ").concat(s.CodexVersion," -- Language: ").concat(s.InstallLanguage," -- AID Language: ").concat(s.RawInstallLanguage))}}})}),t.abrupt("return",e.installedApps);case 5:return t.prev=5,u=t.catch(0),e.log.error(u),t.abrupt("return",null);case 6:case"end":return t.stop()}},t,null,[[0,5]])})))),e.log.disk("Loading Vulcan Library...");var c=n(3446);return e.log.disk("Vulcan Library Successfully Loaded."),e.vulcan=c.createMessageAdapter("CCXP","1.0.0"),e.control=c.createControlAdapter(),e.vulcan.addMessageListener(function(t,n,r,a){t=t.replace(g.Z.get("VULCAN_PREFIX"),""),0!==e.listenerCount(t)&&(e.shouldLogMessage(t)&&e.log.disk("<- ".concat(r," ").concat(a,": ").concat(t," \n ").concat(e.shouldLogContent(t)?n:"").trim()),e.emit(t,n,r,a))}),e}return _()(t,e),c()(t,[{key:"clearInstalledAppsCache",value:function(){this.aidFetched=!1,this.getInstalledApps.cache.clear()}},{key:"shouldLogMessage",value:function(e){var t=g.Z.get("SKIP_LOGGING_MESSAGE_LIST");return!t||!t.includes(e)||g.Z.get("CONSOLE_LOGGING")}},{key:"shouldLogContent",value:function(e){var t=g.Z.get("SKIP_LOGGING_MESSAGE_CONTENT");return!t||!t.includes(e)}},{key:"sendMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=n?"".concat(n," ").concat(r||"*"):"BROADCAST";"string"!=typeof t&&(t=JSON.stringify(t)),this.shouldLogMessage(e)&&this.log.disk("-> ".concat(a,": ").concat(e," \n ").concat(this.shouldLogContent(e)?t:"").trim()),this.vulcanInstanceReleased||this.vulcan.sendMessage(e,t,n,r)}},{key:"isAppRunning",value:function(e,t){var n=!0,r="".concat(e,"-").concat(t);try{n=this.control.isAppRunning(r)}catch(e){this.log.error(new A.Z("".concat(g.Z.analytics.AID_APP_RUNNING_ERROR," - ").concat(r),e)),n=!0}return n}},{key:"vulcanInstanceReleased",get:function(){return!!this.instanceReleased}},{key:"removeAllListenersVulcan",value:function(){this.vulcan.removeAllListeners()}},{key:"releaseInstance",value:function(){this.instanceReleased=!0,this.vulcan.releaseInstance()}}])}(T));P.setMaxListeners(27);const L=P},989:(e,t,n)=>{n.d(t,{E:()=>O,Z:()=>A});var r=n(9591),a=n.n(r),s=n(7537),i=n.n(s),o=n(8765),c=n.n(o),u=n(9548),l=n.n(u),p=n(3761),d=n.n(p),f=n(5370),_=n.n(f),h=n(8779),E=n.n(h),S=n(1307),v=n.n(S),g=n(1239),T=n(6653);function m(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(m=function(){return!!e})()}var y=function(e){return e.SYNC="SYNC",e}(y||{}),O=function(e){return e.AUTH="BackoffAuthentication",e.NETWORK="BackOffNetwork",e}({});const A=new(function(e){function t(){var e,n,r,a;i()(this,t);for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return n=this,r=t,a=[].concat(o),r=d()(r),e=l()(n,m()?Reflect.construct(r,a||[],d()(n).constructor):r.apply(n,a)),E()(e,"SYNC",y.SYNC),E()(e,"_syncRetryTimeout",null),e}return _()(t,e),c()(t,[{key:"isWaitingForBackOff",value:function(e){var t=T.Z.get("BACK_OFF_EXPIRY",e);return!!(t&&new Date(t)>new Date)}},{key:"backOffCause",value:function(e){return T.Z.get("BACK_OFF_CAUSE",e)}},{key:"backOffWaitTime",value:function(e){return T.Z.get("BACK_OFF",e)}},{key:"backOffExpiry",value:function(e){return T.Z.get("BACK_OFF_EXPIRY",e)}},{key:"updateBackOff",value:(n=a()(v().mark(function e(){var t,n,r,a,s,i,o,c,u,l,p=this,d=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]?d[0]:{clear:!1,sync:!0,cause:"Unknown",type:O.NETWORK},n=t.clear,r=void 0!==n&&n,a=t.cause,s=void 0===a?"Unknown":a,i=t.type,o=t.sync,c=void 0===o||o,u=this.backOffWaitTime(i),!r){e.next=1;break}return u&&(T.Z.set("BACK_OFF_EXPIRY",void 0,i),T.Z.set("BACK_OFF",void 0,i),T.Z.set("BACK_OFF_CAUSE",void 0,i)),c&&u&&(clearTimeout(this._syncRetryTimeout),this.emit(this.SYNC)),e.abrupt("return");case 1:return this.isWaitingForBackOff(i)||(u?u*=2:u=T.Z.get("SYNC_INITIAL_RETRY"),u=Math.min(u,T.Z.get("MAX_BACK_OFF")),T.Z.set("BACK_OFF",u,i),(l=new Date).setMilliseconds(l.getMilliseconds()+u),T.Z.set("BACK_OFF_EXPIRY",l.toISOString(),i),T.Z.set("BACK_OFF_CAUSE","".concat(s," for ").concat(u/1e3,"s"),i),clearTimeout(this._syncRetryTimeout),this._syncRetryTimeout=setTimeout(function(){p.emit(p.SYNC)},this.backOffWaitTime(i))),e.abrupt("return");case 2:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]);var n}(g.EventEmitter))},4434:(e,t,n)=>{n.d(t,{Z:()=>O});var r=n(6958),a=n.n(r),s=n(7537),i=n.n(s),o=n(8765),c=n.n(o),u=n(9548),l=n.n(u),p=n(3761),d=n.n(p),f=n(5370),_=n.n(f);const h=require("@babel/runtime/helpers/wrapNativeSuper");var E=n.n(h),S=n(8779),v=n.n(S),g=n(2037);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(t){v()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}var O=function(e){function t(e){var n,r,a,s,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return i()(this,t),r=this,a=t,s=[e||o instanceof Error&&o.message||"Unknown"],a=d()(a),n=l()(r,y()?Reflect.construct(a,s||[],d()(r).constructor):a.apply(r,s)),v()(n,"underlyingError",void 0),v()(n,"error_code",void 0),v()(n,"silent",!1),v()(n,"skipStack",!1),v()(n,"skipScrub",!1),v()(n,"context",""),v()(n,"headers",void 0),v()(n,"payload",{}),v()(n,"subErrorList",[]),v()(n,"supportData",void 0),o&&(o instanceof t?(n.silent=o.isSilent,n.underlyingError=o,o.hasSubErrors&&n.addSubError({err:o}),Object.assign(n.payload,o.ingestPayload)):n.underlyingError=o),n.error_code=c||n.underlyingError&&"string"!=typeof n.underlyingError&&n.underlyingError.code||"Unknown",n}return _()(t,e),c()(t,[{key:"addSubError",value:function(e){var n=this,r=e.err;return this.underlyingError||(r instanceof t?(this.silent=r.isSilent,this.underlyingError="",Object.assign(this.payload,r.ingestPayload)):this.underlyingError=""),"Unknown"===this.error_code&&r instanceof Error&&void 0!==r.code&&(this.underlyingError=r,this.error_code=r.code),r instanceof t&&null!=r&&r.hasSubErrors?r.subErrors.forEach(function(t){n.addSubError(m(m({},e),t))}):this.subErrorList.push(e),this}},{key:"assignSubErrors",value:function(e){return this.subErrorList.forEach(function(t){Object.assign(t,e,t)}),this}},{key:"addSubErrors",value:function(e){var t=this;Object.keys(e||{}).forEach(function(n){var r;null==e||null===(r=e[n].failed)||void 0===r||r.forEach(function(e){return t.addSubError(m(m({},e),{},{surface:n}))})})}},{key:"subErrorJSON",get:function(){var e={};return new Set(this.subErrorList.map(function(e){return e.surface})).forEach(function(t){return e[t||"unknown"]={failed:[]}}),this.subErrorList.forEach(function(t){e[t.surface||"unknown"].failed.push(m(m({},t),{},{surface:void 0}))}),this.subErrorList.length>0?e:void 0}},{key:"hasSubErrors",get:function(){return this.subErrorList.length>0}},{key:"subErrors",get:function(){return a()(this.subErrorList)}},{key:"code",get:function(){return this.error_code}},{key:"short",get:function(){return this.message+(this.context||"")}},{key:"description",get:function(){var e=this.context?this.context+g.EOL:"";return this.subErrorList&&(e+=this.subErrorList.map(function(e){var t,n;return(e.err instanceof String?e.err:"".concat(null===(t=e.err)||void 0===t?void 0:t.message," (").concat(null===(n=e.err)||void 0===n?void 0:n.code,")"))+"@ ".concat(e.url)}).join(g.EOL)),!this.skipStack&&this.stack&&(e+=this.stack+g.EOL),this.underlyingError&&(e+=" VIA ",this.underlyingError instanceof t?e+=this.underlyingError.message+" "+this.underlyingError.code+g.EOL+this.underlyingError.description+g.EOL:this.underlyingError instanceof Error?e+=this.underlyingError.message+this.underlyingError.code+(this.underlyingError.stack?g.EOL+this.underlyingError.stack:"")+g.EOL:e+=this.underlyingError),e}},{key:"responseHeaders",get:function(){return this.headers}},{key:"ingestPayload",get:function(){return this.payload}},{key:"setPayload",value:function(e){return Object.assign(this.payload,e),this}},{key:"setResponseHeaders",value:function(e){return this.headers=e,this}},{key:"setContext",value:function(e){return this.context+=e,this}},{key:"toString",value:function(){return this.message+(this.description||this.message?g.EOL:"")+this.description}},{key:"toJSON",value:function(){return{desc:this.context,message:this.message,code:this.code}}},{key:"toSnapshot",value:function(){var e="".concat(this.message," (").concat(this.code,") ");return this.underlyingError instanceof t?e+this.underlyingError.toSnapshot():this.underlyingError instanceof Error?e+this.underlyingError.message+(this.underlyingError.code?" ".concat(this.underlyingError.code):""):e+this.underlyingError}},{key:"silence",value:function(){return this.silent=!0,this}},{key:"removeStack",value:function(){return this.skipStack=!0,this}},{key:"scrubStatus",get:function(){return this.skipScrub}},{key:"skipErrorScrub",value:function(){return this.skipScrub=!0,this}},{key:"isSilent",get:function(){return this.silent}}])}(E()(Error))},5670:(e,t,n)=>{n.d(t,{Z:()=>I});var r=n(9293),a=n.n(r),s=n(9591),i=n.n(s),o=n(7537),c=n.n(o),u=n(8765),l=n.n(u),p=n(8779),d=n.n(p),f=n(1307),_=n.n(f),h=n(4147),E=n(4470),S=n(1017),v=n(2037),g=n(855),T=n(6653);const m=require("jsonschema");var y=n(2081),O=n(4434),A=function(){return l()(function e(){var t=this;c()(this,e),d()(this,"memoize",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.resolver,a=n.refresher,s=n.wrapper,i=n.timeout,o=void 0===i?T.Z.get("DEFAULT_MEMOIZE_TIMEOUT"):i,c=n.destructor,u=void 0===c?function(){return!0}:c,l=t,p=function(){var t=arguments,n=r?r.apply(this,t):t[0],i=p.cacheTimeout.get(n);if(i&&clearTimeout(i),o>0&&p.cacheTimeout.set(n,setTimeout(function e(){p.cache.get(n)&&(u(n,p.cache.get(n))?p.cache.delete(n):p.cacheTimeout.set(n,setTimeout(e,o)))},o)),p.cache.has(n)){var c=p.cache.get(n);if(!a||!a(c))return s?s(t,c,!0):c}var d=e.apply(this,t);return d instanceof Promise&&l.enablePromiseStateAccess(d),p.cache.set(n,d),s?s(t,d,!1):d};return p.cache=new Map,p.cacheTimeout=new Map,p}),d()(this,"throttle",function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;return function(){var a=this,s=(new Date).getTime(),i=arguments;t&&s<t+r?(clearTimeout(n),n=setTimeout(function(){t=s,e.apply(a,i)},r)):(t=s,e.apply(a,i))}}),d()(this,"setTimeoutAsync",function(e){return new Promise(function(t){return setTimeout(t,e)})})},[{key:"getTimeToExpiry",value:function(e){if(!e)return 0;var t=(new Date).valueOf(),n=new Date(e).valueOf()-t;return isNaN(n)?0:Math.max(0,n)}},{key:"enablePromiseStateAccess",value:function(e){e.state="pending",e.then(function(t){e.state="resolved",e.value=t},function(t){e.state="rejected",e.value=t})}},{key:"getPatchVersion",value:function(e){var t=e&&e.split(".");return t&&"".concat(t[2]?t[2]:0)}},{key:"getMinorVersion",value:function(e){var t=e&&e.split(".");return t&&"".concat(t[1])}},{key:"getMajorVersion",value:function(e){var t=e&&e.split(".");return t&&"".concat(t[0])}},{key:"isDebugModeEnabled",value:function(){return T.Z.get("DEBUG_MODE")}},{key:"enabledDiskLogVerbose",value:function(){return T.Z.get("DISK_LOG_VERBOSE_MODE")}},{key:"debuggingLogsEnabled",value:function(){return!!T.Z.get("debugging_logs").enabled}},{key:"isDateExpired",value:function(e){return 0===this.getTimeToExpiry(e)}},{key:"getHumanReadableTime",value:function(e){var t=e/36e5,n=e/6e4%60,r=e/1e3%60;return t>1?t.toFixed(2)+" hr":n>1?n.toFixed(2)+" min":r>1?r.toFixed(2)+" s":e+" ms"}},{key:"getRandomIntInclusive",value:function(e,t){var n=Math.ceil(e),r=Math.floor(t);return Math.floor(Math.random()*(r-n+1)+n)}},{key:"getRandomizedTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=T.Z.get("MIN_RANDOMIZED_TIME"),n=e?T.Z.get("MAX_RANDOMIZED_TIME_SHORT"):T.Z.get("MAX_RANDOMIZED_TIME");return Math.floor(Math.random()*(n-t))+t}},{key:"validateDataFields",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=new m.Validator;n&&n.forEach(function(e){r.addSchema(e,e.id)});var a=r.validate(e,t);return 0===a.errors.length?null:a.errors}},{key:"parseXml",value:(p=i()(_().mark(function e(t){return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,new Promise(function(){var e=i()(_().mark(function e(n,r){return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:g.parseString(t,function(e,t){e?r(e):n(t)});case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(e){return p.apply(this,arguments)})},{key:"getGSDKProductCodeMapping",value:function(e){var t=T.Z.get("GSDK_APP_CODE_MAPPINGS");return(null==t?void 0:t[e])||e}},{key:"getGSDKLanguage",value:function(e){return e.split("_").join("-")}},{key:"getSophiaLanguage",value:function(e){return e.split("-").join("_")}},{key:"getProcessVersion",value:function(){return"".concat(h.version,"-").concat("1")}},{key:"getGSDKVersion",value:function(){return h.dependencies["@growthsdk/growthsdk"].split("-")[0]}},{key:"isWindows",value:function(){return"win32"===process.platform}},{key:"getMacVersion",value:(u=i()(_().mark(function e(){var t;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this.exec("sw_vers -productVersion",{});case 1:return t=(t=e.sent).split("\n")[0],e.abrupt("return",t);case 2:return e.prev=2,e.catch(0),e.abrupt("return",this.getOsVersion());case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(){return u.apply(this,arguments)})},{key:"getMacBuildVersion",value:(o=i()(_().mark(function e(){var t;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this.exec("sw_vers -buildVersion",{});case 1:return t=(t=e.sent).split("\n")[0],e.abrupt("return",t);case 2:return e.prev=2,e.catch(0),e.abrupt("return","UNKNOWN");case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(){return o.apply(this,arguments)})},{key:"getOsVersion",value:function(){return v.release()}},{key:"getOsPlatform",value:function(){var e=this.isWindows()?"win":"mac";return"arm64"===v.arch()?e+="arm64":e+="64",e}},{key:"isUnsupportedMacOSVersion",value:(s=i()(_().mark(function e(){var t;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!C.getOsPlatform().startsWith("mac")){e.next=1;break}if(t=C.getOsVersion().split("."),parseInt(t[0],10)!=T.Z.get("UNSUPPORTED_MACOS_VERSIONS")){e.next=1;break}return e.abrupt("return",!0);case 1:return e.abrupt("return",!1);case 2:case"end":return e.stop()}},e)})),function(){return s.apply(this,arguments)})},{key:"isMacOSCatalina",value:function(){if(C.getOsPlatform().startsWith("mac")){var e=C.getOsVersion().split(".");if(19==parseInt(e[0],10))return!0}return!1}},{key:"parseMetaValue",value:function(e){var t=e.type,n=e.value;switch(t){case"Boolean":return"true"===n;case"Integer":return parseInt(n);default:return n}}},{key:"decodeMetadata",value:function(e){var t=Buffer.from(e,"base64").toString("utf8");return JSON.parse(t)}},{key:"isPatchEnabled",value:function(e,t){var n;return!!(null===(n=T.Z.get(e,t))||void 0===n?void 0:n.SUPPORT_PATCH)}},{key:"getClientContentVersion",value:function(e,t,n){return(T.Z.get("ACTIVE_VERSIONS",t)||[]).find(function(r){var a,s=null===(a=T.Z.get(r,t))||void 0===a?void 0:a.PREFETCH_CLIENTS,i=null==s?void 0:s[e.productCode];return 1!==C.compareMajorMinorVersions(i,e.productVersion,n)})||T.Z.get("ACTIVE_VERSIONS",t)[0]}},{key:"retryLocalErrors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.Z.get("RETRYABLE_DEFAULT_ATTEMPTS");return function(){var n=i()(_().mark(function n(r){var a,s,i,o=this;return _().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a=0,s=null,i=null;case 1:return s=null,n.next=2,e(r).catch(function(e){if(!T.Z.get("RETRYABLE_ERRORS").includes(null==e?void 0:e.code))throw e;s=e,o.log.disk("Retry-able error present. Retrying ".concat(a+1,". Underlying error ").concat(e))});case 2:i=n.sent;case 3:if(++a<t&&s){n.next=1;break}case 4:if(!s){n.next=5;break}throw new O.Z("LOCAL_NETWORK_ERROR_RETRY_FAILED",s);case 5:return n.abrupt("return",i);case 6:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()}},{key:"sanitizeLocale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.Z.get("SUPPORTED_LOCALES");if(t.includes(e))return e;var n=e.slice(0,2);return t.find(function(e){return e.slice(0,2)===n})||"en_US"}},{key:"compareMajorMinorVersions",value:function(e,t,n){if(n)return this.compareMajorMinorPatchVersions(e,t);if(!e)return 1;if(!t)return-1;var r,a,s,i;try{r=parseInt(e.split(".")[0],10),s=parseInt(e.split(".")[1]||"0",10)}catch(e){return 1}try{a=parseInt(t.split(".")[0],10),i=parseInt(t.split(".")[1]||"0",10)}catch(e){return-1}return r===a&&s===i?0:r<a||r===a&&s<i?1:-1}},{key:"compareMajorMinorPatchVersions",value:function(e,t){if(!e)return 1;if(!t)return-1;var n,r,a,s,i,o;try{n=parseInt(e.split(".")[0],10),a=parseInt(e.split(".")[1]||"0",10),i=parseInt(e.split(".")[2]||"0",10)}catch(e){return 1}try{r=parseInt(t.split(".")[0],10),s=parseInt(t.split(".")[1]||"0",10),o=parseInt(t.split(".")[2]||"0",10)}catch(e){return-1}return n===r&&a===s&&i===o?0:n<r||n===r&&a<s||a===s&&i<o?1:-1}},{key:"hasBeenUsedRecently",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.Z.get("STOP_SYNCING_BEYOND");if(!e)return!1;var n=new Date(e);return!isNaN(n)&&(n.setMilliseconds(t),n>new Date)}},{key:"getDiskSize",value:(r=i()(_().mark(function e(){var t,n,r,a=this,s=arguments;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:T.Z.get("ROOT_DIR"),e.next=1,E.readdir(t);case 1:return n=e.sent,e.next=2,C.waitAll(n.map(function(){var e=i()(_().mark(function e(n){var r;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=S.join(t,n),e.next=1,E.stat(n).catch(function(e){return{isFile:function(){return!1},size:0,isDirectory:function(){return!1}}});case 1:if(!(r=e.sent).isFile()){e.next=2;break}return e.abrupt("return",r.size);case 2:if(!r.isDirectory()){e.next=4;break}return e.next=3,a.getDiskSize(n);case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",0);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:return r=e.sent.reduce(function(e,t){return e+t},0),e.abrupt("return",r);case 3:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"deleteTempFiles",value:(n=i()(_().mark(function e(t){var n,r,a,s=arguments;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:864e5,r=new Date,e.next=1,E.readdir(t);case 1:return a=e.sent,e.next=2,C.waitAll(a.map(function(){var e=i()(_().mark(function e(a){var s,i;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=S.join(t,a),e.next=1,E.stat(s);case 1:if(i=e.sent,!(Number(r)-Number(i.mtime)<n)){e.next=2;break}return e.abrupt("return");case 2:return e.next=3,E.unlink(s);case 3:return e.abrupt("return","Deleted ".concat(s));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).map(function(e){return e.catch(function(e){return"Error deleting temp file: ".concat(e)})}));case 2:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})},{key:"compareValues",value:function(e,t){if(a()(e)!==a()(t))return!1;if("object"===a()(e)&&"object"===a()(t)){if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)&&Array.isArray(t))return JSON.stringify(e)===JSON.stringify(t);if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}return e===t}},{key:"scrubStack",value:function(e){return e?(e=e.toString()).replace(/[A-Z]?\:?(\\|\/).*\1/g,function(e){return e.length>=5?"<r>":e}).trim():e}},{key:"getLocks",value:(t=i()(_().mark(function e(t,n,r){return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,a){var s=void 0,i=void 0,o=function(){t(function(){return new Promise(function(e){s=e})})},c=function(){n(function(){return new Promise(function(e){i=e})})},u=function(){s&&i?r().then(e).catch(a).finally(function(){s(),i()}):s?(s(),s=void 0,setTimeout(o,10),setTimeout(u,30)):i?(i(),i=void 0,setTimeout(c,10),setTimeout(u,30)):setTimeout(u,20)};setTimeout(u,20),o(),c()}));case 1:case"end":return e.stop()}},e)})),function(e,n,r){return t.apply(this,arguments)})},{key:"waitAll",value:(e=i()(_().mark(function e(t){var n,r;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.next=1,Promise.all(t.map(function(e){return e.catch(function(e){return n=n||e})}));case 1:if(r=e.sent,!n){e.next=2;break}throw n;case 2:return e.abrupt("return",r);case 3:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})},{key:"exec",value:function(e,t){return new Promise(function(n,r){return(0,y.exec)(e,t,function(e,t){return e?r(e):n(t)})})}},{key:"isAdobeUser",value:function(e){return e&&e.email&&(e.email.includes("@adobe.com")||e.email.includes("@adobetest.com"))}}]);var e,t,n,r,s,o,u,p}(),C=new A;const I=C},2669:(e,t,n)=>{n.d(t,{NU:()=>f,UL:()=>h,ZP:()=>S,o7:()=>_});var r=n(9591),a=n.n(r),s=n(7537),i=n.n(s),o=n(8765),c=n.n(o),u=n(8779),l=n.n(u),p=n(1307),d=n.n(p),f=function(e){return e[e.Unknown=0]="Unknown",e[e.Deprecated=1]="Deprecated",e[e.SenseiModels=2]="SenseiModels",e[e.Stock=3]="Stock",e[e.CollectionTemplates=4]="CollectionTemplates",e[e.DiscoverPanel=5]="DiscoverPanel",e[e.FirstMileOld=6]="FirstMileOld",e[e.Lcm=7]="Lcm",e[e.Avatar=8]="Avatar",e[e.Learn=9]="Learn",e[e.CcdQuarternary=10]="CcdQuarternary",e[e.CcdTertiary=11]="CcdTertiary",e[e.CcdSecondary=12]="CcdSecondary",e[e.CcdPrimary=13]="CcdPrimary",e[e.FirstMileLatest=14]="FirstMileLatest",e[e.Photoshop=15]="Photoshop",e[e.CCXPFlags=16]="CCXPFlags",e[e.Illustrator=17]="Illustrator",e[e.IllustratorFlags=18]="IllustratorFlags",e[e.IndesignFlags=19]="IndesignFlags",e[e.FeatureFlags=20]="FeatureFlags",e[e.PhotoshopFlags=21]="PhotoshopFlags",e[e.Ghost=22]="Ghost",e[e.Survey=23]="Survey",e}({}),_=function(e){return e[e.Regular=0]="Regular",e[e.BackgroundRequest=1]="BackgroundRequest",e[e.Installation=2]="Installation",e[e.UrgentRequest=3]="UrgentRequest",e}({}),h=function(){return c()(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.key,r=void 0===n?"":n,a=t.value,s=void 0===a?0:a,o=t.channel,c=void 0===o?f.Unknown:o,u=t.level,p=void 0===u?_.Regular:u;i()(this,e),l()(this,"key",void 0),l()(this,"value",void 0),l()(this,"channel",void 0),l()(this,"level",void 0),this.key=r,this.value=s,this.channel=c,this.level=p},[{key:"toString",value:function(){return"".concat(1e3*this.queue+this.value)}},{key:"queue",get:function(){return this.channel+100*this.level}}])}(),E=f.Unknown+100*_.Regular,S=function(){return c()(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:108e5;i()(this,e),this.maxLocks=n,this.defaultTimeout=r,l()(this,"hasWriteLock",!1),l()(this,"readsInProgress",[]),l()(this,"pendingReads",[]),l()(this,"pendingWrites",[]),l()(this,"priorityOverrides",{}),l()(this,"prioritize",function(n){var r=n.key;r&&(t.priorityOverrides[r]=n,e.noTimeout()||setTimeout(function(){r&&delete t.priorityOverrides[r]},1e4),t.pendingReads.forEach(function(e){e.priority.key===r&&t.applyOverride(n,e.priority)}),t.check())})},[{key:"call",value:(s=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=setTimeout(function(){t.reject(new Error("Lock Timed out"))},t.timeout),e.next=1,t.callback().then(function(e){t.resolve(e),clearTimeout(n)}).catch(function(e){t.reject(e),clearTimeout(n)});case 1:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})},{key:"checkReads",value:(r=a()(d().mark(function e(){var t,n,r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],this.hasWriteLock||!(this.pendingReads.length>0)){e.next=3;break}r=d().mark(function e(){var r,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n,s=a.call(r).then(function(){a.readsInProgress.splice(a.readsInProgress.indexOf(r),1),a.check()}),t.push(s);case 1:case"end":return e.stop()}},e)});case 1:if(!(n=this.nextReadLock())){e.next=3;break}return e.delegateYield(r(),"t0",2);case 2:e.next=1;break;case 3:return e.next=4,Promise.all(t);case 4:return e.abrupt("return",t.length);case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"nextReadLock",value:function(){if(0!==this.pendingReads.length){var e=this.readsInProgress.length>0&&this.readsInProgress.reduce(function(e,t){return e.priority.queue>t.priority.queue?e:t}),t=e?e.priority.queue:E,n=this.pendingReads.reduce(function(e,t){return e.priority.queue>t.priority.queue?e:t}).priority.queue;if(!(n<t)){if(n===t)if(this.readsInProgress.filter(function(e){return e.priority.queue===t}).length>=this.maxLocks)return;var r=this.pendingReads.filter(function(e){return e.priority.queue===n});if(0!==r.length){var a=r.reduce(function(e,t){return t.priority.value>e.priority.value?t:e});return this.pendingReads.splice(this.pendingReads.indexOf(a),1),this.readsInProgress.push(a),a}}}}},{key:"check",value:(n=a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.checkReads();case 1:if(0===e.sent){e.next=2;break}e.next=0;break;case 2:if(0!==this.readsInProgress.length||this.hasWriteLock){e.next=4;break}if(!(t=this.pendingWrites.shift())){e.next=4;break}return this.hasWriteLock=!0,e.next=3,this.call(t);case 3:this.hasWriteLock=!1,this.check();case 4:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"read",value:(t=a()(d().mark(function e(t){var n,r,a=this,s=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:new h({}),r=s.length>2&&void 0!==s[2]?s[2]:this.defaultTimeout,n.channel=n.channel||f.Unknown,n.level=n.level||_.Regular,n.value=n.value||0,n.key&&this.priorityOverrides[n.key]&&this.applyOverride(this.priorityOverrides[n.key],n),e.abrupt("return",new Promise(function(e,s){a.pendingReads.push({callback:t,resolve:e,reject:s,priority:n,timeout:r}),a.check()}));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"write",value:(e=a()(d().mark(function e(t){var n,r=this,a=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.defaultTimeout,e.abrupt("return",new Promise(function(e,a){r.pendingWrites.push({callback:t,resolve:e,reject:a,timeout:n}),r.check()}));case 1:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"applyOverride",value:function(e,t){t.level=Math.max(t.level,e.level)}}],[{key:"noTimeout",value:function(){return!1}}]);var e,t,n,r,s}()},9444:(e,t,n)=>{n.d(t,{Z:()=>U});var r=n(9591),a=n.n(r);const s=require("@babel/runtime/helpers/construct");var i=n.n(s),o=n(6958),c=n.n(o),u=n(7537),l=n.n(u),p=n(8765),d=n.n(p),f=n(8779),_=n.n(f),h=n(1307),E=n.n(h),S=n(3837),v=n(5828),g=n(6653),T=n(9548),m=n.n(T),y=n(3761),O=n.n(y),A=n(5370),C=n.n(A),I=n(4470);function R(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(R=function(){return!!e})()}const N=new(function(e){function t(){var e,n,r,a;l()(this,t);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=this,r=t,a=[].concat(i),r=O()(r),e=m()(n,R()?Reflect.construct(r,a||[],O()(n).constructor):r.apply(n,a)),_()(e,"logFilePath","".concat(g.Z.get("LOG_DIR"),"CCX Process.log")),_()(e,"prevLogFilePath","".concat(g.Z.get("LOG_DIR"),"CCX Process (prev).log")),_()(e,"pendingLogWrite",void 0),_()(e,"writingToLog",!1),e}return C()(t,e),d()(t,[{key:"swapLogIfNeeded",value:function(e){var t=this;I.stat(this.logFilePath,function(n,r){!n&&r.size>g.Z.get("MAX_LOG_SIZE")?I.rename(t.logFilePath,t.prevLogFilePath,e):e(null)})}},{key:"doLogWrite",value:function(){var e=this;I.ensureDir(g.Z.get("LOG_DIR"),function(t){if(t)return e.pendingLogWrite=void 0,void console.log(t);e.swapLogIfNeeded(function(t){if(t)return e.pendingLogWrite=void 0,void console.log(t);var n=e.pendingLogWrite;e.pendingLogWrite=void 0,e.writingToLog=!0,I.appendFile(e.logFilePath,n,function(t){t&&console.log(t),e.writingToLog=!1,e.pendingLogWrite&&e.doLogWrite(),e.emit("logWrite")})})})}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.join(": ");g.Z.get("CONSOLE_LOGGING")&&r.match(new RegExp(process.argv[3]||".*"))&&console.log(r);var a=new Date,s=g.Z.get("JSON_LOGGING")?r:"".concat(a.toString().replace(/(\d+\:\d+\:\d+)/,"$1."+a.getMilliseconds())," ").concat(r,"\n");this.pendingLogWrite?this.pendingLogWrite+=s:(this.pendingLogWrite=s,this.writingToLog||this.doLogWrite())}}])}(n(1239).EventEmitter));var k,P=n(4434),L=n(2037),D=n(5670);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach(function(t){_()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var w=function(){return d()(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;l()(this,e),_()(this,"options",void 0),_()(this,"level",void 0),_()(this,"args",void 0),_()(this,"logArgs",[]),_()(this,"error",void 0),_()(this,"params",void 0),_()(this,"payload",void 0),_()(this,"surfaceAnalytics",void 0),this.options=t,this.level=n;for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];this.args=a,this.logArgs=[],this.payload=Object.assign({},this.options.payload),this.options.params&&this.setParams(this.options.params),this.options.surfaceAnalytics&&this.addSurfaceAnalytics(this.options.surfaceAnalytics)},[{key:"stringifyWithCycles",value:function(e){return"string"==typeof e?e:(e instanceof Error&&e.stack&&(e.stack=e.stack.replace(/[A-Z]?:?(\\|\/).*\1/g," ")),S.inspect(e))}},{key:"convertArgsToString",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(this.stringifyWithCycles).join(" ")}},{key:"post",value:function(){var e,t=this;if(this.error&&this.error instanceof P.Z&&this.error.isSilent)return this;this.options.skipDiskLog||(g.Z.get("JSON_LOGGING")?N.log(JSON.stringify(b(b(b({level:this.level.toUpperCase(),prefix:null===(e=this.options.prefix)||void 0===e?void 0:e.trim(),message:this.convertArgsToString.apply(this,c()(this.args).concat(c()(this.logArgs))).trim(),timestamp:(new Date).toISOString()},this.params),this.surfaceAnalytics),this.options.diskParams))+L.EOL):N.log(this.options.prefix+"[".concat(this.level.toUpperCase(),"] ")+this.convertArgsToString.apply(this,c()(this.args).concat(c()(this.logArgs)))));return(this.options.forceSilentError||!1!==this.options.analytics)&&(this.error instanceof P.Z&&this.error.hasSubErrors&&!this.options.combineSubErrors?this.error.subErrors.forEach(function(e){e.err&&k.logProcessEvent(b(b(b({},t.payload),e.err.ingestPayload||{}),e.url&&{"event.url":e.url}),t.params,[e],e.err,t.options.authenticationDisabled)}):k.logProcessEvent(this.payload,this.params,this.surfaceAnalytics,this.error,this.options.authenticationDisabled)),this}},{key:"addSurfaceAnalytics",value:function(e){var t;this.surfaceAnalytics=this.surfaceAnalytics||[],(t=this.surfaceAnalytics).push.apply(t,c()(e))}},{key:"addDiskLog",value:function(){var e;return this.args=(e=this.args).concat.apply(e,arguments),this}},{key:"appendPayload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.payload,e),this}},{key:"setError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P.Z("No error object passed");return e instanceof Error||(e=new P.Z(""+e)),this.appendPayload({"event.type":g.Z.analytics.ERROR}),e instanceof P.Z&&this.appendPayload(e.ingestPayload),this.args.push(e),this.error=e,this}},{key:"setParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.productCode&&this.logArgs.push(" for product ".concat(e.productCode,"[").concat(e.productSemver||e.productVersion,"]")+(e.productLanguage?"[".concat(e.productLanguage,"]"):"")),this.params=e,this}}])}(),U=function(){function e(t){l()(this,e),_()(this,"options",{}),this.options=t}return d()(e,[{key:"context",value:function(t){return new e(b(b(b({},this.options),t),{},{diskParams:b(b({},this.options.diskParams),t.diskParams),combineSubErrors:this.options.combineSubErrors||t.combineSubErrors,payload:b(b({},this.options.payload),t.payload),surfaceAnalytics:[].concat(c()(this.options.surfaceAnalytics||[]),c()(t.surfaceAnalytics||[]))}))}},{key:"disk",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i()(w,[b({analytics:!1},this.options),"DISK"].concat(t)).post()}},{key:"diskDebug",value:function(){if(D.Z.isDebugModeEnabled()){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i()(w,[b({analytics:!1},this.options),"DISK"].concat(t)).post()}}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return i()(w,[this.options,"error"].concat(n)).setError(e).post()}},{key:"info",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return i()(w,[this.options,"info",e].concat(n)).appendPayload({"event.type":g.Z.analytics.t_INFO,"ccxp.message":e}).post()}},{key:"event",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return i()(w,[this.options,e].concat(n)).appendPayload({"event.type":e}).post()}},{key:"warning",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return i()(w,[this.options,"warning",e].concat(n)).appendPayload({"event.type":g.Z.analytics.t_WARNING,"ccxp.message":e}).post()}},{key:"time",value:(r=a()(E().mark(function e(t){var n,r,a;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now(),r=new w(b(b({},this.options),{},{skipDiskLog:!0}),"Perf"),e.next=1,t(r);case 1:return a=e.sent,r.appendPayload({"event.dts_start":new Date(n).toISOString(),"event.dts_end":(new Date).toISOString(),"event.type":g.Z.analytics.t_PERFORMANCE,"event.value":r.payload&&r.payload["event.value"]||Date.now()-n}).post(),e.abrupt("return",a);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"request",value:(t=a()(E().mark(function e(t){var n,r,a,s,i,o,c;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.options,r=n.payload,a=n.silence,s=!!a||"usage-marker"===(null==r?void 0:r["ccxp.mode"]),i=r&&r["event.context_guid"]||v.v4(),o=Date.now(),s||new w(this.options,"INFO").appendPayload({"event.type":g.Z.analytics.t_REQUEST,"event.context_guid":i}).addDiskLog("Request Received").post(),c=new w(b(b({},this.options),{},{forceSilentError:!0}),"INFO"),e.next=1,t(c).then(function(e){return s||c.appendPayload({"event.type":g.Z.analytics.t_RESPONSE,"event.context_guid":i,"event.value":Date.now()-o,"ccxp.partial":!1}).addDiskLog("Response sent in ".concat(Date.now()-o,"ms")).post(),e}).catch(function(e){var t,n;throw e instanceof P.Z&&r&&r["event.subtype"]&&"client"==r["event.subtype"]&&(t={"ccxp.partial":!(null===(n=e.supportData)||void 0===n||!n.path)}),s||c.appendPayload(b({"event.context_guid":i},void 0!==t&&t)).setError(e).post(),e});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"console",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e;(e=console).log.apply(e,arguments)})}],[{key:"init",value:function(){k=n(3221).Z}}]);var t,r}();_()(U,"Builder",void 0),U.Builder=w},1167:(e,t,n)=>{n.d(t,{S:()=>D,Z:()=>b});var r=n(9591),a=n.n(r),s=n(7537),i=n.n(s),o=n(8765),c=n.n(o),u=n(9548),l=n.n(u),p=n(3761),d=n.n(p),f=n(5370),_=n.n(f),h=n(8779),E=n.n(h),S=n(1307),v=n.n(S),g=n(1239);const T=require("dns");var m=n(6653),y=n(9444),O=n(5670),A=n(7310),C=n(989),I=n(4434),R=n(4482),N=n(5828);function k(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(k=function(){return!!e})()}var P=R.ReachabilityChanged,L=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e.UNKNOWN="UNKNOWN",e}(L||{}),D=function(e){return e.OS_NETWORK_NOTIFICATION="OS_NETWORK_NOTIFICATION ",e.CLIENT_REQUEST="CLIENT_REQUEST",e.ONDEMAND_REQUEST="ONDEMAND_REQUEST",e.NETWORK_SLOW_POLL="NETWORK_SLOW_POLL",e.CCXPROCESS_INITIALIZED="CCXPROCESS_INITIALIZED",e.LOOKUP_MAP_SYNC="LOOKUP_MAP_SYNC",e.DOWNLOAD_FETCH_ERROR="DOWNLOAD_FETCH_ERROR",e.UNKNOWN="UNKNOWN",e}({}),x=new(function(e){function t(){var e,n,r,s;return i()(this,t),n=this,r=t,r=d()(r),e=l()(n,k()?Reflect.construct(r,s||[],d()(n).constructor):r.apply(n,s)),E()(e,"networkCheckTimeout",void 0),E()(e,"resolver",void 0),E()(e,"currentCheckId","unknown"),E()(e,"UNKNOWN",L.UNKNOWN),E()(e,"ONLINE",L.ONLINE),E()(e,"OFFLINE",L.OFFLINE),E()(e,"status",L.UNKNOWN),E()(e,"dnsFailed",!1),E()(e,"log",void 0),E()(e,"check",void 0),E()(e,"isOnline",void 0),e.log=new y.Z({prefix:"NetworkStatus >",payload:{"event.subcategory":m.Z.analytics.sc_Network,"event.subtype":m.Z.analytics.st_STATUS}}),e.resolver=new T.Resolver,e.isOnline=function(){return R.isOnline},e.check=O.Z.memoize(e.checkInternal.bind(e),{refresher:function(e){return"pending"!==e.state},destructor:function(e,t){return"pending"!==t.state}}),e.on(e.OFFLINE,O.Z.throttle(function(){var t=a()(v().mark(function t(n,r){return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n===e.OFFLINE){t.next=2;break}return O.Z.isDebugModeEnabled()&&e.log.disk("[".concat(r,"] Change in Network Status from ").concat(n," to ").concat(e.OFFLINE,". Entering Network Backoff")),t.next=1,C.Z.updateBackOff({type:C.E.NETWORK,cause:"Offline[Network Check]"});case 1:t.next=3;break;case 2:O.Z.isDebugModeEnabled()&&e.log.disk("[".concat(r,"] Detected OFFLINE Network Status (unchanged from before)"));case 3:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}(),m.Z.get("OFFLINE_SYNC_THROTTLE"))),e.on(e.ONLINE,O.Z.throttle(function(){var t=a()(v().mark(function t(n,r){return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n===e.ONLINE){t.next=3;break}return O.Z.isDebugModeEnabled()&&e.log.disk("[".concat(r,"] Change in Network Status from ").concat(n," to ").concat(e.ONLINE,".  Clearing Network Backoff")),t.next=1,C.Z.updateBackOff({clear:!0,type:C.E.NETWORK,sync:!1});case 1:return t.next=2,C.Z.updateBackOff({clear:!0,type:C.E.AUTH,sync:!0});case 2:e.clearScheduledNetworkCheck(),t.next=4;break;case 3:O.Z.isDebugModeEnabled()&&e.log.disk("[".concat(r,"] Detected ONLINE Network Status (unchanged from before)"));case 4:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}(),m.Z.get("ONLINE_SYNC_THROTTLE"))),R.on(P,a()(v().mark(function t(){return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.status===e.ONLINE){t.next=2;break}return t.next=1,e.runCheck();case 1:t.next=3;break;case 2:O.Z.isDebugModeEnabled()&&e.log.disk("Reachability Notification Received - Skipping network check since networks status is online.");case 3:case"end":return t.stop()}},t)}))),e}return _()(t,e),c()(t,[{key:"getDnsServers",value:(f=a()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,T.getServers();case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(){return f.apply(this,arguments)})},{key:"runCheck",value:(p=a()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.check(D.OS_NETWORK_NOTIFICATION);case 1:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"checkInternal",value:(u=a()(v().mark(function e(t){var n,r,a,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=N.v4(),this.currentCheckId=n,r=this.status,!m.Z.get("TEMP_NETWORK_STATUS_DISABLED")){e.next=2;break}return e.next=1,this.emitAndSetStatus(this.ONLINE,r,n);case 1:return e.abrupt("return");case 2:return e.next=3,this.isOnline();case 3:if(!e.sent){e.next=4;break}s=this.ONLINE,e.next=5;break;case 4:s=this.OFFLINE;case 5:if((a=s)!==this.OFFLINE){e.next=7;break}return O.Z.isDebugModeEnabled()&&this.log.disk("[".concat(n,"] isOnline() Check returned FALSE from ").concat(t)),e.next=6,this.dnsCheck(n,t);case 6:this.dnsFailed?O.Z.isDebugModeEnabled()&&this.log.disk("[".concat(n,"] DNS.resolve()  Check FAILED - from ").concat(t)):(a=this.ONLINE,O.Z.isDebugModeEnabled()&&this.log.disk("[".concat(n,"] DNS.resolve()  Check  SUCCESSFUL - from ").concat(t))),e.next=8;break;case 7:O.Z.isDebugModeEnabled()&&this.log.disk("[".concat(n,"] isOnline() Check returned TRUE from ").concat(t));case 8:if(r===a){e.next=10;break}return t===D.NETWORK_SLOW_POLL&&this.log.warning("Network Slow Poll resulted in changed Network Status").appendPayload({"event.value":"".concat(r,":").concat(this.status),"event.context_guid":n}),e.next=9,this.emitAndSetStatus(a,r,n);case 9:e.next=11;break;case 10:O.Z.isDebugModeEnabled()&&this.log.disk("[".concat(n,"] No Change in Network Status [").concat(this.status,"] Check due to ").concat(t));case 11:this.scheduleNextNetworkCheck(n);case 12:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"dnsCheck",value:(o=a()(v().mark(function e(t){var n,r,s=this,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:D.UNKNOWN,r=new A.URL(m.Z.get("DNS_RESOLVE_STATUS_CHECK_URL","DEFAULT")).host,O.Z.isDebugModeEnabled()&&this.log.disk("[".concat(t,"] triggered DNS check (").concat(r,") due to  ").concat(n)),e.abrupt("return",new Promise(function(){var e=a()(v().mark(function e(n){var i,o;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=Date.now(),o=setTimeout(function(){s.resolver.cancel(),O.Z.isDebugModeEnabled()&&s.log.disk("[".concat(t,"] DNS Timeout occured. Cancelling DNS Check")),s.dnsFailed=!0},m.Z.get("DNS_RESOLVE_TIMEOUT")),s.resolver.resolve(r,function(){var e=a()(v().mark(function e(a){var c,u,l,p,d,f,_,h,E;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=Date.now()-i,!a){e.next=2;break}return s.dnsFailed=!0,u=s.log,l=new I.Z("DNS FAILED TO RESOLVE",a,a.code),p=r,d=c,f=t,e.next=1,s.getDnsServers();case 1:_=e.sent,h={"event.url":p,"event.value":d,"event.context_guid":f,"ccxp.dns_ip":_},E=l.setPayload.call(l,h).silence(),u.error.call(u,E),e.next=3;break;case 2:s.dnsFailed=!1;case 3:clearTimeout(o),n();case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"scheduleNextNetworkCheck",value:(s=a()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:"unknown",this.status!==this.ONLINE&&this.currentCheckId===t?((n=new Date).setMilliseconds(m.Z.get("NETWORK_POLL_INTERVAL")),this.clearScheduledNetworkCheck(),this.log.disk("[".concat(t,"] Scheduling Next Network Check in: ").concat(O.Z.getHumanReadableTime(n.valueOf()-(new Date).valueOf()))),this.networkCheckTimeout=setTimeout(this.check.bind(this,D.NETWORK_SLOW_POLL),m.Z.get("NETWORK_POLL_INTERVAL"))):O.Z.isDebugModeEnabled()&&this.log.disk("[".concat(t,"] Network Status is ").concat(this.status,".  Not Scheduling Slow Poll. Network ID Matches ? ").concat(this.currentCheckId===t));case 1:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"emitAndSetStatus",value:(r=a()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.currentCheckId===r&&(this.status=t,this.emit(t,n,r));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"clearScheduledNetworkCheck",value:(n=a()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.networkCheckTimeout&&(O.Z.isDebugModeEnabled()&&this.log.disk("Clearing the slow poll"),clearTimeout(this.networkCheckTimeout),delete this.networkCheckTimeout);case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]);var n,r,s,o,u,p,f}(g.EventEmitter));x.setMaxListeners(30);const b=x},5002:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(7537),a=n.n(r),s=n(8765),i=n.n(s),o=n(7310),c=n(5670).Z,u=function(){return i()(function e(){a()(this,e)},null,[{key:"stripPathFromURL",value:function(e){if("string"==typeof e){var t=o.parse(e);if(t.protocol&&t.host)return"".concat(t.protocol,"//").concat(t.host)}}},{key:"getRetryAfterHeader",value:function(e){if(e){var t=e.get("retry-after");if(t)try{var n=parseInt(t,10);if(n)return Math.max(0,n);var r=new Date(t);if(!isNaN(r)){var a=(new Date).valueOf(),s=Math.max(0,r-a),i=c.getRandomizedTime();return Math.round((s+i)/1e3)}}catch(e){}}return 0}},{key:"getExpiry",value:function(e){var t=e.get("expiry")?new Date(e.get("expiry")||""):void 0,n=e.get("cache-control");if(n&&"string"==typeof n&&n.includes("max-age=")){var r=parseInt(n.split("max-age=")[1].trim(),10);isNaN(r)||(t=new Date).setSeconds(r)}if(t&&!isNaN(t))return t.toISOString()}},{key:"getContentTypeHeader",value:function(e){if(e){var t=e.get("content-type");if(t&&"string"==typeof t){var n=t.indexOf(";");return n>0&&(t=t.substring(0,n)),t}}}}])}()},9591:e=>{e.exports=require("@babel/runtime/helpers/asyncToGenerator")},7537:e=>{e.exports=require("@babel/runtime/helpers/classCallCheck")},8765:e=>{e.exports=require("@babel/runtime/helpers/createClass")},8779:e=>{e.exports=require("@babel/runtime/helpers/defineProperty")},3761:e=>{e.exports=require("@babel/runtime/helpers/getPrototypeOf")},5370:e=>{e.exports=require("@babel/runtime/helpers/inherits")},9548:e=>{e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},353:e=>{e.exports=require("@babel/runtime/helpers/slicedToArray")},6958:e=>{e.exports=require("@babel/runtime/helpers/toConsumableArray")},9293:e=>{e.exports=require("@babel/runtime/helpers/typeof")},1307:e=>{e.exports=require("@babel/runtime/regenerator")},6785:e=>{e.exports=require("@ccx/node-ProxyResolver")},5006:e=>{e.exports=require("@ccx/node-aid")},6815:e=>{e.exports=require("@ccx/node-ngl")},4482:e=>{e.exports=require("@ccx/node-reachability")},3446:e=>{e.exports=require("@ccx/node-vulcanjs")},1415:e=>{e.exports=require("@growthsdk/growthsdk")},1239:e=>{e.exports=require("events")},4470:e=>{e.exports=require("fs-extra")},7577:e=>{e.exports=require("ingest/src/ingest")},4809:e=>{e.exports=require("node-fetch")},2917:e=>{e.exports=require("simple-plist")},5828:e=>{e.exports=require("uuid")},3105:e=>{e.exports=require("winreg")},855:e=>{e.exports=require("xml2js")},2081:e=>{e.exports=require("child_process")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},8188:e=>{e.exports=require("module")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},4655:e=>{e.exports=require("v8")},6144:e=>{e.exports=require("vm")},4147:e=>{e.exports=JSON.parse('{"name":"ccx-welcome-process","version":"7.1.6","private":true,"description":"CCXProcess","dependencies":{"@babel/runtime":"^7.21.0","@ccx/adobe-cr":"git+ssh://git@git.corp.adobe.com:CCX/node-adobe-cr.git#v1.0.1","@ccx/node-ProxyResolver":"git+ssh://git@git.corp.adobe.com:ProjectCentral/node-ProxyResolver.git#v2.7.0","@ccx/node-aid":"git+ssh://git@git.corp.adobe.com:CCX/node-aid.git#v0.0.14","@ccx/node-ngl":"git+ssh://git@git.corp.adobe.com:ProjectCentral/node-ngl.git#v1.37.8","@ccx/node-reachability":"git+ssh://git@git.corp.adobe.com:CCX/node-reachability.git#v1.3.5","@ccx/node-vulcanjs":"git+ssh://git@git.corp.adobe.com:CCX/VulcanJS.git#v2.6.6","@ccx/parallel-fetch":"0.0.31","@growthsdk/growthsdk":"1.3.1-3","decompress":"^4.2.1","fs-ext":"2.0.0","fs-extra":"11.3.0","ingest":"git+ssh://git@git.corp.adobe.com:CCX/Ingest.git#v4.3.0","jsonschema":"1.4.1","mime":"3.0.0","mkdirp":"^2.1.3","simple-plist":"^1.3.1","uuid":"9.0.0","winreg":"^1.2.4","xml2js":"0.4.23"},"devDependencies":{"7zip":"0.0.6","@babel/cli":"^7.21.0","@babel/core":"^7.21.0","@babel/plugin-proposal-class-properties":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-transform-runtime":"^7.21.0","@babel/preset-env":"^7.20.2","@babel/preset-typescript":"^7.21.0","@ccx/hyperdrive-builder":"git+ssh://git@git.corp.adobe.com:CCX/hyperdrive-builder.git#5.0.10","@types/core-js":"^2.5.0","@types/decompress":"^4.2.3","@types/es6-promise":"^3.3.0","@types/fs-ext":"0.0.29","@types/fs-extra":"5.0.4","@types/glob":"^7.1.1","@types/jest":"23.3.7","@types/mime":"^2.0.0","@types/minimatch":"3","@types/mustache":"^4.0.1","@types/nock":"^9.3.0","@types/node":"^10.12.0","@types/uuid":"^3.4.4","@types/webpack":"^4.4.17","@types/winreg":"^1.2.4","@types/xml2js":"0.4.3","babel-loader":"^9.1.2","extract-zip":"2.0.1","glob":"7.1.3","husky":"1.1.2","jest":"23.6.0","jest-date-mock":"1.0.5","jest-extended":"0.11.0","jsftp":"2.1.3","matchdep":"2.0.0","mockery":"2.1.0","mustache":"^4.0.1","nock":"10.0.1","node-gyp":"^11.2.0","node-uglifier":"0.5.41","prettier":"2.0.5","pretty-quick":"1.8.0","terser-webpack-plugin":"5.3.6","ts-jest":"23.10.4","ts-loader":"9.4.2","ts-node":"10.9.1","ts-node-dev":"2.0.0","typescript":"3.8","webpack":"5.75.0","webpack-node-externals":"3.0.0"},"prettier":{"tabWidth":4,"useTabs":false,"singleQuote":true,"trailingComma":"all","printWidth":120,"arrowParens":"avoid","endOfLine":"auto"},"engines":{"node":">=22.17.1"},"scripts":{"test":"jest","coverage":"jest --coverage","updateBuildCoverageComment":"ts-node packaging/updateCoverage","main":"ts-node-dev --no-deps --files main --debug","kill":"pkill -f \\".*CCXProcess.app/Contents/MacOS/../js/main.js$\\"","killWin":"cmd /C taskkill /f /im \\"CCXProcess.exe\\" /t","build":"ts-node --files packaging/build.ts compile","build:arm":"ts-node --files packaging/build.ts compile arm","build:mac-arm":"ts-node --files packaging/build.ts compile mac-arm","package":"ts-node --files packaging/build.ts hyperdrive","package:arm":"ts-node --files packaging/build.ts hyperdrive arm","package:mac-arm":"ts-node --files packaging/build.ts hyperdrive mac-arm","jira":"node packaging/jiraRestApi","preinstall":"node packaging/credentials","start":"node -p \\"if (process.platform == \'darwin\') { try { require(\'child_process\').execSync(\'yarn run kill\')} catch(err) {}} else { try { require(\'child_process\').exec(\'yarn run killWin\')} catch (err) {}} require(\'child_process\').execSync(\'yarn run main\', {stdio: [0,1,2]})\\"","postinstall":"node packaging/fixDepsMac","installNoDepCopy":"NO_DEP_COPY=true yarn install","cleanup":"node cleanup-ccx-welcome.js"},"cepPanels":[{"NOTE":"REMOVING START 2.7 from the CCXPROCESS WILL CAUSE LEARN TAB TO GO MISSING IN FRESH INSTALLS OF CC 2019 APPS. ALSO DISABLE YBR NON 2.5 COMPATIBLE CAMPAIGNS BEFORE THIS, Locking 2.7.2-15 version","product":"CCX Start","subproduct":"Extension","version":"2.7.2","build":"2.7.2-15","certification":"Not Tested","destination":"com.adobe.ccx.start-2.7.2","name":"com.adobe.ccx.start"},{"product":"CCX Start","subproduct":"Extension","version":"2.16.0","certification":"Not Tested","destination":"com.adobe.ccx.start-2.16.0","name":"com.adobe.ccx.start"},{"product":"CCX Start","subproduct":"CmdN","version":"3.5.0","certification":"Not Tested","destination":"com.adobe.ccx.fnft-3.5.0","name":"com.adobe.ccx.fnft"}],"UNINSTALLATION INSTRUCTIONS":{"STEPS":"NAME THE KEY uninstall to uninstall extensions. The contents of the key add  an array objects each with a destination folder name and isCEP which is true if this is a CEP extension and false if this is a UXP extension.","SAMPLE":{"uninstall":[{"COMMENT":"The provided destination folder(com.adobe.ccx.start-2.6.1) in the CEP or UXP (CEP in this case) extension is deleted","destination":"com.adobe.ccx.start-2.6.1","isCEP":true}]}},"uninstall-example":[{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.3.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.3.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.5.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.5.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.5.1) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.5.1","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.6.1) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.6.1","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.7.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.7.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.7.2) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.7.2","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.7.4) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.7.4","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.8.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.8.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.9.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.9.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.10.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.10.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.11.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.11.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.12.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.12.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.13.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.13.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2.14.0) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2.14.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-2019) in CEP extensions is deleted","destination":"com.adobe.ccx.start-2019","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-3.1.0) in UXP extensions is deleted","destination":"com.adobe.ccx.start-3.1.0","isCEP":false},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-3.2.0) in UXP extensions is deleted","destination":"com.adobe.ccx.start-3.2.0","isCEP":false},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-3.3.0) in UXP extensions is deleted","destination":"com.adobe.ccx.start-3.3.0","isCEP":false},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-3.4.0) in UXP extensions is deleted","destination":"com.adobe.ccx.start-3.4.0","isCEP":false},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-3.5.0) in UXP extensions is deleted","destination":"com.adobe.ccx.start-3.5.0","isCEP":false},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-3.6.0) in UXP extensions is deleted","destination":"com.adobe.ccx.start-3.6.0","isCEP":false},{"COMMENT":"The provided destination folder (com.adobe.ccx.start-3.7.0) in UXP extensions is deleted","destination":"com.adobe.ccx.start-3.7.0","isCEP":false},{"COMMENT":"The provided destination folder (com.adobe.ccx.start.uxp-2019) in UXP extensions is deleted","destination":"com.adobe.ccx.start.uxp-2019","isCEP":false},{"COMMENT":"The provided destination folder (com.adobe.ccx.fnft-2.5.0) in CMDN extensions is deleted","destination":"com.adobe.ccx.fnft-2.5.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.fnft-2.5.1) in CMDN extensions is deleted","destination":"com.adobe.ccx.fnft-2.5.1","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.fnft-2.6.0) in CMDN extensions is deleted","destination":"com.adobe.ccx.fnft-2.6.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.fnft-3.0.0) in CMDN extensions is deleted","destination":"com.adobe.ccx.fnft-3.0.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.fnft-3.1.0) in CMDN extensions is deleted","destination":"com.adobe.ccx.fnft-3.1.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.fnft-3.2.0) in CMDN extensions is deleted","destination":"com.adobe.ccx.fnft-3.2.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.fnft-3.3.0) in CMDN extensions is deleted","destination":"com.adobe.ccx.fnft-3.3.0","isCEP":true},{"COMMENT":"The provided destination folder (com.adobe.ccx.fnft-3.4.0) in CMDN extensions is deleted","destination":"com.adobe.ccx.fnft-3.4.0","isCEP":true}],"uxpPanels":[{"product":"CCX Start","subproduct":"HomeScreenUXP","version":"10.4.1","certification":"Golden Master","destination":"com.adobe.ccx.start-10.4.1","name":"com.adobe.ccx.start.{{build}}"}],"thor":[{"product":"ACCC","subproduct":"Application","version":"6.0.0","certification":"Release Candidate","name":"ACCCx6_0_0_{{build}}","volume":"Creative Cloud","build":"^\\\\d+$"},{"product":"ACCC","subproduct":"HDSetup","version":"6.0.0","certification":"Release Candidate","name":"HDSetup","volume":"Release"}],"AdobePIM":{"product":"ACCC","subproduct":"AdobePIM","version":"6.0.0","certification":"Release Candidate","name":"AdobePIM","volume":"Release","platform":"winarm64","extension":"zip"},"resolutions":{"xml2js":"0.4.23","node-fetch":"v3.0.0-ccx.7"},"husky":{"hooks":{"pre-commit":"pretty-quick --staged"}}}')}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(6958),t=n.n(e),r=n(9591),a=n.n(r),s=n(7537),i=n.n(s),o=n(8765),c=n.n(o),u=n(8779),l=n.n(u),p=n(1307),d=n.n(p),f=n(6653),_=n(5670),h=n(9444),E=n(5717),S=n(4470),v=n(1017);const g=require("fs-ext");var T=n(5828),m=n(3837),y=n(2037);const O=require("decompress");var A=n(4434);function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return I(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var R=m.promisify(g.flock),N=function(){function e(){i()(this,e)}return c()(e,null,[{key:"writeJsonAtomic",value:(E=a()(d().mark(function t(n,r,a){var s,i,o,c=arguments;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=c.length>3&&void 0!==c[3]&&c[3],n.endsWith("/")||(n+="/"),o="".concat(i=n+r,"_").concat(T.v4(),".json"),t.next=1,S.ensureDir(n);case 1:return t.next=2,S.writeJson(o,a,{spaces:2,EOL:y.EOL});case 2:return t.next=3,e.rename(o,i,s);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t)})),function(e,t,n){return E.apply(this,arguments)})},{key:"readJson",value:(h=a()(d().mark(function e(t,n){var r,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),s=0,e.next=1,S.readJson(t).catch(function(){var e=a()(d().mark(function e(a){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s<100&&(s+=10),!a||"EACCES"!==a.code&&"EPERM"!==a.code&&"ENOENT"!==a.code&&"EBUSY"!==a.code||!(Date.now()-r<6e4)){e.next=3;break}return _.Z.isDebugModeEnabled()&&(null==n||n.disk("Error reading JSON file with backoff ".concat(s,": ").concat(t," --- ").concat(a))),e.next=1,_.Z.setTimeoutAsync(s);case 1:return e.next=2,S.readJson(t).catch(i);case 2:return e.abrupt("return",e.sent);case 3:throw a;case 4:case"end":return e.stop()}},e)}));function i(t){return e.apply(this,arguments)}return i}());case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(e,t){return h.apply(this,arguments)})},{key:"unzip",value:(p=a()(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",O(t,n));case 1:case"end":return e.stop()}},e)})),function(e,t){return p.apply(this,arguments)})},{key:"rename",value:(l=a()(d().mark(function t(n,r){var s,i,o,c=arguments;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=c.length>2&&void 0!==c[2]&&c[2],i=Date.now(),o=0,t.next=1,S.rename(n,r).catch(function(){var t=a()(d().mark(function t(a){return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o<100&&(o+=10),!a||"EACCES"!==a.code&&"EPERM"!==a.code&&"ENOENT"!==a.code&&"EBUSY"!==a.code||!(Date.now()-i<6e4)){t.next=7;break}return t.next=1,_.Z.setTimeoutAsync(o);case 1:if(!s){t.next=3;break}return t.next=2,e.removeOrRename(r);case 2:r=t.sent;case 3:return t.next=4,S.pathExists(r);case 4:if(!t.sent){t.next=5;break}throw a;case 5:return t.next=6,S.rename(n,r).catch(c);case 6:return t.abrupt("return",r);case 7:throw a;case 8:case"end":return t.stop()}},t)}));function c(e){return t.apply(this,arguments)}return c}());case 1:return t.abrupt("return",r);case 2:case"end":return t.stop()}},t)})),function(e,t){return l.apply(this,arguments)})},{key:"writeAtomic",value:(u=a()(d().mark(function t(n){var r,a,s,i,o,c,u,l;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.response,a=n.target,s=n.progress,i=void 0===s?function(){}:s,o=n.renameOnError,c=void 0!==o&&o,u=a+f.Z.get("DOWNLOAD_TMP_EXTENSION"),l=_.Z.throttle(i,f.Z.get("PROGRESS_THROTTLE_INTERVAL")),t.next=1,S.ensureDir(v.dirname(a));case 1:if(!c){t.next=3;break}return t.next=2,e.removeOrRename(u);case 2:u=t.sent;case 3:return r.emitter.on("progress",function(e){l(e.done,e.total,u)}),t.next=4,r.file(u);case 4:return r.emitter.removeAllListeners(),t.next=5,e.rename(u,a,c);case 5:return t.abrupt("return",a);case 6:case"end":return t.stop()}},t)})),function(e){return u.apply(this,arguments)})},{key:"removeOrRename",value:(o=a()(d().mark(function t(n){var r;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,S.remove(n).catch(function(){});case 1:return t.next=2,S.access(n).then(function(){return!0}).catch(function(e){return"ENOENT"!==e.code});case 2:if(!t.sent){t.next=5;break}if(r=n,(n=e.renameFile(n))!==r){t.next=3;break}return t.abrupt("return",n);case 3:return t.next=4,S.remove(n).catch(function(){});case 4:t.next=1;break;case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}},t)})),function(e){return o.apply(this,arguments)})},{key:"renameFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.Z.get("MAX_EPERM_RENAMES"),n=v.extname(e),r=v.basename(e,n),a=r.substr(-3),s=/^\-(\d\d)$/.exec(a),i=s&&s[1]?parseInt(s[1],10):0,o=r.substr(0,r.length-3);return 0===i&&(o=r),++i>t?e:(i<10&&(i="0"+i),v.join(v.dirname(e),o+"-"+i+n))}},{key:"cleanupFolder",value:(s=a()(d().mark(function e(t){var n,r,s,i,o,c,u=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2&&void 0!==u[2]?u[2]:/^$/,e.next=1,S.ensureDir(t);case 1:return e.next=2,S.readdir(t);case 2:return s=e.sent,i=[],o=[],c=[],s.forEach(function(){var e=a()(d().mark(function e(a){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n[a]||r.test(a)?i.push(a):c.push(S.remove(t+a).then(function(){o.push(a)}).catch(function(){i.push(a)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=3,_.Z.waitAll(c);case 3:return e.abrupt("return",{left:i.sort(),removed:o.sort()});case 4:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})},{key:"obtainProcessLock",value:(r=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.Z.get("ROOT_DIR"),e.next=1,S.ensureDir(n);case 1:return r="".concat(n,".").concat(t),e.next=2,S.open(r,"w");case 2:return a=e.sent,e.next=3,R(a,"exnb");case 3:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"getFileSize",value:(n=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,S.stat(t);case 1:return e.abrupt("return",e.sent.size);case 2:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})},{key:"generateFileStats",value:(t=a()(d().mark(function e(t){var n,r,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r=function(){var e=a()(d().mark(function e(r){var a,s,i,o,c,u,l,p,f,_,h,E,g,T;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=S.readdirSync(r),s=a.filter(function(e){return S.statSync(v.join(r,e)).isDirectory()}),i=C(s);try{for(i.s();!(o=i.n()).done;)if(c=o.value,(u=S.readdirSync(v.join(t,c)))&&Array.isArray(u)){l=v.join(r,c,"assets"),p=S.readdirSync(l),f=C(p);try{for(f.s();!(_=f.n()).done;)h=_.value,E=v.join(l,h),g=v.extname(h),n.summary||(n.summary={totalCount:0,totalSizeMB:0}),n[c]||(n[c]={}),n[c].total||(n[c].total={totalCount:0,totalSizeMB:0}),n[c][g]||(n[c][g]={fileCount:0,fileSize:0}),T=parseFloat((S.statSync(E).size/1024/1024).toFixed(3)),n[c][g].fileCount++,n[c][g].fileSize=parseFloat((n[c][g].fileSize+T).toFixed(3)),n[c].total.totalCount++,n[c].total.totalSizeMB=parseFloat((n[c].total.totalSizeMB+T).toFixed(3)),n.summary.totalCount++,n.summary.totalSizeMB=parseFloat((n.summary.totalSizeMB+T).toFixed(3))}catch(e){f.e(e)}finally{f.f()}}}catch(e){i.e(e)}finally{i.f()}case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=v.join(f.Z.get("ROOT_DIR"),f.Z.get("FILE_FOLDER_SUMMARY_FILE")),S.writeFile(n,JSON.stringify(t,null,2),function(e){if(e)throw e});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),e.next=1,r(t).catch(function(e){throw new A.Z("Error generating File Stats Summary for dir ".concat(t," "),e)});case 1:if(!_.Z.isDebugModeEnabled()){e.next=2;break}return e.next=2,s(n).catch(function(e){throw new A.Z("Error writing to File Stats Summary File",e)});case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}]);var t,n,r,s,o,u,l,p,h,E}(),k=n(989),P=n(353),L=n.n(P),D=n(7310),x=n(2669),b=n(3221);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var M=n(1858).Z,Z=function(){return c()(function e(){i()(this,e)},null,[{key:"getMissingProductList",value:(E=a()(d().mark(function e(t){var n,r,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new h.Z({prefix:"LookupMapUtils > ".concat(t.type),payload:{"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",t.type)}}),r=f.Z.get("SUPPORTED_PRODUCTS",t.type),s=[],e.next=1,M.getInstalledApps();case 1:if(!(i=e.sent)){e.next=2;break}return e.next=2,Promise.all(Object.keys(i).map(function(){var e=a()(d().mark(function e(o){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r[o]){e.next=1;break}return e.abrupt("return",Promise.all(Object.keys(i[o]).map(function(){var e=a()(d().mark(function e(a){var c,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.getProductAlias({productCode:o,productVersion:a}),l=null===(c=i[o][a].InstallLanguage)||void 0===c?void 0:c.split(","),e.abrupt("return",Promise.all((l||[]).map(function(e){var i={productCode:u,productVersion:a,productLanguage:e,sapCode:o};if(r[u]&&!t.isRequestPoisoned(i)){var c=t._getCollectionInfo(i);c?Object.keys(c).forEach(function(e){var n=c[e];t._data.metadata[n].params.sapCode=o,t.save()}):(n.disk("App NOT found, Adding : ",u,a,e),s.push(i))}})));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())));case 1:return e.abrupt("return");case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",s);case 3:case"end":return e.stop()}},e)})),function(e){return E.apply(this,arguments)})},{key:"getExcessProductList",value:(p=a()(d().mark(function e(n){var r,s,i,o,c,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],c=Object,e.next=1,n.getCachedRequestData();case 1:if(u=e.sent){e.next=2;break}u={};case 2:return l=u,c.values.call(c,l).forEach(function(e){Object.values(e).forEach(function(e){r.push.apply(r,t()(e))})}),e.next=3,M.getInstalledApps();case 3:if(s=e.sent,i=[],o=f.Z.get("SUPPORTED_PRODUCTS",n.type),!s){e.next=5;break}return e.next=4,Promise.all(Object.keys(s).map(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o[t]&&Object.keys(s[t]).map(function(e){var r,a=n.getProductAlias({productCode:t,productVersion:e});((null===(r=s[t][e].InstallLanguage)||void 0===r?void 0:r.split(","))||[]).forEach(function(t){i.push({productCode:a,productVersion:e,productLanguage:t})})});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",r.filter(function(e){return!i.find(function(t){return t.productCode===e.productCode&&t.productLanguage===e.productLanguage&&n.makeVersionLookupKey(t.productVersion)===n.makeVersionLookupKey(e.productVersion)})}));case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}},e)})),function(e){return p.apply(this,arguments)})},{key:"getStockCollectionUrl",value:function(e){var t=e.id,n=e.params,r=e.options,a=e.map,s=f.Z.getEnvironment(),i=new D.URL(f.Z.get("COLLECTION_URL_".concat(s.LABEL.toUpperCase()),a.type));return n.productCode&&i.searchParams.set("product",n.productCode),n.productLanguage&&i.searchParams.set("locale",n.productLanguage),n.countryCode&&i.searchParams.set("country_code",n.countryCode),i.searchParams.set("search_parameters[offset]",r.offset||"0"),i.searchParams.set("search_parameters[gallery_id]",t),i.searchParams.set("search_parameters[limit]",r.limit||"100"),i.searchParams.set("ff_9909481692","1"),i.searchParams.set("search_parameters[enable_templates]",r.enable_templates||"1"),i.toString()}},{key:"downloadStockCollection",value:(u=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h,E,S,g,T,m,y,O;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,r=t.params,s=t.map,i=t.force,o=void 0===i?{type:"none"}:i,c=t.priority,u=t.options,l=void 0===u?{}:u,p=new A.Z(f.Z.analytics.AGGREGATE_ERROR,"CollectionTemplates"+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),h=0,E=0,(S=new x.UL(c)).channel=x.NU.CollectionTemplates,g=this.getStockCollectionUrl({id:n,params:r,options:l,map:s}),e.next=1,s.fetchAsset({href:g,priority:S,force:o,params:r,assetsDir:s.assetsDir,headers:{"X-API-Key":f.Z.getEnvironment().CLIENT_ID,"X-Product":"".concat(r.productCode),"Content-Type":"application/json"}}).catch(function(e){return p.addSubError({err:e,url:g}),{time:0,path:void 0}});case 1:if(T=e.sent,h+=T.time,E++,!(m=T.path)){e.next=3;break}return y="".concat(s.getPath(),"/").concat(m),e.next=2,N.readJson(y).catch(function(e){throw s.clearAssetMetadata(g),e});case 2:if(!(O=e.sent).files){e.next=3;break}return e.next=3,_.Z.waitAll(O.files.map(function(){var e=a()(d().mark(function e(t){var n,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=t.thumbnail_url)||void 0===n||!n.startsWith("http")){e.next=2;break}return e.next=1,s.fetchAsset({href:t.thumbnail_url,priority:S,force:U(U({},o),{},{depth:o.depth-1}),params:r,assetsDir:s.assetsDir}).catch(function(e){return p.addSubError({url:t.thumbnail_url,err:e}),{time:0,path:t.thumbnail_url}});case 1:a=e.sent,t.thumbnail_url=a.path,h+=a.time,E++;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).finally(a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,N.writeJsonAtomic(v.dirname(y)+"/",v.basename(y),O,!0);case 1:if(!(t=e.sent)||t===y){e.next=2;break}return m=v.basename(v.dirname(t))+"/"+v.basename(y),s.cachedAsset(g).path=m,e.next=2,s.save();case 2:case"end":return e.stop()}},e)})));case 3:if(!p.hasSubErrors&&m){e.next=4;break}throw p.assignSubErrors({id:n});case 4:return e.abrupt("return",{path:m,time:h,count:E});case 5:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"getTutorialUrl",value:function(e){var t=e.id,n=e.productLanguage,r=e.status,a=void 0===r?"live":r,s=e.productVersion,i=e.productSemver,o=e.surface,c=void 0===o?"in_app_panel:v2":o,u=f.Z.getEnvironment(),l=new D.URL(f.Z.get("URL_".concat(u.LABEL.toUpperCase()),"UTUTS_SERVICE"));return l.searchParams.set("aem_id",t),n&&l.searchParams.set("locale",n),l.searchParams.set("inline_surface",c),l.searchParams.set("status",a),i?l.searchParams.set("app_version",i):s&&l.searchParams.set("app_version",s),l.toString()}},{key:"getPlaylistUrl",value:function(e){var t=e.aem_id,n=e.locale,r=void 0===n?"en_US":n,a=e.status,s=void 0===a?"live":a,i=f.Z.getEnvironment(),o=new D.URL(f.Z.get("URL_".concat(i.LABEL.toUpperCase()),"PLAYLIST_SERVICE"));return o.searchParams.set("aem_id",t),o.searchParams.set("locale",r),o.searchParams.set("status",s),o.toString()}},{key:"downloadSinglePlaylist",value:(o=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,_,h,E;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lookupMap,r=t.force,t.bundle,a=t.aem_id,s=t.locale,i=t.status,o=t.error,c=t.params,u=t.priority,l=[],p="",_=this.getPlaylistUrl({aem_id:a,locale:s,status:i}),e.next=1,n.fetchAsset({href:_,assetsDir:n.assetsDir,priority:u,params:U(U({},c),{},{filePrefix:"PLAYLIST"}),headers:{"x-api-key":f.Z.getEnvironment().CLIENT_ID,"x-forwarded-for":b.Z.getIpAddress()},force:U(U({},r),{},{depth:(r.depth||0)-2})}).catch(function(e){return o.addSubError({err:e,url:_}),{path:void 0,time:0}});case 1:if(!(h=e.sent).path){e.next=3;break}return E=v.basename(h.path),e.next=2,N.readJson("".concat(n.assetsDir,"/").concat(E)).catch(function(e){return n.clearAssetMetadata(_),o.addSubError({err:e,url:_}),[]});case 2:return l=e.sent,e.abrupt("return",{learnPlaylists:l,totalTime:h.time,count:1,playlistPath:h.path,location:p});case 3:return e.abrupt("return",{learnPlaylists:l,totalTime:0,count:0,playlistPath:void 0,location:p});case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"downloadTutorial",value:(s=a()(d().mark(function e(t){var n,r,s,i,o,c,u,p,h,E,S,g,T,m,y,O,C,I,R,k,P,L,D,b,w,M,Z;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,r=t.id,s=t.url,i=t.priority,o=t.inline_surface,c=t.force,u=void 0===c?{type:"none"}:c,p=t.analyticsData,h=t.filePrefix,E=t.status,S=void 0===E?"live":E,g=t.ututMetaLocale,T=t.map,m=t.shouldPrefetchTemplates,y=void 0!==m&&m,O=t.downloadableTemplates,C=void 0===O?[]:O,I=new A.Z(f.Z.analytics.AGGREGATE_ERROR,"Ututs"+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),R=0,k=0,P=U(U({},n),{},{filePrefix:h}),(L=new x.UL(i)).channel=x.NU.Lcm,D=null!=s?s:this.getTutorialUrl({id:r,productLanguage:g,status:S,productVersion:n.productVersion,productSemver:n.productSemver,surface:o||f.Z.get("UTUTS_API_REQUEST_SURFACE",T.type)}),e.next=1,T.fetchAsset({href:D,analyticsData:p,priority:L,force:u,params:P,assetsDir:T.assetsDir,headers:{"X-API-Key":f.Z.getEnvironment().CLIENT_ID}}).catch(function(e){return I.addSubError({err:e,url:D}),{time:0,path:void 0}});case 1:if(b=e.sent,R+=b.time,k++,!(w=b.path)){e.next=5;break}return M="".concat(T.getPath(),"/").concat(w),e.next=2,N.readJson(M).catch(function(e){T.clearAssetMetadata(D),I.addSubError({err:e,id:r,url:D})});case 2:if(Z=e.sent,!Array.isArray(null==Z?void 0:Z.tutorials)){e.next=4;break}return e.next=3,_.Z.waitAll(Z.tutorials.map(function(){var e=a()(d().mark(function e(t){var n,r,a,s,i,o,c;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y&&(null===(a=t.surfaces)||void 0===a||null===(a=a.in_app_panel)||void 0===a?void 0:a.template)&&(s=w)&&C.push(l()({},s,Z)),null===(n=t.metadata)||void 0===n||null===(n=n.images)||void 0===n||!n.hero){e.next=2;break}return e.next=1,T.fetchAsset({href:t.metadata.images.hero,analyticsData:p,priority:L,force:U(U({},u),{},{depth:u.depth-1}),params:P,assetsDir:T.assetsDir}).catch(function(e){var n;return I.addSubError({url:null===(n=t.metadata)||void 0===n||null===(n=n.images)||void 0===n?void 0:n.hero,err:e}),{time:0,path:void 0}});case 1:i=e.sent,t.metadata.images.heroPath=i.path,R+=i.time,k++;case 2:if(null===(r=t.metadata)||void 0===r||null===(r=r.images)||void 0===r||!r.thumbnail){e.next=4;break}return e.next=3,T.fetchAsset({href:t.metadata.images.thumbnail,analyticsData:p,priority:L,force:U(U({},u),{},{depth:u.depth-1}),params:P,assetsDir:T.assetsDir}).catch(function(e){var n;return I.addSubError({err:e,url:null===(n=t.metadata)||void 0===n||null===(n=n.images)||void 0===n?void 0:n.thumbnail}),{time:0,path:void 0}});case 3:o=e.sent,t.metadata.images.thumbnailPath=o.path,R+=o.time,k++;case 4:return e.next=5,N.writeJsonAtomic(v.dirname(M)+"/",v.basename(M),Z,!0);case 5:if(!(c=e.sent)||c===M){e.next=6;break}return w=v.basename(v.dirname(c))+"/"+v.basename(M),T.cachedAsset(D).path=w,e.next=6,T.save();case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:e.next=5;break;case 4:if(!Array.isArray(null==Z?void 0:Z.playlists)){e.next=5;break}return e.next=5,_.Z.waitAll(null==Z?void 0:Z.playlists.map(function(){var e=a()(d().mark(function e(t){var n,r,a,s,i,o,c;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t||null===(n=t.images)||void 0===n||!n.hero){e.next=2;break}return e.next=1,T.fetchAsset({href:null===(a=t.images)||void 0===a?void 0:a.hero,analyticsData:p,priority:L,force:U(U({},u),{},{depth:u.depth-1}),params:P,assetsDir:T.assetsDir}).catch(function(e){var n;return I.addSubError({url:null==t||null===(n=t.images)||void 0===n?void 0:n.hero,err:e}),{time:0,path:void 0}});case 1:s=e.sent,t.images.heroPath=s.path,R+=s.time,k++;case 2:if(null==t||null===(r=t.images)||void 0===r||!r.thumbnail){e.next=4;break}return e.next=3,T.fetchAsset({href:null==t||null===(i=t.images)||void 0===i?void 0:i.thumbnail,analyticsData:p,priority:L,force:U(U({},u),{},{depth:u.depth-1}),params:P,assetsDir:T.assetsDir}).catch(function(e){var n;return I.addSubError({url:null===(n=t.images)||void 0===n?void 0:n.thumbnail,err:e}),{time:0,path:void 0}});case 3:o=e.sent,t.images.thumbnailPath=o.path,R+=o.time,k++;case 4:return e.next=5,N.writeJsonAtomic(v.dirname(M)+"/",v.basename(M),Z,!0);case 5:if(!(c=e.sent)||c===M){e.next=6;break}return w=v.basename(v.dirname(c))+"/"+v.basename(M),T.cachedAsset(D).path=w,e.next=6,T.save();case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 5:if(!I.hasSubErrors&&w){e.next=6;break}throw I.assignSubErrors({id:r});case 6:return e.abrupt("return",{path:w,time:R,count:k});case 7:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"downloadImagesHelper",value:(r=a()(d().mark(function e(t,n,r,s){var i,o,c,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=0,o=0,c=function(){var e=a()(d().mark(function e(t,n,r,a){var s,c,u,l,p,f,_,h;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:p={},(null==r||null===(s=r.images)||void 0===s?void 0:s.hero)&&(p[r.images.hero]={assetType:"hero",assetRef:r.images}),(null==r||null===(c=r.images)||void 0===c?void 0:c.thumbnail)&&(p[r.images.thumbnail]={assetType:"thumbnail",assetRef:r.images}),(null==r||null===(u=r.metadata)||void 0===u||null===(u=u.images)||void 0===u?void 0:u.hero)&&(p[r.metadata.images.hero]={assetType:"hero",assetRef:r.metadata.images}),(null==r||null===(l=r.metadata)||void 0===l||null===(l=l.images)||void 0===l?void 0:l.thumbnail)&&(p[r.metadata.images.thumbnail]={assetType:"thumbnail",assetRef:r.metadata.images}),(null==r?void 0:r.hero)&&(p[r.hero]={assetType:"hero",assetRef:r}),(null==r?void 0:r.thumbnail)&&(p[r.thumbnail]={assetType:"thumbnail",assetRef:r}),f=d().mark(function e(){var r,s,c,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=L()(h[_],2),s=r[0],c=r[1],u=c.assetType,l=c.assetRef,t.href=s,e.next=1,n.fetchAsset(t).then(function(e){var t="".concat(u,"Path");l[t]=e.path,e.time&&(i++,o+=e.time)}).catch(function(e){return a.addSubError({err:e,url:s}),{path:void 0,time:0}});case 1:case"end":return e.stop()}},e)}),_=0,h=Object.entries(p);case 1:if(!(_<h.length)){e.next=3;break}return e.delegateYield(f(),"t0",2);case 2:_++,e.next=1;break;case 3:return e.abrupt("return",{count:i,totalTime:o});case 4:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),e.prev=1,e.next=2,c(t,n,r,s);case 2:return u=e.sent,e.abrupt("return",{count:u.count,totalTime:u.totalTime});case 3:return e.prev=3,l=e.catch(1),s.addSubError(l),e.abrupt("return",{count:i,totalTime:o});case 4:case"end":return e.stop()}},e,null,[[1,3]])})),function(e,t,n,a){return r.apply(this,arguments)})},{key:"getDownloadedTemplateCount",value:(n=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,e.next=1,_.Z.waitAll((t||[]).map(function(){var e=a()(d().mark(function e(t){var r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=Object.keys(t)[0],null!=(s=t[a])&&null!==(r=s.surfaces)&&void 0!==r&&null!==(r=r.in_app_panel)&&void 0!==r&&r.templatePath&&n++;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:return e.abrupt("return",n);case 2:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})},{key:"processContentFile",value:(e=a()(d().mark(function e(t,n,r,a){var s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=v.join(n.assetsDir,v.basename(r)),e.next=1,N.readJson(s).catch(function(e){return delete a[t.path],{}});case 1:return i=e.sent,e.abrupt("return",i);case 2:case"end":return e.stop()}},e)})),function(t,n,r,a){return e.apply(this,arguments)})}]);var e,n,r,s,o,u,p,E}(),F=n(3193),G=n(9106),V=n(9548),H=n.n(V),K=n(3761),B=n.n(K);const j=require("@babel/runtime/helpers/get");var W=n.n(j),Y=n(5370),X=n.n(Y),q=n(9293),J=n.n(q),Q=n(1167);const z=require("mime");var $=n(5002),ee=n(1239);const te=require("abort-controller");var ne=n.n(te);const re=require("@ccx/parallel-fetch");var ae=n.n(re),se=n(1858),ie=n(3837),oe=ie.promisify(n(2917).writeFile),ce=ie.promisify(n(2081).exec),ue=n(4470);const le=new(function(){return c()(function e(){i()(this,e),l()(this,"log",new h.Z({prefix:"CCXProcessScheduler > "}))},[{key:"updateMacOsScheduler",value:(n=a()(d().mark(function e(t,n){var r,a,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={Label:"com.adobe.ccxprocess",ProgramArguments:["/Applications/Utilities/Adobe Creative Cloud Experience/CCXProcess/CCXProcess.app/Contents/MacOS/CCXProcess","--openAtBoot"],StartCalendarInterval:{Hour:t,Minute:n}},a=f.Z.get("LAUNCH_AGENT"),s=f.Z.get("LAUNCH_DIRECTORY"),e.next=1,ue.ensureDir(s).catch(function(e){throw new Error("Error creating user launch agent directory")});case 1:return e.next=2,oe(a,r).catch(function(e){throw new Error("Error writing plist file in user launch agent directory")});case 2:return i="launchctl  unload -w ".concat(process.env.HOME,"/Library/LaunchAgents/com.adobe.ccxprocess.plist ;  launchctl load -w ").concat(process.env.HOME,"/Library/LaunchAgents/com.adobe.ccxprocess.plist"),e.next=3,ce("".concat(i),{cwd:v.dirname(a)}).catch(function(e){throw new Error("Error scheduling user launchd job")});case 3:this.log.disk("CCXProcess launch scheduled!");case 4:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"updateWinOsScheduler",value:(t=a()(d().mark(function e(t,n){var r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r='schtasks /create /tn "Launch Adobe CCXProcess" /tr "\\"C:\\Program Files\\Adobe\\Adobe Creative Cloud Experience\\CCXProcess.exe\\"" /sc daily /st '.concat(t,":").concat(n," -f"),e.next=1,ce("".concat(r)).catch(function(e){throw new Error("Error scheduling job via task scheduler: ".concat(e))});case 1:this.log.disk("CCXProcess launch scheduled!");case 2:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"updateOSScheduler",value:(e=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Date(t),!f.Z.isPlatformWindows()){e.next=2;break}return e.next=1,this.updateWinOsScheduler(n.getHours().toString().padStart(2,"0"),n.getMinutes().toString().padStart(2,"0"));case 1:case 4:e.next=6;break;case 2:return e.next=3,_.Z.isUnsupportedMacOSVersion();case 3:if(e.sent){e.next=5;break}return e.next=4,this.updateMacOsScheduler(n.getHours(),n.getMinutes());case 5:throw new Error("Unsupported Mac OS version for scheduling!");case 6:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})}]);var e,t,n}());var pe=n(8963);const de=new(function(){return c()(function e(){i()(this,e),l()(this,"log",void 0),l()(this,"_launchTime",void 0),l()(this,"_setLaunchTimeout",void 0),l()(this,"currEarliestDT",new Date(Date.now()+f.Z.get("BPO_DEFAULT_LAUNCH_INTERVAL"))),l()(this,"_minimumRunTimeout",void 0),l()(this,"_lifecycleTimeout",void 0),l()(this,"maps",void 0),l()(this,"nextSyncTimes",{}),l()(this,"appCodePreventingQuit",void 0),l()(this,"healthMonitor",void 0),l()(this,"thorInterface",void 0),l()(this,"proxy",void 0),l()(this,"serviceInterface",void 0),this.log=new h.Z({prefix:"Lifecycle > ",payload:{"event.workflow":f.Z.analytics.w_INTERNAL,"event.subcategory":f.Z.analytics.sc_APP_LIFECYCLE_MANAGER}}),this.maps=[],this._launchTime=(new Date).getTime(),this.appCodePreventingQuit=null},[{key:"currentNextLaunchTime",value:function(){return this.currEarliestDT}},{key:"resetCurrentLaunchCount",value:function(){var e,t=Date.now(),n=Date.parse(null===(e=this.getLaunchInfo())||void 0===e?void 0:e.BPO_LAUNCH_COUNT_RESTART_AFTER)<t;return this.log.disk("Result of resetCurrentLaunchCount: ".concat(n)),n}},{key:"setNextLaunchTimer",value:function(){var e=this;this._setLaunchTimeout&&clearTimeout(this._setLaunchTimeout),this._setLaunchTimeout=setTimeout(a()(d().mark(function t(){return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,e.writeNextLaunchTime("Launch write timer");case 1:case"end":return t.stop()}},t)})),f.Z.get("BPO_SYNC_TRIGGERED_SET_LAUNCH_DELAY"))}},{key:"writeNextLaunchTime",value:(y=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.log.disk("Setting next launch to: ".concat(this.currentNextLaunchTime().toISOString()).concat(t?" - ".concat(t):"")),f.Z.set("NEXT_LAUNCH_TIME",this.currentNextLaunchTime().toISOString());case 1:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"determineNextLaunchTime",value:(m=a()(d().mark(function e(n,r){var a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!r||r&&r<0?delete this.nextSyncTimes[n]:r&&r>0&&(a=Date.now(),s=a+r,this.nextSyncTimes[n]=s),i=Math.min.apply(Math,t()(Object.values(this.nextSyncTimes))),(o=Math.min(i,Date.now()+f.Z.get("BPO_DEFAULT_LAUNCH_INTERVAL")))&&!Number.isNaN(o)&&Number.isInteger(o)?this.currEarliestDT=new Date(o):this.currEarliestDT=new Date(Date.now()+f.Z.get("BPO_DEFAULT_LAUNCH_INTERVAL")),this.setNextLaunchTimer();case 1:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"incrementLaunchCounter",value:function(){var e,t=this.getLaunchInfo();t||(t={CURRENT_LAUNCH_CYCLE_COUNT:0,LAST_LAUNCH_TIME:(new Date).toISOString(),BPO_LAUNCH_COUNT_RESTART_AFTER:this.getUTCResetDate().toISOString(),FAIL_QUIT_CYCLE_TRACKING:{},FAILED_QUIT_ATTEMPTS:0,SUCCESSFUL_QUIT_ATTEMPTS:0}),t.CURRENT_LAUNCH_CYCLE_COUNT=null!==(e=t)&&void 0!==e&&e.CURRENT_LAUNCH_CYCLE_COUNT?t.CURRENT_LAUNCH_CYCLE_COUNT+1:1,t.LAST_LAUNCH_TIME=(new Date).toISOString(),t.BPO_LAUNCH_COUNT_RESTART_AFTER=t.BPO_LAUNCH_COUNT_RESTART_AFTER||this.getUTCResetDate().toISOString(),f.Z.set("LAUNCH_INFO",t)}},{key:"setQuitTimer",value:function(){var e=this;this._minimumRunTimeout&&clearTimeout(this._minimumRunTimeout),this._minimumRunTimeout=setTimeout(function(){e.quit()},f.Z.get("BPO_MINIMUM_RUN_TIME"))}},{key:"setMaps",value:function(e){this.maps=e}},{key:"setHeatlhMonitor",value:function(e){this.healthMonitor=e}},{key:"setStartTime",value:function(e){f.Z.set("STARTUP_TIME",e),this._launchTime=e.getTime()}},{key:"setThorInterface",value:function(e){this.thorInterface=e}},{key:"setProxy",value:function(e){this.proxy=e}},{key:"setServiceInterface",value:function(e){this.serviceInterface=e}},{key:"calculateDownTime",value:(T=a()(d().mark(function e(){var t,n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.Z.get("LAST_QUIT_TIME"),(n=f.Z.get("STARTUP_TIME"))?(n=new Date(n).getTime(),t?(t=new Date(t).getTime(),r=Math.round((n-t)/6e4),f.Z.set("LAST_DOWN_TIME",r),this.log.disk("Latest process down time was ".concat(r," mins"))):this.log.disk("No previous quit time detected: ".concat(t))):this.log.disk("No start time detected calculating down time."),e.abrupt("return");case 1:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})},{key:"calculateLaunchDiff",value:(g=a()(d().mark(function e(){var t,n,r,a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.Z.get("STARTUP_TIME"),n=f.Z.get("NEXT_LAUNCH_TIME"),r=f.Z.get("LAUNCH_BEFORE_WINDOW"),a=f.Z.get("LAUNCH_AFTER_WINDOW"),s=f.Z.get("LAUNCH_WITHIN_WINDOW"),t?(t=new Date(t).getTime(),n?(n=new Date(n).getTime(),i=n-t,o=f.Z.get("BPO_LAUNCH_DIFFERENTIAL_WINDOW"),i<0&&Math.abs(i)>o?(a?f.Z.set("LAUNCH_AFTER_WINDOW",a+1):f.Z.set("LAUNCH_AFTER_WINDOW",1),this.log.disk("Process launched after expected time.")):i>0&&Math.abs(i)>o?(r?f.Z.set("LAUNCH_BEFORE_WINDOW",r+1):f.Z.set("LAUNCH_BEFORE_WINDOW",1),this.log.disk("Process launched before expected time.")):(s?f.Z.set("LAUNCH_WITHIN_WINDOW",s+1):f.Z.set("LAUNCH_WITHIN_WINDOW",1),this.log.disk("Process launched within expected time.")),i=Math.abs(Math.round((n-t)/6e4)),f.Z.set("EXPECTED_LAUNCH_TIME_DIFFERENTIAL",i),this.log.disk("Difference from expected launch time to actual launch time was ".concat(i," mins"))):this.log.disk("No previous expected launch time detected: ".concat(n))):this.log.disk("No start time detected calculating launch differential."),e.abrupt("return");case 1:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"resetLaunchWindowCounter",value:function(){f.Z.set("LAUNCH_BEFORE_WINDOW",0),f.Z.set("LAUNCH_AFTER_WINDOW",0),f.Z.set("LAUNCH_WITHIN_WINDOW",0)}},{key:"start",value:(v=a()(d().mark(function e(t,n,r,a,s,i){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setStartTime(n),this.setHeatlhMonitor(r),this.setThorInterface(a),this.setProxy(s),this.setServiceInterface(i),this.setMaps(t),e.next=1,this.calculateDownTime();case 1:return e.next=2,this.calculateLaunchDiff();case 2:return e.next=3,this.writeNextLaunchTime("Starting Lifecycle Initialization");case 3:this.setQuitTimer(),this.getLaunchInfo()||this.setDefaultLaunchInfo(),this.incrementLaunchCounter();case 4:case"end":return e.stop()}},e,this)})),function(e,t,n,r,a,s){return v.apply(this,arguments)})},{key:"maxLaunchCountReached",value:function(){var e;return(null===(e=this.getLaunchInfo())||void 0===e?void 0:e.CURRENT_LAUNCH_CYCLE_COUNT)>=f.Z.get("BPO_MAX_RESTARTS")}},{key:"updateFailQuitReasonTracking",value:function(e){if(e){var t=this.getLaunchInfo()||{},n=t.FAIL_QUIT_CYCLE_TRACKING||{},r="APP_RUNNING"===e?"APP_RUNNING_TOTAL":"APP_INSTALLED_TOTAL";switch(e){case"APP_RUNNING":case"APP_INSTALLED":n[e]?n[e][this.appCodePreventingQuit]?n[e][this.appCodePreventingQuit]=n[e][this.appCodePreventingQuit]+1:n[e][this.appCodePreventingQuit]=1:n[e]=l()({},this.appCodePreventingQuit,1),n[r]=null!=n[r]?n[r]+1:1;break;default:n[e]?n[e]=n[e]+1:n[e]=1}t.FAILED_QUIT_ATTEMPTS=(t.FAILED_QUIT_ATTEMPTS||0)+1,t.FAIL_QUIT_CYCLE_TRACKING=n,f.Z.set("LAUNCH_INFO",t)}}},{key:"updateSuccesfulQuitCount",value:function(){var e=this.getLaunchInfo()||{};e.SUCCESSFUL_QUIT_ATTEMPTS?e.SUCCESSFUL_QUIT_ATTEMPTS=e.SUCCESSFUL_QUIT_ATTEMPTS+1:e.SUCCESSFUL_QUIT_ATTEMPTS=1,f.Z.set("LAUNCH_INFO",e)}},{key:"setDefaultLaunchInfo",value:function(){f.Z.set("LAUNCH_INFO",{CURRENT_LAUNCH_CYCLE_COUNT:0,LAST_LAUNCH_TIME:(new Date).toISOString(),BPO_LAUNCH_COUNT_RESTART_AFTER:this.getUTCResetDate().toISOString(),FAIL_QUIT_CYCLE_TRACKING:{},FAILED_QUIT_ATTEMPTS:0,SUCCESSFUL_QUIT_ATTEMPTS:0})}},{key:"generateBuffer",value:function(){arguments.length>0&&void 0!==arguments[0]||f.Z.get("BPO_RESET_BUFFER");return Math.floor(Math.random()*(f.Z.get("BPO_RESET_BUFFER")+1))}},{key:"getUTCResetDate",value:function(){var e=new Date;e.setUTCHours(0,0,0,0),e.setUTCDate(e.getUTCDate()+1);var t=this.generateBuffer();return e.setUTCMilliseconds(t),e}},{key:"getLaunchInfo",value:function(){return f.Z.get("LAUNCH_INFO")}},{key:"getLaunchCount",value:function(){var e=this.getLaunchInfo();return e&&e.CURRENT_LAUNCH_CYCLE_COUNT&&0!==e.CURRENT_LAUNCH_CYCLE_COUNT?e.CURRENT_LAUNCH_CYCLE_COUNT:(this.setDefaultLaunchInfo(),0)}},{key:"summaryEventTimer",get:function(){var e;return null===(e=this.getLaunchInfo())||void 0===e?void 0:e.BPO_LAUNCH_COUNT_RESTART_AFTER}},{key:"logAppLifecycleSummary",value:(S=a()(d().mark(function e(){var t,n,r,s,i,o,c,u,l,p,h,E,S,v,g,T=this,m=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(m.length>0&&void 0!==m[0])||m[0],r=this.getLaunchInfo(),s=Date.now(),this._lifecycleTimeout&&(this.log.disk("Clearing the timeout in lifecycle summary."),clearTimeout(this._lifecycleTimeout)),!this.resetCurrentLaunchCount()){e.next=5;break}if(this.log.disk("Sending current lifecycle stats"),p=Object,h={},E={"ccxp.cycle_launches":r.CURRENT_LAUNCH_CYCLE_COUNT,"ccxp.failed_quit_cycles":r.FAILED_QUIT_ATTEMPTS,"ccxp.successful_quit_cycles":r.SUCCESSFUL_QUIT_ATTEMPTS,"ccxp.failed_quit_reasons":JSON.stringify(r.FAIL_QUIT_CYCLE_TRACKING),"ccxp.runtime":s-this._launchTime,"ccxp.downtime":f.Z.get("LAST_DOWN_TIME"),"ccxp.expected_launch_diff":f.Z.get("EXPECTED_LAUNCH_TIME_DIFFERENTIAL"),"ccxp.launch_before":f.Z.get("LAUNCH_BEFORE_WINDOW"),"ccxp.launch_after":f.Z.get("LAUNCH_AFTER_WINDOW"),"ccxp.launch_within":f.Z.get("LAUNCH_WITHIN_WINDOW")},!n){e.next=2;break}return e.next=1,null===(i=this.healthMonitor)||void 0===i?void 0:i.getHealthMetricPayload();case 1:S=e.sent,e.next=3;break;case 2:S={};case 3:return v=S,e.next=4,this.getFileStatsPayload();case 4:g=e.sent,o=p.assign.call(p,h,E,v,g),this.log.info(f.Z.analytics.t_SUMMARY).appendPayload(o),_.Z.isDebugModeEnabled()&&this.log.disk("****** Health Metrics  Payload: ",JSON.stringify(o,null,2)),this.setDefaultLaunchInfo(),this.resetLaunchWindowCounter(),e.next=6;break;case 5:this.summaryEventTimer||((c=this.getLaunchInfo()).BPO_LAUNCH_COUNT_RESTART_AFTER=this.getUTCResetDate().toISOString(),f.Z.set("LAUNCH_INFO",c));case 6:u=new Date(this.summaryEventTimer).getTime()-s,(Number.isNaN(u)||!Number.isInteger(u)||u<0||u>f.Z.get("BPO_SUMMARY_FUTURE_DATE"))&&(this.log.disk("Issue with next summary event timer. Resetting summary timer from provided value: ".concat(this.summaryEventTimer)),u=this.getUTCResetDate().getTime()-s,(l=this.getLaunchInfo()).BPO_LAUNCH_COUNT_RESTART_AFTER=this.getUTCResetDate().toISOString(),f.Z.set("LAUNCH_INFO",l)),this.log.disk("Setting next log timer in ".concat(u," ms at ").concat(null===(t=this.getLaunchInfo())||void 0===t?void 0:t.BPO_LAUNCH_COUNT_RESTART_AFTER)),this._lifecycleTimeout=setTimeout(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,T.logAppLifecycleSummary(!0);case 1:case"end":return e.stop()}},e)})),u);case 7:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})},{key:"isSupportedAppInstalled",value:(p=a()(d().mark(function e(){var t,n,r,a,s,i=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.Z.get("BPO_RUNNING_APPS"),e.next=1,se.Z.getInstalledApps();case 1:if(n=e.sent,this.appCodePreventingQuit=null,n){e.next=2;break}return this.appCodePreventingQuit="AID_FAILURE",this.log.disk("Unable to shutdown in installed check due to empty installed applications"),e.abrupt("return",!0);case 2:return(s=t.find(function(e){return r=!1,a=n[e.appCode],i.appCodePreventingQuit=e.appCode,a&&(r=Object.keys(a).find(function(t){return!1===e.checkIfRunning&&_.Z.compareMajorMinorVersions(e.minVersion,t)>=0&&_.Z.compareMajorMinorVersions(e.maxVersion,t)<=0})),r}))&&this.log.disk("Found installed application on machine: ",s.appCode,a&&Object.keys(a)),e.abrupt("return",!!s);case 3:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"isSupportedAppRunning",value:(u=a()(d().mark(function e(){var t,n,r,a,s,i=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.Z.get("BPO_RUNNING_APPS"),e.next=1,se.Z.getInstalledApps();case 1:if(n=e.sent,this.appCodePreventingQuit=null,n){e.next=2;break}return this.appCodePreventingQuit="AID_FAILURE",this.log.disk("Unable to shutdown in running check due to empty installed applications"),e.abrupt("return",!0);case 2:return(s=t.find(function(e){return r=!1,a=n[e.appCode],i.appCodePreventingQuit=e.appCode,a&&(r=Object.keys(a).find(function(t){return!0===e.checkIfRunning&&_.Z.compareMajorMinorVersions(e.minVersion,t)>=0&&_.Z.compareMajorMinorVersions(e.maxVersion,t)<=0&&se.Z.isAppRunning(e.appCode,t)})),r}))&&this.log.disk("Found one app running out of:",s.appCode,a&&Object.keys(a)),e.abrupt("return",!!s);case 3:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"minNextLaunchThreshold",value:function(){var e=Date.now()+f.Z.get("BPO_NEXT_LAUNCH_THRESHOLD");return this.currentNextLaunchTime().getTime()<=e&&(this.log.disk("Not quitting due to relaunch in ".concat((this.currentNextLaunchTime().getTime()-Date.now())/6e4," with threshold ").concat(f.Z.get("BPO_NEXT_LAUNCH_THRESHOLD")/6e4," minutes")),!0)}},{key:"waitingForBackoff",value:function(){var e,t=k.Z.isWaitingForBackOff(k.E.NETWORK),n=k.Z.isWaitingForBackOff(k.E.AUTH);return e=t?"[network]":"",e+=n?"[auth]":"",!(!t&&!n)&&(this.log.disk("Quit delayed: ".concat(e," backoff")),!0)}},{key:"syncInProgress",value:(o=a()(d().mark(function e(){var t,n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Array,n=!1,!(this.maps&&this.maps.length>0)){e.next=1;break}return e.next=1,_.Z.waitAll(this.maps.map(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,n.isAnyIdSyncInProgress().then(function(e){e&&t.push(n.type)});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:return t.length>0?(this.log.disk("Quit Delayed: lookupMap(s) are syncing: ".concat(t.toString()," ")),n=!0):this.log.disk("No Lookupmaps are currently syncing"),e.abrupt("return",n);case 2:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"scheduleOSlaunchTime",value:(s=a()(d().mark(function e(){var t,n,r,a,s,i=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Date.now(),n=new Date(f.Z.get("NEXT_LAUNCH_TIME")).getTime(),r=Math.min(n,t+f.Z.get("BPO_DEFAULT_LAUNCH_INTERVAL")),a=Math.max(r,t+f.Z.get("BPO_NEXT_LAUNCH_THRESHOLD")),new Date(a).toISOString()!==f.Z.get("NEXT_LAUNCH_TIME")&&(this.log.disk("next launch time is being corrected as it was not in threshold of more than ".concat(f.Z.get("BPO_NEXT_LAUNCH_THRESHOLD")/6e4,"mins and less than ").concat(f.Z.get("BPO_DEFAULT_LAUNCH_INTERVAL")/36e5,"hrs ").concat(f.Z.get("NEXT_LAUNCH_TIME"))),f.Z.set("NEXT_LAUNCH_TIME",new Date(a).toISOString())),s=f.Z.get("NEXT_LAUNCH_TIME"),e.next=1,le.updateOSScheduler(s).then(function(){return i.log.disk("CCXProcessScheduler is updated with next launch time of","".concat(s)),!0}).catch(function(e){return i.log.disk("Quit failed due to: OS_LAUNCH_SCHEDULER_ERROR caused by ".concat(e.message)),!1});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"setLastQuitTime",value:function(){f.Z.set("LAST_QUIT_TIME",(new Date).toISOString())}},{key:"quit",value:(r=a()(d().mark(function e(){var t,n,r,a,s,i,o,c,u,l,p,h,E,S,v,g,T,m,y,O,A,C,I,R;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!0,r="Unknown",o=i=!0,e.next=1,_.Z.isUnsupportedMacOSVersion();case 1:if(c=e.sent,o!==c){e.next=2;break}u=22,e.next=21;break;case 2:return l=i,e.next=3,this.isSupportedAppRunning();case 3:if(p=e.sent,l!==p){e.next=4;break}h=23,e.next=20;break;case 4:return E=i,e.next=5,this.isSupportedAppInstalled();case 5:if(S=e.sent,E!==S){e.next=6;break}v=24,e.next=19;break;case 6:if(i!==this.maxLaunchCountReached()){e.next=7;break}g=25,e.next=18;break;case 7:if(i!==this.minNextLaunchThreshold()){e.next=8;break}T=26,e.next=17;break;case 8:if(i!==this.waitingForBackoff()){e.next=9;break}m=27,e.next=16;break;case 9:return y=i,e.next=10,this.syncInProgress();case 10:if(O=e.sent,y!==O){e.next=11;break}A=28,e.next=15;break;case 11:return C=i,e.next=12,this.scheduleOSlaunchTime();case 12:if(I=!e.sent,C!==I){e.next=13;break}R=29,e.next=14;break;case 13:R=30;case 14:A=R;case 15:m=A;case 16:T=m;case 17:g=T;case 18:v=g;case 19:h=v;case 20:u=h;case 21:e.next=u;break;case 22:return n=!1,r="UNSUPPORTED_MACOS_VERSION",e.abrupt("continue",31);case 23:return n=!1,r="APP_RUNNING",e.abrupt("continue",31);case 24:return n=!1,r="APP_INSTALLED",e.abrupt("continue",31);case 25:return n=!1,r="MAX_LAUNCH_REACHED",e.abrupt("continue",31);case 26:return n=!1,r="MIN_LAUNCH_THRESHOLD",e.abrupt("continue",31);case 27:return n=!1,r="WAITING_FOR_BACKOFF",e.abrupt("continue",31);case 28:return n=!1,r="SYNC_IN_PROGRESS",e.abrupt("continue",31);case 29:return n=!1,r="OS_LAUNCH_SCHEDULER_ERROR",e.abrupt("continue",31);case 30:n=!0;case 31:if(this.setLastQuitTime(),n){e.next=32;break}return this.log.disk("Quit failed due to: ".concat(r)),this.updateFailQuitReasonTracking(r),this.setQuitTimer(),e.abrupt("return");case 32:return this.log.disk("All quit conditions passed"),this.updateSuccesfulQuitCount(),a=this.getLaunchInfo(),e.next=33,null===(t=this.healthMonitor)||void 0===t?void 0:t.getHealthMetricPayload();case 33:return s=e.sent,this.log.info(f.Z.analytics.t_QUIT).appendPayload({"ccxp.cycle_launches":a.CURRENT_LAUNCH_CYCLE_COUNT,"ccxp.failed_quit_cycles":a.FAILED_QUIT_ATTEMPTS,"ccxp.failed_quit_reasons":JSON.stringify(a.FAIL_QUIT_CYCLE_TRACKING),"ccxp.runtime":Date.now()-this._launchTime,"ccxp.next_launch_time":f.Z.get("NEXT_LAUNCH_TIME"),"ccxp.downtime":f.Z.get("LAST_DOWN_TIME"),"ccxp.expected_launch_diff":f.Z.get("EXPECTED_LAUNCH_TIME_DIFFERENTIAL"),"ccxp.launch_before":f.Z.get("LAUNCH_BEFORE_WINDOW"),"ccxp.launch_after":f.Z.get("LAUNCH_AFTER_WINDOW"),"ccxp.launch_within":f.Z.get("LAUNCH_WITHIN_WINDOW")}).appendPayload(s),this.log.disk("Preparing shutdown."),e.next=34,this.exit();case 34:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getFileStatsPayload",value:(n=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=1,N.generateFileStats(f.Z.get("ROOT_DIR")).then(function(e){var n,r;t={"ccxp.file_stats":e,"ccxp.file_total_count":null==e||null===(n=e.summary)||void 0===n?void 0:n.totalCount,"ccxp.file_total_size_mb":null==e||null===(r=e.summary)||void 0===r?void 0:r.totalSizeMB}}).catch(function(e){return n.log.disk(new A.Z("Error generating file stats",e)),{}});case 1:return e.abrupt("return",t);case 2:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"exit",value:(e=a()(d().mark(function e(){var t,n=this,r=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:0,this.log.disk("Beginning exit procedure from BPO."),e.next=1,pe.Z.shutdown();case 1:return this.log.disk("Flushing ingest logs."),e.next=2,b.Z.flush(!0,function(){var e,r,a;n.log.disk("Flush completed."),n.log.disk("Removing all event listeners"),null===(e=n.serviceInterface)||void 0===e||e.removeAllListeners(),null===(r=n.thorInterface)||void 0===r||r.removeAllListeners(),null===(a=n.proxy)||void 0===a||a.removeAllListeners(),se.Z.removeAllListenersVulcan(),se.Z.releaseInstance(),E.Z.shutdown(),setTimeout(function(){n.log.disk("Shutting down process."),process.exit(t)},1e3)});case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"clearNextTime",value:function(){this.currEarliestDT=new Date(Date.now()+f.Z.get("BPO_DEFAULT_LAUNCH_INTERVAL"))}}]);var e,n,r,s,o,u,p,S,v,g,T,m,y}());var fe=n(1415);function _e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return he(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ve(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ve=function(){return!!e})()}var ge=function(e){function n(e){var t,r,s,o;return i()(this,n),r=this,s=n,s=B()(s),t=H()(r,ve()?Reflect.construct(s,o||[],B()(r).constructor):s.apply(r,o)),l()(t,"_data",void 0),l()(t,"_apiData",void 0),l()(t,"_type",void 0),l()(t,"_path",void 0),l()(t,"_fileName",void 0),l()(t,"_apiFileName",void 0),l()(t,"_downloadManager",void 0),l()(t,"_diskLock",void 0),l()(t,"_syncLock",void 0),l()(t,"log",void 0),l()(t,"gc",void 0),l()(t,"_syncTimeout",void 0),l()(t,"_gsdkUpdateQueue",void 0),l()(t,"_gsdkUpdateRunner",void 0),l()(t,"fetchOnDemandContent",void 0),l()(t,"fetchAsset",void 0),l()(t,"fetchGSDKAsset",void 0),l()(t,"_fetchCollectionData",void 0),l()(t,"fetchCollectionIndex",void 0),l()(t,"_updateGSDKUseTime",_.Z.memoize(function(){var e=a()(d().mark(function e(n,r){var a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.updateParams([r]);case 1:a=e.sent,pe.Z.isEnabled&&pe.Z.isClientSupported(a[0],t)&&(s=pe.Z.createConsumer(a[0]),pe.Z.updateConsumerActivity(s,fe.ConsumerActivity.activated));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),{timeout:36e5})),l()(t,"_saveInProgress",!1),l()(t,"_calledSave",!1),l()(t,"logApiRenameError",_.Z.throttle(function(){t.log.error(new A.Z(f.Z.analytics.ACCESSOR_ERROR_TYPE,"Renamed api file: ".concat(t._apiFileName),f.Z.analytics.ACCESSOR_READ_RENAME_ERROR_CODE)).appendPayload({"event.subtype":f.Z.analytics.st_ACCESSOR,"ccxp.path":t._apiFileName})},f.Z.get("FILE_ACCESS_RENAME_THROTTLE"))),l()(t,"abortControllers",{}),f.Z.patch(e.LABEL,e||{}),t._type=e.LABEL,t._path=v.join(f.Z.get("ROOT_DIR"),f.Z.get("DIR",t.type)),t._fileName=f.Z.get("LOOKUP_MAP_FILE",t.type)||f.Z.get("LOOKUP_MAP_FILE"),t._apiFileName=f.Z.get("FILE_ACCESS_MAP_FILE"),t._downloadManager=null,t._diskLock=new x.ZP,t._syncLock=new x.ZP(9999),t._gsdkUpdateQueue={},t._gsdkUpdateRunner={},t.log=new h.Z({prefix:"".concat(f.Z.get("LOG_PREFIX",t.type),"LookupMap > "),payload:{"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",t.type)}}),t.fetchOnDemandContent=_.Z.memoize(_.Z.retryLocalErrors(t._fetchOnDemandContent.bind(t)),{refresher:function(e){return"pending"!==e.state},resolver:function(e){return t.paramsToOnDemandId(e)},destructor:function(e,t){return"pending"!==t.state}}),t.fetchGSDKAsset=_.Z.memoize(_.Z.retryLocalErrors(t._fetchGSDKAsset.bind(t))),t.fetchAsset=_.Z.memoize(_.Z.retryLocalErrors(t._fetchAsset.bind(t)),{refresher:function(e){return"pending"!==e.state},resolver:function(e){return e.key||e.href},wrapper:function(e,n,r){var a=e[0]||{};return a.force&&a.force.type&&r&&["stale","always"].includes(a.force.type)?n.then(function(){return t._fetchAsset(a)}):n},destructor:function(e,t){return"pending"!==t.state}}),t._fetchCollectionData=_.Z.memoize(t._fetchCollectionDataRaw,{refresher:function(e){return"pending"!==e.state},resolver:function(e){return t.paramsToId(e.params,!1)},wrapper:function(e,n,r){var a=e[0]||{};return a.force&&a.force.type&&r&&["stale","always"].includes(a.force.type)?n.then(function(){return t._fetchCollectionData(a)}):n},destructor:function(e,t){return"pending"!==t.state}}),t.fetchCollectionIndex=t.fetchCollectionIndexRaw.bind(t),t.gc=_.Z.memoize(t._gc,{refresher:function(e){return"pending"!==e.state},destructor:function(e,t){return"pending"!==t.state}}),t}return X()(n,e),c()(n,[{key:"patchEnabledClient",value:function(e){return _.Z.isPatchEnabled(this.getClientVersion(e),this.type)}},{key:"updateGSDKUseTime",value:function(e){var t=["activated",e.productVersion,e.productCode,e.productLanguage].join("-");this._updateGSDKUseTime(t,e)}},{key:"getProductAlias",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getClientVersion(t),r=null===(e=f.Z.get(n,this.type))||void 0===e?void 0:e.PRODUCT_ALIASES;if(t.productCode)return r&&r[t.productCode]||t.productCode}},{key:"createFAClientDir",value:(Ne=a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f.Z.get("FILE_ACCESSOR_WRITE_ENABLED",this.type)){e.next=1;break}return e.abrupt("return");case 1:t=this.clientDir,S.ensureDir(t).catch(function(e){throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,e,f.Z.analytics.ACCESSOR_WRITE_ERROR_CREATING_DIR_CODE)});case 2:case"end":return e.stop()}},e,this)})),function(){return Ne.apply(this,arguments)})},{key:"checkAssetsFolder",value:(Re=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:S.ensureDir(this.assetsDir).catch(function(e){throw new A.Z(e)});case 1:case"end":return e.stop()}},e,this)})),function(){return Re.apply(this,arguments)})},{key:"isAnyIdSyncInProgress",value:(Ie=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,e.next=1,_.Z.waitAll(Object.keys(this._data.metadata).map(function(){var e=a()(d().mark(function e(r){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.isSyncInProgress(r)&&(t=!0);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:return e.abrupt("return",t);case 2:case"end":return e.stop()}},e,this)})),function(){return Ie.apply(this,arguments)})},{key:"isSyncInProgress",value:function(e){var t=this._fetchCollectionData.cache&&this._fetchCollectionData.cache.get(e);return t&&"pending"===t.state}},{key:"paramsToIdRaw",value:function(e){var t=this._getCollectionInfo(e);if(t&&t.pendingId)return t.pendingId;if(t&&t.latestId){var n=this._data.metadata[t.latestId];if(_.Z.getTimeToExpiry(null==n?void 0:n.expiryTime)>0)return t.latestId}}},{key:"paramsToId",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.paramsToIdRaw(e);if(r)return r;var a=this.generateId(e);return this._addNewCollectionInfo({params:e,isPending:!0,collectionId:a,file:null===(t=this._data)||void 0===t||null===(t=t.metadata[a])||void 0===t?void 0:t.path}),n?this.save().then(function(){return a}):(this.save(),a)}},{key:"generateId",value:function(e){return[e.filePrefix,e.productCode,e.productVersion,e.productLanguage,T.v4()].filter(function(e){return!!e}).join("-").trim()}},{key:"expireAll",value:(Ce=a()(d().mark(function e(t){var n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._data){e.next=1;break}return e.abrupt("return");case 1:return Object.keys(this._data.metadata).forEach(function(e){t&&t===n._data.metadata[e].userId&&delete n._data.metadata[e].expiryTime}),e.next=2,this.save();case 2:case"end":return e.stop()}},e,this)})),function(e){return Ce.apply(this,arguments)})},{key:"forceRefresh",value:(Ae=a()(d().mark(function e(n){var r,s,i,o=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign({},n,{productVersion:this.makeVersionLookupKey(n.productVersion)}),s=t()(Object.values(r)).filter(function(e){return void 0!==e}),i=this.getIdsByKeys(s),e.next=1,Promise.all(i.map(function(){var e=a()(d().mark(function e(t){var n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=o.getCollectionParamters(t))||void 0===n?void 0:n.params,!pe.Z.isClientSupported(r,o)||!pe.Z.isEnabled){e.next=1;break}((null==r?void 0:r.surfaceId)||[]).forEach(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,pe.Z.updateContent(n,pe.Z.createConsumer(r)).then(function(){o.log.disk("[".concat(t,"] GSDK updateContent suceeded for ").concat(n))}).catch(function(e){o.log.disk("[".concat(t,"] GSDK content update failed for ").concat(n,": ").concat(e))});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=2;break;case 1:return e.next=2,o.expireOne(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)})),function(e){return Ae.apply(this,arguments)})},{key:"getCollectionParamters",value:function(e){var t;return null===(t=this._data.metadata)||void 0===t?void 0:t[e]}},{key:"getIdsByKeys",value:function(e){var t=[],n=e.reduce(function(e,n){return e[n]?e[n]:(t.push(n),e)},this._data.versionInfo[E.Z.getUserId()]),r=[];if(n.pendingId?r.push(n.pendingId):n.latestId&&r.push(n.latestId),r.length>0)return r;var a=new Set,s=function(e){var n=!1;e.pendingId?(r.push(e.pendingId),n=!0):e.latestId&&(r.push(e.latestId),n=!0);var i=Object.keys(e).some(function(t){return"object"===J()(e[t])});if(!n&&i){var o=Object.keys(e),c=t.find(function(t){return!!e[t]});c?(a.add(c),t=t.filter(function(e){return e!==c}),s(e[c])):o.forEach(function(t){return s(e[t])})}};return s(n),t.length>0?[]:r}},{key:"expireOne",value:(Oe=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,delete this._data.metadata[t].expiryTime,e.next=2;break;case 1:return e.prev=1,e.catch(0),e.abrupt("return");case 2:return e.next=3,this.save();case 3:case"end":return e.stop()}},e,this,[[0,1]])})),function(e){return Oe.apply(this,arguments)})},{key:"_getLookupKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.makeVersionLookupKey(e.productVersion),r=[t||E.Z.getUserId()];return r.push(e.productCode,n,e.productLanguage),r}},{key:"_getGSDKUpdateKeys",value:function(e){return this._getLookupKeys(e).join("-")}},{key:"makeVersionLookupKey",value:function(e){var t=e&&e.split(".");return t&&"".concat(t[0],".").concat(t[1])}},{key:"_getCollectionInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var n=this._getLookupKeys(e,t),r=this._data.versionInfo;return n.forEach(function(e){r&&(r=r[e])}),r}}},{key:"_setCollectionInfo",value:function(e,t){var n=this._getLookupKeys(e),r=this._data.versionInfo;return n.forEach(function(e,a){a===n.length-1?r[e]=t:(r[e]=r[e]||{},r=r[e])}),r}},{key:"_isDataReferenced",value:function(e){var t=this._data.metadata[e],n=t&&this._getCollectionInfo(t.params,t.userId);return!!n&&!!Object.keys(n).find(function(t){return e===n[t]})}},{key:"_isDataPrimaryReference",value:function(e){var t=this._data.metadata[e],n=t&&this._getCollectionInfo(t.params,t.userId);if(n){if(n.pendingId)return e===n.pendingId;if(n.latestId)return e===n.latestId}return!1}},{key:"_checkValidity",value:function(e,t){}},{key:"_addNewCollectionInfo",value:function(e){var t=this,n=e.params,r=e.isPending,a=e.collectionId,s=e.expiry,i=e.retry,o=e.cause,c=void 0===o?"Unknown":o,u=e.refreshTime,l=e.file,p=e.subErrors,d=this._getCollectionInfo(n)||{},f=new Date,_=void 0;return Object.values(d).forEach(function(e){var n=t._data.metadata[e];if(n&&n.lastUseTime){var r=new Date(n.lastUseTime);!isNaN(r.getTime())&&r>f&&(f=r)}_=_||(null==n?void 0:n.delay),n&&delete n.delay}),(!r&&_&&u&&new Date(u)>new Date(_.expiryTime)||r&&_&&new Date>new Date(_.expiryTime))&&(_=void 0),r?d.pendingId=a:(d.latestId=a,delete d.pendingId),this._setCollectionInfo(n,d),this._data.metadata[a]={expiryTime:s?s.toISOString():void 0,userId:E.Z.getUserId(),lastUseTime:f.toISOString(),retry:i,cause:c,params:n,refreshTime:u,path:null!=l?l:r?void 0:"".concat(a,".json"),subErrors:p,delay:_},this._data.metadata[a]}},{key:"sanitizeParams",value:function(e){var t=f.Z.get("SUPPORTED_LOCALES",this.type);return e.productLanguage=_.Z.sanitizeLocale(e.productLanguage,t),e}},{key:"isRequestPoisoned",value:function(e){var t=f.Z.get("SUPPORTED_PRODUCTS",this.type),n=f.Z.get("UNSUPPORTED_AFTER_VERSION",this.type);return!e.productCode||!t[e.productCode]||(!!(n[e.productCode]&&_.Z.compareMajorMinorVersions(n[e.productCode],e.productVersion,this.patchEnabledClient(e))>-1)||!(_.Z.compareMajorMinorVersions(t[e.productCode],e.productVersion,this.patchEnabledClient(e))>-1))}},{key:"_calculateExpiry",value:function(e,t){var n,r=e?e.expiryTime:void 0;if(r){n=new Date(r);var a=new Date;a.setMilliseconds(f.Z.get("MAX_TIMEOUT")),n>a&&(n=a);var s=new Date;s.setMilliseconds(f.Z.get("MIN_TIMEOUT")),n<s&&(n=s)}return n}},{key:"_calculateBackOffMetadata",value:function(e){var t,n=e.metadata,r=e.error,a=e.updateBackOff,s=void 0===a||a,i=e.initialRetry,o=void 0===i?f.Z.get("SYNC_INITIAL_RETRY"):i,c="killed before response",u=r;u&&u.responseHeaders&&(t=$.Z.getRetryAfterHeader(u.responseHeaders)),t?o=1e3*t:null!=n&&n.retry&&(o=n.retry*(s?2:1),o=Math.max(f.Z.get("SYNC_INITIAL_RETRY"),o)),o=Math.min(o,f.Z.get("MAX_BACK_OFF")),u&&(c=u.short?u.short:u.message?null==u?void 0:u.message:u.toString(),u.code&&"403012"===u.code.toString()&&(o=f.Z.get("EMBARGO_BACK_OFF")));var l=new Date;return l.setMilliseconds(o),{expiry:l,retry:o,cause:c,subErrors:null==r?void 0:r.subErrorJSON}}},{key:"fetchCollectionIndexRaw",value:(ye=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,h,E,S,v,g,T,m,y,O,A=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.requestId,a=t.desiredId,s=t.params,i=t.oldMetadata,o=t.priority,c=t.force,u=t.skipAuth,l=void 0!==u&&u,p=t.gsdkData,h=void 0===p?{surfaces:{}}:p,E=t.skipApiCall,S=void 0!==E&&E,v=this._createCollectionData(a),g=!0,e.next=1,v.load({version:this.getClientVersion(s),file:null===(n=this._data)||void 0===n||null===(n=n.metadata[a])||void 0===n?void 0:n.path}).then(function(){var e;null!==(e=A._data)&&void 0!==e&&e.metadata[a]&&(A._data.metadata[a].path=v.fileName)}).catch(function(e){g=!1});case 1:if(g&&_.Z.isDateExpired(v.expiryTime)&&(g=!1),g&&v.isDefaultData&&(g=!1),T=i&&i.refreshTime,g&&("stale"===c.type&&_.Z.isDateExpired(null==i?void 0:i.expiryTime)||"always"===c.type)&&(g=!1),g){e.next=6;break}return e.next=2,this.downloadManager.downloadCollectionData({id:r,params:s,priority:o,skipAuth:l,skipApiCall:S});case 2:return m=e.sent,y=Object.assign({},m.surfaces,h.surfaces),m.surfaces=y,m._ccx=m._ccx||{},m._ccx.version=f.Z.get("LOOKUP_COLLECTION_FILE_VERSION",this.type),e.next=3,v.setData(m,this.getClientVersion(s));case 3:if(!(O=e.sent)){e.next=4;break}throw O;case 4:return e.next=5,v.save();case 5:return T=(new Date).toISOString(),this._data.metadata[a]&&(this._data.metadata[a].path=v.fileName,this._data.metadata[a].refreshTime=T),e.next=6,this.save();case 6:return this._checkValidity(v,s),e.abrupt("return",v);case 7:case"end":return e.stop()}},e,this)})),function(e){return ye.apply(this,arguments)})},{key:"_fetchCollectionDataRaw",value:(me=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h,S,v,g,m=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=void 0===n?{}:n,s=t.priority,i=void 0===s?void 0:s,o=t.payload,c=void 0===o?void 0:o,u=t.force,l=void 0===u?{type:"none"}:u,p=t.fetchType,h=void 0===p?"pre-fetch":p,E.Z.getUserId()){e.next=1;break}throw new A.Z("signed out").silence();case 1:return r=this.sanitizeParams(r),e.next=2,this.updateParams([r]);case 2:return r=e.sent[0],e.next=3,this._syncLock.read(a()(d().mark(function e(){var t,n,s,o,u,p,y,O,C,I,R,N,P,L,x,b,w,U,M;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Q.Z.status!==Q.Z.OFFLINE){e.next=1;break}throw m.log.disk("Not downloading collection - offline"),new A.Z("offline").silence();case 1:if(!k.Z.isWaitingForBackOff(k.E.NETWORK)){e.next=2;break}throw new A.Z("Awaiting global back-off ".concat(k.Z.backOffCause(k.E.NETWORK))).silence();case 2:return e.next=3,m.paramsToId(r);case 3:if(n=e.sent,s=m._getCollectionInfo(r),o=n,!s||n!==s.latestId){e.next=6;break}if("always"===l.type){e.next=4;break}return e.abrupt("return",m._createCollectionData(n));case 4:try{delete m._data.metadata[n].expiryTime}catch(e){m.log.disk("Failed to find desiredId ".concat(n," for deletion."))}return e.next=5,m.paramsToId(r);case 5:n=e.sent;case 6:if(u=function(e){m.emit(n,e),o!==n&&m.emit(o,e)},(i=i||m.priority({params:r,key:n})).key=n,!m.isRequestPoisoned(r)){e.next=7;break}throw new A.Z("Poisoned request not supported.").silence();case 7:if(!(p=Object.assign({},m._data.metadata[n]))||_.Z.isDateExpired(p.expiryTime)||"none"!==l.type){e.next=8;break}throw y="Waiting for back-off ".concat(p.cause," for ").concat(_.Z.getHumanReadableTime(p.retry||0)," expiring at ").concat(p.expiryTime," in ").concat(_.Z.getHumanReadableTime(new Date(p.expiryTime).getTime()-Date.now())),m.log.context({params:r}).disk(y),new A.Z(y).silence();case 8:return m._addNewCollectionInfo(Se(Se({params:r,isPending:!0,collectionId:n,refreshTime:p.refreshTime},m._calculateBackOffMetadata({metadata:m._data.metadata[n],initialRetry:f.Z.get("KILLED_BEFORE_RESPONSE_INITIAL_RETRY")})),{},{file:null===(t=m._data)||void 0===t||null===(t=t.metadata[n])||void 0===t?void 0:t.path})),e.next=9,m.save();case 9:return O=T.v4(),C=T.v4(),e.next=10,m.downloadManager.url(r);case 10:return I=e.sent,R=new D.URL(I).origin,N={},e.next=11,F.Z.getNodeTunnelOptionsForURL(R);case 11:return P=e.sent.details,e.next=12,E.Z.getAccessToken().catch(function(e){return!1});case 12:return L=!!e.sent,v=m.log.context({params:r,payload:Se(Se({},c),{},{"exp.request_guid":O,"event.subtype":f.Z.analytics.st_API,"ccxp.mode":"gsdk-".concat(h),"ccxp.force_depth":null==l?void 0:l.depth,"content.type":f.Z.analytics.GSDK,"ccxp.request_type":"get","ccxp.proxy":P,"ccxp.using_auth":L},m.downloadManager.additionalAnalytics(r))}),e.next=13,m.downloadManager.downloadGSDKCollectionData({id:C,params:r,lookup:m});case 13:return x=e.sent,b=x.response,w=x.analytics,U=x.error,M=x.usedGSDK,S=b,N=w,g=U,e.next=14,m.log.context({params:r,payload:Se(Se(Se({},c),{},{"exp.request_guid":O},!M&&{"event.url":I,"content.action":I}),{},{"event.subtype":f.Z.analytics.st_API,"ccxp.mode":M?"gsdk-".concat(h):h,"ccxp.force_depth":null==l?void 0:l.depth,"ccxp.request_type":"get","ccxp.proxy":P,"ccxp.using_auth":L,"content.type":M?f.Z.analytics.GSDK:f.Z.analytics.SOPHIA_CARDS},m.downloadManager.additionalAnalytics(r))}).request(function(){var e=a()(d().mark(function e(t){var s,o,c,f,_,h;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u(s={}),!g){e.next=1;break}throw g;case 1:return o={requestId:O,params:r,desiredId:n,oldMetadata:p,force:l,priority:i,gsdkData:S,skipAuth:!L,skipApiCall:M},e.next=2,m.fetchCollectionIndex(o).catch(function(){var e=a()(d().mark(function e(t){var n,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"401013"!==(null===(n=t.code)||void 0===n?void 0:n.toString())){e.next=3;break}return m.log.context({params:r}).error(new A.Z("Retrying with fresh token",t)),E.Z.reset(!0),e.next=1,k.Z.updateBackOff({clear:!0,type:k.E.AUTH,sync:!1});case 1:return e.next=2,m.fetchCollectionIndex(o).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw t;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return s=e.sent,e.abrupt("return",s);case 3:e.next=5;break;case 4:e.prev=4,i=e.catch(0),m.log.context({params:r}).error(new A.Z("Auth retry failed",i));case 5:throw t;case 6:case"end":return e.stop()}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}());case 2:return c=e.sent,m.downloadManager.applyResponseAnalytics(t,c.data,r,N),s.path="".concat(m._path+c.fileName),s.contentId=c.id,s.total=c.totalItems,m._data.metadata[c.id]&&(m._data.metadata[c.id].path=c.fileName),u(s),e.next=3,c.sync({priority:i,payload:t.options.payload,params:r,progress:function(e){s.path="".concat(m._path+c.fileName),u(Object.assign(e,s))},force:l,gsdkLogger:v});case 3:return m._checkValidity(c,r),m._addNewCollectionInfo({params:r,isPending:!1,collectionId:c.id,expiry:m._calculateExpiry(c,r),refreshTime:m._data&&m._data.metadata[n]&&m._data.metadata[n].refreshTime,file:c.fileName}),e.next=4,m.save();case 4:return m.emit("newCollection",r,c),e.abrupt("return",c);case 5:return e.prev=5,h=e.catch(0),m._addNewCollectionInfo(Se(Se({params:r,isPending:!0,collectionId:n,refreshTime:m._data.metadata[n].refreshTime},m._calculateBackOffMetadata({metadata:m._data.metadata[n],error:h,updateBackOff:!1})),{},{file:null===(f=m._data)||void 0===f||null===(f=f.metadata[n])||void 0===f?void 0:f.path})),e.next=6,m.save();case 6:throw h instanceof A.Z&&(h.supportData={id:n,path:null===(_=m._data)||void 0===_||null===(_=_.metadata[n])||void 0===_?void 0:_.path}),h;case 7:case"end":return e.stop()}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}());case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}},e)})),i).catch(function(){var e=a()(d().mark(function e(t){var n,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof A.Z)||t.supportData||t.hasSubErrors){e.next=2;break}return e.next=1,m.paramsToId(r);case 1:n=e.sent,a=m._data.metadata[n],t.addSubErrors(null==a?void 0:a.subErrors),null!=a&&a.path&&(t.supportData={id:n,path:null==a?void 0:a.path});case 2:throw t;case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return me.apply(this,arguments)})},{key:"_clearScheduledSyncJob",value:function(){this._syncTimeout&&(clearTimeout(this._syncTimeout),delete this._syncTimeout)}},{key:"_scheduleNextSyncJob",value:(Te=a()(d().mark(function e(t){var n,r,s,i,o,c,u=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=1/0,this._clearScheduledSyncJob(),!k.Z.isWaitingForBackOff(k.E.NETWORK)){e.next=2;break}return s=new Date(k.Z.backOffExpiry(k.E.NETWORK)).getTime()-(new Date).getTime(),this.log.disk("Scheduling next sync in ".concat(_.Z.getHumanReadableTime(s)," after global backoff")),s=Math.min(f.Z.get("MAX_TIMEOUT"),s),i={type:"none"},e.next=1,de.determineNextLaunchTime(this.type,s);case 1:return this._syncTimeout=setTimeout(function(){u.sync.bind(u)({force:i}).catch(function(e){u.log.disk("Error syncing after content backoff for ".concat(u.type),e)})},s),e.abrupt("return");case 2:return e.next=3,_.Z.waitAll(Object.keys(this._data.metadata).map(function(){var e=a()(d().mark(function e(t){var n,r,a,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u._data.metadata[t],!u.needsSync(t,{checkExpiry:!1})){e.next=2;break}if(r=_.Z.getTimeToExpiry(n.expiryTime),n.delay&&(a=_.Z.getTimeToExpiry(n.delay.expiryTime),0===r&&(r=a),s=Math.min(s,a)),0!==r){e.next=1;break}return r=f.Z.get("SYNC_INITIAL_RETRY"),(i=new Date).setMilliseconds(r),n.expiryTime=i.toISOString(),e.next=1,u.save();case 1:s=Math.min(s,r);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:return e.next=4,_.Z.waitAll(Object.values(null!==(n=null===(r=this._data)||void 0===r?void 0:r.onDemandMetadata)&&void 0!==n?n:{}).map(function(){var e=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"notReady"===u.getOnDemandCollectionInfo(t.params)&&!u.isOnDemandSyncInProgress(u.paramsToOnDemandId(t.params))&&_.Z.hasBeenUsedRecently(t.lastUseTime)&&(n=_.Z.getTimeToExpiry(t.expiryTime),s=Math.min(s,n));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 4:return f.Z.get("FILE_ACCESSOR_WRITE_ENABLED",this.type)&&(o=f.Z.get("LAST_FILEACCESSOR_WRITE_PARSED",this._type))&&!isNaN(Date.parse(o))&&(s=Math.min(s,Date.parse(o)-Date.now()+f.Z.get("FILEACCESSOR_WRITE_SLA"))),s+=_.Z.getRandomizedTime(s<f.Z.get("TIME_FOR_SHORT_RANDOMIZE")),s=Math.min(s,f.Z.get("MAX_TIMEOUT")),this.log.disk("Scheduling next sync in ".concat(_.Z.getHumanReadableTime(s)," at ").concat(new Date(Date.now()+s).toISOString()," from ").concat(t)),c={type:"none"},e.next=5,de.determineNextLaunchTime(this.type,s);case 5:this._syncTimeout=setTimeout(function(){u.sync.bind(u)({force:c}).catch(function(e){u.log.disk("Error syncing content for ".concat(u.type),e)})},s);case 6:case"end":return e.stop()}},e,this)})),function(e){return Te.apply(this,arguments)})},{key:"_getReferencedIdList",value:function(){var e=this,t={};return Object.keys(this._data.metadata).forEach(function(n){e._isDataReferenced(n)&&(t[n]=!0)}),t}},{key:"_isPendingCollection",value:function(e){var t=this._data.metadata[e],n=t&&this._getCollectionInfo(t.params,t.userId);return!(!n||!n.pendingId)&&e===n.pendingId}},{key:"_refetchCollection",value:(ge=a()(d().mark(function e(t){var n,r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._data.metadata,!(r=n[t]&&n[t].params)){e.next=2;break}return this.clearCollectionInfo(r,t,!1),this.log.disk("Refetch collection [".concat(t,"]")),e.next=1,this.addNewCollectionData({params:r}).catch(function(e){return a.log.context({params:r}).error(new A.Z("Error Re-fetching collection",e))&&void 0});case 1:return e.abrupt("return",e.sent);case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}},e,this)})),function(e){return ge.apply(this,arguments)})},{key:"_getReferencedAssetList",value:(Ee=a()(d().mark(function e(t){var n,r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.next=1,_.Z.waitAll(Object.keys(t).map(function(){var e=a()(d().mark(function e(t){var a,s,i,o,c,u,l,p;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r._createCollectionData(t),e.prev=1,i=r.getClientVersion(r._data.metadata[t].params),e.next=2,a.load({version:i,skipSaving:!0,file:null===(s=r._data.metadata[t])||void 0===s?void 0:s.path});case 2:return c=Object,u=n,e.next=3,a.getReferencedAssets();case 3:l=e.sent,c.assign.call(c,u,l),e.next=6;break;case 4:if(e.prev=4,"ENOENT"!==(p=e.catch(1)).code&&p.code!==b.Z.INVALID_COLLECTION){e.next=5;break}r.log.disk("File is missing for collection [".concat(a.id,"]")),(o=r._data.metadata[a.id])&&o.userId===E.Z.getUserId()&&r._isDataPrimaryReference(a.id)&&!r._isPendingCollection(a.id)&&r._refetchCollection(a.id),e.next=6;break;case 5:throw p;case 6:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}()));case 1:return e.abrupt("return",n);case 2:case"end":return e.stop()}},e)})),function(e){return Ee.apply(this,arguments)})},{key:"_cleanupCache",value:function(e,t){var n,r=this,a=this._data.metadata;Object.keys(a).forEach(function(n){var s,i;r._isDataPrimaryReference(n)||e[n]&&t.includes(null!==(s=null===(i=r._data.metadata[n])||void 0===i?void 0:i.path)&&void 0!==s?s:"".concat(n,".json"))||delete a[n]});var s=null!==(n=this._data.onDemandMetadata)&&void 0!==n?n:{};Object.keys(s).forEach(function(e){r.getOnDemandCollectionInfo(s[e].params,s[e].userId)||delete s[e]})}},{key:"_cleanupAssetsCache",value:function(e,t){var n=this._data.assetMetadata;Object.keys(n).forEach(function(r){var a=n[r];a.path&&(e[a.path]&&t.includes(v.basename(a.path))||delete n[r])})}},{key:"generateApiFile",value:(he=a()(d().mark(function e(t){var n,r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={},Object.keys(this._data.versionInfo).forEach(function(e){e&&"undefined"!==e&&(n[e]={data:[]},Object.keys(t.metadata).forEach(function(s,i){var o,c=a._getLookupKeys(t.metadata[s].params).reduce(function(e,t){return e[t]?e[t]:e},a._data.versionInfo[e]);c.latestId&&(r[c.latestId]||(n[e].data.push(null===(o=a._data)||void 0===o?void 0:o.metadata[c.latestId]),r[c.latestId]=!0))}))}),e.abrupt("return",{version:f.Z.get("FILE_ACCESS_MAP_FILE_VERSION"),client:this.type,session:b.Z.event_session_tracker,lastUpdateTime:new Date(Date.now()).toISOString(),users:n});case 1:case"end":return e.stop()}},e,this)})),function(e){return he.apply(this,arguments)})},{key:"setData",value:function(e){var t=_.Z.validateDataFields(e,f.Z.get("MAP_DATA_SCHEMA"));return t?this.log.error(new A.Z(b.Z.DATA_VALIDATION_ERR,t[0])):this._data=e,t}},{key:"getMinorVersion",value:function(e,t,n,r){var a=Object.keys(r.metadata).find(function(a){var s,i,o=null===(s=r.metadata[a])||void 0===s?void 0:s.params;return(null==o?void 0:o.productCode)===t&&(null==o?void 0:o.productVersion.split(".")[0])===n&&(null===(i=r.metadata[a])||void 0===i?void 0:i.userId)===e});if(!a)return null;var s=r.metadata[a].params.productVersion;return this.makeVersionLookupKey(s)}},{key:"upgrade",value:(le=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}},e)})),function(e){return le.apply(this,arguments)})},{key:"getTutorialAssets",value:(ue=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}},e)})),function(e){return ue.apply(this,arguments)})},{key:"getCollectionAsset",value:(ce=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}},e)})),function(e){return ce.apply(this,arguments)})},{key:"load",value:(oe=a()(d().mark(function e(){var t,n,r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,S.readJson(this._path+this._fileName).catch(function(e){r.log.disk("Failed to load lookup file from disk: ".concat(r._fileName," - ").concat(e))});case 1:if(t=e.sent,n=!1,t){e.next=2;break}this.log.disk("Empty lookup file: ".concat(this._fileName)),e.next=4;break;case 2:if(t.version===f.Z.get("LOOKUP_MAP_FILE_VERSION",this._type)){e.next=4;break}return this.log.disk("Lookup file version mismatch: ".concat(this._fileName)),e.next=3,this.upgrade(t).catch(function(e){return null});case 3:t=e.sent,n=!0;case 4:if(t&&!this.setData(t)||((t={}).version=f.Z.get("LOOKUP_MAP_FILE_VERSION",this._type),t.versionInfo={},t.metadata={},t.assetMetadata={},t.usersInfo={},t.onDemand={},t.onDemandMetadata={},this.setData(t),n=!0),t.onDemand||(t.onDemand={},t.onDemandMetadata={},n=!0),!n){e.next=5;break}return e.next=5,this.save();case 5:case"end":return e.stop()}},e,this)})),function(){return oe.apply(this,arguments)})},{key:"getPath",value:function(){return this._path}},{key:"updateDisplayedId",value:(ie=a()(d().mark(function e(t){var n,r,a,s,i,o=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,!(r=t.displayed)||!n){e.next=1;break}if(s=null!==(a=Object.keys(this._data.metadata).find(function(e){return o._data.metadata[e].path===r}))&&void 0!==a?a:v.basename(r,".json"),(i=this._getCollectionInfo(n))||(this._addNewCollectionInfo({params:n,isPending:!1,collectionId:s,file:r}),i=this._getCollectionInfo(n)),!i||i.lastDisplayedId===s){e.next=1;break}return i.lastDisplayedId=s,this._setCollectionInfo(n,i),e.next=1,this.save();case 1:case"end":return e.stop()}},e,this)})),function(e){return ie.apply(this,arguments)})},{key:"validateParams",value:function(e){var t=_.Z.validateDataFields(e,f.Z.get("PARAMETERS_SCHEMA",this.type));if(t)throw new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,t[0])}},{key:"getPending",value:(ae=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=t.updateLastUseTime,n){e.next=1;break}return a=new A.Z(b.Z.DATA_VALIDATION_ERR,"No data to get the path for in LookupMap"),this.log.error(a),e.abrupt("return");case 1:e.prev=1,this.validateParams(n),e.next=3;break;case 2:return e.prev=2,l=e.catch(1),this.log.error(new A.Z(l,"No data to get the path for in LookupMap")),e.abrupt("return");case 3:if(s=!1,i=void 0,o=void 0,!(c=this._getCollectionInfo(n))){e.next=4;break}if(u=[c.partialId,c.latestId,c.pendingId].reduce(function(e,t){var n,r;return e?t?new Date((null===(n=p._data.metadata[e])||void 0===n?void 0:n.refreshTime)||0)>new Date((null===(r=p._data.metadata[t])||void 0===r?void 0:r.refreshTime)||0)?e:t:e:t}),i=u&&this._data.metadata[u].path,o=u&&this._data.metadata[u].subErrors,r&&((u&&this._data.metadata[c.pendingId?c.pendingId:u]||{}).lastUseTime=(new Date).toISOString(),s=!0,this.updateGSDKUseTime(n)),!s){e.next=4;break}return e.next=4,this.save();case 4:return e.abrupt("return",{partial:i,failures:o});case 5:case"end":return e.stop()}},e,this,[[1,2]])})),function(e){return ae.apply(this,arguments)})},{key:"updatePending",value:(te=a()(d().mark(function e(t){var n,r,a,s,i,o,c;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=t.id,a=t.updateLastUseTime,s=t.err,n){e.next=1;break}return i=new A.Z(b.Z.DATA_VALIDATION_ERR,"No data to get the path for in LookupMap"),this.log.error(i),e.abrupt("return");case 1:if(this.validateParams(n),o=!1,!(c=this._getCollectionInfo(n))){e.next=2;break}if(c.partialId!==r&&(c.partialId=r,this._data.metadata[r]=this._data.metadata[r]||{},this._data.metadata[r].subErrors=s.subErrorJSON,o=!0),a&&((this._data.metadata[c.pendingId?c.pendingId:c.partialId]||{}).lastUseTime=(new Date).toISOString(),this.updateGSDKUseTime(n),o=!0),!o){e.next=2;break}return e.next=2,this.save();case 2:case"end":return e.stop()}},e,this)})),function(e){return te.apply(this,arguments)})},{key:"getLatestId",value:(ee=a()(d().mark(function e(t){var n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params){e.next=1;break}return e.abrupt("return",void 0);case 1:return r=this._getCollectionInfo(n),e.abrupt("return",r&&r.latestId);case 2:case"end":return e.stop()}},e,this)})),function(e){return ee.apply(this,arguments)})},{key:"getLatestPath",value:(q=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,_,h,S,v,g,T,m,y,O=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=t.updateLastUsedId,a=void 0!==r&&r,s=t.updateLastUseTime,i=void 0!==s&&s,n){e.next=1;break}return o=new A.Z(b.Z.DATA_VALIDATION_ERR,"No data to get the path for in LookupMap"),this.log.error(o),e.abrupt("return");case 1:if(this.validateParams(n),n.productCode=this.getProductAlias(n),!(c=this._getCollectionInfo(n))||!c.latestId){e.next=3;break}if(p=!1,a&&c.latestId!==c.lastUsedId&&(c.lastUsedId=c.latestId,this._setCollectionInfo(n,c),p=!0),i&&(_=this._data.metadata[c.lastUsedId?c.lastUsedId:""]||{},h=_.lastUseTime,_.lastUseTime=(new Date).toISOString(),h&&((S=new Date(h)).setMilliseconds(f.Z.get("STOP_SYNCING_BEYOND")),S<new Date&&(v={type:"none"},this.sync({force:v}).catch(function(e){O.log.disk("Error syncing outdated content ",e)}))),this.updateGSDKUseTime(n),p=!0),!p){e.next=2;break}return e.next=2,this.save();case 2:return(g=this._data.metadata[c.latestId])&&g.userId===E.Z.getUserId()&&!this._isPendingCollection(c.latestId)&&((y=this._createCollectionData(c.latestId)).load({version:this.getClientVersion(n),file:null===(T=this._data)||void 0===T||null===(T=T.metadata[c.latestId])||void 0===T?void 0:T.path}).catch(function(e){"ENOENT"===e.code&&(O.log.disk("File is missing for collection [".concat(y.id,"]")),O._refetchCollection(y.id))}),null!==(m=this._data)&&void 0!==m&&m.metadata[c.latestId]&&(this._data.metadata[c.latestId].path=y.fileName)),e.abrupt("return",this._path+(null!==(u=null===(l=this._data.metadata[c.latestId])||void 0===l?void 0:l.path)&&void 0!==u?u:"".concat(c.latestId,".json")));case 3:return e.abrupt("return",void 0);case 4:case"end":return e.stop()}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"getExpiry",value:function(e){return this._data.metadata[e]&&this._data.metadata[e].expiryTime}},{key:"save",value:(Y=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._data){e.next=1;break}throw t=new A.Z(b.Z.DATA_VALIDATION_ERR,"No data to save to LookupMap."),this.log.error(t),t;case 1:if(!this._saveInProgress){e.next=2;break}return this._calledSave=!0,e.abrupt("return");case 2:return this._calledSave=!1,this._saveInProgress=!0,e.next=3,this._diskLock.write(a()(d().mark(function e(){var t,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,N.writeJsonAtomic(n._path,f.Z.get("LOOKUP_MAP_FILE"),n._data,!0);case 1:t=e.sent,v.basename(t)!==n._fileName&&(n._fileName=v.basename(t),f.Z.set("LOOKUP_MAP_FILE",n._fileName,n.type)),e.next=3;break;case 2:return e.prev=2,a=e.catch(0),n.log.error(new A.Z(f.Z.analytics.LOOKUP_MAP_ERROR,a,a.code),"Error writing to map json file: ".concat(n._fileName)),e.abrupt("return");case 3:if(!f.Z.get("FILE_ACCESSOR_WRITE_ENABLED",n.type)){e.next=8;break}return e.prev=4,e.next=5,n.generateApiFile(n._data);case 5:return n._apiData=e.sent,e.next=6,N.writeJsonAtomic(n._path,f.Z.get("FILE_ACCESS_MAP_FILE"),n._apiData,!0);case 6:r=e.sent,v.basename(r)!==f.Z.get("FILE_ACCESS_MAP_FILE")&&(n._apiFileName=v.basename(r),n.logApiRenameError()),e.next=8;break;case 7:e.prev=7,s=e.catch(4),n.log.error(new A.Z(f.Z.analytics.ACCESSOR_ERROR_TYPE,s,f.Z.analytics.ACCESSOR_READ_ERROR_CODE),"Error writing to api json file: ".concat(n._apiFileName));case 8:case"end":return e.stop()}},e,null,[[0,2],[4,7]])})));case 3:if(this._saveInProgress=!1,!this._calledSave){e.next=5;break}return e.next=4,this.save();case 4:this._calledSave=!1;case 5:case"end":return e.stop()}},e,this)})),function(){return Y.apply(this,arguments)})},{key:"cachedAsset",value:function(e){return this._data.assetMetadata[e]}},{key:"_fetchGSDKAsset",value:(W=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,h,E;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,r=t.asset,a=t.href,s=t.ext,i=t.assetsDir,c=0,e.prev=1,u=this.generateId(Object.assign({},n,{filePrefix:"GSDK"})),l="",s?l=s:a&&(l=(l=(l=v.extname(a))&&l.substr(1))||"bin"),p="".concat(i).concat(u,".").concat(l),h=Date.now(),_.Z.isDebugModeEnabled()&&(this.log.disk("Asking GSDK to save file path: ".concat(p)),this.log.disk("GSDK asset id: ".concat(JSON.stringify(r)))),this.log.disk("[".concat(u,"] Saving asset from GSDK - ").concat(a)),e.next=2,pe.Z.saveCachedAsset(p,r);case 2:return o="".concat(v.basename(i),"/").concat(v.basename(p)),c+=Date.now()-h,this.log.context({diskParams:{time:c}}).disk("[".concat(u,"] Finished saving asset in ").concat(c,"ms")),e.abrupt("return",{path:o,time:c});case 3:throw e.prev=3,E=e.catch(1),new A.Z(f.Z.analytics.GSDK_SAVE_CACHED_ASSET_FAILURE,E.message||"NO_SAVE_ERROR_MESSAGE",E.code||"NO_SAVE_ERROR_CODE").removeStack();case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return W.apply(this,arguments)})},{key:"clearAssetMetadata",value:function(e){delete this._data.assetMetadata[e]}},{key:"_fetchAsset",value:(j=a()(d().mark(function e(t){var n,r,s,i,o,c,u,p,h,E,g,T,m,y,O,C,I,R,k,P,L,D,x,b,w,U,M,Z,F,G,V,H,K,B,j,W,Y,X,q,J,Q,ee,te,ne,re,ae,se,ie,oe,ce,ue=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.href,u=t.assetsDir,p=t.priority,h=t.params,E=t.force,g=t.key,T=t.headers,m=t.auth,y=t.progressKey,O=t.options,C=void 0===O?{}:O,g=g||c,I=(null===(n=this._data)||void 0===n?void 0:n.assetMetadata[g])||{},R=I.lastModified,k=I.expiry,P=I.etag,L=I.date,!(oe=I.path)){e.next=2;break}return e.next=1,S.pathExists("".concat(u,"../").concat(I.path));case 1:oe=e.sent;case 2:if((D=oe)||(R=P=L=k=void 0),E&&E.depth>=0&&"always"===E.type&&(!E.from||!I.refreshTime||new Date(E.from)>new Date(I.refreshTime))&&(R=P=L=k=void 0),!(new Date(k||"")>new Date)){e.next=3;break}return e.abrupt("return",{path:I.path});case 3:if("always"===(null==E?void 0:E.type)&&(null!==(r=null==E?void 0:E.depth)&&void 0!==r?r:0)>=0||!D||!I.path||".json"===v.extname(I.path)||f.Z.get("NON_IDEMPOTENT_IMAGES",this.type)){e.next=4;break}return e.abrupt("return",{path:I.path});case 4:if(x=null!=p&&p.key?this.abortControllers[p.key]:void 0,b=I.temp&&v.normalize("".concat(u,"/../").concat(I.temp)),!(ce=b)){e.next=6;break}return e.next=5,S.pathExists(b);case 5:ce=e.sent;case 6:if(w=ce,U=!0,M=0,Z=void 0,F=I.path,G=function(e){var t;y=null!=y?y:"Asset-"+(null!==(t=null==p?void 0:p.key)&&void 0!==t?t:g),ue.emit(y,l()({},g||c,e))},V=_.Z.throttle(G,f.Z.get("PROGRESS_THROTTLE_INTERVAL")),D||!w||!b||!I.path){e.next=11;break}return e.next=7,this.downloadManager.load(b).catch(function(e){ue.log.error(new A.Z("Could not load file for resume",e))});case 7:if(!(H=e.sent)){e.next=11;break}return H.emitter.on("progress",V),e.next=8,this.downloadManager.resume(H,{url:c,priority:p,options:Object.assign({},{signal:null==x?void 0:x.signal},C)}).catch(function(){var e=a()(d().mark(function e(t){var n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ue.log.error(new A.Z("Resume Failed",t)),"ERR_SSL_DECRYPTION_FAILED_OR_BAD_RECORD_MAC"!==t.code){e.next=1;break}throw r=null!==(n=f.Z.get("ASSET_MAX_SOCKETS",ue._type))&&void 0!==n?n:f.Z.get("NETWORK_MAX_SOCKETS"),f.Z.set("ASSET_MAX_SOCKETS",Math.max(Math.floor(r/2),1),ue._type),new A.Z("server",t,"LOCAL_RETRY");case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 8:if(K=e.sent,H.emitter.off("progress",V),U=void 0===K){e.next=10;break}return e.next=9,N.rename(b,"".concat(u,"../").concat(I.path)).catch(function(){return U=!0});case 9:M+=K||0;case 10:Z=H.headers;case 11:if(B=I.id||this.generateId(h||{}),!U){e.next=18;break}return T=T||{},P?T["If-None-Match"]=P:R?T["If-Modified-Since"]=R:L&&(T["If-Modified-Since"]=L),e.next=12,this.downloadManager.get({url:c,options:Object.assign({},{headers:T,parallel:{minimumPartialSize:null!==(j=f.Z.get("ASSET_MINIMUM_PARTIAL_SIZE",this._type))&&void 0!==j?j:f.Z.get("NETWORK_MINIMUM_PARTIAL_SIZE"),maxSockets:null!==(W=f.Z.get("ASSET_MAX_SOCKETS",this._type))&&void 0!==W?W:f.Z.get("NETWORK_MAX_SOCKETS"),maxLatency:null!==(Y=f.Z.get("ASSET_MAX_LATENCY",this._type))&&void 0!==Y?Y:f.Z.get("NETWORK_MAX_LATENCY"),maxLatencyRetries:null!==(X=f.Z.get("ASSET_MAX_LATENCY_RETRIES",this._type))&&void 0!==X?X:f.Z.get("NETWORK_MAX_LATENCY_RETRIES")},signal:null==x?void 0:x.signal},C),auth:m,priority:p,id:B}).catch(function(){var e=a()(d().mark(function e(t){var n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("ERR_SSL_DECRYPTION_FAILED_OR_BAD_RECORD_MAC"!==t.code){e.next=1;break}throw r=null!==(n=f.Z.get("ASSET_MAX_SOCKETS",ue._type))&&void 0!==n?n:f.Z.get("NETWORK_MAX_SOCKETS"),f.Z.set("ASSET_MAX_SOCKETS",Math.max(Math.floor(r/2),1),ue._type),new A.Z("server",t,"LOCAL_RETRY");case 1:if(4!==Math.floor(t.code/100)&&5!==Math.floor(t.code/100)||!T||!T["If-None-Match"]&&!T["If-Modified-Since"]){e.next=3;break}return delete I.date,delete I.lastModified,delete I.etag,e.next=2,ue.save();case 2:throw new A.Z("server",t,"LOCAL_RETRY");case 3:throw t;case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 12:if(J=e.sent,Q=J.response,Z=Q.headers,M+=J.time,304!==Q.status){e.next=15;break}if(!I.path){e.next=14;break}return this._data.assetMetadata[g]=Se(Se({},I),{},{expiry:Z&&$.Z.getExpiry(Z)||new Date(Date.now()+f.Z.get("ASSET_DEFAULT_EXPIRATION")),refreshTime:(new Date).toISOString()}),e.next=13,this.save();case 13:return e.abrupt("return",{path:I.path});case 14:throw new Error("Got 304 for asset not on disk for url ".concat(c));case 15:return(ee=z.getExtension($.Z.getContentTypeHeader(Q.headers)||""))||(ee=(ee=(ee=v.extname(Q.url))&&ee.substr(1))||"bin"),te="".concat(u).concat(B,".").concat(ee),this._data.assetMetadata[g]=(null===(q=this._data)||void 0===q?void 0:q.assetMetadata[g])||{},this._data.assetMetadata[g].id=B,this._data.assetMetadata[g].path=v.basename(u)+"/".concat(B,".").concat(ee),e.next=16,this.save();case 16:return ne=Date.now(),re=!1,e.next=17,N.writeAtomic({response:Q,target:te,progress:function(e,t,n){var r;!re&&g&&ue._data.assetMetadata[g]&&(null===(r=ue._data.assetMetadata[g])||void 0===r?void 0:r.temp)!==n&&(ue._data.assetMetadata[g].temp=v.basename(u)+"/"+v.basename(n),ue.save()),V({done:e,total:t})},renameOnError:!0});case 17:te=e.sent,re=!0,F="".concat(v.basename(u),"/").concat(v.basename(te)),Z=Q.headers,M+=Date.now()-ne;case 18:return this._data.assetMetadata[g]={id:B,path:F,expiry:Z&&$.Z.getExpiry(Z)||new Date(Date.now()+f.Z.get("ASSET_DEFAULT_EXPIRATION")),refreshTime:(new Date).toISOString()},null!==(s=Z)&&void 0!==s&&s.get("last-modified")&&(this._data.assetMetadata[g].lastModified=null===(ae=Z)||void 0===ae?void 0:ae.get("last-modified")),null!==(i=Z)&&void 0!==i&&i.get("etag")&&(this._data.assetMetadata[g].etag=null===(se=Z)||void 0===se?void 0:se.get("etag")),null!==(o=Z)&&void 0!==o&&o.get("date")&&(this._data.assetMetadata[g].date=null===(ie=Z)||void 0===ie?void 0:ie.get("date")),e.next=19,this.save();case 19:return e.abrupt("return",{path:F,time:M});case 20:case"end":return e.stop()}},e,this)})),function(e){return j.apply(this,arguments)})},{key:"priority",value:function(e){var t=e.params,n=e.key,r=void 0===n?"":n,a=e.level,s=void 0===a?x.o7.Regular:a;return new x.UL({key:r,value:f.Z.get("PRODUCT_PRIORITY")[t.productCode]||0,channel:f.Z.get("PRIORITY_CHANNEL",this._type),level:s})}},{key:"isValidDataForParams",value:function(e){e.id,e.params;return!0}},{key:"addDelay",value:(K=a()(d().mark(function e(t){var n,r,a,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,!("always"===(r=t.force).type&&r.delay&&r.delay>0)){e.next=3;break}return e.next=1,this.paramsToId(n);case 1:if(s=this._getCollectionInfo(n),!(i=null!==(a=null==s?void 0:s.pendingId)&&void 0!==a?a:null==s?void 0:s.latestId)){e.next=3;break}return this._data.metadata[i].delay={depth:r.depth||0,expiryTime:new Date(Date.now()+r.delay).toISOString()},this._data.metadata[i].params=n,e.next=2,this._scheduleNextSyncJob("addDelay");case 2:return e.abrupt("return",this._createCollectionData(i));case 3:return e.abrupt("return",void 0);case 4:case"end":return e.stop()}},e,this)})),function(e){return K.apply(this,arguments)})},{key:"delayExpiry",value:function(e){var t;return e?null===(t=this._data)||void 0===t||null===(t=t.metadata[e])||void 0===t||null===(t=t.delay)||void 0===t?void 0:t.expiryTime:void 0}},{key:"addNewGSDKCollectionData",value:(V=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,_=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,r=t.payload,s=t.priorityLevel,i=t.progress,o=void 0===i?function(){}:i,c=t.force,u=t.fetchType,l=void 0===u?"update":u,p=t.log,e.next=1,this._syncLock.read(a()(d().mark(function e(){var t,a,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=_._getCollectionInfo(n))){e.next=4;break}if(!t.pendingId||!_.isSyncInProgress(t.pendingId)){e.next=1;break}return p.context({params:n}).disk("Active download in progress. Sending the update back to the queue"),_.emit("queueGSDKUpdate",n,l),e.abrupt("return");case 1:return e.next=2,_.addNewCollectionData({params:n,payload:r,priorityLevel:s,progress:o,force:c,fetchType:l});case 2:return e.abrupt("return",e.sent);case 3:e.next=5;break;case 4:throw a=_._data.versionInfo,_._getLookupKeys(n).forEach(function(e){a&&a[e]&&(a=a[e])}),i=new A.Z("No collection found on update.","Related Keys: ".concat(JSON.stringify(Object.keys(a))),f.Z.analytics.GSDK_CONTENT_UPDATE_FAILURE).removeStack(),p.error(i),i;case 5:case"end":return e.stop()}},e)})));case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e,this)})),function(e){return V.apply(this,arguments)})},{key:"addNewCollectionData",value:(G=a()(d().mark(function e(){var t,n,r,s,i,o,c,u,l,p,h,E,S,v,g,T,m,y,O,C,I,R,N,k,P,L,D,w=this,U=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(r=U.length>0&&void 0!==U[0]?U[0]:{}).params,i=r.payload,o=r.priorityLevel,c=r.progress,u=void 0===c?function(){}:c,l=r.force,p=r.fetchType,h=void 0===p?"pre-fetch":p,s){e.next=1;break}throw E=new A.Z(b.Z.DATA_VALIDATION_ERR,"No parameters to add the collection of."),this.log.error(E),E;case 1:return e.next=2,this.updateParams([s]);case 2:S=e.sent[0],s=null!=S?S:s,e.prev=3,this.validateParams(s),e.next=5;break;case 4:throw e.prev=4,L=e.catch(3),new A.Z(b.Z.PARAM_VALIDATION_ERR,L);case 5:if(!this.isRequestPoisoned(s)){e.next=6;break}throw new A.Z("Poisoned request not supported.").silence();case 6:if(null===(t=l)||void 0===t||!t.delay){e.next=9;break}return e.next=7,this.addDelay({params:s,force:l});case 7:return v=e.sent,h="delayed",e.next=8,this.save();case 8:return e.abrupt("return",v);case 9:if(!(g=this._getCollectionInfo(s))||!s.ccxVersion){e.next=10;break}if(T=!1,Object.values(g).forEach(function(e){var t=w._data.metadata[e];t&&t.params&&t.params.ccxVersion&&(t.params.ccxVersion&&-1!==_.Z.compareMajorMinorVersions(s.ccxVersion,t.params.ccxVersion,w.patchEnabledClient(t.params))||(t.params.ccxVersion=s.ccxVersion,T=!0))}),!T){e.next=10;break}return e.next=10,this.save();case 10:if(!g||!s.vmStatus){e.next=11;break}if(m=!1,y=!(256&s.vmStatus),Object.values(g).forEach(function(e){var t=w._data.metadata[e];t&&t.params&&(y||!t.params.vmStatus)&&(t.params.vmStatus=s.vmStatus,m=!0)}),!m){e.next=11;break}return e.next=11,this.save();case 11:if(!g||!g.latestId){e.next=16;break}if(O=g.latestId,this._data.metadata[O]=this._data.metadata[O]||{},C=!0,f.Z.get("MINOR_VERSION_SHOULD_UPDATE_CONTENT",this.type)&&(Object.values(g).some(function(e){var t=w._data.metadata[e];return!!(t&&t.params&&t.params.productVersion&&0==_.Z.compareMajorMinorVersions(s.productVersion,t.params.productVersion,w.patchEnabledClient(t.params)))})||(l={type:"always"})),!l){e.next=14;break}D=l.type,e.next="always"===D?12:"stale"===D?13:14;break;case 12:h="update"!==h?"force-always":"".concat(h,"-always"),C=!1;try{delete this._data.metadata[O].expiryTime}catch(e){this.log.disk("Failed to find id: ".concat(O," for deletion."))}return e.abrupt("continue",14);case 13:return h="update"!==h?"force-stale":"".concat(h,"-stale"),_.Z.isDateExpired(null===(n=this._data.metadata[O])||void 0===n?void 0:n.expiryTime)&&(h="expired",C=!1),e.abrupt("continue",14);case 14:if(this._data.metadata[O]){if(!this.isValidDataForParams({id:O,params:s})){C=!1;try{delete this._data.metadata[O].expiryTime}catch(e){this.log.disk("Failed to find id: ".concat(O," for deletion."))}}}else C=!1;if(!C){e.next=16;break}return R=this._createCollectionData(O),this._data.metadata[O].params=s,e.next=15,R.load({version:this.getClientVersion(s),file:null===(I=this._data)||void 0===I||null===(I=I.metadata[O])||void 0===I?void 0:I.path}).then(function(e){var t;return null!==(t=w._data)&&void 0!==t&&t.metadata[O]&&(w._data.metadata[O].path=R.fileName),e}).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return w.clearCollectionInfo(s,O,!1),e.next=1,w.addNewCollectionData({params:s,payload:i,progress:u,priorityLevel:o,force:l,fetchType:h});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 15:return e.abrupt("return",e.sent);case 16:return e.next=17,this.paramsToId(s);case 17:return N=e.sent,k=this.priority({params:s,key:N,level:o||x.o7.Regular}),this._syncLock.prioritize(k),this._downloadManager.prioritize(k),this.addListener(N,u),e.next=18,this._fetchCollectionData({params:s,priority:k,payload:i,force:l,fetchType:h}).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return w.log.context({params:s}).disk(t,"Error adding new collection"),e.next=1,w._scheduleNextSyncJob("FetchCollection-Error");case 1:throw w.removeListener(N,u),t;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 18:return P=e.sent,this.removeListener(N,u),e.next=19,this._scheduleNextSyncJob("Collection-Completed");case 19:return e.abrupt("return",P);case 20:case"end":return e.stop()}},e,this,[[3,4]])})),function(){return G.apply(this,arguments)})},{key:"needsSync",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.checkExpiry,s=void 0===a||a,i=r.force,o=void 0!==i&&i,c=r.inFuture,u=void 0!==c&&c,l=this._data.metadata[e],p=l&&l.userId===E.Z.getUserId()&&this._isDataPrimaryReference(e)&&!this.isRequestPoisoned(l.params);u&&l.delay?p=p&&!(this.isSyncInProgress(e)&&_.Z.isDateExpired(null===(t=l.delay)||void 0===t?void 0:t.expiryTime)):p=p&&!this.isSyncInProgress(e);(o||(p=p&&(!1===f.Z.get("STOP_REQUEST_TRAFFIC",this.type)||!!l.lastUseTime&&_.Z.hasBeenUsedRecently(l.lastUseTime))),s&&!o)&&(l.delay&&_.Z.isDateExpired(null===(n=l.delay)||void 0===n?void 0:n.expiryTime)||(p=p&&_.Z.isDateExpired(null==l?void 0:l.expiryTime)));return p}},{key:"parseFileAccessorWrites",value:(Z=a()(d().mark(function e(){var t,n,r,s,i,o,c,u,l,p,h=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.log.context({payload:{"event.subtype":f.Z.analytics.st_ACCESSOR}}),f.Z.get("FILE_ACCESSOR_WRITE_ENABLED",this.type)){e.next=1;break}return e.abrupt("return");case 1:return n=f.Z.get("FILE_ACCESSOR_WRITE_FOLDER"),r=v.join(this.getPath(),n),e.next=2,S.ensureDir(r).catch(function(e){throw f.Z.set("LAST_FILEACCESSOR_WRITE_PARSED",(new Date).toISOString(),h.type),new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,e,f.Z.analytics.ACCESSOR_WRITE_ERROR_CREATING_DIR_CODE)});case 2:return e.next=3,S.readdir(r).catch(function(e){throw f.Z.set("LAST_FILEACCESSOR_WRITE_PARSED",(new Date).toISOString(),h.type),new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,e,f.Z.analytics.ACCESSOR_WRITE_ERROR_READING_DIR_CODE)});case 3:s=e.sent,i=f.Z.get("LAST_FILEACCESSOR_WRITE_PARSED",this.type),f.Z.set("LAST_FILEACCESSOR_WRITE_PARSED",(new Date).toISOString(),this.type),o=[],s.length&&t.disk("Processing ".concat(s.length," file accessor writes.")),c=_e(s),e.prev=4,l=d().mark(function e(){var n,a,s,c,l,p,g,T,m,y;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.value,a={},s={},c=v.join(r,n),!new RegExp(f.Z.get("IGNORED_FILES_REGEXP",h.type)||f.Z.get("IGNORED_FILES_REGEXP")).test(n)){e.next=1;break}return _.Z.isDebugModeEnabled()&&h.log.disk("Ignoring file - ".concat(n)),e.abrupt("return",0);case 1:if(a["exp.request_guid"]=n.replace(/.json$/,""),e.prev=2,n.endsWith(".json")){e.next=3;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"File is not JSON",f.Z.analytics.ACCESSOR_WRITE_ERROR_FILE_TYPE_CODE).removeStack();case 3:return e.next=4,N.getFileSize(c).catch(function(e){throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"Err getting file size ".concat(e),f.Z.analytics.ACCESSOR_WRITE_ERROR_FILE_SIZE_CODE)});case 4:if(!(e.sent>f.Z.get("MAX_ACCESSOR_FILE_SIZE"))){e.next=5;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"File is larger than ".concat(f.Z.get("MAX_ACCESSOR_FILE_SIZE")),f.Z.analytics.ACCESSOR_WRITE_ERROR_FILE_SIZE_CODE).removeStack();case 5:return e.next=6,S.readJson(c);case 6:if(l=e.sent){e.next=7;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"Empty File Content",f.Z.analytics.ACCESSOR_WRITE_ERROR_NO_CONTENT).removeStack();case 7:if(l.clientSession?a["ccxp.clientSession"]=l.clientSession:h.log.context({payload:a,params:s}).disk("No clientSession provided"),l.timestamp&&(a["event.dts_start"]=l.timestamp),l.analytics&&(l.analytics["env.fw.name"]&&(a["env.fw.name"]=l.analytics["env.fw.name"]),l.analytics["env.fw.version"]&&(a["env.fw.version"]=l.analytics["env.fw.version"])),l.params){e.next=8;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"Params not supplied.",f.Z.analytics.ACCESSOR_WRITE_ERROR_NO_PARAMS_CODE).removeStack();case 8:if(s=l.params,a["event.context_guid"]=l.session,f.Z.get("SUPPORTED_FILE_WRITE_VERSIONS").includes(parseInt(l.version))){e.next=9;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"Invalid version: ".concat(l.version),f.Z.analytics.ACCESSOR_WRITE_ERROR_INVALID_VERSION_CODE).removeStack();case 9:if(isNaN(Date.parse(l.timestamp||""))&&(a["event.dts_start"]=(new Date).toISOString(),a["ccxp.invalid_timestamp"]=l.timestamp),!((g=new Date(l.timestamp)).getTime()>Date.now())){e.next=10;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"Timestamp is in the future.",f.Z.analytics.ACCESSOR_WRITE_ERROR_TIMESTAMP_FUTURE_CODE).removeStack();case 10:if(!(i&&g.getTime()<new Date(i).getTime())){e.next=11;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"Timestamp is older than last parsed timestamp.",f.Z.analytics.ACCESSOR_WRITE_ERROR_TIMESTAMP_OLDER_CODE).removeStack();case 11:if(l.user){e.next=12;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"User not supplied.",f.Z.analytics.ACCESSOR_WRITE_ERROR_NO_USER_CODE).removeStack();case 12:if(a["ccxp.path"]=l.path,a["ccxp.client_params"]=s,a["ccxp.accessor_user"]=l.user,l.user!==E.Z.getUserId()&&t.context({payload:a,params:s}).disk("User does not match. Expected ".concat(E.Z.getUserId()," but got ").concat(l.user,".")),l.path||null!==(p=l.error)&&void 0!==p&&p.description){e.next=13;break}throw new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"No path or error description specified in Write API File ".concat(n),f.Z.analytics.ACCESSOR_WRITE_ERROR_NO_PATH_DESCRIPTION_CODE).removeStack();case 13:e.next=16;break;case 14:return e.prev=14,(y=e.catch(2))instanceof A.Z?t.context({payload:a,params:s}).error(y):t.context({payload:a,params:s}).error(new A.Z(f.Z.analytics.ACCESSOR_WRITE_FILE_ERROR_TYPE,"Error parsing write api file:"+y,f.Z.analytics.ACCESSOR_WRITE_ERROR_FILE_INVALID_JSON_CODE)),e.next=15,S.remove(c).catch(function(e){h.log.disk("Error removing file ".concat(c))});case 15:return e.abrupt("return",0);case 16:l.error?(m=new A.Z(f.Z.analytics.ACCESSOR_CLIENT_ERROR_TYPE,null===(T=l)||void 0===T?void 0:T.error.description,l.error.code).setPayload({"ccxp.underlying_error":JSON.stringify(l.error.underlyingError)}).removeStack(),t.context({payload:a,params:s}).error(m),delete l.error):t.context({payload:a,params:s}).info(f.Z.analytics.ACCESSOR_WRITE_SUCCESS),o.push({filePath:c,content:l,payload:a,params:s});case 17:case"end":return e.stop()}},e,null,[[2,14]])}),c.s();case 5:if((u=c.n()).done){e.next=8;break}return e.delegateYield(l(),"t0",6);case 6:if(0!==e.t0){e.next=7;break}return e.abrupt("continue",7);case 7:e.next=5;break;case 8:e.next=10;break;case 9:e.prev=9,p=e.catch(4),c.e(p);case 10:return e.prev=10,c.f(),e.finish(10);case 11:return o=o.sort(function(e,t){var n,r;return new Date(null!==(n=e.content.timestamp)&&void 0!==n?n:0)<new Date(null!==(r=t.content.timestamp)&&void 0!==r?r:0)?-1:1}),e.next=12,_.Z.waitAll(o.map(function(){var e=a()(d().mark(function e(n){var r,a,s,i,o,c,u,l,p,_,E,g,T;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.filePath,a=n.content,s=n.payload,i=n.params,s["exp.request_guid"]=v.basename(r,".json"),s["event.subtype"]=f.Z.analytics.st_ACCESSOR,s["event.context_guid"]=a.session,e.next=1,h.updateParams([i]);case 1:return o=e.sent[0],e.next=2,h.addNewCollectionData({params:o,payload:s,priorityLevel:x.o7.BackgroundRequest,fetchType:"file-accessor"}).catch(function(e){});case 2:return(c=h._getCollectionInfo(o,a.user))?(a.path&&(u=v.basename(a.path,".json"),l=u.substr(-3),0!==((p=/^\-(\d\d)$/.exec(l))&&p[1]?parseInt(p[1],10):0)&&(u=u.slice(0,-3)),h._data.metadata[u]?c.lastDisplayedId?(E=h._data.metadata[c.lastDisplayedId]||{},new Date(null!==(_=E.lastUseTime)&&void 0!==_?_:"")<new Date(a.timestamp)&&(c.lastDisplayedId=u)):c.lastDisplayedId=u:t.context({payload:s,params:i}).error(new A.Z(f.Z.analytics.ACCESSOR_ERROR_TYPE,"Displayed id ".concat(u," not found in metadata}."),f.Z.analytics.ACCESSOR_WRITE_DISPLAY_ID_NOT_FOUND_CODE).removeStack())),g=h._data.metadata[c.lastDisplayedId||c.latestId||c.pendingId||c.partialId||""]||{},(!(T=g.lastUseTime)||new Date(T)<new Date(a.timestamp))&&(g.lastUseTime=new Date(a.timestamp).toISOString()),h.updateGSDKUseTime(i)):t.context({payload:s,params:o}).error(new A.Z(f.Z.analytics.ACCESSOR_ERROR_TYPE,"Cannot update last use time / displayed as collectionInfo not found.").removeStack()),e.next=3,S.remove(r);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).catch(function(e){});case 12:if(!(o.length>0)){e.next=13;break}return e.next=13,this.save();case 13:case"end":return e.stop()}},e,this,[[4,9,10,11]])})),function(){return Z.apply(this,arguments)})},{key:"sync",value:(M=a()(d().mark(function e(){var t,n,r,s,i,o,c,u,l=this,p=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=p.length>0&&void 0!==p[0]?p[0]:{}).force,s=void 0===r?{type:"none"}:r,i=n.init,o=void 0!==i&&i,e.next=1,this.parseFileAccessorWrites().catch(function(e){l.log.error(e)});case 1:if(c="pre-fetch",Q.Z.status!==Q.Z.OFFLINE){e.next=5;break}return e.next=2,k.Z.updateBackOff({cause:"Offline[Network-Sync]",type:k.E.NETWORK});case 2:return e.next=3,Q.Z.check(Q.S.LOOKUP_MAP_SYNC);case 3:return e.next=4,this._scheduleNextSyncJob("NetworkBackoff");case 4:throw new A.Z("Offline[Network-Sync]",new Error("Offline-Lookup-Sync"),f.Z.analytics.OFFLINE_ERROR);case 5:if(this._clearScheduledSyncJob(),"always"!==s.type){e.next=6;break}return c="force-always",e.next=6,this.expireAll(E.Z.getUserId());case 6:if(null===(t=this._data)||void 0===t||!t.metadata){e.next=7;break}return e.next=7,_.Z.waitAll(Object.keys(this._data.metadata).map(function(e){var t=l._data.metadata[e],n=Se({},s),r=c;return l.needsSync(e,{force:"none"!==n.type,checkExpiry:!l._isPendingCollection(e)})?(t&&t.expiryTime&&_.Z.isDateExpired(t.expiryTime)?r="expired":null!=t&&t.delay&&_.Z.isDateExpired(t.delay.expiryTime)&&(r="delayed",n.type="always",n.depth=t.delay.depth),l._fetchCollectionData({params:t.params,force:n,fetchType:o?"init-".concat(r):r})):Promise.resolve()})).then(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f.Z.get("REFRESH_ON_STALE",l.type)&&Object.keys(l._data.metadata).map(function(){var e=a()(d().mark(function e(t){var n,r,a,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=l._data.metadata[t],s=t,e.next=1,l.getLatestId({params:n.params});case 1:if(i=e.sent,!(a=s===i)){e.next=2;break}a=n.lastUseTime;case 2:if(!(r=a)){e.next=3;break}r=!_.Z.hasBeenUsedRecently(n.lastUseTime,f.Z.get("STALE_AFTER",l.type));case 3:if(!r){e.next=5;break}return l.log.disk("Stale content found. Resetting to default config."),e.next=4,l.resetSettings();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e)}))).then(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,l.syncOnDemandAssets();case 1:case"end":return e.stop()}},e)}))).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,l._scheduleNextSyncJob("Sync Error");case 1:throw t;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 7:return e.prev=7,e.next=8,this.gc();case 8:e.next=11;break;case 9:return e.prev=9,u=e.catch(7),e.next=10,this._scheduleNextSyncJob("Sync-GC-Error");case 10:throw u;case 11:return e.next=12,this._scheduleNextSyncJob("Sync");case 12:case"end":return e.stop()}},e,this,[[7,9]])})),function(){return M.apply(this,arguments)})},{key:"resetSettings",value:(U=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return U.apply(this,arguments)})},{key:"_gc",value:(w=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,_.Z.getLocks(this._syncLock.write.bind(this._syncLock),this._diskLock.write.bind(this._diskLock),a()(d().mark(function e(){var t,r,a,s,i,o,c,u,l,p,_,h;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.log.disk("GC starts."),t=n._getReferencedIdList(),r={},a={},Object.keys(t).forEach(function(e){var t,a,s=null!==(t=null===(a=n._data)||void 0===a||null===(a=a.metadata[e])||void 0===a?void 0:a.path)&&void 0!==t?t:"".concat(e,".json");r[s]=!0}),r[n._fileName]=!0,e.next=1,N.cleanupFolder(n._path,r,new RegExp(f.Z.get("IGNORED_FILES_REGEXP",n.type)||f.Z.get("IGNORED_FILES_REGEXP")));case 1:return s=e.sent,i=s.left,(o=s.removed).length>0&&n.log.disk("Removed from ".concat(n._path," - ").concat(o.join(" "))),e.next=2,n._getReferencedAssetList(t);case 2:return c=e.sent,e.next=3,n._getOnDemandAssetList();case 3:return u=e.sent,Object.assign(c,u),Object.keys(c).forEach(function(e){a[v.basename(e)]=!0}),l=n._path+f.Z.get("ASSETS_DIRNAME")+"/",e.next=4,N.cleanupFolder(l,a);case 4:p=e.sent,_=p.left,(h=p.removed).length>0&&n.log.disk("Removed from ".concat(l," - ").concat(h.join(", "))),n._cleanupCache(t,i),n._cleanupAssetsCache(c,_);case 5:case"end":return e.stop()}},e)})));case 1:return e.next=2,this.save();case 2:this.log.disk("GC ended successfully."),e.next=4;break;case 3:throw e.prev=3,t=e.catch(0),this.log.error(new A.Z(t,f.Z.analytics.GC_ERROR)),t;case 4:case"end":return e.stop()}},e,this,[[0,3]])})),function(){return w.apply(this,arguments)})},{key:"setForUser",value:(L=a()(d().mark(function e(t,n){var r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=(r=this._data.usersInfo)||{})[E.Z.getUserId()]=r[E.Z.getUserId()]||{},r[E.Z.getUserId()][t]=n,e.next=1,this.save();case 1:case"end":return e.stop()}},e,this)})),function(e,t){return L.apply(this,arguments)})},{key:"getForUser",value:function(e){var t=this._data.usersInfo&&this._data.usersInfo[E.Z.getUserId()];return t&&t[e]}},{key:"getLastTimeOfNotification",value:function(){var e=this.getForUser("lastTimeOfNotification");return e||(e=(new Date).getTime(),this.setForUser("lastTimeOfNotification",e)),Number(e)}},{key:"setLastTimeOfNotification",value:(P=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.setForUser("lastTimeOfNotification",t);case 1:case"end":return e.stop()}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"uninstall",value:(R=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.clearCollectionInfo(t);case 1:return e.next=2,this.clearOnDemandCollectionInfo(t);case 2:return e.next=3,this.gc();case 3:case"end":return e.stop()}},e,this)})),function(e){return R.apply(this,arguments)})},{key:"update",value:(I=a()(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.updateOnDemandCollectionInfo(t,n);case 1:case"end":return e.stop()}},e,this)})),function(e,t){return I.apply(this,arguments)})},{key:"clearCollectionInfo",value:(C=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,h,E,S,v,g,T,m,y,O=this,A=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=A.length>1&&void 0!==A[1]?A[1]:void 0,r=!(A.length>2&&void 0!==A[2])||A[2],this.validateParams(t),a=this._getLookupKeys(t),!r){e.next=10;break}return s={},e.next=1,se.Z.getInstalledApps();case 1:return i=e.sent,e.next=2,Object.keys(i||{}).forEach(function(e){var n=i[e];Object.keys(n).forEach(function(e){O.getProductAlias({productCode:n[e].SAPCode,productVersion:n[e].CodexVersion})===t.productCode&&_.Z.compareMajorMinorVersions(f.Z.get("SUPPORTED_PRODUCTS",O._type)[t.productCode],e,O.patchEnabledClient(t))>=0&&(s[e]=n[e])})});case 2:return e.next=3,this.updateParams(Object.values(s).map(function(e){var t,n=e;return null===(t=n.InstallLanguage)||void 0===t?void 0:t.split(",").map(function(e){return{productCode:O.getProductAlias({productCode:n.SAPCode,productVersion:n.CodexVersion}),productVersion:n.CodexVersion,productLanguage:e}})}).flat());case 3:o=e.sent,c=_e(o),e.prev=4,c.s();case 5:if((u=c.n()).done){e.next=7;break}if(l=u.value,JSON.stringify(this._getLookupKeys(l))!==JSON.stringify(a)){e.next=6;break}return this.log.context({params:t}).disk("Not uninstalling regular ".concat(t.productCode,"[").concat(t.productVersion,"] because a competing key software still exists.")),e.abrupt("return");case 6:e.next=5;break;case 7:e.next=9;break;case 8:e.prev=8,y=e.catch(4),c.e(y);case 9:return e.prev=9,c.f(),e.finish(9);case 10:if(p=this._data.versionInfo,h=!1,E=[["root",p]],a.forEach(function(e){p&&p[e]?(p=p[e],E.push([e,p])):h=!0}),!h&&0!==E.length){e.next=11;break}return e.abrupt("return");case 11:for(S=E.pop(),v=S[0],g=S[1],T=[],Object.keys(g).forEach(function(e){n?g[e]===n&&(delete g[e],T.push(n)):(T.push(g[e]),delete g[e])}),T.forEach(function(e){return delete O._data.metadata[e]});E.length>0&&0===Object.keys(g).length;)m=v,S=E.pop(),v=S[0],delete(g=S[1])[m];return e.next=12,this.save();case 12:case"end":return e.stop()}},e,this,[[4,8,9,10]])})),function(e){return C.apply(this,arguments)})},{key:"downloadManager",get:function(){return this._downloadManager}},{key:"type",get:function(){return this._type}},{key:"getCachedRequestData",value:function(){var e=this,t={};return _.Z.waitAll(Object.keys(this._data.metadata).map(function(){var n=a()(d().mark(function n(r){var a,s,i,o;return d().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if((a=e._data.metadata[r]).userId!==E.Z.getUserId()){n.next=2;break}return s=a.params,n.next=1,e.getLatestId({params:s});case 1:i=n.sent,s&&s.productCode&&s.productVersion&&(t[s.productCode]||(t[s.productCode]={}),o=function(e){t[e.productCode][e.productVersion]||(t[e.productCode][e.productVersion]=[]),t[e.productCode][e.productVersion].push(e)},i===r&&o(a.params));case 2:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())),t}},{key:"updateParams",value:(O=a()(d().mark(function e(t){var n,r,a,s,i=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(JSON.stringify(t)),e.next=1,F.Z.getOSLocale();case 1:return a=e.sent,s=(null===(n=E.Z.getUserInfo())||void 0===n?void 0:n.countryCode)||(null==a?void 0:a.split("_")[1]),r.forEach(function(e){if((e=i.sanitizeParams(e)).productLanguage=e.productLanguage||"en_US",e.countryCode=e.countryCode||s,e.platform=e.platform||_.Z.getOsPlatform(),e.osVersion=e.osVersion||_.Z.getOsVersion(),e.productSemver=e.productSemver||e.productVersion,e.productVersion=e.productVersion||e.productSemver,e.productCode){var t=i.getProductAlias(e);e.sapCode=e.sapCode||t,e.productCode=t}}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e)})),function(e){return O.apply(this,arguments)})},{key:"getClientVersion",value:function(e){return _.Z.getClientContentVersion(e,this.type,_.Z.isPatchEnabled(e,this.type))}},{key:"targetDetails",value:function(e){return e}},{key:"diskLock",get:function(){return this._diskLock}},{key:"clientDir",get:function(){var e=v.join(f.Z.get("ROOT_DIR"),f.Z.get("DIR",this.type));return e=v.join(e,f.Z.get("FILE_ACCESSOR_WRITE_FOLDER"))}},{key:"assetsDir",get:function(){return v.join(f.Z.get("ROOT_DIR"),f.Z.get("DIR",this.type),f.Z.get("ASSETS_DIRNAME"))+"/"}},{key:"_getOnDemandLookupKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._getLookupKeys(e,t)}},{key:"getOnDemandCollection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var n=this._getOnDemandLookupKeys(e,t),r=this._data.onDemand;return n.forEach(function(e){r&&(r=r[e])}),r}var a=new A.Z(b.Z.DATA_VALIDATION_ERR,"No data to get collection for in LookupMap.");this.log.error(a)}},{key:"getOnDemandCollectionInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getOnDemandCollection(e,t);if(n)return n[this.paramsToOnDemandId(e)]}},{key:"paramsToOnDemandId",value:function(e){return(null==e?void 0:e.url)||(null==e?void 0:e.id)}},{key:"addOnDemandCollectionInfo",value:(y=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,f,_,h,S,v;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=t.state,a=t.updateLastUseTime,s=void 0!==a&&a,i=t.expiry,o=t.retry,c=t.cause,!(u=this.paramsToOnDemandId(n))){e.next=1;break}p=this._getOnDemandLookupKeys(n),f=this._data.onDemand,_=_e(p);try{for(_.s();!(h=_.n()).done;)v=h.value,f[v]=null!==(S=f[v])&&void 0!==S?S:{},f=f[v]}catch(e){_.e(e)}finally{_.f()}return f[u]=r,this._data.onDemandMetadata[u]={userId:E.Z.getUserId(),params:n,lastUseTime:s?(new Date).toISOString():null===(l=this._data)||void 0===l||null===(l=l.onDemandMetadata)||void 0===l||null===(l=l[u])||void 0===l?void 0:l.lastUseTime,expiryTime:null==i?void 0:i.toISOString(),retry:o,cause:c},e.next=1,this.save();case 1:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"_getOnDemandAssetList",value:(m=a()(d().mark(function e(){var t,n,r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},Object.values((null===(t=this._data)||void 0===t?void 0:t.onDemandMetadata)||{}).forEach(function(e){var t,a=r.paramsToOnDemandId(e.params),s=null===(t=r._data.assetMetadata[a])||void 0===t?void 0:t.path;s&&(n[s]=!0)}),e.abrupt("return",n);case 1:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"_fetchOnDemandContent",value:(g=a()(d().mark(function e(t){var n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=t.force,a=t.priority,s=this.paramsToOnDemandId(n)){e.next=1;break}throw new Error(b.Z.DATA_VALIDATION_ERR);case 1:return e.next=2,this.fetchAsset({href:s,assetsDir:this.assetsDir,force:r,priority:a,params:n,options:{timeout:f.Z.get("ON_DEMAND_ASSET_TIMEOUT")}});case 2:return e.abrupt("return",e.sent.path);case 3:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"updateOnDemandCollectionInfo",value:(p=a()(d().mark(function e(t,n){var r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateParams(n),this.validateParams(t),Object.keys(this._data.onDemand).forEach(function(e){var a=r.getOnDemandCollection(t,e);if(a){var s,i=r._getOnDemandLookupKeys(n),o=r._data.onDemand,c=_e(i);try{for(c.s();!(s=c.n()).done;){var u,l=s.value;o[l]=null!==(u=o[l])&&void 0!==u?u:{},o=o[l]}}catch(e){c.e(e)}finally{c.f()}Object.keys(a).forEach(function(e){r._data.onDemandMetadata[e]&&(r._data.onDemandMetadata[e].params=Object.assign(r._data.onDemandMetadata[e].params,n)),o[e]=a[e]})}}),e.next=1,this.save();case 1:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"clearOnDemandCollectionInfo",value:(u=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,h,E,S,v,g,T,m,y,O=this,A=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=A.length>1&&void 0!==A[1]?A[1]:void 0,r=!(A.length>2&&void 0!==A[2])||A[2],this.validateParams(t),a=this._getOnDemandLookupKeys(t),!r){e.next=10;break}return s={},e.next=1,se.Z.getInstalledApps();case 1:if(!(i=e.sent)){e.next=2;break}return e.next=2,Object.keys(i).forEach(function(e){var n=i[e];Object.keys(n).forEach(function(e){O.getProductAlias({productCode:n[e].SAPCode,productVersion:n[e].CodexVersion})===t.productCode&&_.Z.compareMajorMinorVersions(f.Z.get("SUPPORTED_PRODUCTS",O._type)[t.productCode],e,O.patchEnabledClient(t))>=0&&(s[e]=n[e])})});case 2:return e.next=3,this.updateParams(Object.values(s).map(function(e){var t,n=e;return null===(t=n.InstallLanguage)||void 0===t?void 0:t.split(",").map(function(e){return{productCode:O.getProductAlias({productCode:n.SAPCode,productVersion:n.CodexVersion}),productVersion:n.CodexVersion,productLanguage:e}})}).flat());case 3:o=e.sent,c=_e(o),e.prev=4,c.s();case 5:if((u=c.n()).done){e.next=7;break}if(l=u.value,JSON.stringify(this._getOnDemandLookupKeys(l))!==JSON.stringify(a)){e.next=6;break}return this.log.context({params:t}).disk("Not uninstalling on demand ".concat(t.productCode,"[").concat(t.productVersion,"] because a competing key software still exists.")),e.abrupt("return");case 6:e.next=5;break;case 7:e.next=9;break;case 8:e.prev=8,y=e.catch(4),c.e(y);case 9:return e.prev=9,c.f(),e.finish(9);case 10:if(p=this._data.onDemand,h=!1,E=[["root",p]],a.forEach(function(e){p&&p[e]?(p=p[e],E.push([e,p])):h=!0}),!h&&0!==E.length){e.next=11;break}return e.abrupt("return");case 11:for(S=E.pop(),v=S[0],g=S[1],T=[],Object.keys(g).forEach(function(e){n?g[e]===n&&(delete g[e],T.push(n)):(T.push(e),delete g[e])});E.length>0&&0===Object.keys(g).length;)m=v,S=E.pop(),v=S[0],delete(g=S[1])[m];return T.forEach(function(e){O.getOnDemandCollectionInfo(O._data.onDemandMetadata[e].params)||delete O._data.onDemandMetadata[e]}),e.next=12,this.save();case 12:case"end":return e.stop()}},e,this,[[4,8,9,10]])})),function(e){return u.apply(this,arguments)})},{key:"syncOnDemandAssets",value:(o=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,_.Z.waitAll(Object.values((null===(t=this._data)||void 0===t?void 0:t.onDemandMetadata)||{}).map(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!1===f.Z.get("STOP_REQUEST_TRAFFIC",n.type)||t.lastUseTime&&_.Z.hasBeenUsedRecently(t.lastUseTime))||"paused"===n.getOnDemandCollectionInfo(t.params)){e.next=1;break}return e.next=1,n.getOnDemandData({params:t.params,force:{type:"stale",depth:999}});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"isOnDemandSyncInProgress",value:function(e){var t=this.fetchOnDemandContent.cache&&this.fetchOnDemandContent.cache.get(e);return t&&"pending"===t.state}},{key:"getOnDemandAssetPath",value:function(e){var t;return e.url?null===(t=this._data)||void 0===t||null===(t=t.assetMetadata)||void 0===t||null===(t=t[e.url])||void 0===t?void 0:t.path:void 0}},{key:"getOnDemandData",value:(s=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,f,h,E,S,v,g,T,m,y,O=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.params,s=void 0===r?{}:r,i=t.force,o=void 0===i?{type:"none"}:i,c=t.updateLastUseTime,u=void 0!==c&&c,l=t.priorityLevel,p=void 0===l?x.o7.Regular:l,f=this.paramsToOnDemandId(s)){e.next=1;break}throw h=new A.Z(b.Z.DATA_VALIDATION_ERR,"Cannot generate key from parameters."),this.log.error(h),h;case 1:if(this.abortControllers[f]=this.abortControllers[f]||new(ne()),E=this.priority({params:s,key:f,level:p}),this._downloadManager.prioritize(E),this.getOnDemandCollectionInfo(s)){e.next=2;break}return e.next=2,this.addOnDemandCollectionInfo(Se({params:s,state:"notReady",updateLastUseTime:u},this._calculateBackOffMetadata({updateBackOff:!1,metadata:null===(S=this._data)||void 0===S?void 0:S.onDemandMetadata[f]})));case 2:if(v=s&&s.url&&this._data.assetMetadata[null===(n=s)||void 0===n?void 0:n.url],g=o&&"always"===o.type||"ready"!=this.getOnDemandCollectionInfo(s)||v&&_.Z.getTimeToExpiry(v.expiry)<=0,!(T=g?void 0:this.getOnDemandAssetPath(s))){e.next=3;break}e.next=7;break;case 3:if(this.isOnDemandSyncInProgress(f)){e.next=5;break}return m={assets:{}},y=function(e){Object.assign(m.assets,e),O.emit(f,m)},this.on("Asset-".concat(f),y),e.next=4,this._syncLock.read(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,O.log.context({payload:{"ccxp.mode":"on-demand","event.subtype":"api","ccxp.request_type":"get","event.url":s.url,"content.id":s.id}}).request(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,O.updateParams([s]);case 1:return s=e.sent[0],e.next=2,O._fetchOnDemandContent({params:s,force:o,priority:E}).catch(function(){var e=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof re.AbortError){e.next=2;break}return e.next=1,O.addOnDemandCollectionInfo(Se({params:s,state:"notReady"},O._calculateBackOffMetadata({metadata:null===(n=O._data)||void 0===n?void 0:n.onDemandMetadata[f],error:t})));case 1:O.log.error(new A.Z("Error getting on demand data",t)),O._scheduleNextSyncJob("onDemand-Error");case 2:throw t;case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})));case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),E);case 4:T=e.sent,this.off("Asset-".concat(f),y),e.next=7;break;case 5:return e.next=6,this._fetchOnDemandContent({params:s,force:o,priority:E});case 6:T=e.sent;case 7:return e.next=8,this.addOnDemandCollectionInfo({params:s,state:"ready",updateLastUseTime:u});case 8:return delete this.abortControllers[f],e.abrupt("return",T);case 9:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"onDemandAbort",value:(r=a()(d().mark(function e(){var t,n,r,a,s=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>0&&void 0!==s[0]?s[0]:{},r=this.paramsToOnDemandId(n)){e.next=1;break}throw a=new Error(b.Z.DATA_VALIDATION_ERR),this.log.error(new A.Z("Cannot generate key from parameters.",a)),a;case 1:if(null===(t=this.abortControllers[r])||void 0===t||t.abort(),!this.isOnDemandSyncInProgress(r)){e.next=2;break}return e.next=2,this.getOnDemandData({params:n});case 2:"notReady"===this.getOnDemandCollectionInfo(n)&&this.addOnDemandCollectionInfo({params:n,state:"paused",updateLastUseTime:!1}),delete this.abortControllers[r];case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})}]);var r,s,o,u,p,g,m,y,O,C,I,R,P,L,w,U,M,Z,G,V,K,j,W,Y,q,ee,te,ae,ie,oe,ce,ue,le,he,Ee,ge,Te,me,ye,Oe,Ae,Ce,Ie,Re,Ne}(ee);function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ye=function(){return c()(function e(t,n){i()(this,e),l()(this,"_id",void 0),l()(this,"_lookupMap",void 0),l()(this,"_diskLock",void 0),l()(this,"log",void 0),l()(this,"_fileName",void 0),l()(this,"_data",void 0),this._id=t,this._lookupMap=n,this._diskLock=n.diskLock,this.log=new h.Z({prefix:"".concat(f.Z.get("LOG_PREFIX",n.type),"Data > "),payload:{"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",n.type)}}),this._fileName="".concat(this._id,".json")},[{key:"setData",value:(u=a()(d().mark(function e(t){var n,r,a,s=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:"",t){e.next=1;break}return e.abrupt("return",new A.Z(b.Z.MISSING_DATA,"No data to set for ".concat(this._lookupMap.type)));case 1:return(r=this.validateData(t,n))?this.log.error(b.Z.DATA_VALIDATION_ERR,new A.Z("[Collection]: Invalid data: ".concat(JSON.stringify(null===(a=r[0])||void 0===a?void 0:a.message)))):this._data=t,e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"fileName",get:function(){return this._fileName}},{key:"assetsDir",get:function(){return v.join(f.Z.get("ROOT_DIR"),f.Z.get("DIR",this._lookupMap.type),f.Z.get("ASSETS_DIRNAME"))+"/"}},{key:"hasValidCards",value:function(e){return!0}},{key:"id",get:function(){return this._id}},{key:"expiryTime",get:function(){return this._data&&this._data.expirationDTS}},{key:"upgrade",value:(o=a()(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}},e)})),function(e,t){return o.apply(this,arguments)})},{key:"load",value:(s=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.version,r=t.skipSaving,a=t.file,this._fileName=null!=a?a:this._fileName,e.next=1,S.readJson(this._lookupMap.getPath()+this._fileName);case 1:if(s=e.sent,i=!1,s){e.next=2;break}throw new A.Z(b.Z.DATA_VALIDATION_ERR,"Failure to load collection JSON");case 2:if(o=s._ccx&&s._ccx.version||s.version,c=f.Z.get("LOOKUP_COLLECTION_FILE_VERSION",this._lookupMap.type),!s||o===c){e.next=5;break}return this.log.disk("Collection File mismatch. File ".concat(this._fileName," with version:").concat(o," vs version from lookup:").concat(c)),e.next=3,this.upgrade(s,n).catch(function(e){return null});case 3:if(s=e.sent){e.next=4;break}throw new A.Z(b.Z.INVALID_COLLECTION,"Required Collection Lookup file upgrade not available for ".concat(this._lookupMap.type," - ").concat(o,":").concat(c),b.Z.INVALID_COLLECTION);case 4:i=!0;case 5:return e.next=6,this.setData(s,n);case 6:if(!(u=e.sent)){e.next=7;break}throw u;case 7:if(u||!i||r){e.next=8;break}return e.next=8,this.save();case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"save",value:(r=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._data){e.next=1;break}throw new Error("No data to save");case 1:return e.next=2,this._diskLock.write(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,N.writeJsonAtomic(n._lookupMap.getPath(),n._fileName,n._data,!0);case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})));case 2:t=e.sent,this._fileName=v.basename(t);case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"logFailures",value:(n=a()(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)})},{key:"sync",value:(t=a()(d().mark(function e(){var t,n=this,r=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},this._data){e.next=1;break}throw new A.Z(f.Z.analytics.MISSING_DATA,"No data to sync");case 1:return this.logFailures(t.params||{},t.gsdkLogger),e.next=2,this.syncData(me(me({},t),{},{progress:function(){var e=a()(d().mark(function e(r){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,n.save();case 1:t.progress&&t.progress(r);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()})).finally(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,n.save();case 1:case"end":return e.stop()}},e)})));case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"isDefaultData",get:function(){var e;return!(null===(e=this._data)||void 0===e||null===(e=e._ccx)||void 0===e||!e.isDefault)}},{key:"data",get:function(){return this._data}},{key:"restoreSettingsFromDisk",value:(e=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"validateData",value:function(e,t){return null}}]);var e,t,n,r,s,o,u}();function Oe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ae(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ae(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Re=function(){return c()(function e(t,n){i()(this,e),l()(this,"lock",void 0),l()(this,"templateLock",void 0),l()(this,"log",void 0),l()(this,"assetsDir",void 0),l()(this,"processedInfo",void 0),this.log=new h.Z({prefix:"".concat(f.Z.get("LOG_PREFIX",t),"DataManager"),payload:{"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",t)}}),this.assetsDir=v.join(f.Z.get("ROOT_DIR"),f.Z.get("DIR",t),f.Z.get("ASSETS_DIRNAME"))+"/",this.lock=n,this.templateLock=new x.ZP(2),this.processedInfo={details:new Array,templateDownloadSummary:new Array,playlistDownloadSumary:new Array,tutorialDownloadSumary:new Array}},[{key:"downloadAemCollectionTemplateData",value:(O=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h,E,S,g,T,m,y,O,C,I,R=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.card,r=t.lookupMap,s=t.priority,t.bundle,i=t.params,o=t.started,c=t.force,u=0,l=0,p={},h="",E="","URL"!==n.dataType||!n.data){e.next=3;break}return E="data",e.next=1,r.fetchAsset({href:n.data,assetsDir:this.assetsDir,priority:s,params:i,force:Ie(Ie({},c),{},{depth:(c.depth||0)-1})});case 1:return S=e.sent,u++,l+=S.time,h=v.basename(S.path),e.next=2,N.readJson("".concat(this.assetsDir,"/").concat(h),this.log).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw r.clearAssetMetadata(n.data),delete n.path,delete n.content,t;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:p=e.sent,n.path=S.path,e.next=6;break;case 3:if("application/json"!==n.dataType||!n.data){e.next=5;break}return p=JSON.parse(n.data),h=r.generateId(i)+".json",C=v,e.next=4,N.writeJsonAtomic(this.assetsDir,h,p,!0);case 4:I=e.sent,h=C.basename.call(C,I),n.path=f.Z.get("ASSETS_DIRNAME")+"/"+h,e.next=6;break;case 5:return e.abrupt("return",{totalTime:l,count:u});case 6:if(o(),!p.data){e.next=10;break}g=new A.Z(f.Z.analytics.AGGREGATE_ERROR,"AEM"+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),T=0,m=Object.values(p.data);case 7:if(!(T<m.length)){e.next=9;break}if(O=m[T],!Array.isArray(null===(y=O.item)||void 0===y?void 0:y.templateCollections)){e.next=8;break}return e.next=8,_.Z.waitAll(O.item.templateCollections.map(function(){var e=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.collectionId){e.next=2;break}return e.next=1,Z.downloadStockCollection({id:t.collectionId,options:t.options,priority:s,params:i,force:Ie(Ie({},c),{},{depth:(c.depth||0)-2}),map:r}).catch(function(e){return g.addSubError({err:e,url:t._publishUrl,id:t._path}),{path:void 0,time:0}});case 1:n=e.sent,t.path=n.path,n.time&&(l+=n.time),u++;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).finally(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,R.lock.write(a()(d().mark(function e(){var t,a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.basename(R.assetsDir)+"/",s=v,e.next=1,N.writeJsonAtomic(R.assetsDir,h,p,!0);case 1:if(i=e.sent,o=s.basename.call(s,i),n.path=a+o,!(E.length>0)){e.next=2;break}if((null===(t=r.cachedAsset(n.data))||void 0===t?void 0:t.path)===n.path||!r.cachedAsset(n.data)){e.next=2;break}return r.cachedAsset(n.data).path=n.path,e.next=2,r.save();case 2:case"end":return e.stop()}},e)})));case 1:case"end":return e.stop()}},e)})));case 8:T++,e.next=7;break;case 9:if(!g.hasSubErrors){e.next=10;break}throw g;case 10:return e.abrupt("return",{totalTime:l,count:u});case 11:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"downloadAEMData",value:(y=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h,E,g,T,m,y,O,C,I,R,k,P=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.card,r=t.lookupMap,s=t.priority,i=t.bundle,o=t.params,c=t.started,u=t.force,l=0,p=0,h={},E="",g="",T={path:"",time:0},_.Z.isDebugModeEnabled()&&(this.log.disk("Downloading content for container -- ".concat(JSON.stringify(n))),this.log.disk("Is this container GSDK content -- ".concat(!!n.gsdkEnabledContent)),m=S.existsSync(this.assetsDir),this.log.disk("Is the asset dir on disk - ".concat(this.assetsDir," -- ").concat(m))),"URL"!==n.dataType||!n.data){e.next=3;break}return g="data",e.next=1,r.fetchAsset({href:n[g],assetsDir:this.assetsDir,priority:s,params:o,force:Ie(Ie({},u),{},{depth:(u.depth||0)-1})});case 1:return T=e.sent,l++,p+=T.time,E=v.basename(T.path),e.next=2,N.readJson("".concat(this.assetsDir,"/").concat(E),this.log).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw r.clearAssetMetadata(n.data),delete n.path,delete n.content,new A.Z(f.Z.analytics.INVALID_JSON,t,f.Z.analytics.READ_ASSET_FAILURE).removeStack().skipErrorScrub();case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:h=e.sent,n.path=T.path,i&&(n.content=h),e.next=6;break;case 3:if("application/json"!==n.dataType||!n.data){e.next=5;break}return h=JSON.parse(n.data),i&&(n.content=h),E=r.generateId(o)+".json",R=v,e.next=4,N.writeJsonAtomic(this.assetsDir,E,h,!0);case 4:k=e.sent,E=R.basename.call(R,k),n.path=f.Z.get("ASSETS_DIRNAME")+"/"+E,e.next=6;break;case 5:return e.abrupt("return",{totalTime:p,count:l});case 6:if(c(),!h.data){e.next=10;break}y=new A.Z(f.Z.analytics.AGGREGATE_ERROR,"AEM"+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),O=0,C=Object.values(h.data);case 7:if(!(O<C.length)){e.next=9;break}if(I=C[O],!Array.isArray(I._references)){e.next=8;break}return e.next=8,_.Z.waitAll(I._references.map(function(){var e=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._publishUrl){e.next=2;break}return e.next=1,r.fetchAsset({href:t._publishUrl,assetsDir:P.assetsDir,priority:s,params:o,force:Ie(Ie({},u),{},{depth:(u.depth||0)-2})}).catch(function(e){return y.addSubError({err:e,url:t._publishUrl,id:t._path}),{path:void 0,time:0}});case 1:n=e.sent,t.path=n.path,n.time&&(p+=n.time),l++;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).finally(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,P.lock.write(a()(d().mark(function e(){var t,a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.basename(P.assetsDir)+"/",s=v,e.next=1,N.writeJsonAtomic(P.assetsDir,E,h,!0);case 1:if(i=e.sent,o=s.basename.call(s,i),n.path=a+o,!(g.length>0)){e.next=2;break}if((null===(t=r.cachedAsset(n.data))||void 0===t?void 0:t.path)===n.path||!r.cachedAsset(n.data)){e.next=2;break}return r.cachedAsset(n.data).path=n.path,e.next=2,r.save();case 2:case"end":return e.stop()}},e)})));case 1:case"end":return e.stop()}},e)})));case 8:O++,e.next=7;break;case 9:if(!y.hasSubErrors){e.next=10;break}throw y;case 10:return e.abrupt("return",{totalTime:p,count:l});case 11:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"passThroughContent",value:(m=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,_,h=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.card,r=t.lookupMap,t.priority,t.bundle,s=t.params,i=t.started,t.force,o=0,c=0,u="",l={path:"",time:0},i(),p=new A.Z(f.Z.analytics.AGGREGATE_ERROR,"PASS"+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),e.prev=1,e.next=2,r.fetchGSDKAsset({params:s,asset:n.gsdkContent.rootAssetMetadata[0],assetId:n.gsdkContent.rootAssetMetadata[0].id,href:n.gsdkContent.rootAssetMetadata[0].url,ext:"txt",assetsDir:this.assetsDir});case 2:return l=e.sent,u=v.basename(l.path),n.path=l.path,o++,e.next=3,this.lock.write(a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.path=v.basename(h.assetsDir)+"/"+v.basename(u),(null===(t=r.cachedAsset(n.data))||void 0===t?void 0:t.path)===n.path||!r.cachedAsset(n.data)){e.next=1;break}return r.cachedAsset(n.data).path=n.path,e.next=1,r.save();case 1:case"end":return e.stop()}},e)})));case 3:e.next=5;break;case 4:e.prev=4,_=e.catch(1),p.addSubError({err:_,url:n.data});case 5:if(!p.hasSubErrors){e.next=6;break}throw p;case 6:return e.abrupt("return",{totalTime:c,count:o});case 7:case"end":return e.stop()}},e,this,[[1,4]])})),function(e){return m.apply(this,arguments)})},{key:"downloadIndexFileData",value:(T=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h,E,g,T,m,y,O,C,I,R,k,P=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.card,i=t.lookupMap,o=t.priority,c=t.bundle,u=t.params,l=t.started,p=t.force,h=0,E=0,g={},T="",m="",y={path:"",time:0},_.Z.isDebugModeEnabled()&&(this.log.disk("Downloading content for container -- ".concat(JSON.stringify(s))),this.log.disk("Is this container GSDK content -- ".concat(!!s.gsdkEnabledContent)),O=S.existsSync(this.assetsDir),this.log.disk("Is the asset dir on disk - ".concat(this.assetsDir," -- ").concat(O))),"URL"!==s.dataType||!s.data){e.next=3;break}return m="data",e.next=1,i.fetchAsset({href:s[m],assetsDir:this.assetsDir,priority:o,params:u,force:Ie(Ie({},p),{},{depth:(p.depth||0)-1})});case 1:return y=e.sent,h++,E+=y.time,T=v.basename(y.path),e.next=2,N.readJson("".concat(this.assetsDir,"/").concat(T),this.log).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw i.clearAssetMetadata(s.data),delete s.path,delete s.content,new A.Z(f.Z.analytics.INVALID_JSON,t,f.Z.analytics.READ_ASSET_FAILURE).removeStack().skipErrorScrub();case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:g=e.sent,s.path=y.path,c&&(s.content=g),e.next=6;break;case 3:if("application/json"!==s.dataType||!s.data){e.next=5;break}return g=JSON.parse(s.data),c&&(s.content=g),T=i.generateId(u)+".json",R=v,e.next=4,N.writeJsonAtomic(this.assetsDir,T,g,!0);case 4:k=e.sent,T=R.basename.call(R,k),s.path=f.Z.get("ASSETS_DIRNAME")+"/"+T,e.next=6;break;case 5:case 10:return e.abrupt("return",{totalTime:E,count:h});case 6:if(l(),C=new A.Z(f.Z.analytics.AGGREGATE_ERROR,"DP Index"+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),null===(n=g)||void 0===n||!n.paths){e.next=8;break}return g._assetPaths={},I=Object.keys(g.paths),e.next=7,_.Z.waitAll(I.map(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,i.fetchAsset({href:g.paths[t],assetsDir:P.assetsDir,priority:o,params:u,force:Ie(Ie({},p),{},{depth:(p.depth||0)-2})}).catch(function(e){return C.addSubError({err:e,url:g.paths[t]}),{path:void 0,time:0,count:0}});case 1:y=e.sent,g._assetPaths[t]=y.path,y.time&&(E+=y.time),h++;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).finally(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,P.lock.write(a()(d().mark(function e(){var t,n,r,a,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.basename(P.assetsDir)+"/",r=v,e.next=1,N.writeJsonAtomic(P.assetsDir,T,g,!0);case 1:if(a=e.sent,o=r.basename.call(r,a),s.path=n+o,!(m.length>0)){e.next=2;break}if((null===(t=i.cachedAsset(s.data))||void 0===t?void 0:t.path)===s.path||!i.cachedAsset(s.data)){e.next=2;break}return i.cachedAsset(s.data).path=s.path,e.next=2,i.save();case 2:case"end":return e.stop()}},e)})));case 1:case"end":return e.stop()}},e)})));case 7:e.next=9;break;case 8:if(null===(r=g)||void 0===r||!r.toolTechniques){e.next=9;break}return g._toolTechniquesPaths={},e.next=9,_.Z.waitAll(g.toolTechniques.map(function(){var e=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Z.downloadTutorial({params:u,id:t,priority:o,force:p,analyticsData:{},filePrefix:"DP",status:u.status||"live",ututMetaLocale:u.productLanguage,map:i}).catch(function(e){return C.addSubError({err:e,id:t}),{path:void 0,time:0,count:0}});case 1:(n=e.sent).path&&(g._toolTechniquesPaths[t]=n.path),n.time&&(E+=n.time),n.count&&(h+=n.count);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).finally(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,P.lock.write(a()(d().mark(function e(){var t,n,r,a,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.basename(P.assetsDir)+"/",r=v,e.next=1,N.writeJsonAtomic(P.assetsDir,T,g,!0);case 1:if(a=e.sent,o=r.basename.call(r,a),s.path=n+o,!(m.length>0)){e.next=2;break}if((null===(t=i.cachedAsset(s.data))||void 0===t?void 0:t.path)===s.path||!i.cachedAsset(s.data)){e.next=2;break}return i.cachedAsset(s.data).path=s.path,e.next=2,i.save();case 2:case"end":return e.stop()}},e)})));case 1:case"end":return e.stop()}},e)})));case 9:if(!C.hasSubErrors){e.next=10;break}throw C;case 11:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"downloadLearnPESData",value:(g=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h,E,S,g,T,m,y,O,C,I,R,k,P=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.modeID,r=t.card,s=t.lookupMap,i=t.priority,o=t.bundle,c=t.shouldPrefetchTemplates,u=void 0!==c&&c,l=t.params,p=t.started,h=t.force,E=0,S=0,g=[],T="",m="",y={href:"",assetsDir:this.assetsDir,priority:i,params:l,force:Ie(Ie({},h),{},{depth:(h.depth||0)-1})},"URL"!==r.dataType||!r.data){e.next=3;break}return m="data",e.next=1,s.fetchAsset({href:r.data,assetsDir:this.assetsDir,priority:i,params:Ie(Ie({},l),{},{filePrefix:"PLAYCOLLECTION"}),headers:{"x-api-key":f.Z.getEnvironment().CLIENT_ID},force:Ie(Ie({},h),{},{depth:(h.depth||0)-1})});case 1:return O=e.sent,E++,S+=O.time,T=v.basename(O.path),e.next=2,N.readJson("".concat(this.assetsDir,"/").concat(T),this.log).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw s.clearAssetMetadata(r.data),delete r.path,delete r.content,t;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:g=e.sent,r.path=O.path,o&&(r.content=g),e.next=7;break;case 3:if("application/json"!==r.dataType||!r.data){e.next=5;break}return g=JSON.parse(r.data),o&&(r.content=g),T=s.generateId(l)+".json",R=v,e.next=4,N.writeJsonAtomic(this.assetsDir,T,g,!0);case 4:k=e.sent,T=R.basename.call(R,k),r.path=f.Z.get("ASSETS_DIRNAME")+"/"+T,e.next=7;break;case 5:if(r.data){e.next=6;break}throw new A.Z(f.Z.analytics.DATA_VALIDATION_ERR,"Empty data field - ".concat(JSON.stringify(r.data)),f.Z.analytics.INVALID_COLLECTION);case 6:case 10:return e.abrupt("return",{totalTime:S,count:E});case 7:if(p(),!g){e.next=10;break}if(C=new A.Z(f.Z.analytics.AGGREGATE_ERROR,"PES"+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),I=[],Array.isArray(g)){e.next=8;break}C.addSubError({err:new A.Z(f.Z.analytics.DATA_VALIDATION_ERR,"Unexpected content type - ".concat(JSON.stringify(g)),f.Z.analytics.INVALID_COLLECTION).removeStack(),url:r.data}),"URL"===r.dataType&&(s.clearAssetMetadata(r.data),delete r.path,delete r.content),e.next=9;break;case 8:return e.next=9,_.Z.waitAll(g.map(function(){var e=a()(d().mark(function e(t){var r,a,o,c,p;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.playlist_metadata){e.next=7;break}r=Oe(t.playlist_metadata),e.prev=1,o=d().mark(function e(){var r,o,c,p,f,_,g,T,O,A,R,N;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.value,e.next=1,Z.downloadImagesHelper(y,s,r,C);case 1:if(o=e.sent,E+=o.count,S+=o.totalTime,P.markProcessedInfo({lookupMap:s,surface:n,description:"downloaded hero and thumb for playlist in playlist_metadata",playlistCollectionID:t.aem_id,playlistID:r.aem_id}),!r.aem_id){e.next=20;break}return e.next=2,Z.downloadSinglePlaylist({lookupMap:s,force:h,bundle:!1,aem_id:r.aem_id,locale:r.locale,status:r.status,error:C,params:l,priority:i});case 2:if(c=e.sent,P.markProcessedInfo({lookupMap:s,surface:n,description:"downloaded and saved playlist",playlistCollectionID:t.aem_id,playlistID:r.aem_id,fileName:v.basename(c.playlistPath)}),!c.playlistPath){e.next=20;break}r.playlistPath=c.playlistPath,S+=c.totalTime,E+=c.count,p=Oe(c.learnPlaylists),e.prev=3,p.s();case 4:if((f=p.n()).done){e.next=16;break}if(!(_=f.value).images){e.next=6;break}return e.next=5,Z.downloadImagesHelper(y,s,_,C);case 5:g=e.sent,E+=g.count,S+=g.totalTime,P.markProcessedInfo({lookupMap:s,surface:n,description:"downloaded hero and thumb in playlist images array",playlistCollectionID:t.aem_id,playlistID:_.aem_id});case 6:T=Oe(_.utut_metadata||[]),e.prev=7,A=d().mark(function e(){var a,o,c,p,f,_;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=O.value,e.next=1,Z.downloadImagesHelper(y,s,a,C);case 1:if(o=e.sent,P.markProcessedInfo({lookupMap:s,surface:n,description:"downloaded hero and thumb for utut_metadata in playlist",playlistCollectionID:t.aem_id,playlistID:r.aem_id,tutorialID:a.aem_id}),E+=o.count,S+=o.totalTime,!u){e.next=2;break}return p=a.aem_id,f=null!=a&&null!==(c=a.platforms)&&void 0!==c&&c.includes("in-app")?"in_app_panel":"help_json",_=u&&"in_app_panel"===f,e.next=2,Z.downloadTutorial({params:l,id:a.aem_id,priority:i,inline_surface:f,force:h,analyticsData:{},filePrefix:"TUTORIAL",status:a.status||"live",ututMetaLocale:a.locale,map:s,shouldPrefetchTemplates:_,downloadableTemplates:I}).then(function(e){a.tutorialPath=e.path,E++,P.markProcessedInfo({lookupMap:s,surface:n,description:"downloaded tutorial (including images in images array) playlist utut_meta",playlistCollectionID:t.aem_id,playlistID:r.aem_id,tutorialID:a.aem_id,fileName:v.basename(e.path)})}).catch(function(e){return C.addSubError({err:e,id:p}),{path:void 0,time:0,count:0}});case 2:case"end":return e.stop()}},e)}),T.s();case 8:if((O=T.n()).done){e.next=10;break}return e.delegateYield(A(),"t0",9);case 9:e.next=8;break;case 10:e.next=12;break;case 11:e.prev=11,R=e.catch(7),T.e(R);case 12:return e.prev=12,T.f(),e.finish(12);case 13:return e.next=14,P.saveJsonUpdates({card:c.learnPlaylists,filename:v.basename(c.playlistPath),location:m,lookupMap:s,content:c.learnPlaylists,error:C,surface:n});case 14:P.markProcessedInfo({lookupMap:s,surface:n,description:"Saving Json Updates for after processing single playlist utut_meta",playlistCollectionID:t.aem_id,playlistID:r.aem_id,fileName:v.basename(c.playlistPath)});case 15:e.next=4;break;case 16:e.next=18;break;case 17:e.prev=17,N=e.catch(3),p.e(N);case 18:return e.prev=18,p.f(),e.finish(18);case 19:P.markProcessedInfo({lookupMap:s,surface:n,description:"Saving Json Updates after processing playlist",playlistCollectionID:t.aem_id,playlistID:r.aem_id,fileName:v.basename(c.playlistPath)});case 20:case"end":return e.stop()}},e,null,[[3,17,18,19],[7,11,12,13]])}),r.s();case 2:if((a=r.n()).done){e.next=4;break}return e.delegateYield(o(),"t0",3);case 3:e.next=2;break;case 4:e.next=6;break;case 5:e.prev=5,p=e.catch(1),r.e(p);case 6:return e.prev=6,r.f(),e.finish(6);case 7:if(P.markProcessedInfo({lookupMap:s,surface:n,description:"saving JSON updates after processing playlist metadata array",playlistCollectionID:t.aem_id,fileName:T}),!t.images){e.next=9;break}return e.next=8,Z.downloadImagesHelper(y,s,t,C);case 8:c=e.sent,E+=c.count,S+=c.totalTime,P.markProcessedInfo({lookupMap:s,surface:n,description:"saving JSON updates after processing playlist metadata array",playlistCollectionID:t.aem_id,fileName:T});case 9:case"end":return e.stop()}},e,null,[[1,5,6,7]])}));return function(t){return e.apply(this,arguments)}}())).then(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=1;break}return e.next=1,P._downloadTemplates(n,I,y,s,C).catch(function(e){C.addSubError(e)});case 1:case"end":return e.stop()}},e)}))).finally(a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,P.lock.write(a()(d().mark(function e(){var t,n,a,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.basename(P.assetsDir)+"/",a=v,e.next=1,N.writeJsonAtomic(P.assetsDir,T,g,!0);case 1:if(i=e.sent,o=a.basename.call(a,i),r.path=n+o,!(m.length>0)){e.next=2;break}if((null===(t=s.cachedAsset(r[m]))||void 0===t?void 0:t.path)===r.path||!s.cachedAsset(r[m])){e.next=2;break}return s.cachedAsset(r[m]).path=r.path,e.next=2,s.save();case 2:case"end":return e.stop()}},e)})));case 1:P.markProcessedInfo({lookupMap:s,surface:n,description:"Saving JSON updates after processing playlist collection",playlistCollectionID:null===(t=g)||void 0===t?void 0:t.aem_id});case 2:case"end":return e.stop()}},e)})));case 9:if(!C.hasSubErrors){e.next=10;break}throw C;case 11:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"markProcessedInfo",value:function(e){var t=e.lookupMap,n=e.surface,r=e.description,a=e.playlistCollectionID,s=e.playlistID,i=e.tutorialID,o=e.fileName,c=e.assetUrl;if(_.Z.isDebugModeEnabled()){var u,l,p=(null===(u=this.processedInfo)||void 0===u||null===(u=u.details)||void 0===u?void 0:u.length)+1,d=Object.assign({order:p,surface:n,description:r},a?{playlistCollectionID:a}:{},s?{playlistID:s}:{},i?{tutorialID:i}:{},c?{url:c}:{},o?{fileName:o}:{});if(null===(l=this.processedInfo)||void 0===l||null===(l=l.details)||void 0===l||l.push(d),"Downloaded Template"===r){var f,h=(null===(f=this.processedInfo)||void 0===f||null===(f=f.templateDownloadSummary)||void 0===f?void 0:f.length)+1;delete(d=Ie({},d)).order,delete d.fileName,d.templateOrder=h,this.processedInfo.templateDownloadSummary.push(d)}else if("downloaded and saved playlist"===r){var E,S=(null===(E=this.processedInfo)||void 0===E||null===(E=E.playlistDownloadSumary)||void 0===E?void 0:E.length)+1;delete(d=Ie({},d)).order,delete d.fileName,d.playlistOrder=S,this.processedInfo.playlistDownloadSumary.push(d)}else if("downloaded tutorial (including images in images array) playlist utut_meta"===r){var v,g=(null===(v=this.processedInfo)||void 0===v||null===(v=v.tutorialDownloadSumary)||void 0===v?void 0:v.length)+1;delete(d=Ie({},d)).order,delete d.fileName,d.tutorialOrder=g,this.processedInfo.tutorialDownloadSumary.push(d)}else{var T,m=(null===(T=this.processedInfo)||void 0===T||null===(T=T.tutorialDownloadSumary)||void 0===T?void 0:T.length)+1;delete(d=Ie({},d)).order,delete d.fileName,d.tutorialOrder=m,this.processedInfo.tutorialDownloadSumary.push(d)}this.logPESProcessedInfo(t)}}},{key:"logPESProcessedInfo",value:(E=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_.Z.isDebugModeEnabled()&&_.Z.enabledDiskLogVerbose()){n={},r=Oe(this.processedInfo.details);try{for(r.s();!(a=r.n()).done;)s=a.value,i=s.description,n[i]=(n[i]||0)+1}catch(e){r.e(e)}finally{r.f()}o=Object.values(n).reduce(function(e,t){return e+t},0),n.total=o,c=this.processedInfo.details[this.processedInfo.details.length-1],this.log.disk("\n************************************************************************"),this.log.disk("Latest PES Info Event Processed: ",c),this.log.disk("************************************************************************\n"),u=v.join(f.Z.get("ROOT_DIR"),f.Z.get("CONTENT_PROCESSING_SUMMARY",t.type)),S.writeFile(u,JSON.stringify(Ie(Ie({},this.processedInfo),{},{summary:n}),null,2),function(e){if(e)throw l.log.disk("\n\n\t\t****** Error Writing  Info at file path ***** \n ".concat(u," \n\n")),e})}case 1:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"saveJsonUpdates",value:(p=a()(d().mark(function e(t){var n,r,s,i,o,c,u=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.card,r=t.filename,s=t.location,i=t.lookupMap,o=t.content,c=t.error,void 0===t.lock&&this.lock,t.surface,e.next=1,this.lock.write(a()(d().mark(function e(){var t,a,c,l,p;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.basename(u.assetsDir)+"/",c=v,e.next=1,N.writeJsonAtomic(u.assetsDir,r,o,!0);case 1:if(l=e.sent,p=c.basename.call(c,l),n.path=a+p,!(s.length>0)){e.next=2;break}if((null===(t=i.cachedAsset(n[s]))||void 0===t?void 0:t.path)===n.path||!i.cachedAsset(n[s])){e.next=2;break}return i.cachedAsset(n[s]).path=n.path,e.next=2,i.save();case 2:case"end":return e.stop()}},e)}))).catch(function(e){c.addSubError({err:e,url:n.data})});case 1:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"downloadLearnContent",value:(u=a()(d().mark(function e(n){var r,s,i,o,c,u,l,p,h,E,S,g,T,m,y,O,C,I,R,k,P,L=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.card,c=n.lookupMap,u=n.priority,l=n.bundle,p=n.params,h=n.started,E=n.force,S=0,g=0,T={},m="",y="",O="ututService",C="quickAction","URL"!==o.dataType||!o.data){e.next=3;break}return y="data",e.next=1,c.fetchAsset({href:o.data,assetsDir:this.assetsDir,priority:u,params:p,force:Ie(Ie({},E),{},{depth:(E.depth||0)-1})});case 1:return I=e.sent,S++,g+=I.time,m=v.basename(I.path),e.next=2,N.readJson("".concat(this.assetsDir,"/").concat(m),this.log).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw c.clearAssetMetadata(o.data),delete o.path,delete o.content,t;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:T=e.sent,o.path=I.path,l&&(o.content=T),e.next=6;break;case 3:if("application/json"!==o.dataType||!o.data){e.next=5;break}return T=JSON.parse(o.data),l&&(o.content=T),m=c.generateId(p)+".json",k=v,e.next=4,N.writeJsonAtomic(this.assetsDir,m,T,!0);case 4:P=e.sent,m=k.basename.call(k,P),o.path=f.Z.get("ASSETS_DIRNAME")+"/"+m,e.next=6;break;case 5:case 8:return e.abrupt("return",{totalTime:g,count:S});case 6:return h(),R=new A.Z(f.Z.analytics.AGGREGATE_ERROR,"LEARN"+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),e.next=7,_.Z.waitAll([].concat(t()((T.data&&Object.values(T.data)||[]).map(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t._references)){e.next=1;break}return e.next=1,_.Z.waitAll(t._references.map(function(){var e=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._publishUrl){e.next=2;break}return e.next=1,c.fetchAsset({href:t._publishUrl,assetsDir:L.assetsDir,priority:u,params:p,force:Ie(Ie({},E),{},{depth:(E.depth||0)-2})}).catch(function(e){return R.addSubError({err:e,url:t._publishUrl,id:t._path}),{path:void 0,time:0}});case 1:n=e.sent,t.path=n.path,n.time&&(S++,g+=n.time);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),t()(((null===(r=T.data)||void 0===r||null===(r=r.userintentByPath)||void 0===r||null===(r=r.item)||void 0===r||null===(r=r.pages)||void 0===r||null===(r=r.recommendations)||void 0===r?void 0:r.items)||[]).map(function(){var e=a()(d().mark(function e(t){var n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!f.Z.get("USER_INTENT_SUPPORTED_UTUT_TYPES").includes(null===(n=t.content)||void 0===n?void 0:n.type)){e.next=2;break}return e.next=1,Z.downloadTutorial({params:p,url:t.content.downloadUrl,id:t.content.id||"",priority:u,force:Ie(Ie({},E),{},{depth:(E.depth||0)-1}),analyticsData:L.userIntentRecommendationAnalyticsData(t),filePrefix:"HEL",ututMetaLocale:p.productLanguage,map:c}).catch(function(e){return R.addSubError(Ie({err:e,id:t.content.id,url:t.content.downloadUrl},o.containerAnalyticsData)),{time:0,count:0,path:void 0}});case 1:a=e.sent,t.path=a.path;case 2:if(!f.Z.get("USER_INTENT_SUPPORTED_PLAYLIST_TYPES").includes(null===(r=t.content)||void 0===r?void 0:r.type)){e.next=4;break}return e.next=3,Z.downloadTutorial({params:p,url:t.content.downloadUrl,id:t.content.id||"",priority:u,force:Ie(Ie({},E),{},{depth:(E.depth||0)-1}),analyticsData:L.userIntentRecommendationAnalyticsData(t),filePrefix:"PLA",ututMetaLocale:p.productLanguage,map:c}).catch(function(e){return R.addSubError(Ie({err:e,id:t.content.id,url:t.content.downloadUrl},o.containerAnalyticsData)),{time:0,count:0,path:void 0}});case 3:s=e.sent,t.path=s.path;case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),t()((T.tutorials||[]).map(function(){var e=a()(d().mark(function e(t){var n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=t.metadata)||void 0===n||null===(n=n.images)||void 0===n||null===(n=n.hero)||void 0===n||!n.length){e.next=2;break}return e.next=1,c.fetchAsset({href:t.metadata.images.hero,analyticsData:L.ututAnalyticsData(t),priority:u,params:p,force:Ie(Ie({},E),{},{depth:(E.depth||0)-1}),assetsDir:L.assetsDir}).catch(function(e){return R.addSubError(Ie({err:e,url:t.metadata.images.hero,id:t.tutorialUUID||t.aem_id},o.containerAnalyticsData)),{path:void 0,time:0}});case 1:r=e.sent,t.metadata.images.heroPath=r.path,g+=r.time,S++;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),t()((T.playlists||[]).map(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.tutorial_ids){e.next=1;break}return t.tutorial_paths={},e.next=1,_.Z.waitAll(t.tutorial_ids.map(function(){var e=a()(d().mark(function e(n){var r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Z.downloadTutorial({params:p,id:n,priority:u,force:Ie(Ie({},E),{},{depth:(E.depth||0)-1}),analyticsData:L.ututPlaylistAnalyticsData(t,n),filePrefix:"LCM",status:t.status||"live",ututMetaLocale:p.productLanguage,map:c}).catch(function(e){return R.addSubError(Ie({err:e,id:n},o.containerAnalyticsData)),{time:0,count:0,path:void 0}});case 1:r=e.sent,t.tutorial_paths[n]=r.path,g+=r.time,S+=r.count;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),t()(((null===(s=T.data)||void 0===s?void 0:s.recommendations)||[]).map(function(){var e=a()(d().mark(function e(t){var n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(n=t.content)||void 0===n?void 0:n.type)!==C){e.next=2;break}return r={},e.next=1,_.Z.waitAll(Object.keys(t.content.assetUrls||{}).map(function(){var e=a()(d().mark(function e(n){var a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.content.assetUrls[n],!L.shouldPrefetchAsset(n,c)){e.next=2;break}return e.next=1,c.fetchAsset({href:a,analyticsData:L.recommendationAnalyticsData(t),priority:u,params:p,force:Ie(Ie({},E),{},{depth:(E.depth||0)-1}),assetsDir:L.assetsDir}).catch(function(e){var n;return R.addSubError({err:e,url:a,id:null==t||null===(n=t.content)||void 0===n?void 0:n.uuid}),{path:void 0,time:0}});case 1:s=e.sent,r[n]=s.path,g+=null==s?void 0:s.time,S++,e.next=3;break;case 2:L.log.disk("Asset ".concat(n," in QuickAction deny list. Skipping prefetch"));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:t.content.assetPaths=r;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),t()(((null===(i=T.data)||void 0===i?void 0:i.recommendations)||[]).map(function(){var e=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t||null===(n=t.content)||void 0===n||!n.downloadUrl||(null==t||null===(r=t.content)||void 0===r?void 0:r.source)!==O){e.next=2;break}return e.next=1,Z.downloadTutorial({params:p,url:t.content.downloadUrl,id:t.content.id||"",priority:u,force:Ie(Ie({},E),{},{depth:(E.depth||0)-1}),analyticsData:L.recommendationAnalyticsData(t),filePrefix:"REC",ututMetaLocale:p.productLanguage,map:c}).catch(function(e){var n,r;return R.addSubError(Ie({err:e,id:null==t||null===(n=t.content)||void 0===n?void 0:n.id,url:null==t||null===(r=t.content)||void 0===r?void 0:r.downloadUrl},null==o?void 0:o.containerAnalyticsData)),{time:0,count:0,path:void 0}});case 1:a=e.sent,t.content.path=a.path,g+=a.time,S+=a.count;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())))).finally(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,L.lock.write(a()(d().mark(function e(){var t,n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.basename(L.assetsDir)+"/",r=v,e.next=1,N.writeJsonAtomic(L.assetsDir,m,T,!0);case 1:if(a=e.sent,s=r.basename.call(r,a),o.path=n+s,!(y.length>0)){e.next=2;break}if((null===(t=c.cachedAsset(o.data))||void 0===t?void 0:t.path)===o.path||!c.cachedAsset(o.data)){e.next=2;break}return c.cachedAsset(o.data).path=o.path,e.next=2,c.save();case 2:case"end":return e.stop()}},e)})));case 1:case"end":return e.stop()}},e)})));case 7:if(!R.hasSubErrors){e.next=8;break}throw R;case 9:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"shouldPrefetchAsset",value:function(e,t){return!(f.Z.get("QUICK_ACTIONS_PREFETCH_DENY_LIST",t.type)||[]).includes(e)}},{key:"userIntentRecommendationAnalyticsData",value:function(e){var t,n;return{"event.subcategory":f.Z.analytics.sc_USER_INTENT_RECOMMENDATIONS,"event.subtype":f.Z.analytics.st_API,"content.id":null==e||null===(t=e.content)||void 0===t?void 0:t.id,"content.type":null==e||null===(n=e.content)||void 0===n?void 0:n.type}}},{key:"ututAnalyticsData",value:function(e){return{"event.subcategory":f.Z.analytics.sc_UTUTS,"event.subtype":f.Z.analytics.st_API,"content.id":e.tutorialUUID||e.aem_id,"content.name":e.metadata&&e.metadata.descriptions&&e.metadata.descriptions.short,"content.category":e.metadata&&e.metadata.level,"content.action":e.metadata&&e.metadata.urls&&e.metadata.urls.helpx,"content.type":e.metadata&&e.metadata.learning_approach}}},{key:"ututPlaylistAnalyticsData",value:function(e,t){return{"event.subcategory":f.Z.analytics.sc_LCM,"event.subtype":f.Z.analytics.st_API,"content.id":t,"content.name":e.description,"content.category":e.level}}},{key:"recommendationAnalyticsData",value:function(e){var t,n;return{"event.subcategory":f.Z.analytics.sc_RECOMMMENDATIONS,"event.subtype":f.Z.analytics.st_API,"content.id":null==e||null===(t=e.content)||void 0===t?void 0:t.id,"content.type":null==e||null===(n=e.content)||void 0===n?void 0:n.type}}},{key:"downloadData",value:(o=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,f,_,h,E;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.modeID,r=t.card,a=t.lookupMap,s=t.priority,i=t.bundle,o=void 0!==i&&i,c=t.params,u=void 0===c?{}:c,l=t.started,p=void 0===l?function(){}:l,f=t.force,_=void 0===f?{type:"none"}:f,e.prev=1,r.gsdkEnabledContent&&this.log.disk("Received a GSDK enabled container for ".concat(n,".")),h=n,e.next="Discover_Panel"===h||"DP_Tool_Techniques_v1"===h||"GHOST_Discover_Panel"===h||"GHOST_DP_Tool_Techniques_v1"===h?2:"payment_notification_banner"===h||"GHOST_payment_notification_banner"===h||"NPS_SURVEY"===h||"NPS_SURVEY"===h?4:"CCX_Start_5.11_Stock"===h||"GHOST_CCX_Start_5.11_Stock"===h?6:"CCXP_FLOODGATE_FLAGS-CCXP-FG1"===h?8:"CCD_ALL_APPS_BANNERS"===h||"CCD_APPS_CATALOG"===h||"CCD_APP_SKELETON"===h||"CCD_PMP"===h||"CCD_USER_FEEDBACK"===h||"CCD_HOME_SKELETON"===h||"CCD_FRAMEWORK"===h||"CCD_QUICK_ACTIONS"===h||"payment_notification_banner"===h||"CCD_APPS_SKELETON"===h||"CCD_APPS_CUSTOM_CARDS"===h||"CCD_GENESIS"===h||"CCD_FFE"===h||"GHOST_CCD_ALL_APPS_BANNERS"===h||"GHOST_CCD_APPS_CATALOG"===h||"GHOST_CCD_APP_SKELETON"===h||"GHOST_CCD_PMP"===h||"GHOST_CCD_USER_FEEDBACK"===h||"GHOST_CCD_HOME_SKELETON"===h||"GHOST_CCD_FRAMEWORK"===h||"GHOST_CCD_QUICK_ACTIONS"===h||"GHOST_CCD_APPS_SKELETON"===h||"GHOST_CCD_APPS_CUSTOM_CARDS"===h||"GHOST_CCD_GENESIS"===h||"GHOST_CCD_FFE"===h||"in_app_contextual_notifications"===h||"GHOST_in_app_contextual_notifications"===h?10:"PES_ATLAS"===h||"PES_BROWSE_LEARN"===h||"GHOST_PES_ATLAS"===h||"GHOST_PES_BROWSE_LEARN"===h?12:"PES_WHATS_NEW"===h||"GHOST_PES_WHATS_NEW"===h?14:"CCX_Start_3.1_Tutorials"===h||"LCM_LEARN_PANEL"===h||"GHOST_CCX_Start_3.1_Tutorials"===h||"GHOST_LCM_LEARN_PANEL"===h?16:18;break;case 2:return e.next=3,this.downloadIndexFileData({card:r,lookupMap:a,priority:s,bundle:o,params:u,started:p,force:_});case 3:case 5:case 7:case 9:case 11:case 13:case 15:case 17:case 19:return e.abrupt("return",e.sent);case 4:return e.next=5,this.passThroughContent({card:r,lookupMap:a,priority:s,bundle:o,params:u,started:p,force:_});case 6:return e.next=7,this.downloadAemCollectionTemplateData({card:r,lookupMap:a,priority:s,bundle:o,params:u,started:p,force:_});case 8:return e.next=9,this.processDownloadedFlags({modeID:n,card:r,lookupMap:a,priority:s,bundle:o,params:u,started:p,force:_});case 10:return e.next=11,this.downloadAEMData({card:r,lookupMap:a,priority:s,bundle:o,params:u,started:p,force:_});case 12:return e.next=13,this.downloadLearnPESData({modeID:n,card:r,lookupMap:a,priority:s,bundle:!1,shouldPrefetchTemplates:!1,params:u,started:p,force:_});case 14:return e.next=15,this.downloadLearnPESData({modeID:n,card:r,lookupMap:a,priority:s,bundle:!1,shouldPrefetchTemplates:!0,params:u,started:p,force:_});case 16:return e.next=17,this.downloadLearnContent({card:r,lookupMap:a,priority:s,bundle:!0,params:u,started:p,force:_});case 18:return e.next=19,this.downloadAEMData({card:r,lookupMap:a,priority:s,bundle:!0,params:u,started:p,force:_});case 20:e.next=22;break;case 21:throw e.prev=21,E=e.catch(1),this.log.disk("Error downloading content for ".concat(n," ").concat(E,", ").concat(E.stack,", card: ").concat(JSON.stringify(r),",")),E;case 22:case"end":return e.stop()}},e,this,[[1,21]])})),function(e){return o.apply(this,arguments)})},{key:"processDownloadedFlags",value:(s=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.modeID,a=t.card,s=t.lookupMap,t.priority,t.bundle,t.params,t.started,t.force,i=(null===(n=a.releases[0])||void 0===n?void 0:n.features)||[],o=(null===(r=a.releases[0])||void 0===r?void 0:r.meta)||[],c=0,u=Date.now(),(f.Z.get("ACTIVATED_FLAGS",s.type)||[]).forEach(function(e){if(i.includes(e)){c++;var t=o.find(function(t){return t.k===e});if(t)try{var n=_.Z.decodeMetadata(t.v);n=_.Z.parseMetaValue(n),f.Z.set(t.k,n)}catch(e){p.log.error(new A.Z("Failed parsing  feature flag [".concat(t.k,"] metadata [").concat(t.v,"]token"),e))}}else f.Z.remove(e)}),l=Date.now(),e.abrupt("return",{totalTime:l-u,count:c});case 1:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})},{key:"getReferencedAssets",value:(r=a()(d().mark(function e(t,n,r){var s,i,o,c,u,l,p,f,h,E,g,T,m;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s={},m=t,e.next="Discover_Panel"===m||"DP_Tool_Techniques_v1"===m||"GHOST_Discover_Panel"===m||"GHOST_DP_Tool_Techniques_v1"===m?1:"CCX_Start_5.11_Stock"===m||"GHOST_CCX_Start_5.11_Stock"===m?4:"PES_ATLAS"===m||"PES_BROWSE_LEARN"===m||"PES_WHATS_NEW"===m||"GHOST_PES_ATLAS"===m||"GHOST_PES_BROWSE_LEARN"===m||"GHOST_PES_WHATS_NEW"===m?7:10;break;case 1:if(!n.path){e.next=3;break}return s[n.path]=!0,i=v.basename(n.path),e.next=2,S.readJson("".concat(this.assetsDir,"/").concat(i)).catch(function(){return delete s[n.path],{}});case 2:if(null!=(o=e.sent)&&o._assetPaths&&Object.keys(o._assetPaths).forEach(function(e){s[o._assetPaths[e]]=!0}),null==o||!o._toolTechniquesPaths){e.next=3;break}return e.next=3,_.Z.waitAll(Object.values(o._toolTechniquesPaths).map(function(){var e=a()(d().mark(function e(t){var n,a,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object,a=s,e.next=1,r.getTutorialAssets(t);case 1:i=e.sent,n.assign.call(n,a,i);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",s);case 4:if(!n.path){e.next=6;break}return s[n.path]=!0,u=v.basename(n.path),e.next=5,S.readJson("".concat(this.assetsDir,"/").concat(u)).catch(function(){return delete s[n.path],{}});case 5:return l=e.sent,e.next=6,_.Z.waitAll(((null==l||null===(c=l.data)||void 0===c||null===(c=c.modalCollectionsByPath)||void 0===c||null===(c=c.item)||void 0===c?void 0:c.templateCollections)||[]).map(function(){var e=a()(d().mark(function e(t){var n,a,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object,a=s,e.next=1,r.getCollectionAsset(t.path);case 1:i=e.sent,n.assign.call(n,a,i);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 6:return e.abrupt("return",s);case 7:if(!n.path){e.next=9;break}return s[n.path]=!0,e.next=8,this.getPESReferencedAssetsHelper(r,s,t,n,v.join(this.assetsDir,v.basename(n.path)));case 8:p=e.sent,Object.assign(s,p);case 9:return e.abrupt("return",s);case 10:if(!n.path){e.next=12;break}return s[n.path]=!0,f=v.basename(n.path),e.next=11,S.readJson("".concat(this.assetsDir,"/").concat(f)).catch(function(){return delete s[n.path],{}});case 11:if((h=e.sent)&&h.data)for(E=0,g=Object.values(h.data);E<g.length;E++)T=g[E],Array.isArray(T._references)&&T._references.forEach(function(e){e.path&&(s[e.path]=!0)});case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"_downloadTemplates",value:(n=a()(d().mark(function e(t,n,r,s,i){var o,c,u,l,p,_,h=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=f.Z.get("PREFETCH_TEMPLATE_LIMIT",s.type),e.next=1,Z.getDownloadedTemplateCount(n);case 1:c=e.sent,u=Oe(n),e.prev=2,p=d().mark(function e(){var n,u,p,f,_;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.value,u=Object.keys(n)[0],p=n[u],!(c<o)){e.next=2;break}return c++,e.next=1,h.templateLock.read(a()(d().mark(function e(){var n,o,c,l,f;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=0,c=0,null==(l=null==p||null===(n=p.tutorials[0])||void 0===n||null===(n=n.surfaces)||void 0===n?void 0:n.in_app_panel)||!l.template){e.next=2;break}return e.next=1,s.fetchAsset(Object.assign({},r,{href:l.template})).then(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.templatePath=n.path,e.next=1,N.writeJsonAtomic(h.assetsDir,v.basename(u),p,!0);case 1:return h.markProcessedInfo({lookupMap:s,surface:t,description:"Downloaded Template",tutorialID:null==p?void 0:p.tutorials[0].aem_id,fileName:v.basename(l.templatePath),assetUrl:l.template}),e.abrupt("return",n);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){return i.addSubError({err:e,id:p.aem_id}),{path:void 0,time:0}});case 1:(f=e.sent).time&&(c++,o+=f.time);case 2:return e.abrupt("return",{time:o,count:c});case 3:case"end":return e.stop()}},e)})));case 1:e.next=3;break;case 2:_=null==p||null===(f=p.tutorials[0])||void 0===f||null===(f=f.surfaces)||void 0===f?void 0:f.in_app_panel.template,h.log.disk("Template download reached (".concat(o,"). Skipping ").concat(_)),h.markProcessedInfo({lookupMap:s,surface:t,description:"Not Downloading Template",tutorialID:null==p?void 0:p.tutorials[0].aem_id});case 3:case"end":return e.stop()}},e)}),u.s();case 3:if((l=u.n()).done){e.next=5;break}return e.delegateYield(p(),"t0",4);case 4:e.next=3;break;case 5:e.next=7;break;case 6:e.prev=6,_=e.catch(2),u.e(_);case 7:return e.prev=7,u.f(),e.finish(7);case 8:return e.abrupt("return",{path:void 0,time:0});case 9:case"end":return e.stop()}},e,null,[[2,6,7,8]])})),function(e,t,r,a,s){return n.apply(this,arguments)})},{key:"getPESReferencedAssetsHelper",value:(e=a()(d().mark(function e(t,n,r,a,s){var i,o,c,u,l,p,_,h,E,S;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a,!s){e.next=2;break}return e.next=1,Z.processContentFile(a,t,v.basename(s),n);case 1:i=e.sent,e.next=3;break;case 2:i=a;case 3:if(o=f.Z.get("GC_ASSET_INFO",t.type).EXCLUDE_GC_PATHS,c=f.Z.get("GC_ASSET_INFO",t.type).EXCLUDE_GC_MAP,u=f.Z.get("GC_ASSET_INFO",t.type).PROCESS_JSON,l=Ie({},n),"object"!==J()(i)||null===i){e.next=9;break}E=d().keys(i);case 4:if((S=E()).done){e.next=9;break}if(p=S.value,_=i[p],o.includes(p)&&(l[_]=!0),c.includes(p)&&"object"===J()(_)&&null!==_&&_ instanceof Map&&_.forEach(function(e,t){l[e]=!0}),h=void 0,!u.includes(p)||".json"!==v.extname(_)){e.next=6;break}return e.next=5,this.getPESReferencedAssetsHelper(t,l,r,i,_);case 5:h=e.sent,e.next=8;break;case 6:return e.next=7,this.getPESReferencedAssetsHelper(t,l,r,i[p],void 0);case 7:h=e.sent;case 8:l=Ie(Ie({},l),h),e.next=4;break;case 9:return e.abrupt("return",l);case 10:case"end":return e.stop()}},e,this)})),function(t,n,r,a,s){return e.apply(this,arguments)})}]);var e,n,r,s,o,u,p,E,g,T,m,y,O}();function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Pe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Pe=function(){return!!e})()}var Le=function(e){function t(e,n){var r,a,s,o;return i()(this,t),a=this,s=t,o=[e,n],s=B()(s),r=H()(a,Pe()?Reflect.construct(s,o||[],B()(a).constructor):s.apply(a,o)),l()(r,"dataManager",void 0),r.dataManager=new Re(n.type,r._lookupMap.diskLock),r}return X()(t,e),c()(t,[{key:"syncDataPromises",value:(o=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,_=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.analyticsParams,r=t.payload,s=t.surface,i=t.card,o=t.priority,c=t.params,u=t.force,l=t.started,p=f.Z.get("IGNORE_PERF_EVENTS_FOR_SURFACES",this._lookupMap.type).includes(s),e.next=1,this.log.context({analytics:!p,payload:r,surfaceAnalytics:[ke({surface:s},n)]}).time(function(){var e=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,_.dataManager.downloadData({modeID:s,card:i,lookupMap:_._lookupMap,priority:o,params:c,started:l,force:u});case 1:n=e.sent,r=n.count,a=n.totalTime,t.appendPayload({"event.url":"URL"===i.dataType&&i.data||"","event.count":r,"event.value":a/r,"exp.surface_id":"".concat(s,"(").concat(i.containerId,")")});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"syncData",value:(s=a()(d().mark(function e(){var t,n,r,s,i,o,c,u,l,p,h,E,S,v,g,T,m=this,y=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=y.length>0&&void 0!==y[0]?y[0]:{}).priority,r=void 0===n?new x.UL:n,s=t.payload,i=void 0===s?{}:s,o=t.params,c=void 0===o?{}:o,u=t.progress,l=void 0===u?function(){}:u,p=t.force,h=void 0===p?{type:"none"}:p,E=t.gsdkOnly,S=void 0!==E&&E,this._data){e.next=1;break}return e.abrupt("return");case 1:return v={started:[],complete:[],failed:[]},g=new A.Z(f.Z.analytics.AGGREGATE_ERROR,f.Z.get("AGGREGATE_TYPE",this._lookupMap.type)+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),T=[],Object.keys(this._data.surfaces||{}).forEach(function(e){var t=!1;T.push(_.Z.waitAll((m._data.surfaces[e].containers||[]).map(function(){var n=a()(d().mark(function n(s,o){var u,p;return d().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!S||0!=!!s.gsdkEnabledContent){n.next=1;break}return n.abrupt("return");case 1:return(p=new x.UL(r)).value+=(null===(u=f.Z.get("SURFACE_PRIORITY",m._lookupMap.type))||void 0===u?void 0:u[e])||0,p=m.getPriorityChannel(e,p),n.next=2,m.syncDataPromises({analyticsParams:s.containerAnalyticsData,payload:i,surface:e,card:s,priority:p,params:c,force:h,started:function(){v.started.includes(e)||(v.started.push(e),l(Object.assign({},v)))}}).catch(function(){var n=a()(d().mark(function n(r){return d().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t=!0,g.addSubError(ke(ke({surface:e,url:s.data},Object.assign({},s.containerAnalyticsData,{containerLabel:s.containerLabel})),{},{err:r}));case 1:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());case 2:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())).then(function(){v.started.includes(e)||v.started.push(e),t?v.failed.push(e):v.complete.push(e),l(Object.assign({},v))}))}),e.next=2,_.Z.waitAll(T);case 2:if(!g.hasSubErrors){e.next=3;break}throw g;case 3:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"logFailures",value:(r=a()(d().mark(function e(t,n){var r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object.keys(this._data.surfaces||{}).forEach(function(e){(r._data.surfaces[e].failedContainers||[]).forEach(function(t){if(r.log.disk("Surface Error (".concat(t.errorCode,"): ").concat(t.errorMessage," - ").concat(e,"(").concat(t.containerId,")")),t.gsdkEnabledContent&&t.errorMessage!==fe.CampaignState.NoTargetingCampaign){var a,s,i=new A.Z("Failed Container",t.errorMessage,t.errorCode).removeStack().skipErrorScrub();n.error(i).appendPayload({"content.type":f.Z.analytics.GSDK,"content.size":"".concat(null!==(a=r._data.surfaces[e])&&void 0!==a&&a.containers?r._data.surfaces[e].containers.length:0,":").concat(null!==(s=r._data.surfaces[e])&&void 0!==s&&s.failedContainers?r._data.surfaces[e].failedContainers.length:0)}).addSurfaceAnalytics([Object.assign({},{surface:e},t.containerAnalyticsData,{containerLabel:t.containerLabel})])}})});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"getPriorityChannel",value:function(e,t){return t}},{key:"totalItems",get:function(){var e;return null!==(e=this._data)&&void 0!==e&&e.surfaces?Object.keys(this._data.surfaces).length:0}},{key:"validateData",value:function(e,t){return _.Z.validateDataFields(e,f.Z.get("SOPHIA_RESPONSE_SCHEMA"))||null}},{key:"getReferencedAssets",value:(n=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},!this._data||!this._data.surfaces){e.next=1;break}return e.next=1,_.Z.waitAll(Object.keys(this._data.surfaces).map(function(){var e=a()(d().mark(function e(r){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,_.Z.waitAll((n._data.surfaces[r].containers||[]).map(function(){var e=a()(d().mark(function e(a){var s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,n.dataManager.getReferencedAssets(r,a,n._lookupMap);case 1:s=e.sent,Object.assign(t,s);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:return e.abrupt("return",t);case 2:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]);var n,r,s,o}(ye);const De={AJO_SUPPORTED:!0,ANALYTICS_SUBCATEGORY:"Sophia",LOOKUP_MAP_FILE_VERSION:7,LOOKUP_COLLECTION_FILE_VERSION:3,ASSET_MAX_SOCKETS:4,ASSET_MINIMUM_PARTIAL_SIZE:65536,FILE_ACCESSOR_WRITE_ENABLED:!0,SUPPORTED_PRODUCTS:{AEFT:"24.0",AEFTBETA:"24.0",IDSN:"18.0",IDSNBETA:"18.0",IDSNPR:"18.0",ILST:"26.0",ILSTPR:"26.0",ILSTBETA:"26.0",PHXS:"25.0",PHSP:"25.0",PHSPPR:"25.0",PHSPBETA:"25.0",PPRO:"24.0",PPROBETA:"24.0",SPRK:"54.0",SPRKDV:"54.0"},UNSUPPORTED_AFTER_VERSION:{},PARAMETERS_SCHEMA:{id:"psdk_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},LOG_PREFIX:"FirstMile",LABEL:"FIRST_MILE",DIR:"data/",VULCAN_TYPE:"FirstMile",PRIORITY_CHANNEL:x.NU.FirstMileLatest,ANONYMOUS_RETRY_DISABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!0,SOPHIA_VERBOSE_FLAG_ENABLED:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,SUPPORTS_ON_DEMAND:!0,ACTIVE_VERSIONS:["V4_0","V6_0","V7_0"],V4_0:{VERSION_LESS_THAN:"6.8",START_VERSION:"6.7.0.44",PREFETCH_CLIENTS:{ILST:"28.0",ILSTBETA:"28.0",ILSTPR:"28.0",SPRK:"57.1",SPRKDV:"57.1",IDSN:"19.2",IDSNBETA:"19.2",IDSNPR:"19.2"},PRODUCT_ALIASES:{IDSNBETA:"IDSN",IDSNPR:"IDSN",SPRKDV:"SPRK",ILSTBETA:"ILST",ILSTPR:"ILST"},SURFACES:["CCX_Start_4.0_Toast","CCX_Start_4.0_Home","CCX_Start_4.0_Whats_New"]},V6_0:{VERSION_LESS_THAN:"8.2",START_VERSION:"8.0.0.78",PREFETCH_CLIENTS:{PPRO:"25.2",PPROBETA:"25.2"},PRODUCT_ALIASES:{PPROBETA:"PPRO"},SURFACES:["CCX_Start_4.0_Toast","CCX_Start_4.0_Home","CCX_Start_4.0_Whats_New","CCX_Start_4.0_View_Plans"]},V7_0:{VERSION_LESS_THAN:"99.9",START_VERSION:"10.4.1.2",PREFETCH_CLIENTS:{AEFT:"99.0",AEFTBETA:"99.0",PHXS:"99.0",PHSP:"99.0",PHSPPR:"99.0",PHSPBETA:"99.0",ILST:"99.0",ILSTBETA:"99.0",ILSTPR:"99.0",SPRK:"99.0",SPRKDV:"99.0",IDSN:"99.0",IDSNBETA:"99.0",IDSNPR:"99.0",PPRO:"99.0",PPROBETA:"99.0"},PRODUCT_ALIASES:{PHSP:"PHXS",AEFTBETA:"AEFT",SPRKDV:"SPRK"},SURFACES:["CCX_Start_4.0_Toast","CCX_Start_4.0_Home","CCX_Start_4.0_Whats_New","CCX_Start_4.0_View_Plans","PES_FEATURES"]},SURFACE_PRIORITY:{"CCX_Start_4.0_Toast":100,"CCX_Start_4.0_Home":200,"CCX_Start_4.0_View_Plans":100,"CCX_Start_4.0_Whats_New":100,PES_FEATURES:200},SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","en_AE","en_GB","en_IL","es_ES","es_MX","fi_FI","fr_FR","fr_CA","fr_MA","hu_HU","id_ID","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","th_TH","tr_TR","uk_UA","vi_VN","zh_CN","zh_TW"],IGNORE_PERF_EVENTS_FOR_SURFACES:["CCX_Start_4.0_Toast","CCX_Start_4.0_Home","CCX_Start_4.0_View_Plans","CCX_Start_4.0_Whats_New","PES_FEATURES"],GSDK_DEFAULT_EXPIRY_TIME:2};function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var we=function(){return c()(function e(t){i()(this,e),l()(this,"type",void 0),l()(this,"_requestLock",void 0),l()(this,"prioritize",void 0),l()(this,"log",void 0),l()(this,"downloadCollectionData",void 0),this.type=t,e.requestLock=e.requestLock||new x.ZP(f.Z.get("NUM_CONCURRENT_REQUESTS")),this._requestLock=e.requestLock,this.prioritize=this._requestLock.prioritize,this.log=new h.Z({prefix:"".concat(f.Z.get("LOG_PREFIX",t),"DownloadManager > "),payload:{"event.subtype":f.Z.analytics.st_API,"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",this.type)}}),this.downloadCollectionData=this.downloadCollectionDataRaw.bind(this)},[{key:"postProcessContent",value:function(e,t){return e}},{key:"url",value:(p=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.assign({},t),r=f.Z.getEnvironment(),a=new D.URL(f.Z.get("URL_".concat(r.LABEL.toUpperCase()),this.type)),(n.verbose||f.Z.get("SOPHIA_VERBOSE_FLAG_ENABLED",this.type))&&(n.verbose=f.Z.get("SOPHIA_VERBOSE_FLAG_ENABLED",this.type).toString()),delete n.sapCode,this.appendUrlSearchParams(a.searchParams,n),e.abrupt("return",a.toString());case 1:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"additionalAnalytics",value:function(e){return{}}},{key:"applyResponseAnalytics",value:function(e,t,n,r){if(e.appendPayload(be({"exp.response_guid":t.analyticsData&&t.analyticsData.responseGUID},r)),t.surfaces){var a=function(n){Array.isArray(t.surfaces[n].containers)&&e.addSurfaceAnalytics(t.surfaces[n].containers.map(function(e){return Object.assign({},{surface:n},e.containerAnalyticsData,{containerLabel:e.containerLabel})}))};for(var s in t.surfaces)a(s)}}},{key:"filterAndSortGSDKContainers",value:function(e,n){var r=this;if(!e||!Array.isArray(e))return[];var a=e.filter(function(e){return(null==e?void 0:e.tags)&&Array.isArray(e.tags)&&e.tags.includes(n)}),s=a.length>0?a:e;return s.length>1?t()(s).sort(function(e,t){for(var n=0,a=[e,t];n<a.length;n++){var s=a[n];s&&void 0===s.sortOrder&&r.log.disk('Warning: Container with label:"'.concat(s.containerLabel||"undefined",'" (ID: ').concat(s.containerId||"undefined",") has undefined sortOrder"))}return(e&&void 0!==e.sortOrder?Number(e.sortOrder):Number.MAX_SAFE_INTEGER)-(t&&void 0!==t.sortOrder?Number(t.sortOrder):Number.MAX_SAFE_INTEGER)}):s}},{key:"downloadGSDKCollectionData",value:(u=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h,E,S,v,g,m,y=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,s=void 0===r?T.v4():r,i=t.params,o=t.lookup,c={surfaces:{}},u={},l=void 0,p=!1,h=0,E=0,S=f.Z.get("GSDK_CONTAINER_SCHEMA"),v=pe.Z.isClientSupported(i,o),g=o.getClientVersion(i),m=null===(n=f.Z.get(g,o.type))||void 0===n?void 0:n.ALTERNATE_ANALYTICS_ID,!pe.Z.isEnabled){e.next=5;break}if(!v){e.next=4;break}if(p=!0,!pe.Z.isInitialized){e.next=2;break}return e.next=1,_.Z.waitAll((i.surfaceId||[]).map(function(){var e=a()(d().mark(function e(t){var n,r,a,o,p,v,g,T,O;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),c.surfaces[t]={containers:[],failedContainers:[],surfaceAnalyticsData:{surfaceId:t}},u=Object.assign({},u,{"content.type":f.Z.analytics.GSDK}),o=pe.Z.createConsumer(i),y.log.context({params:i}).disk("[".concat(s,"] Requesting content from GSDK for ").concat(t," for consumer ").concat(JSON.stringify(o))),e.next=1,pe.Z.getCachedContentForConsumer(t,o).then(function(e){var t=L()(e,2),n=t[0],r=t[1];return n.length<1&&r.length<1&&(l=new A.Z(f.Z.analytics.GSDK_CACHED_CONTENT_FAILURE,"EMPTY_GSDK_CACHE",f.Z.analytics.GSDK_EMPTY_CACHED_CONTENT_ERROR).removeStack()),[n,r]}).catch(function(e){return l=new A.Z(f.Z.analytics.GSDK_CACHED_CONTENT_FAILURE,e.message||"NO_ERROR_MESSAGE",e.code||"NO_REQUEST_ERROR_MESSAGE").removeStack(),[[],[]]});case 1:p=e.sent,v=L()(p,2),g=v[0],T=v[1],g=g?y.filterAndSortGSDKContainers(g,t):g,T=T?y.filterAndSortGSDKContainers(T,t):T,h+=g.length,E+=T.length,null===(n=g)||void 0===n||n.forEach(function(e,n){var r,a,s,i,o,u,p,d,h,E,v,g={gsdkEnabledContent:!0,containerId:e.sortOrder,containerLabel:null===(r=e.container)||void 0===r?void 0:r.name,containerAnalyticsData:be({variationId:null===(a=e.monitoringData)||void 0===a?void 0:a["exp.variation_id"],actionBlockId:null===(s=e.monitoringData)||void 0===s?void 0:s["exp.action_block_id"],campaignId:m?0:null===(i=e.monitoringData)||void 0===i?void 0:i["exp.campaign_id"],containerId:null===(o=e.monitoringData)||void 0===o?void 0:o["exp.container_id"],controlGroupId:null===(u=e.monitoringData)||void 0===u?void 0:u["exp.control_group_id"],treatmentId:null===(p=e.monitoringData)||void 0===p?void 0:p["exp.treatment_id"],containerStatus:"".concat(e.status,"-").concat(null===(d=e.container)||void 0===d?void 0:d.name)},m&&{ajoCampaignid:null===(h=e.monitoringData)||void 0===h?void 0:h["exp.campaign_id"]}),gsdkStatus:e.status,gsdkContent:e},T=_.Z.validateDataFields(e,S);if(T)c.surfaces[t].failedContainers.push(Object.assign({},g,{errorMessage:JSON.stringify(null===(v=T[0])||void 0===v?void 0:v.stack),errorCode:f.Z.analytics.GSDK_SCHEMA_VALIDATION_ERROR}));else if(e.status===pe.Z.anonymousContentMarker)l=new A.Z(f.Z.analytics.GSDK_CACHED_CONTENT_FAILURE,"AnonymousContent","AnonymousContent").removeStack();else if(e.campaignState===pe.Z.noTargetingCampaignValue)c.surfaces[t].failedContainers.push(Object.assign({},g,{errorMessage:pe.Z.noTargetingCampaignValue,errorCode:30002}));else if(null!==(E=e.rootAssetMetadata[0])&&void 0!==E&&E.url)c.surfaces[t].containers.push(Object.assign({},g,{dataType:"URL",data:e.rootAssetMetadata[0].url}));else{var y;c.surfaces[t].failedContainers.push(Object.assign({},g,{errorMessage:"Missing URL field - (".concat(null===(y=e.rootAssetMetadata[0])||void 0===y?void 0:y.url,")"),errorCode:f.Z.analytics.GSDK_URL_MISSING_ERROR}))}}),null===(r=T)||void 0===r||r.forEach(function(e,n){if(e.syncStatus===pe.Z.syncingStatus)l=new A.Z(f.Z.analytics.GSDK_CACHED_CONTENT_FAILURE,"SyncingContent","SyncingContent").removeStack();else{var r,a,s,i,o,u,p,d,_,h,E,S,v="No Error Object in Failed Container",g=f.Z.analytics.GSDK_NO_ERROR_OBJECT_IN_FAILED_CONTAINER;e.error&&(v=e.error.message?"".concat(e.error.message):"No Error Message in Failed Container Error Object",null!==(h=e.error.underlyingError)&&void 0!==h&&h.type&&(v+="_".concat(e.error.underlyingError.type)),null!==(E=e.error.underlyingError)&&void 0!==E&&E.description&&(v+="_".concat(e.error.underlyingError.description)),g=e.error.code?f.Z.analytics.GSDK_ERROR_PREFIX+e.error.code+"_"+(null===(S=e.error.underlyingError)||void 0===S?void 0:S.code):f.Z.analytics.GSDK_NO_ERROR_CODE_IN_FAILED_CONTAINER),c.surfaces[t].failedContainers.push({gsdkEnabledContent:!0,containerId:e.sortOrder,containerLabel:null===(r=e.container)||void 0===r?void 0:r.name,errorMessage:v,errorCode:g,containerAnalyticsData:be({variationId:null===(a=e.monitoringData)||void 0===a?void 0:a["exp.variation_id"],actionBlockId:null===(s=e.monitoringData)||void 0===s?void 0:s["exp.action_block_id"],campaignId:m?0:null===(i=e.monitoringData)||void 0===i?void 0:i["exp.campaign_id"],containerId:null===(o=e.monitoringData)||void 0===o?void 0:o["exp.container_id"],controlGroupId:null===(u=e.monitoringData)||void 0===u?void 0:u["exp.control_group_id"],treatmentId:null===(p=e.monitoringData)||void 0===p?void 0:p["exp.treatment_id"],containerStatus:"".concat(e.syncStatus,"-").concat(null===(d=e.container)||void 0===d?void 0:d.name)},m&&{ajoCampaignid:null===(_=e.monitoringData)||void 0===_?void 0:_["exp.campaign_id"]}),gsdkStatus:e.syncStatus,gsdkContent:e})}}),c.surfaces[t].containers.length<1&&delete c.surfaces[t].containers,c.surfaces[t].failedContainers.length<1&&delete c.surfaces[t].failedContainers,O=Date.now()-a,y.log.context({diskParams:{time:O}}).disk("[".concat(s,"] Finished ").concat(t," in ").concat(O,"ms"));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:e.next=3;break;case 2:l=new A.Z("GSDK not initialized","Cannot get cached content",f.Z.analytics.GSDK_CACHED_CONTENT_FAILURE).removeStack();case 3:e.next=4;break;case 4:e.next=5;break;case 5:return e.abrupt("return",{response:c,analytics:Object.assign({},u,{"content.size":"".concat(h,":").concat(E)}),error:l,usedGSDK:p});case 6:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)})},{key:"downloadCollectionDataRaw",value:(o=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h,S,v,g=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=t.priority,s=t.id,i=void 0===s?T.v4():s,o=t.skipAuth,c=void 0!==o&&o,void 0===(u=t.skipApiCall)||!u){e.next=1;break}return(l=new Date).setDate(l.getDate()+f.Z.get("GSDK_DEFAULT_EXPIRY_TIME",this.type)),this.log.disk("Skipping api call to Sophia, for product ".concat(n.productCode,"[").concat(n.productVersion,"]")+(n.productLanguage?"[".concat(n.productLanguage,"]"):"")),e.abrupt("return",{expirationDTS:l.toISOString(),surfaces:{}});case 1:return e.next=2,this.url(n);case 2:return p=e.sent,e.next=3,this.log.context({params:n,analytics:!1}).time(function(){var e=a()(d().mark(function e(t){var n,a,s,o,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={"content-type":"application/json","X-API-Key":f.Z.getEnvironment().CLIENT_ID},c||(n["x-gw-ims-user-id"]=E.Z.getUserId()),e.next=1,g.get({url:p,options:{method:"GET",timeout:f.Z.get("SERVER_TIMEOUT"),headers:n},priority:r,auth:!c,id:i});case 1:return a=e.sent,s=a.response,o=a.time,t.appendPayload({"event.value":o,"event.url":p,"env.svc.name":f.Z.get("ANALYTICS_SUBCATEGORY",g.type)}),u=Date.now(),e.next=2,g.getResponseJson(s,p);case 2:return l=e.sent,o+=Date.now()-u,e.abrupt("return",l);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:if(h=e.sent,S=f.Z.get("SOPHIA_RESPONSE_SCHEMA"),!(v=_.Z.validateDataFields(h,S))){e.next=4;break}throw new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,v);case 4:return h.analyticsData&&(h.analyticsData.requestId=i),h=this.postProcessContent(h,n),e.abrupt("return",h);case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"load",value:(s=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,(0,re.load)(t);case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})},{key:"resume",value:(r=a()(d().mark(function e(t){var n,r,s,i,o,c=this,u=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=u.length>1&&void 0!==u[1]?u[1]:{}).url,s=n.priority,i=n.id,o=void 0===i?T.v4():i,!k.Z.isWaitingForBackOff(k.E.NETWORK)){e.next=1;break}throw this.log.disk("Waiting for global back-off ".concat(k.Z.backOffCause(k.E.NETWORK)," expiring ").concat(k.Z.backOffExpiry(k.E.NETWORK))),new Error("Waiting for global back-off ".concat(k.Z.backOffCause(k.E.NETWORK)));case 1:if(Q.Z.status!==Q.Z.OFFLINE){e.next=2;break}throw new Error("Cannot get ".concat(r," - Offline"));case 2:return e.next=3,this._requestLock.read(a()(d().mark(function e(){var a,i,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c.log.disk("[".concat(o,"] Resuming ").concat(r," - Priority(").concat(s&&s.toString()||0,")")),a=Date.now(),i=new D.URL(r||t.url).origin,u=n.options||{},e.next=1,F.Z.getNodeTunnelOptionsForURL(i);case 1:return u.agent=e.sent.agent,e.next=2,t.resume(r,u);case 2:return l=Date.now()-a,c.log.disk("[".concat(o,"] Finished.")),e.abrupt("return",l);case 3:case"end":return e.stop()}},e)})),s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"get",value:(n=a()(d().mark(function e(){var t,n,r,s,i,o,c,u,l,p,h=this,S=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=S.length>0&&void 0!==S[0]?S[0]:{url:""}).url,r=t.options,s=void 0===r?{}:r,i=t.auth,o=void 0!==i&&i,c=t.id,u=void 0===c?T.v4():c,l=t.priority,!k.Z.isWaitingForBackOff(k.E.NETWORK)){e.next=1;break}throw this.log.disk("Waiting for global back-off ".concat(k.Z.backOffCause(k.E.NETWORK)," expiring ").concat(k.Z.backOffExpiry(k.E.NETWORK))),new Error("Waiting for global back-off ".concat(k.Z.backOffCause(k.E.NETWORK)));case 1:if(Q.Z.status!==Q.Z.OFFLINE){e.next=2;break}throw new Error("Cannot get ".concat(n," - Offline"));case 2:return s.headers=s.headers||{},s.headers["X-Request-Id"]=u,s.headers["user-agent"]="Adobe CCXProcess-".concat(_.Z.getProcessVersion(),"/").concat(process.platform,"-").concat(_.Z.getOsVersion(),"-").concat(process.arch),s.parallel=Object.assign({minimumPartialSize:f.Z.get("NETWORK_MINIMUM_PARTIAL_SIZE"),maxSockets:f.Z.get("NETWORK_MAX_SOCKETS"),maxLatency:f.Z.get("NETWORK_MAX_LATENCY"),maxLatencyRetries:f.Z.get("NETWORK_MAX_LATENCY_RETRIES"),exitOnLatency:!1},s.parallel||{}),s.timeout=s.timeout||f.Z.get("ASSET_DOWNLOAD_TIMEOUT",this.type),p=this.log.context({diskParams:{id:u,priority:null==l?void 0:l.toString(),auth:!!o,url:n}}),e.next=3,this._requestLock.read(a()(d().mark(function e(){var t,r,i,c,_,S,v,g,T,m,y,O;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Date.now(),r=new D.URL(n).origin,!(O=o)){e.next=2;break}return e.next=1,E.Z.getAccessToken().catch(function(e){return h.log.disk("Error getting access token - ".concat(e)),!1});case 1:O=e.sent;case 2:if(i=O,c=!1,!o||i){e.next=3;break}if(!k.Z.isWaitingForBackOff(k.E.AUTH)||!f.Z.get("ANONYMOUS_RETRY_DISABLED",h.type)){e.next=3;break}throw h.log.disk("Waiting for global back-off ".concat(k.Z.backOffCause(k.E.AUTH)," expiring ").concat(k.Z.backOffExpiry(k.E.AUTH))),new Error("Waiting for global back-off ".concat(k.Z.backOffCause(k.E.AUTH)));case 3:return o&&i&&(s.headers.Authorization="Bearer ".concat(i),c=!0),s.headers.Connection="keep-alive",e.next=4,F.Z.getNodeTunnelOptionsForURL(r);case 4:return s.agent=e.sent.agent,p.disk("[".concat(u,"] Requesting ").concat(c?"with Auth Headers":"without Auth Headers"," ").concat(n," - Priority(").concat(l&&l.toString()||0,")")),e.next=5,ae()(n,s).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("aborted"===t.type&&(t=new A.Z("aborted",t,"ABORT_ERROR")),"system"!==t.type||"ENOTFOUND"!==t.code&&"EADDRNOTAVAIL"!==t.code){e.next=3;break}return e.next=1,k.Z.updateBackOff({cause:"Offline[Network-"+t.code+"]",type:k.E.NETWORK});case 1:return e.next=2,Q.Z.check(Q.S.DOWNLOAD_FETCH_ERROR);case 2:throw new A.Z("Offline[Network]",new Error("Offline-Download"),t.code).setPayload({"event.url":n});case 3:if("system"!==t.type||"PROXY"!==t.code){e.next=4;break}return e.next=4,k.Z.updateBackOff({cause:t.message,type:k.E.NETWORK});case 4:throw t;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:if((_=e.sent).ok||304===_.status){e.next=8;break}return e.next=6,_.text();case 6:if(S=e.sent,v=0,401!==_.status){e.next=7;break}return e.next=7,k.Z.updateBackOff({cause:"Server Error[".concat(_.status,"]"),type:k.E.AUTH});case 7:try{T=JSON.parse(S),v=null!==(g=null==T?void 0:T.error_code)&&void 0!==g?g:0}catch(e){}throw(m=new A.Z(f.Z.analytics.st_NETWORK,"Failed to get ".concat(n," with status code ").concat(_.status).concat(404===_.status?"":" - "+S),0!=v?v:_.status).setPayload({"event.url":n})).setResponseHeaders(_.headers),m;case 8:return e.next=9,k.Z.updateBackOff({clear:!0,type:k.E.NETWORK});case 9:return y=Date.now()-t,p.context({diskParams:{time:y}}).disk("[".concat(u,"] Finished ").concat(y,"ms with status ").concat(_.status)),e.abrupt("return",{response:_,time:y});case 10:case"end":return e.stop()}},e)})),l).catch(function(e){throw p.disk("[".concat(u,"] Failed - ").concat(e)),e});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"getResponseJson",value:(e=a()(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.json().catch(function(){var e=a()(d().mark(function e(r){var a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new A.Z(f.Z.analytics.INVALID_JSON,r),s=n,e.next=1,t.text();case 1:throw i=e.sent.length,o={"event.url":s,"event.value":i},a.setPayload.call(a,o);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(t,n){return e.apply(this,arguments)})},{key:"appendUrlSearchParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(n){Array.isArray(t[n])?t[n].forEach(function(t){e.append(n,t||"")}):e.append(n,t[n]||"")};for(var r in t)n(r)}}]);var e,n,r,s,o,u,p}();function Ue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ue=function(){return!!e})()}function Me(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}l()(we,"requestLock",void 0);var Ze=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,Ue()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"postProcessContent",value:function(e,n){return e.ccxVersion=n.ccxVersion,Me(t,"postProcessContent",this,3)([e,n])}},{key:"applyResponseAnalytics",value:function(e,n,r,a){return e.appendPayload({"content.size":Object.keys(n.surfaces||{}).length}),Me(t,"applyResponseAnalytics",this,3)([e,n,r,a])}}])}(we);function Fe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Fe=function(){return!!e})()}function Ge(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var Ve=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[De],r=B()(r),(e=H()(n,Fe()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new Ze(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new Le(e,this)}},{key:"isRequestPoisoned",value:function(e){var t=f.Z.get("SUPPORTED_PRODUCTS",this.type);return!e.productCode||!t[e.productCode]||(!!(e.productCode&&t[e.productCode]&&_.Z.compareMajorMinorVersions(t[e.productCode],e.productVersion,this.patchEnabledClient(e))<0)||!!(_.Z.isWindows()&&_.Z.compareMajorMinorVersions(f.Z.get("EARLIEST_SUPPORTED_WINDOWS_VERSION_UXP"),_.Z.getOsVersion(),this.patchEnabledClient(e))<0&&f.Z.get("UNSUPPORTED_WINDOWS_UXP_APPS").includes(e.productCode)))}},{key:"updateParams",value:(n=a()(d().mark(function e(n){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Ge(t,"updateParams",this,3)([n]);case 1:return(r=e.sent).forEach(function(e){var t=a.getClientVersion(e);e.ccxVersion=e.ccxVersion||f.Z.get(t,a.type).START_VERSION,e.surfaceId=f.Z.get(t,a.type).SURFACES}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n}(ge);function He(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(He=function(){return!!e})()}var Ke=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,He()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"getReferencedTutorialsOrPlaylists",value:(r=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},t.tutorials?null===(r=t.tutorials)||void 0===r||r.forEach(function(e){if(e&&e.metadata&&e.metadata.images){var t=e.metadata.images;t.heroPath&&(n[t.heroPath]=!0),t.thumbnailPath&&(n[t.thumbnailPath]=!0)}}):t.playlists&&(null===(a=t.playlists)||void 0===a||a.forEach(function(e){if(e&&e.images){var t=e.images;t.heroPath&&(n[t.heroPath]=!0),t.thumbnailPath&&(n[t.thumbnailPath]=!0)}})),e.abrupt("return",n);case 1:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"getReferencedAssets",value:(n=a()(d().mark(function e(){var t,n,r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},n=["PES_ATLAS","PES_BROWSE_LEARN","PES_WHATS_NEW","GHOST_PES_ATLAS","GHOST_PES_BROWSE_LEARN","GHOST_PES_WHATS_NEW"],e.next=1,_.Z.waitAll(Object.keys(this._data.surfaces||{}).map(function(){var e=a()(d().mark(function e(s){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,_.Z.waitAll((r._data.surfaces[s].containers||[]).map(function(){var e=a()(d().mark(function e(i){var o,c,u,l,p,h,E,g,T,m;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i.path&&(t[i.path]=!0),i.containerLabel!==f.Z.get("USER_INTENT_DIALOG")){e.next=3;break}return p=Object,h=t,e.next=1,r.dataManager.getReferencedAssets(s,i,r._lookupMap);case 1:return E=e.sent,p.assign.call(p,h,E),e.next=2,_.Z.waitAll((null===(l=i.content)||void 0===l||null===(l=l.data)||void 0===l||null===(l=l.userintentByPath)||void 0===l||null===(l=l.item)||void 0===l||null===(l=l.pages)||void 0===l||null===(l=l.recommendations)||void 0===l||null===(l=l.items)||void 0===l?void 0:l.map(function(){var e=a()(d().mark(function e(n){var a,s,i,o,c,u;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.path){e.next=3;break}return(a={})[n.path]=!0,e.next=1,S.readJson(r.assetsDir+"/"+v.basename(n.path)).catch(function(e){return delete a[n.path],{}});case 1:return s=e.sent,i=Object,o=t,c=a,e.next=2,r.getReferencedTutorialsOrPlaylists(s);case 2:u=e.sent,i.assign.call(i,o,c,u);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()))||[]);case 2:e.next=11;break;case 3:if(!Array.isArray(null===(o=i.content)||void 0===o?void 0:o.tutorials)){e.next=5;break}return e.next=4,_.Z.waitAll(i.content.tutorials.map(function(){var e=a()(d().mark(function e(n){var r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n&&n.metadata&&n.metadata.images&&(r=n.metadata.images).heroPath&&(t[r.heroPath]=!0);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 4:e.next=11;break;case 5:if(!Array.isArray(null===(c=i.content)||void 0===c?void 0:c.playlists)){e.next=7;break}return e.next=6,_.Z.waitAll(i.content.playlists.map(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,_.Z.waitAll(Object.values(n.tutorial_paths||{}).map(function(){var e=a()(d().mark(function e(n){var a,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object,s=t,e.next=1,r._lookupMap.getTutorialAssets(n);case 1:i=e.sent,a.assign.call(a,s,i);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 6:e.next=11;break;case 7:if(!Array.isArray(null===(u=i.content)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.recommendations)){e.next=9;break}return e.next=8,_.Z.waitAll(i.content.data.recommendations.map(function(){var e=a()(d().mark(function e(n){var s,i,o,c,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=Object,u=t,e.next=1,r._lookupMap.getTutorialAssets(null===(s=n.content)||void 0===s?void 0:s.path);case 1:l=e.sent,c.assign.call(c,u,l),"quickAction"===(null===(i=n.content)||void 0===i?void 0:i.type)&&null!==(o=n.content)&&void 0!==o&&o.assetPaths&&_.Z.waitAll(Object.keys(n.content.assetPaths).map(function(){var e=a()(d().mark(function e(r){var a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(a=n.content.assetPaths[r])&&(t[a]=!0);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 8:e.next=11;break;case 9:if(!n.includes(s)){e.next=11;break}return t[i.path]=!0,g=Object,T=t,e.next=10,r.dataManager.getReferencedAssets(s,i,r._lookupMap);case 10:m=e.sent,g.assign.call(g,T,m);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:return e.abrupt("return",t);case 2:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]);var n,r}(Le);function Be(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Be=function(){return!!e})()}function je(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var We=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,Be()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"url",value:(n=a()(d().mark(function e(n){var r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.Z.compareMajorMinorVersions(f.Z.get("SUPPORTED_LEARN_THIRD_PARTY_START_MIN_VERSION"),n.ccxVersion||"")>-1,e.abrupt("return",je(t,"url",this,3)([Object.assign(n,{allowThirdPartyContent:r.toString()})]));case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"postProcessContent",value:function(e,n){for(var r in e.ccxVersion=n.ccxVersion,e.surfaces)Array.isArray(e.surfaces[r].containers)&&e.surfaces[r].containers.forEach(function(e,t){e.data&&"application/json"===e.dataType&&(e.content=JSON.parse(e.data))});return je(t,"postProcessContent",this,3)([e,n])}},{key:"numberOfTutorials",value:function(e){var t=0,n=0,r=0;return Object.keys(e.surfaces||{}).forEach(function(a){var s;((null===(s=e.surfaces)||void 0===s?void 0:s[a].containers)||[]).forEach(function(e){var a,s,i;null!==(a=e.content)&&void 0!==a&&a.tutorials&&(null!==(i=e.content.tutorials[0])&&void 0!==i&&i.metadata&&e.content.tutorials[0].metadata.platforms&&(e.content.tutorials[0].metadata.platforms.includes("in-app")?n=e.content.tutorials.length:t=e.content.tutorials.length));r=(null===(s=e.content)||void 0===s||null===(s=s.playlists)||void 0===s?void 0:s.length)||0})}),{web:t,app:n,ututs:r}}},{key:"applyResponseAnalytics",value:function(e,n,r,a){var s=this.numberOfTutorials(n);return e.appendPayload({"content.size":"".concat(s.web,":").concat(s.app,":").concat(s.ututs)}),je(t,"applyResponseAnalytics",this,3)([e,n,r,a])}}]);var n}(we);const Ye={AJO_SUPPORTED:!0,ANALYTICS_SUBCATEGORY:"Learn",LOOKUP_COLLECTION_FILE_VERSION:3,LOOKUP_MAP_FILE_VERSION:2,LOG_PREFIX:"Learn",SUPPORTED_PRODUCTS:{AEFT:"24.0",AEFTBETA:"24.0",IDSN:"18.0",IDSNBETA:"18.0",IDSNPR:"18.0",ILST:"26.0",ILSTPR:"26.0",ILSTBETA:"26.0",PHXS:"25.0",PHSP:"25.0",PHSPPR:"25.0",PHSPBETA:"25.0",PPRO:"24.0",PPROBETA:"24.0"},UNSUPPORTED_AFTER_VERSION:{},PARAMETERS_SCHEMA:{id:"learn_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},SURFACE_PRIORITY:{"CCX_Start_3.1_Tutorials":100,LCM_LEARN_PANEL:100,PES_ATLAS:100,PES_BROWSE_LEARN:100,PES_WHATS_NEW:100},GC_ASSET_INFO:{EXCLUDE_GC_PATHS:["heroPath","thumbnailPath","playlistPath","tutorialPath","templatePath"],EXCLUDE_GC_MAP:["_assetPaths","_references"],PROCESS_JSON:["playlistPath","tutorialPath"]},FILE_ACCESSOR_WRITE_ENABLED:!0,CONTENT_PROCESSING_SUMMARY:"ContentProcessingSummary.json",PREFETCH_TEMPLATE_LIMIT:10,LABEL:"LEARN",VULCAN_TYPE:"Tutorial",DIR:"learn/",NON_IDEMPOTENT_IMAGES:!0,PRIORITY_CHANNEL:x.NU.Learn,ANONYMOUS_RETRY_DISABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!0,LCM_SUPPORTED_PRODUCTS:{PHXS:"25.0",PHSPBETA:"25.0",PHSPPR:"25.0",PHSP:"25.0",ILST:"26.0",ILSTBETA:"26.0",ILSTPR:"26.0",PPRO:"25.6",PPROBETA:"25.6"},UTUTS_SURFACE:"LCM_LEARN_PANEL",UTUTS_API_REQUEST_SURFACE:"in_app_panel:v2",SUPPORTS_ON_DEMAND:!0,SOPHIA_VERBOSE_FLAG_ENABLED:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,QUICK_ACTIONS_PREFETCH_DENY_LIST:["sampleFile"],ACTIVE_VERSIONS:["V4_0","V5_0","V6_0"],V4_0:{VERSION_LESS_THAN:"6.8",START_VERSION:"6.7.0.44",PREFETCH_CLIENTS:{AEFT:"99.0",AEFTBETA:"99.0",ILST:"28.1",ILSTBETA:"28.1",ILSTPR:"28.1",IDSN:"19.2",IDSNBETA:"19.2",IDSNPR:"19.2",PPRO:"25.2",PPROBETA:"25.2"},PRODUCT_ALIASES:{PPROBETA:"PPRO",AEFTBETA:"AEFT",IDSNBETA:"IDSN",IDSNPR:"IDSN",ILSTBETA:"ILST",ILSTPR:"ILST"},SURFACES:["CCX_Start_3.1_Tutorials"],UTUTS_SURFACES:["CCX_Start_3.1_Tutorials","LCM_LEARN_PANEL"]},V5_0:{VERSION_LESS_THAN:"7.4",START_VERSION:"7.3.0.57",PREFETCH_CLIENTS:{PHXS:"25.8",PHSP:"25.8",PHSPBETA:"25.8",PHSPPR:"25.8",ILST:"99.0",ILSTBETA:"99.0",ILSTPR:"99.0",IDSN:"99.0",IDSNBETA:"99.0",IDSNPR:"99.0"},PRODUCT_ALIASES:{PHSP:"PHXS"},SURFACES:["CCX_Start_3.1_Tutorials"],UTUTS_SURFACES:["CCX_Start_3.1_Tutorials","LCM_LEARN_PANEL"]},V6_0:{VERSION_LESS_THAN:"99.99",START_VERSION:"10.4.1.2",PREFETCH_CLIENTS:{PHXS:"99.0",PHSP:"99.0",PHSPBETA:"99.0",PHSPPR:"99.0",PPRO:"99.0",PPROBETA:"99.0"},PRODUCT_ALIASES:{PHSP:"PHXS"},SURFACES:["PES_ATLAS","PES_BROWSE_LEARN","PES_WHATS_NEW","CCX_Start_3.1_Tutorials"],UTUTS_SURFACES:["PES_ATLAS","PES_BROWSE_LEARN","PES_WHATS_NEW","CCX_Start_3.1_Tutorials","LCM_LEARN_PANEL"]},LEARN_DATA_SCHEMA:{id:"/LEARN_CARD_DATA",type:"object",properties:{tutorials:{type:"array",items:{type:"object",properties:{metadata:{type:"object",properties:{images:{type:"object",properties:{hero:{type:"string"},thumbnail:{type:"string"}}}}}}}}}},SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","en_AE","en_GB","en_IL","es_ES","es_MX","fi_FI","fr_FR","fr_CA","fr_MA","hu_HU","id_ID","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","th_TH","tr_TR","uk_UA","vi_VN","zh_CN","zh_TW"],IGNORE_PERF_EVENTS_FOR_SURFACES:["PES_ATLAS","PES_BROWSE_LEARN","PES_WHATS_NEW","CCX_Start_3.1_Tutorials","LCM_LEARN_PANEL"],GSDK_DEFAULT_EXPIRY_TIME:2};function Xe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Xe=function(){return!!e})()}function qe(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var Je=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[Ye],r=B()(r),(e=H()(n,Xe()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new We(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new Ke(e,this)}},{key:"isRequestPoisoned",value:function(e){var t=f.Z.get("SUPPORTED_PRODUCTS",this.type)||{};return!e.productCode||!t[e.productCode]||(!!(e.productCode&&t[e.productCode]&&_.Z.compareMajorMinorVersions(t[e.productCode],e.productVersion,this.patchEnabledClient(e))<0)||!!(_.Z.isWindows()&&_.Z.compareMajorMinorVersions(f.Z.get("EARLIEST_SUPPORTED_WINDOWS_VERSION_UXP"),_.Z.getOsVersion(),this.patchEnabledClient(e))<0&&f.Z.get("UNSUPPORTED_WINDOWS_UXP_APPS").includes(e.productCode)))}},{key:"updateParams",value:(o=a()(d().mark(function e(n){var r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,qe(t,"updateParams",this,3)([n]);case 1:return e.abrupt("return",e.sent.map(function(e){var t=r.getClientVersion(e);e.ccxVersion=e.ccxVersion||f.Z.get(t,r.type).START_VERSION;var n=f.Z.get("LCM_SUPPORTED_PRODUCTS",r.type)[e.productCode];return e.surfaceId=n&&_.Z.compareMajorMinorVersions(e.productVersion,n)<=0?f.Z.get(t,r.type).UTUTS_SURFACES:f.Z.get(t,r.type).SURFACES,e}));case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"_fetchOnDemandContent",value:(s=a()(d().mark(function e(n){var r,a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.params,a=n.force,s=n.priority,!r.url){e.next=2;break}return e.next=1,qe(t,"_fetchOnDemandContent",this,3)([n]);case 1:return e.abrupt("return",e.sent);case 2:if(r.id){e.next=3;break}throw new A.Z(f.Z.analytics.DATA_VALIDATION_ERR,"Cannot add on demand model without id");case 3:return e.next=4,Z.downloadTutorial({id:r.id,priority:s,params:r,force:a,analyticsData:{"content.id":r.id},filePrefix:"LCM",status:r.status||"live",ututMetaLocale:r.productLanguage,map:this});case 4:if(i=e.sent,o=i.path){e.next=5;break}throw new A.Z("FETCH","No path downloaded from AEM");case 5:return e.abrupt("return",o);case 6:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"_getOnDemandLookupKeys",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=null===(t=e.productVersion)||void 0===t?void 0:t.split(".")[0],a=[n||E.Z.getUserId()];return a.push(e.productCode,r,e.productLanguage),a}},{key:"getOnDemandAssetPath",value:function(e){var t,n,r=e.id,a=void 0===r?"":r,s=e.productLanguage,i=e.status,o=e.productVersion,c=e.productSemver;return e.url?null===(t=this._data)||void 0===t||null===(t=t.assetMetadata)||void 0===t||null===(t=t[e.url])||void 0===t?void 0:t.path:null===(n=this._data)||void 0===n||null===(n=n.assetMetadata)||void 0===n||null===(n=n[Z.getTutorialUrl({id:a,productLanguage:s,status:i,productVersion:o,productSemver:c,surface:f.Z.get("UTUTS_API_REQUEST_SURFACE",this.type)})])||void 0===n?void 0:n.path}},{key:"_getOnDemandAssetList",value:(r=a()(d().mark(function e(){var t,n,r,a,s,i,o,c,u,l,p;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=Object.values((null===(t=this._data)||void 0===t?void 0:t.onDemandMetadata)||{}),a=0,s=r;case 1:if(!(a<s.length)){e.next=5;break}if(!(i=s[a]).params.id){e.next=3;break}return u=Object,l=n,e.next=2,this.getTutorialAssets(null===(o=this._data)||void 0===o||null===(o=o.assetMetadata[Z.getTutorialUrl({id:i.params.id||"",productLanguage:i.params.productLanguage,status:i.params.status,productVersion:i.params.productVersion,productSemver:i.params.productSemver,surface:f.Z.get("UTUTS_API_REQUEST_SURFACE",this.type)})])||void 0===o?void 0:o.path);case 2:p=e.sent,u.assign.call(u,l,p),e.next=4;break;case 3:n[(null===(c=this._data)||void 0===c||null===(c=c.assetMetadata[i.params.url||""])||void 0===c?void 0:c.path)||""]=!0;case 4:a++,e.next=1;break;case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getTutorialAssets",value:(n=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",{});case 1:return(r={})[t]=!0,e.next=2,S.readJson("".concat(this.getPath(),"/").concat(t)).catch(function(){return{}});case 2:return null==(a=e.sent)||null===(n=a.tutorials)||void 0===n||n.forEach(function(e){var t,n;null!==(t=e.metadata)&&void 0!==t&&null!==(t=t.images)&&void 0!==t&&t.heroPath&&(r[e.metadata.images.heroPath]=!0),null!==(n=e.metadata)&&void 0!==n&&null!==(n=n.images)&&void 0!==n&&n.thumbnailPath&&(r[e.metadata.images.thumbnailPath]=!0)}),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r,s,o}(ge);const Qe={AJO_SUPPORTED:!1,LABEL:"CCD",ANALYTICS_SUBCATEGORY:"CCD",VULCAN_TYPE:"CCD_UNSUPPORTED",LOG_PREFIX:"CCD",LOOKUP_MAP_FILE_VERSION:3,LOOKUP_COLLECTION_FILE_VERSION:1,SUPPORTED_PRODUCTS:{ACCC:"99.99",KCCC:"99.99"},UNSUPPORTED_AFTER_VERSION:{},ACTIVE_VERSIONS:["V1"],V1:{PRODUCT_ALIASES:{KCCC:"ACCC"},SURFACES:["CCD_ALL_APPS_BANNERS","CCD_APPS_CATALOG","CCD_APP_SKELETON","CCD_PMP","CCD_USER_FEEDBACK","CCD_HOME_SKELETON","CCD_FRAMEWORK","CCD_QUICK_ACTIONS","payment_notification_banner","CCD_APPS_SKELETON","CCD_APPS_CUSTOM_CARDS","CCD_GENESIS","CCD_FFE"]},FILE_ACCESSOR_WRITE_ENABLED:!1,DIR:"ccd/",PRIORITY_CHANNEL:x.NU.CcdPrimary,SURFACE_PRIORITY:{payment_notification_banner:0,CCD_PMP:0,CCD_USER_FEEDBACK:200,CCD_FRAMEWORK:200,CCD_QUICK_ACTIONS:300,CCD_APPS_CATALOG:300,CCD_ALL_APPS_BANNERS:500,CCD_APP_SKELETON:600,CCD_APPS_SKELETON:600,CCD_HOME_SKELETON:600,CCD_APPS_CUSTOM_CARDS:600,CCD_GENESIS:600,CCD_FFE:600},AEM_SURFACES:["CCD_ALL_APPS_BANNERS","CCD_APPS_CATALOG","CCD_APP_SKELETON","CCD_PMP","CCD_USER_FEEDBACK","CCD_HOME_SKELETON","CCD_FRAMEWORK","CCD_QUICK_ACTIONS","payment_notification_banner","CCD_APPS_SKELETON","CCD_APPS_CUSTOM_CARDS","CCD_GENESIS","CCD_FFE"],SECONDARY_SURFACES:["CCD_ALL_APPS_BANNERS","CCD_HOME_SKELETON","CCD_QUICK_ACTIONS"],TERTIARY_SURFACES:["CCD_APPS_CATALOG"],QUARTERNARY_SURFACES:["CCD_USER_FEEDBACK","CCD_PMP","payment_notification_banner"],SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","es_ES","es_MX","fi_FI","fr_FR","fr_CA","hu_HU","id_ID","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","th_TH","tr_TR","uk_UA","vi_VN","zh_CN","zh_TW"],ANONYMOUS_RETRY_DISABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!0,SOPHIA_VERBOSE_FLAG_ENABLED:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,IGNORE_PERF_EVENTS_FOR_SURFACES:["CCD_ALL_APPS_BANNERS","CCD_APPS_CATALOG","CCD_APP_SKELETON","CCD_PMP","CCD_USER_FEEDBACK","CCD_HOME_SKELETON","CCD_FRAMEWORK","CCD_QUICK_ACTIONS","payment_notification_banner","CCD_APPS_SKELETON","CCD_APPS_CUSTOM_CARDS","CCD_GENESIS","CCD_FFE"],IGNORED_FILES_REGEXP:"\\bassets|api|client_settings\\b"};function ze(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ze=function(){return!!e})()}function $e(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var et=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,ze()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"url",value:(r=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$e(t,"url",this,3)([Object.assign(n,{comLocale:n.comLocale||(n.productLanguage?n.productLanguage.substring(0,2):"en"),comCustomerUi:n.comCustomerUi||"cc_desktop"})]));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"downloadCollectionDataRaw",value:(n=a()(d().mark(function e(n){var r,a,s,i,o,c,u,l,p;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.params,a=n.priority,s=n.id,i=void 0===s?T.v4():s,o=n.skipAuth,c=void 0!==o&&o,u=n.skipApiCall,l=void 0!==u&&u,!f.Z.get("TEMP_CCD_CONTENT_DOWNLOAD_DISABLED")){e.next=1;break}return(p=new Date).setDate(p.getDate()+14),e.abrupt("return",{expirationDTS:p.toISOString(),surfaces:{}});case 1:return e.abrupt("return",$e(t,"downloadCollectionDataRaw",this,3)([{params:r,priority:a,id:i,skipAuth:c,skipApiCall:l}]));case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}(we);function tt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tt=function(){return!!e})()}var nt=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,tt()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"getPriorityChannel",value:function(e,t){return f.Z.get("SECONDARY_SURFACES",this._lookupMap.type).includes(e)&&(t.channel=x.NU.CcdSecondary),f.Z.get("TERTIARY_SURFACES",this._lookupMap.type).includes(e)&&(t.channel=x.NU.CcdTertiary),f.Z.get("QUARTERNARY_SURFACES",this._lookupMap.type).includes(e)&&(t.channel=x.NU.CcdQuarternary),t}}])}(Le);function rt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(rt=function(){return!!e})()}function at(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var st=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[Qe],r=B()(r),(e=H()(n,rt()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new et(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new nt(e,this)}},{key:"_getLookupKeys",value:function(e,t){var n=[t||E.Z.getUserId()];return n.push(e.productLanguage),n}},{key:"validateParams",value:function(e){}},{key:"uninstall",value:(r=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"isRequestPoisoned",value:function(e){return!0}},{key:"generateId",value:function(e){return[e.filePrefix,e.productLanguage,T.v4()].filter(function(e){return!!e}).join("-").trim()}},{key:"updateParams",value:(n=a()(d().mark(function e(n){var r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,at(t,"updateParams",this,3)([n]);case 1:return e.abrupt("return",e.sent.map(function(e){var t=e.comLocale||(e.productLanguage?e.productLanguage.substring(0,2):"en"),n=e.comCustomerUi||"cc_desktop",a=Object.assign({productCode:e.productCode||"ACCC"},{comLocale:t,comCustomerUi:n},e);return a.surfaceId=f.Z.get(r.getClientVersion(e),r.type).SURFACES,a}));case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"sanitizeParams",value:function(e){return e.productLanguage=_.Z.sanitizeLocale(e.productLanguage,f.Z.get("SUPPORTED_LOCALES",this.type)),e}},{key:"targetDetails",value:function(e){return{productCode:"ACCC"}}},{key:"isValidDataForParams",value:function(e){var t=e.id,n=e.params,r=this._data.metadata[t];return!(r&&r.params&&r.params.countryCode&&n.countryCode&&r.params.countryCode!==n.countryCode)}}]);var n,r}(ge);const it={AJO_SUPPORTED:!0,LABEL:"DISCOVER_PANEL",ANALYTICS_SUBCATEGORY:"DiscoverPanel",VULCAN_TYPE:"DiscoverPanel",LOG_PREFIX:"DiscoverPanel",LOOKUP_MAP_FILE_VERSION:1,LOOKUP_COLLECTION_FILE_VERSION:1,ACTIVE_VERSIONS:["V2","V3","V4"],DIR:"discover_panel/",FILE_ACCESSOR_WRITE_ENABLED:!0,SUPPORTED_PRODUCTS:{PHXS:"25.0",PHSP:"25.0",PHSPPR:"25.0",PHSPBETA:"25.0",ILST:"26.0",ILSTPR:"26.0",ILSTBETA:"26.0",PPRO:"25.6",PPROBETA:"25.6"},UNSUPPORTED_AFTER_VERSION:{},PARAMETERS_SCHEMA:{id:"discover_panel_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},V2:{SURFACES:["Discover_Panel","DP_Tool_Techniques_v1"],PREFETCH_CLIENTS:{ILST:"27.2",ILSTPR:"27.2",ILSTBETA:"27.2"},PRODUCT_ALIASES:{ILSTPR:"ILST",ILSTBETA:"ILST"}},V3:{SURFACES:["Discover_Panel","DP_Tool_Techniques_v1","in_app_contextual_notifications"],PREFETCH_CLIENTS:{ILST:"28.1",ILSTBETA:"28.1",ILSTPR:"28.1"},PRODUCT_ALIASES:{ILSTPR:"ILST",ILSTBETA:"ILST"}},V4:{SURFACES:["Discover_Panel","DP_Tool_Techniques_v1","in_app_contextual_notifications"],PREFETCH_CLIENTS:{PHXS:"99.9",PHSP:"99.9",PHSPPR:"99.9",PHSPBETA:"99.9",ILST:"99.9",ILSTPR:"99.9",ILSTBETA:"99.9",PPRO:"99.9",PPROBETA:"99.9"},PRODUCT_ALIASES:{PHSP:"PHXS"}},SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","en_AE","en_GB","en_IL","es_ES","es_MX","fi_FI","fr_FR","fr_CA","fr_MA","hu_HU","id_ID","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","th_TH","tr_TR","uk_UA","vi_VN","zh_CN","zh_TW"],PRIORITY_CHANNEL:x.NU.DiscoverPanel,NON_IDEMPOTENT_IMAGES:!0,SURFACE_PRIORITY:{Discover_Panel:100,DP_Tool_Techniques_v1:100,in_app_contextual_notifications:100},ANONYMOUS_RETRY_DISABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!1,SOPHIA_VERBOSE_FLAG_ENABLED:!0,UTUTS_API_REQUEST_SURFACE:"help_json",SUPPORTS_ON_DEMAND:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,IGNORE_PERF_EVENTS_FOR_SURFACES:["Discover_Panel","DP_Tool_Techniques_v1","in_app_contextual_notifications"],GSDK_DEFAULT_EXPIRY_TIME:2};function ot(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ot=function(){return!!e})()}function ct(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var ut=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,ot()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"url",value:(n=a()(d().mark(function e(n){var r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.productVersion,a=Object.assign({},n),s=r.split("."),e.abrupt("return",ct(t,"url",this,3)([Object.assign({},a,{productVersion:"".concat(s[0],".").concat(s[1])})]));case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n}(we);function lt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(lt=function(){return!!e})()}function pt(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var dt=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[it],r=B()(r),(e=H()(n,lt()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new ut(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new Le(e,this)}},{key:"updateParams",value:(r=a()(d().mark(function e(n){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,pt(t,"updateParams",this,3)([n]);case 1:return(r=e.sent).forEach(function(e){var t=a.getClientVersion(e);e.surfaceId=f.Z.get(t,a.type).SURFACES}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getTutorialAssets",value:(n=a()(d().mark(function e(t){var n,r,a,s=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",{});case 1:return(r={})[t]=!0,e.next=2,S.readJson("".concat(this.getPath()).concat(t)).catch(function(e){s.log.error(new A.Z("filesystem",e))});case 2:return null==(a=e.sent)||null===(n=a.tutorials)||void 0===n||n.forEach(function(e){var t,n;null!==(t=e.metadata)&&void 0!==t&&null!==(t=t.images)&&void 0!==t&&t.heroPath&&(r[e.metadata.images.heroPath]=!0),null!==(n=e.metadata)&&void 0!==n&&null!==(n=n.images)&&void 0!==n&&n.thumbnailPath&&(r[e.metadata.images.thumbnailPath]=!0)}),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}(ge);const ft={AJO_SUPPORTED:!1,LABEL:"ILLUSTRATOR_FLAGS",ANALYTICS_SUBCATEGORY:"IllustratorFlags",VULCAN_TYPE:"IllustratorFlags",LOG_PREFIX:"IllustratorFlags",LOOKUP_MAP_FILE_VERSION:1,LOOKUP_COLLECTION_FILE_VERSION:1,FILE_ACCESSOR_WRITE_ENABLED:!0,DEFAULT_DATA_EXPIRATION:864e5,SUPPORT_PATCH:!0,ETAG_KEY_SEPERATOR:"-URL-",FG_API_KEY:"CCXProcess_v7_0",FG_IMS_ORG_ID:"9E1005A551ED61CA0A490D45@AdobeOrg",FG_SANDBOX_NAME_STAGING:"xlg-stage",FG_SANDBOX_NAME_PRODUCTION:"xlg-prod",STOP_REQUEST_TRAFFIC:!1,SUPPORTED_PRODUCTS:{ILST:"28.1.0",ILSTBETA:"28.1.0",ILSTPR:"28.1.0"},UNSUPPORTED_AFTER_VERSION:{},ACTIVE_VERSIONS:["V1"],V1:{SUPPORT_PATCH:!0,PREFETCH_CLIENTS:{ILST:"99.99.999",ILSTBETA:"99.99.999",ILSTPR:"99.99.999"},PRODUCT_ALIASES:{ILSTBETA:"ILST",ILSTPR:"ILST"},FLOODGATE_ALIASES:{ILST:"AI",ILSTBETA:"AI",ILSTPR:"AI"}},DIR:"illustratorFlags/",PARAMETERS_SCHEMA:{id:"illustrator_flags_client_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},FLOODGATE_RESPONSE_SCHEMA:{id:"/FLOODGATE_RESPONSE",type:"object",properties:{clients:{type:"object",properties:{releases:{type:"array"}}},ttl:{type:"number"}},required:["clients"]},PRIORITY_CHANNEL:x.NU.IllustratorFlags,ANONYMOUS_RETRY_DISABLED:!0,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!1,ASSET_DOWNLOAD_TIMEOUT:3e5,FLOODGATE_URL_STAGING:"https://p13n-stage.adobe.io/fg/api/v2/feature",FLOODGATE_URL_PRODUCTION:"https:///p13n.adobe.io/fg/api/v2/feature"};function _t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_t=function(){return!!e})()}var ht=function(e){function t(e,n){return i()(this,t),r=this,a=t,s=[e,n],a=B()(a),H()(r,_t()?Reflect.construct(a,s||[],B()(r).constructor):a.apply(r,s));var r,a,s}return X()(t,e),c()(t,[{key:"syncData",value:(r=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._data&&(this._data.path="".concat(v.basename(this._fileName))),e.abrupt("return");case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getReferencedAssets",value:(n=a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},this._data&&this._data.path&&(t[this._data.path]=!0),e.abrupt("return",t);case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"totalItems",get:function(){return 1}}]);var n,r}(ye);function Et(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Et=function(){return!!e})()}var St=function(e){function t(e,n){var r,a,s,o;return i()(this,t),a=this,s=t,o=[e],s=B()(s),r=H()(a,Et()?Reflect.construct(s,o||[],B()(a).constructor):s.apply(a,o)),l()(r,"_lookupMap",void 0),r._lookupMap=n,r}return X()(t,e),c()(t,[{key:"url",value:(u=a()(d().mark(function e(t){var n,r,a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.Z.getEnvironment(),r=new D.URL(f.Z.get("FLOODGATE_URL_".concat(n.LABEL.toUpperCase()),this.type)),a=this._lookupMap.getFloodgateProductAliases(t),s="".concat(a,"_").concat(_.Z.getMajorVersion(t.productVersion),"_").concat(_.Z.getMinorVersion(t.productVersion),"_").concat(_.Z.getPatchVersion(t.productVersion)),i=_.Z.isWindows()?"WIN":"MAC",o="".concat(t.productCode,":").concat(t.productVersion,":").concat(i,":").concat(t.productLanguage,"&clientId=").concat(s),e.abrupt("return",r.toString()+o);case 1:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"downloadCollectionDataRaw",value:(o=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,r=t.priority,s=t.id,i=void 0===s?T.v4():s,t.skipAuth,e.next=1,this.url(n);case 1:return o=e.sent,e.next=2,E.Z.getAccessToken().catch(function(e){return!1});case 2:return u=e.sent,e.next=3,this.log.context({params:n,analytics:!1}).time(function(){var e=a()(d().mark(function e(t){var a,s,l,_,h,E;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p.get({url:o,options:{method:"GET",timeout:f.Z.get("SERVER_TIMEOUT"),headers:p.getRequestHeaders(o)},priority:r,auth:u,id:i});case 1:s=e.sent,l=s.response,_=s.time,t.appendPayload({"event.value":_,"event.url":o,"env.svc.name":f.Z.get("ANALYTICS_SUBCATEGORY",p.type)}),h=null,c=null===(a=l.headers)||void 0===a?void 0:a.get("etag"),E=l.status,e.next=200===E?2:304===E?4:6;break;case 2:return e.next=3,p.getResponseJson(l,o);case 3:case 5:return h=e.sent,e.abrupt("continue",6);case 4:return e.next=5,p.getCachedResponseJson(o,n);case 6:return e.abrupt("return",h);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:return l=e.sent,this.validateSchema(l,o),l=this.postProcessContent(l,n),e.next=4,this.processResponseHeaders(n,c,o);case 4:return e.abrupt("return",l);case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"postProcessContent",value:function(e,t){return e.expirationDTS=new Date(Date.now()+f.Z.get("DEFAULT_DATA_EXPIRATION",this._lookupMap.type)).toISOString(),e}},{key:"validateSchema",value:function(e,t){var n=f.Z.get("FLOODGATE_RESPONSE_SCHEMA",this.type),r=_.Z.validateDataFields(e,n);if(r)throw this.deleteEtag(t),new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,r)}},{key:"getRequestHeaders",value:function(e){var t={"content-type":"application/json","X-API-Key":f.Z.get("FG_API_KEY",this.type),"x-gw-ims-org-id":f.Z.get("FG_IMS_ORG_ID",this.type),"x-sandbox-name":f.Z.get("FG_SANDBOX_NAME_".concat(f.Z.getEnvironment().LABEL.toUpperCase()),this.type)},n=this.getCachedEtag(e);return n&&(t["If-None-Match"]=n),t}},{key:"deleteEtag",value:function(e){delete this._lookupMap._data.assetMetadata[this._getEtagLookupKey(e)]}},{key:"saveEtag",value:function(e,t,n){var r={id:n,etag:e,path:"".concat(n,".json"),url:t};this._lookupMap._data.assetMetadata[this._getEtagLookupKey(t)]=r}},{key:"getCachedResponseJson",value:(s=a()(d().mark(function e(t,n){var r,s,i,o,c,u,l,p=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=null,i=this.getCachedEtag(t),e.next=1,this._lookupMap._getCollectionInfo(n);case 1:if(u=r=e.sent,c=null===u){e.next=2;break}c=void 0===r;case 2:if(!c){e.next=3;break}l=void 0,e.next=4;break;case 3:l=r.pendingId;case 4:return o=l,i&&o&&this.saveEtag(i,t,o),e.next=5,this._lookupMap.getLatestPath({params:n}).then(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.next=1,S.readJson(n).catch(function(e){throw p.deleteEtag(t),new A.Z(f.Z.analytics.FLOODGATE_RESPONSE_INVALID_JSON_CACHE,e,f.Z.analytics.FLOODGATE_RESPONSE_INVALID_JSON_CACHE_CODE)});case 1:s=e.sent;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:return e.abrupt("return",s);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"getResponseJson",value:(r=a()(d().mark(function e(t,n){var r,a,s,i,o,c,u,l,p,_,h,E,S;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=2,t.json();case 2:r=e.sent,e.next=9;break;case 3:if(e.prev=3,i=e.catch(1),o=new A.Z(f.Z.analytics.FLOODGATE_RESPONSE_INVALID_JSON,i,f.Z.analytics.FLOODGATE_RESPONSE_INVALID_JSON_CODE),c=n,!(l=t.text)){e.next=5;break}return e.next=4,t.text();case 4:l=e.sent;case 5:if(p=a=l,u=null===p){e.next=6;break}u=void 0===a;case 6:if(!u){e.next=7;break}_=void 0,e.next=8;break;case 7:_=a.length;case 8:h=0|_,E=t.status,S={"event.url":c,"event.value":h,"ccxp.fg_response_code":E},s=o.setPayload.call(o,S),this.log.error(s);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this,[[1,3]])})),function(e,t){return r.apply(this,arguments)})},{key:"processResponseHeaders",value:(n=a()(d().mark(function e(t,n,r){var a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return i="",e.next=1,null===(a=this._lookupMap._getCollectionInfo(t))||void 0===a?void 0:a.pendingId;case 1:o=e.sent,s=i.concat.call(i,o),this.saveEtag(n,r,s);case 2:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"_getEtagLookupKey",value:function(e){return"".concat(E.Z.getUserId()).concat(f.Z.get("ETAG_KEY_SEPERATOR",this.type)).concat(e)}},{key:"getCachedEtag",value:function(e){var t,n=this._getEtagLookupKey(e);return null===(t=this._lookupMap._data)||void 0===t||null===(t=t.assetMetadata[n])||void 0===t?void 0:t.etag}}]);var n,r,s,o,u}(we);function vt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(vt=function(){return!!e})()}function gt(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var Tt=function(e){function t(e){var n,r,a,s;return i()(this,t),r=this,a=t,s=[e],a=B()(a),n=H()(r,vt()?Reflect.construct(a,s||[],B()(r).constructor):a.apply(r,s)),l()(n,"_data",void 0),n._downloadManager=new St(n.type,n),n}return X()(t,e),c()(t,[{key:"_getCollectionInfo",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return gt(t,"_getCollectionInfo",this,3)([e,n])}},{key:"getFloodgateProductAliases",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getClientVersion(e),n=f.Z.get(t,this.type).FLOODGATE_ALIASES;if(e.productCode)return n&&n[e.productCode]||e.productCode}},{key:"makeVersionLookupKey",value:function(e,t){var n=e&&e.split(".");return t?n&&"".concat(n[0],".").concat(n[1],".").concat(n[2]?n[2]:0):n&&"".concat(n[0],".").concat(n[1])}},{key:"updateParams",value:(r=a()(d().mark(function e(n){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,gt(t,"updateParams",this,3)([n]);case 1:return(r=e.sent).forEach(function(e){e.productSemver=a.makeVersionLookupKey(e.productSemver,!0),e.productVersion=a.makeVersionLookupKey(e.productVersion,!0)}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_cleanupAssetsCache",value:function(e){var t=this._data.assetMetadata;Object.keys(t).forEach(function(n){var r=t[n];r.path&&(e[r.path]||delete t[n])})}},{key:"_getLookupKeys",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=_.Z.isPatchEnabled(this.getClientVersion(e),this.type);t=this.makeVersionLookupKey(e.productVersion,r);var a=[n||E.Z.getUserId()];return a.push(e.productCode,t,e.productLanguage),a}},{key:"generateApiFile",value:(n=a()(d().mark(function e(t){var n,r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={},Object.keys(this._data.versionInfo).forEach(function(e){e&&"undefined"!==e&&(n[e]={data:[]},Object.keys(t.metadata).forEach(function(s,i){var o=a._getLookupKeys(t.metadata[s].params).reduce(function(e,t){return e[t]?e[t]:e},a._data.versionInfo[e]);if(o.latestId&&!r[o.latestId]){var c=Object.assign({},a._data.metadata[o.latestId]);Object.keys(t.assetMetadata).forEach(function(e,n){var r=t.assetMetadata[e];r.id===o.latestId&&(c.etag=r.etag,c.url=r.url)}),n[e].data.push(c),r[o.latestId]=!0}}))}),e.abrupt("return",{version:f.Z.get("FILE_ACCESS_MAP_FILE_VERSION"),client:this.type,session:b.Z.event_session_tracker,lastUpdateTime:new Date(Date.now()).toISOString(),users:n});case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}(ge);function mt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(mt=function(){return!!e})()}var yt=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,mt()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"url",value:(n=a()(d().mark(function e(t){var n,r,a,s,i,o,c;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.Z.getEnvironment(),r=new D.URL(f.Z.get("FLOODGATE_URL_".concat(n.LABEL.toUpperCase()),this.type)),a=this._lookupMap.getFloodgateProductAliases(t),s="".concat(a,"_").concat(_.Z.getMajorVersion(t.productVersion),"_").concat(_.Z.getMinorVersion(t.productVersion),"_").concat(_.Z.getPatchVersion(t.productVersion)),i=_.Z.isWindows()?"WIN":"MAC",o=t.productLanguage,c="?p=".concat(t.productCode,":").concat(t.productVersion,":").concat(i,":").concat(o,"&productLanguage=").concat(o,"&platform=").concat(i,"&meta=true&clientId=").concat(s,"&mergeFlags=true"),e.abrupt("return",r.toString()+c);case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n}(St);function Ot(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ot=function(){return!!e})()}var At=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[ft],r=B()(r),(e=H()(n,Ot()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new yt(e.type,e),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new ht(e,this)}}])}(Tt);const Ct={AJO_SUPPORTED:!1,LABEL:"CCXP_FLAGS",ANALYTICS_SUBCATEGORY:"CCXPFlags",VULCAN_TYPE:"CCXPFlags",LOG_PREFIX:"CCXPFlags",LOOKUP_MAP_FILE_VERSION:1,LOOKUP_COLLECTION_FILE_VERSION:1,FILE_ACCESSOR_WRITE_ENABLED:!1,DEFAULT_DATA_EXPIRATION:864e5,SUPPORT_PATCH:!0,ETAG_KEY_SEPERATOR:"-URL-",FG_API_KEY:"CCXProcess_FG_1",CCXP_FG_CLIENT_ID:"CCXP-FG1",FG_IMS_ORG_ID:"9E1005A551ED61CA0A490D45@AdobeOrg",FG_SANDBOX_NAME_STAGING:"xlg-stage",FG_SANDBOX_NAME_PRODUCTION:"xlg-prod",STOP_REQUEST_TRAFFIC:!1,SUPPORTED_PRODUCTS:{CCXP:"5.1.0"},UNSUPPORTED_AFTER_VERSION:{},ACTIVE_VERSIONS:["V1"],V1:{SUPPORT_PATCH:!0,PREFETCH_CLIENTS:{CCXP:"99.99.999"},PRODUCT_ALIASES:{CCXP:"CCXP"},FLOODGATE_ALIASES:{CCXP:"CCXP"}},REFRESH_ON_STALE:!0,STALE_AFTER:12096e5,DIR:"ccxpFlags/",PARAMETERS_SCHEMA:{id:"ccxp_flags_client_parameters",type:"object",properties:{}},FLOODGATE_RESPONSE_SCHEMA:{id:"/FLOODGATE_RESPONSE",type:"object",properties:{clients:{type:"object",properties:{releases:{type:"array"}}},ttl:{type:"number"}},required:["clients"]},PRIORITY_CHANNEL:x.NU.CCXPFlags,ANONYMOUS_RETRY_DISABLED:!0,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!1,ASSET_DOWNLOAD_TIMEOUT:3e5,FLOODGATE_URL_STAGING:"https://p13n-stage.adobe.io/fg/api/v2/feature?&meta=true",FLOODGATE_URL_PRODUCTION:"https:///p13n.adobe.io/fg/api/v2/feature?&meta=true",ACTIVATED_FLAGS:["override_health_metrics_collection_frequency","enable_gsdk_ghost_content","ccxp_gsdk_config","debugging_logs","GSDK_AEFT","GSDK_IDSN","GSDK_ILST","GSDK_PHXS","GSDK_PPRO","GSDK_SPRK"],IGNORE_PERF_EVENTS_FOR_SURFACES:["CCXP_FLOODGATE_FLAGS-CCXP-FG1"]};function It(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(It=function(){return!!e})()}var Rt=function(e){function t(e,n){return i()(this,t),r=this,a=t,s=[e,n],a=B()(a),H()(r,It()?Reflect.construct(a,s||[],B()(r).constructor):a.apply(r,s));var r,a,s}return X()(t,e),c()(t,[{key:"validateSchema",value:function(e,n){var r,a,s,i,o,c;(a=t,s="validateSchema",i=this,o=3,c=W()(B()(1&o?a.prototype:a),s,i),2&o&&"function"==typeof c?function(e){return c.apply(i,e)}:c)([e,n]);var u=null===(r=e.clients[f.Z.get("CCXP_FG_CLIENT_ID",this.type)].releases)||void 0===r?void 0:r[0],l=(null==u?void 0:u.features)||[],p=(null==u?void 0:u.meta)||[];(f.Z.get("ACTIVATED_FLAGS",this.type)||[]).forEach(function(e){if(l.includes(e)){var t=p.find(function(t){return t.k===e});if(t)try{var n=_.Z.decodeMetadata(t.v);n=_.Z.parseMetaValue(n)}catch(e){throw new A.Z("Failed parsing  feature flag [".concat(t.k,"] metadata [").concat(t.v,"]token"),e)}}})}},{key:"url",value:(n=a()(d().mark(function e(t){var n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.Z.getEnvironment(),r=new D.URL(f.Z.get("FLOODGATE_URL_".concat(n.LABEL.toUpperCase()),this.type)),a=f.Z.get("CCXP_FG_CLIENT_ID",this.type),s="&clientId=".concat(a),e.abrupt("return",r.toString()+s);case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"postProcessContent",value:function(e,t){var n=new Date,r=Math.max(86400,e.ttl||0),a=f.Z.get("MAX_RANDOMIZED_TIME")/1e3;return n.setSeconds(r+_.Z.getRandomIntInclusive(-a,a)),e.expirationDTS=n,e}}]);var n}(St);function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Pt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Pt=function(){return!!e})()}var Lt=function(e){function t(e,n){var r,a,s,o;return i()(this,t),a=this,s=t,o=[e,n],s=B()(s),r=H()(a,Pt()?Reflect.construct(s,o||[],B()(a).constructor):s.apply(a,o)),l()(r,"dataManager",void 0),r.dataManager=new Re(n.type,n.diskLock),r}return X()(t,e),c()(t,[{key:"restoreSettingsFromDisk",value:(o=a()(d().mark(function e(){var t,n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.log.disk("Attempting restoring feature flags from disk content"),t=pe.Z.isEnabled,e.prev=1,n=f.Z.get("CCXP_FG_CLIENT_ID",this._lookupMap.type),r="CCXP_FLOODGATE_FLAGS-".concat(n),a=this.data.clients[n],e.next=2,this.dataManager.downloadData({modeID:r,card:a,lookupMap:this._lookupMap});case 2:return this.log.disk("Successfully restored all features flags from current disk content to settings"),e.next=3,this.processGSDKFlagResponse(t);case 3:e.next=6;break;case 4:return e.prev=4,s=e.catch(1),e.next=5,this.processGSDKFlagResponse(t);case 5:throw new A.Z("Failed to restore flag settings",s);case 6:case"end":return e.stop()}},e,this,[[1,4]])})),function(){return o.apply(this,arguments)})},{key:"processGSDKFlagResponse",value:(s=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log.disk("Processing GSDK feature flags on CCXP flag response updates."),!pe.Z.isEnabled){e.next=2;break}return this.log.disk("GSDK has been enabled. Starting up. Previous status ".concat(t,".")),e.next=1,pe.Z.startup();case 1:e.next=3;break;case 2:return this.log.disk("GSDK has been disabled. Shutting down. Previous status ".concat(t,".")),e.next=3,pe.Z.shutdown();case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"syncData",value:(r=a()(d().mark(function e(){var t,n,r,s,i,o,c,u,l,p,_,h,E=this,S=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=S.length>0&&void 0!==S[0]?S[0]:{}).priority,r=t.payload,s=t.params,t.progress,i=t.force,o=void 0===i?{type:"none"}:i,this._data){e.next=1;break}return e.abrupt("return");case 1:if(c=pe.Z.isEnabled,this._data.path="".concat(v.basename(this._fileName)),!f.Z.get("CCXP_FEATURE_FLAGS_LOCAL_OVERRIDE")){e.next=2;break}return this.log.disk("Ignoring syncing data from feature flags response."),e.abrupt("return");case 2:if(u=new A.Z(f.Z.analytics.AGGREGATE_ERROR,f.Z.get("AGGREGATE_TYPE",this._lookupMap.type)+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),l=f.Z.get("CCXP_FG_CLIENT_ID",this._lookupMap.type),!this.data.clients[l]){e.next=3;break}return p="CCXP_FLOODGATE_FLAGS-".concat(l),_=new x.UL(n),h=this._data.clients[l],e.next=3,this.syncDataPromises({analyticsParams:void 0,payload:r,surface:p,card:h,priority:_,params:s,force:o}).catch(function(e){u.addSubError({surface:p,url:"",err:e})}).then(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,E.processGSDKFlagResponse(c);case 1:case"end":return e.stop()}},e)})));case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"syncDataPromises",value:(n=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.analyticsParams,r=t.payload,s=t.surface,i=t.card,o=t.priority,c=t.params,u=t.force,l=f.Z.get("IGNORE_PERF_EVENTS_FOR_SURFACES",this._lookupMap.type).includes(s),e.next=1,this.log.context({analytics:!l,payload:r,surfaceAnalytics:[kt({surface:s},n)]}).time(function(){var e=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p.dataManager.downloadData({modeID:s,card:i,lookupMap:p._lookupMap,priority:o,params:c,force:u});case 1:n=e.sent,r=n.count,a=n.totalTime,t.appendPayload({"event.count":r,"event.value":a/r,"exp.surface_id":"".concat(s)});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r,s,o}(ht);function Dt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Dt=function(){return!!e})()}var xt=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[Ct],r=B()(r),(e=H()(n,Dt()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new Rt(e.type,e),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new Lt(e,this)}},{key:"makeVersionLookupKey",value:function(e,n){var r,a,s,i,o,c=e&&e.split("-");return c&&(r=t,a="makeVersionLookupKey",s=this,i=3,o=W()(B()(1&i?r.prototype:r),a,s),2&i&&"function"==typeof o?function(e){return o.apply(s,e)}:o)([c[0],n])}},{key:"_getLookupKeys",value:function(e,t){return[t||E.Z.getUserId()]}},{key:"uninstall",value:(r=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"resetSettings",value:(n=a()(d().mark(function e(){var t=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(f.Z.get("ACTIVATED_FLAGS",this.type)||[]).forEach(function(e){t.log.disk("Removing flag due to stale content: ".concat(e,".")),f.Z.remove(e)}),e.abrupt("return");case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]);var n,r}(Tt);const bt={AJO_SUPPORTED:!0,LABEL:"Photoshop",ANALYTICS_SUBCATEGORY:"Photoshop",VULCAN_TYPE:"Photoshop",LOG_PREFIX:"Photoshop",LOOKUP_MAP_FILE_VERSION:1,LOOKUP_COLLECTION_FILE_VERSION:1,FILE_ACCESSOR_WRITE_ENABLED:!0,ACTIVE_VERSIONS:["V2","V3"],SUPPORTED_PRODUCTS:{PHXS:"25.0",PHSP:"25.0",PHSPPR:"25.0",PHSPBETA:"25.0"},UNSUPPORTED_AFTER_VERSION:{},DIR:"photoshop/",PARAMETERS_SCHEMA:{id:"photoshop_client_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},PRIORITY_CHANNEL:x.NU.Photoshop,SURFACE_PRIORITY:{Ps_Feature_Flag:500},V2:{SURFACES:["Ps_Feature_Flag"],PREFETCH_CLIENTS:{PHXS:"26.5",PHSP:"26.5",PHSPPR:"26.5",PHSPBETA:"26.5"},PRODUCT_ALIASES:{PHSP:"PHXS"},ALTERNATE_ANALYTICS_ID:!0},V3:{SURFACES:["Ps_Feature_Flag"],PREFETCH_CLIENTS:{PHXS:"99.0",PHSP:"99.0",PHSPPR:"99.0",PHSPBETA:"99.0"},PRODUCT_ALIASES:{PHSP:"PHXS"}},SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","en_AE","en_GB","en_IL","es_ES","es_MX","fi_FI","fr_FR","fr_CA","fr_MA","hu_HU","id_ID","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","th_TH","tr_TR","uk_UA","vi_VN","zh_CN","zh_TW"],ANONYMOUS_RETRY_DISABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!1,SOPHIA_VERBOSE_FLAG_ENABLED:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,IGNORE_PERF_EVENTS_FOR_SURFACES:["Ps_Feature_Flag"],GSDK_DEFAULT_EXPIRY_TIME:2};function wt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(wt=function(){return!!e})()}function Ut(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var Mt=function(e){function n(){var e,t,r,a;return i()(this,n),t=this,r=n,a=[bt],r=B()(r),(e=H()(t,wt()?Reflect.construct(r,a||[],B()(t).constructor):r.apply(t,a)))._downloadManager=new we(e.type),e}return X()(n,e),c()(n,[{key:"_createCollectionData",value:function(e){return new Le(e,this)}},{key:"_getLookupKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=Ut(n,"_getLookupKeys",this,3)([e,t]),a=this.getClientVersion(e);return r.splice(1,0,a),r}},{key:"forceRefresh",value:(s=a()(d().mark(function e(n){var r,s,i,o,c=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign({},n,{productVersion:this.makeVersionLookupKey(n.productVersion)}),s=f.Z.get("ACTIVE_VERSIONS",this.type),i=s.map(function(e){return[e].concat(t()(Object.values(r))).filter(function(e){return void 0!==e})}),o=i.map(function(e){return c.getIdsByKeys(e)}).reduce(function(e,n){return[].concat(t()(e),t()(n))},[]).filter(function(e,t,n){return n.indexOf(e)===t}),e.next=1,Promise.all(o.map(function(){var e=a()(d().mark(function e(t){var n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=c.getCollectionParamters(t))||void 0===n?void 0:n.params,!pe.Z.isClientSupported(r,c)||!pe.Z.isEnabled){e.next=1;break}((null==r?void 0:r.surfaceId)||[]).forEach(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,pe.Z.updateContent(n,pe.Z.createConsumer(r)).then(function(){c.log.disk("[".concat(t,"] GSDK updateContent suceeded for ").concat(n))}).catch(function(e){c.log.disk("[".concat(t,"] GSDK content update failed for ").concat(n,": ").concat(e))});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=2;break;case 1:return e.next=2,c.expireOne(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"updateParams",value:(r=a()(d().mark(function e(t){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Ut(n,"updateParams",this,3)([t]);case 1:return(r=e.sent).map(function(e){var t=a.getClientVersion(e);e.surfaceId=f.Z.get(t,a.type).SURFACES}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}]);var r,s}(ge);const Zt={AJO_SUPPORTED:!1,LABEL:"INDESIGN_FLAGS",ANALYTICS_SUBCATEGORY:"IndesignFlags",VULCAN_TYPE:"IndesignFlags",LOG_PREFIX:"IndesignFlags",LOOKUP_MAP_FILE_VERSION:1,LOOKUP_COLLECTION_FILE_VERSION:1,DEFAULT_LANGUAGE_FS:"Roman",FILE_ACCESSOR_WRITE_ENABLED:!0,DEFAULT_DATA_EXPIRATION:864e5,SUPPORT_PATCH:!0,ETAG_KEY_SEPERATOR:"-URL-",FG_API_KEY:"CCXProcess_v7_0",FG_IMS_ORG_ID:"9E1005A551ED61CA0A490D45@AdobeOrg",FG_SANDBOX_NAME_STAGING:"xlg-stage",FG_SANDBOX_NAME_PRODUCTION:"xlg-prod",STOP_REQUEST_TRAFFIC:!1,SUPPORTED_PRODUCTS:{IDSN:"19.4.0",IDSNBETA:"19.4.0",IDSNPR:"19.4.0"},UNSUPPORTED_AFTER_VERSION:{},ACTIVE_VERSIONS:["V1"],V1:{SUPPORT_PATCH:!0,PREFETCH_CLIENTS:{IDSN:"99.99.9999",IDSNBETA:"99.99.9999",IDSNPR:"99.99.9999"},FLOODGATE_ALIASES:{IDSN:"IDSN",IDSNBETA:"IDSN",IDSNPR:"IDSN"}},DIR:"indesignFlags/",PARAMETERS_SCHEMA:{id:"indesign_flags_client_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},FLOODGATE_RESPONSE_SCHEMA:{id:"/FLOODGATE_RESPONSE",type:"object",properties:{clients:{type:"object",properties:{releases:{type:"array"}}},ttl:{type:"number"}},required:["clients"]},PRIORITY_CHANNEL:x.NU.IndesignFlags,ANONYMOUS_RETRY_DISABLED:!0,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!1,ASSET_DOWNLOAD_TIMEOUT:3e5,FLOODGATE_URL_STAGING:"https://p13n-stage.adobe.io/fg/api/v2/feature?&meta=true&p=",FLOODGATE_URL_PRODUCTION:"https:///p13n.adobe.io/fg/api/v2/feature?&meta=true&p="};function Ft(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ft=function(){return!!e})()}var Gt=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,Ft()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"url",value:(n=a()(d().mark(function e(t){var n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new D.URL(f.Z.get("FLOODGATE_URL_".concat(f.Z.getEnvironment().LABEL.toUpperCase()),this.type)),r=this._lookupMap.getFloodgateProductAliases(t),a=f.Z.get("DEFAULT_LANGUAGE_FS",this.type),s="".concat(r,":").concat(t.productVersion,"_").concat(this.getProductRelease(t.productCode),":").concat(this.getOsPlatform(),":").concat(t.productLanguage,"&osParameter=").concat(this.getOsPlatform(),"&productLocale=").concat(t.productLanguage,"&languageFS=").concat(a,"&mergeFlags=true"),e.abrupt("return",n.toString()+s);case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getProductRelease",value:function(e){var t;switch(e){case"IDSNBETA":t="BETA";break;case"IDSNPR":t="PR";break;default:t="GA"}return t}},{key:"getOsPlatform",value:function(){return _.Z.isWindows()?"WIN":"MAC"}}]);var n}(St);function Vt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Vt=function(){return!!e})()}var Ht=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[Zt],r=B()(r),(e=H()(n,Vt()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new Gt(e.type,e),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new ht(e,this)}}])}(Tt);const Kt={AJO_SUPPORTED:!0,LABEL:"ILLUSTRATOR",ANALYTICS_SUBCATEGORY:"Illustrator",VULCAN_TYPE:"Illustrator",LOG_PREFIX:"Illustrator",LOOKUP_MAP_FILE_VERSION:1,LOOKUP_COLLECTION_FILE_VERSION:1,FILE_ACCESSOR_WRITE_ENABLED:!0,ACTIVE_VERSIONS:["V1","V2","V3","V4"],SUPPORTED_PRODUCTS:{ILST:"27.6",ILSTPR:"27.6",ILSTBETA:"27.6"},UNSUPPORTED_AFTER_VERSION:{},DIR:"illustrator/",PARAMETERS_SCHEMA:{id:"illustrator_client_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},PRIORITY_CHANNEL:x.NU.Illustrator,SURFACE_PRIORITY:{illustrator_workspace:100},V1:{SURFACES:["illustrator_workspace"],PREFETCH_CLIENTS:{ILST:"27.7",ILSTBETA:"27.7",ILSTPR:"27.7"},PRODUCT_ALIASES:{ILSTBETA:"ILST",ILSTPR:"ILST"}},V2:{SURFACES:["illustrator_workspace","illustrator_feature_flags"],PREFETCH_CLIENTS:{ILST:"27.9",ILSTBETA:"27.9",ILSTPR:"27.9"},PRODUCT_ALIASES:{ILSTBETA:"ILST",ILSTPR:"ILST"}},V3:{SURFACES:["illustrator_workspace","illustrator_feature_flags"],PREFETCH_CLIENTS:{ILST:"28.1",ILSTBETA:"28.1",ILSTPR:"28.1"},PRODUCT_ALIASES:{ILSTBETA:"ILST",ILSTPR:"ILST"}},V4:{SURFACES:["illustrator_workspace","illustrator_feature_flags"],PREFETCH_CLIENTS:{ILST:"99.0",ILSTBETA:"99.0",ILSTPR:"99.0"}},ANONYMOUS_RETRY_DISABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!0,SOPHIA_VERBOSE_FLAG_ENABLED:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,IGNORE_PERF_EVENTS_FOR_SURFACES:["illustrator_workspace","illustrator_feature_flags"],GSDK_DEFAULT_EXPIRY_TIME:2};function Bt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Bt=function(){return!!e})()}function jt(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var Wt=function(e){function n(){var e,t,r,a;return i()(this,n),t=this,r=n,a=[Kt],r=B()(r),(e=H()(t,Bt()?Reflect.construct(r,a||[],B()(t).constructor):r.apply(t,a)))._downloadManager=new we(e.type),e}return X()(n,e),c()(n,[{key:"_createCollectionData",value:function(e){return new Le(e,this)}},{key:"_getLookupKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=jt(n,"_getLookupKeys",this,3)([e,t]),a=this.getClientVersion(e);return r.splice(1,0,a),r}},{key:"forceRefresh",value:(s=a()(d().mark(function e(n){var r,s,i,o,c=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign({},n,{productVersion:this.makeVersionLookupKey(n.productVersion)}),s=f.Z.get("ACTIVE_VERSIONS",this.type),i=s.map(function(e){return[e].concat(t()(Object.values(r))).filter(function(e){return void 0!==e})}),o=i.map(function(e){return c.getIdsByKeys(e)}).reduce(function(e,n){return[].concat(t()(e),t()(n))},[]).filter(function(e,t,n){return n.indexOf(e)===t}),e.next=1,Promise.all(o.map(function(){var e=a()(d().mark(function e(t){var n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=c.getCollectionParamters(t))||void 0===n?void 0:n.params,!pe.Z.isClientSupported(r,c)||!pe.Z.isEnabled){e.next=1;break}((null==r?void 0:r.surfaceId)||[]).forEach(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,pe.Z.updateContent(n,pe.Z.createConsumer(r)).then(function(){c.log.disk("[".concat(t,"] GSDK updateContent suceeded for ").concat(n))}).catch(function(e){c.log.disk("[".concat(t,"] GSDK content update failed for ").concat(n,": ").concat(e))});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=2;break;case 1:return e.next=2,c.expireOne(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"updateParams",value:(r=a()(d().mark(function e(t){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,jt(n,"updateParams",this,3)([t]);case 1:return(r=e.sent).map(function(e){var t=a.getClientVersion(e);e.surfaceId=f.Z.get(t,a.type).SURFACES}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}]);var r,s}(ge);function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function qt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(qt=function(){return!!e})()}var Jt=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,qt()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"downloadAsset",value:(s=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.asset,r=t.link,a=t.priority,s=t.analytics,i=t.params,o=n&&n[r],n&&o&&0!==o.length){e.next=1;break}throw new A.Z(f.Z.analytics.DATA_VALIDATION_ERR,"Missing stock asset for ".concat(JSON.stringify(o)));case 1:return e.next=2,this._lookupMap.fetchAsset({href:o.toString(),assetsDir:this.assetsDir,priority:a,params:i});case 2:c=e.sent,u=c.path,l=c.time,s&&(0!==s.time&&s.time?s.time+=l:s.time=l,0!==s.count&&s.time?s.count++:s.count=1),n[r]=u;case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"validateData",value:function(e){return _.Z.validateDataFields(e,f.Z.get("TEMPLATES_DATA_SCHEMA",this._lookupMap.type))}},{key:"totalItems",get:function(){return this._data&&this._data.templates&&this._data.templates.length||0}},{key:"syncData",value:(r=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p,h=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.priority,r=t.payload,s=t.params,i=t.progress,o=void 0===i?function(){}:i,this._data&&this._data.templates){e.next=1;break}return e.abrupt("return");case 1:return c={count:0,time:0},u=[],l={started:0,complete:0,failed:0},p=new A.Z(f.Z.analytics.AGGREGATE_ERROR,f.Z.get("AGGREGATE_TYPE",this._lookupMap.type)+f.Z.analytics.AGGREGATE_ERROR_DESCRIPTION),this._data.templates.forEach(function(e){l.started++,o(l);var t=0;function r(){return i.apply(this,arguments)}function i(){return(i=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:2===++t&&(l.complete++,o(l));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}e.thumbnail_url&&0!==e.thumbnail_url.length&&e.thumbnail_url.startsWith("http")&&u.push(h.downloadAsset({asset:e,link:"thumbnail_url",priority:n,analytics:c,params:s}).then(r).catch(function(n){var r;p.addSubError({id:null===(r=e.id)||void 0===r?void 0:r.toString(),url:e.thumbnail_url,err:n}),-1!==t&&(l.failed=l.failed+1,o(l),t=-1)})),e.previews&&0!==e.previews.length&&e.previews.forEach(function(a){a&&a.url&&a.url.startsWith("http")&&u.push(h.downloadAsset({asset:a,link:"url",priority:n,analytics:c,params:s}).then(r).catch(function(n){var r;p.addSubError({id:null===(r=e.id)||void 0===r?void 0:r.toString(),url:a.url,err:n}),-1!==t&&(l.failed=l.failed+1,o(l),t=-1)}))})}),e.next=2,this.log.context({analytics:!1}).time(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.appendPayload(Xt(Xt({},r),{},{"event.count":c.count,"event.value":c.time/c.count})),e.next=1,_.Z.waitAll(u);case 1:if(!p.hasSubErrors){e.next=2;break}throw p;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getReferencedAssets",value:(n=a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},this._data&&this._data.templates&&this._data.templates.forEach(function(e){e&&e.thumbnail_url&&(t[e.thumbnail_url]=!0),e&&e.previews&&e.previews.forEach(function(e){e&&e.url&&(t[e.url]=!0)})}),e.abrupt("return",t);case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]);var n,r,s}(ye);function Qt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Qt=function(){return!!e})()}var zt=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,Qt()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"url",value:(r=a()(d().mark(function e(t){var n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.Z.getEnvironment(),r=Math.min(100,f.Z.get("TEMP_DEFAULT_TEMPLATES_DOWNLOADED")),isNaN(r)&&(r=100),a=new D.URL(f.Z.get("URL_".concat(n.LABEL.toUpperCase()),this.type)),s=l()({product:t.productCode,locale:t.productLanguage,country_code:t.countryCode},"search_parameters[limit]","".concat(r)),this.appendUrlSearchParams(a.searchParams,s),e.abrupt("return",a.toString());case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"downloadCollectionDataRaw",value:(n=a()(d().mark(function e(t){var n,r,a,s,i,o,c,u,l,p,_,h,S,v,g,m,y;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=t.priority,a=t.id,s=void 0===a?T.v4():a,f.Z.get("TEMP_DEFAULT_TEMPLATES_DOWNLOADED")){e.next=1;break}return(i=new Date).setDate(i.getDate()+14),e.abrupt("return",{expirationDTS:i.toISOString(),templates:[]});case 1:return e.next=2,this.url(n);case 2:return o=e.sent,_=this,h=o,S={timeout:f.Z.get("SERVER_TIMEOUT"),headers:{"X-API-Key":f.Z.getEnvironment().CLIENT_ID,"X-Product":"".concat(n.productCode,"/").concat(n.productVersion),"Content-Type":"application/json"}},v=r,g=s,e.next=3,E.Z.getAccessToken().catch(function(e){return!1});case 3:return m=!!e.sent,y={url:h,options:S,priority:v,id:g,auth:m},e.next=4,_.get.call(_,y);case 4:return c=e.sent,u=c.response,e.next=5,this.getResponseJson(u,o);case 5:return"number"==typeof(l=e.sent).expirationDTS&&(p=new Date(1e3*l.expirationDTS),l.expirationDTS=p.toISOString()),e.abrupt("return",l);case 6:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}(we);const $t={AJO_SUPPORTED:!1,ANALYTICS_SUBCATEGORY:"Stock",LOOKUP_MAP_FILE_VERSION:3,LOOKUP_COLLECTION_FILE_VERSION:1,FILE_ACCESSOR_WRITE_ENABLED:!0,SUPPORTED_PRODUCTS:{IDSN:"12.0",IDSNBETA:"12.0",IDSNPR:"12.0",ILST:"21.0",ILSTPR:"21.0",ILSTBETA:"21.0",PHXS:"18.0",PHSP:"18.0",PHSPPR:"18.0",PHSPBETA:"18.0"},UNSUPPORTED_AFTER_VERSION:{},ACTIVE_VERSIONS:["V1"],V1:{PREFETCH_CLIENTS:{IDSN:"99.9",IDSNBETA:"99.9",IDSNPR:"99.9",ILST:"99.9",ILSTBETA:"99.9",ILSTPR:"99.9",PHXS:"99.9",PHSP:"99.9",PHSPPR:"99.9",PHSPBETA:"99.9"},PRODUCT_ALIASES:{PHSP:"PHXS",PHSPPR:"PHXS",PHSPBETA:"PHXS",IDSNBETA:"IDSN",IDSNPR:"IDSN",ILSTBETA:"ILST",ILSTPR:"ILST"}},PARAMETERS_SCHEMA:{id:"stock_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"},countryCode:{type:"string"}},required:["productCode","productVersion","productLanguage","countryCode"]},TEMPLATES_DATA_SCHEMA:{id:"STOCK_TEMPLATES_DATA",type:"object",properties:{templates:{type:"array"},expirationDTS:{type:"string"},nb_results:{type:"number"}},required:["expirationDTS"]},SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","en_AE","en_GB","en_IL","es_ES","es_MX","fi_FI","fr_FR","fr_CA","fr_MA","hu_HU","id_ID","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","th_TH","tr_TR","uk_UA","vi_VN","zh_CN","zh_TW"],LOG_PREFIX:"Stock",URL_STAGING:"https://stock-stage.adobe.io/Rest/Media/1/Search/Templates",URL_PRODUCTION:"https://stock.adobe.io/Rest/Media/1/Search/Templates",DIR:"stock/",LABEL:"STOCK",PRIORITY_CHANNEL:x.NU.Stock,ANONYMOUS_RETRY_DISABLED:!0,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!1,TEMP_DEFAULT_TEMPLATES_DOWNLOADED:100,ASSET_DOWNLOAD_TIMEOUT:3e5};function en(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(en=function(){return!!e})()}function tn(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var nn=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[$t],r=B()(r),(e=H()(n,en()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new zt(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new Jt(e,this)}},{key:"uninstall",value:(n=a()(d().mark(function e(n){var r,a,s=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},e.next=1,se.Z.getInstalledApps();case 1:if(!((a=e.sent)&&n.productCode&&a[n.productCode])){e.next=2;break}if(!Object.keys(a[n.productCode]).some(function(e){return r=a[n.productCode][e],_.Z.compareMajorMinorVersions(f.Z.get("SUPPORTED_PRODUCTS",s._type)[n.productCode],e,s.patchEnabledClient(n))>=0})){e.next=2;break}return this.log.disk("Not uninstalling ".concat(n.productCode,"[").concat(n.productVersion,"] because a competing key software still exists ").concat(r.SAPCode,"[").concat(r.CodexVersion,"]")),e.abrupt("return");case 2:return e.abrupt("return",tn(t,"uninstall",this,3)([n]));case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_getLookupKeys",value:function(e,t){var n=[t||E.Z.getUserId()||""];return n.push(e.productCode,e.productLanguage),n}}]);var n}(ge);function rn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(rn=function(){return!!e})()}var an=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,rn()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"totalItems",get:function(){return 1}},{key:"getReferencedAssets",value:(r=a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},this._data&&this._data.path&&(t[this._data.path]=!0),e.abrupt("return",t);case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"syncData",value:(n=a()(d().mark(function e(t){var n,r,a,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.priority,t.payload,a=t.params,null!==(n=this._data)&&void 0!==n&&null!==(n=n.images)&&void 0!==n&&n[100]){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,this._lookupMap.fetchAsset({href:this._data.images[100],assetsDir:this.assetsDir,priority:r,params:a});case 2:return s=e.sent,i=s.path,this._data.path=i,e.abrupt("return");case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}(ye);function sn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(sn=function(){return!!e})()}var on=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,sn()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"url",value:(r=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.Z.getEnvironment(),r=f.Z.get("URL_".concat(n.LABEL.toUpperCase()),this.type),a=new D.URL("".concat(r)),e.abrupt("return",a.toString());case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"downloadCollectionDataRaw",value:(n=a()(d().mark(function e(t){var n,r,s,i,o,c,u,l,p=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,r=t.priority,s=t.id,i=void 0===s?T.v4():s,e.next=1,this.url(n);case 1:return o=e.sent,e.next=2,this.log.context({params:n,analytics:!1}).time(function(){var e=a()(d().mark(function e(t){var n,a,s,c,u;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p.get({url:o,options:{method:"GET",timeout:f.Z.get("SERVER_TIMEOUT"),headers:{"content-type":"application/json","X-API-Key":f.Z.getEnvironment().CLIENT_ID}},priority:r,auth:!0,id:i});case 1:return n=e.sent,a=n.response,s=n.time,t.appendPayload({"event.value":s,"event.url":o,"env.svc.name":f.Z.get("ANALYTICS_SUBCATEGORY",p.type)}),c=Date.now(),e.next=2,p.getResponseJson(a,o);case 2:return u=e.sent,s+=Date.now()-c,e.abrupt("return",u);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:if(c=e.sent,u=f.Z.get("RESPONSE_SCHEMA",this.type),!(l=_.Z.validateDataFields(c,u))){e.next=3;break}throw new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,l);case 3:return c=this.postProcessContent(c,n),e.abrupt("return",c);case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"postProcessContent",value:function(e,t){var n=new Date;return n.setDate(n.getDate()+1),e.expirationDTS=n.toISOString(),e}}]);var n,r}(we);const cn={AJO_SUPPORTED:!1,ANALYTICS_SUBCATEGORY:"Avatar",LOG_PREFIX:"Avatar",DIR:"avatar/",LABEL:"AVATAR",VULCAN_TYPE:"Avatar",LOOKUP_MAP_FILE_VERSION:1,FILE_ACCESSOR_WRITE_ENABLED:!0,LOOKUP_COLLECTION_FILE_VERSION:1,PARAMETERS_SCHEMA:{id:"avatar_parameters",type:"object",properties:{}},ACTIVE_VERSIONS:["V1"],RESPONSE_SCHEMA:{id:"avatar_endpoint_schema_v2",type:"object",properties:{images:{type:"object",properties:{100:{type:"string"}},required:["100"]}},required:["images"]},SUPPORTED_PRODUCTS:{CCXP:"4.3"},UNSUPPORTED_AFTER_VERSION:{},URL_STAGING:"https://pps-stage.adobe.io/api/profile",URL_PRODUCTION:"https://pps.adobe.io/api/profile",PRIORITY_CHANNEL:x.NU.Avatar,ANONYMOUS_RETRY_DISABLED:!0,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!1,ASSET_DOWNLOAD_TIMEOUT:3e5};function un(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(un=function(){return!!e})()}var ln=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[cn],r=B()(r),(e=H()(n,un()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new on(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new an(e,this)}},{key:"uninstall",value:(n=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"_getLookupKeys",value:function(e,t){return[t||E.Z.getUserId()||""]}},{key:"isRequestPoisoned",value:function(e){return!1}},{key:"generateId",value:function(e){return"".concat(T.v4()).trim()}}]);var n}(ge);const pn={AJO_SUPPORTED:!0,LABEL:"COLLECTION_TEMPLATES",ANALYTICS_SUBCATEGORY:"CollectionTemplates",VULCAN_TYPE:"CollectionTemplates",LOG_PREFIX:"CollectionTemplates",LOOKUP_MAP_FILE_VERSION:2,LOOKUP_COLLECTION_FILE_VERSION:1,FILE_ACCESSOR_WRITE_ENABLED:!0,ACTIVE_VERSIONS:["V1"],DIR:"collectionTemplates/",SUPPORTED_PRODUCTS:{ILST:"26.0",ILSTPR:"26.0",ILSTBETA:"26.0"},UNSUPPORTED_AFTER_VERSION:{},PARAMETERS_SCHEMA:{id:"stock_collection_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"},countryCode:{type:"string"}},required:["productCode","productVersion","productLanguage","countryCode"]},TEMPLATES_DATA_SCHEMA:{id:"STOCK_COLLECTIONS_DATA",type:"object",properties:{templates:{type:"array"},expirationDTS:{type:"string"},nb_results:{type:"number"}},required:["expirationDTS"]},V1:{SURFACES:["CCX_Start_5.11_Stock"],PREFETCH_CLIENTS:{ILST:"99.0",ILSTBETA:"99.0",ILSTPR:"99.0"},PRODUCT_ALIASES:{ILSTBETA:"ILST",ILSTPR:"ILST"}},COLLECTION_URL_STAGING:"https://stock-stage.adobe.io/Rest/Media/1/Search/Collections",COLLECTION_URL_PRODUCTION:"https://stock.adobe.io/Rest/Media/1/Search/Collections",PRIORITY_CHANNEL:x.NU.CollectionTemplates,SURFACE_PRIORITY:{"CCX_Start_5.11_Stock":0},ANONYMOUS_RETRY_DISABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!1,SOPHIA_VERBOSE_FLAG_ENABLED:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,IGNORE_PERF_EVENTS_FOR_SURFACES:["CCX_Start_5.11_Stock"],GSDK_DEFAULT_EXPIRY_TIME:3};function dn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(dn=function(){return!!e})()}function fn(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var _n=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[pn],r=B()(r),(e=H()(n,dn()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new we(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new Le(e,this)}},{key:"updateParams",value:(r=a()(d().mark(function e(n){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,fn(t,"updateParams",this,3)([n]);case 1:return(r=e.sent).forEach(function(e){var t=a.getClientVersion(e);e.surfaceId=f.Z.get(t,a.type).SURFACES}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getCollectionAsset",value:(n=a()(d().mark(function e(t){var n,r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",{});case 1:return(n={})[t]=!0,e.next=2,S.readJson("".concat(this.getPath()).concat(t)).catch(function(e){a.log.error(new A.Z("filesystem",e))});case 2:return null==(r=e.sent)||r.files.forEach(function(e){e.thumbnail_url&&(n[e.thumbnail_url]=!0)}),e.abrupt("return",n);case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}(ge);const hn={AJO_SUPPORTED:!0,ANALYTICS_SUBCATEGORY:"Survey",LOOKUP_MAP_FILE_VERSION:1,LOOKUP_COLLECTION_FILE_VERSION:1,ASSET_MAX_SOCKETS:4,ASSET_MINIMUM_PARTIAL_SIZE:65536,FILE_ACCESSOR_WRITE_ENABLED:!0,SUPPORTED_PRODUCTS:{PHXS:"27.0",PHSP:"27.0",PHSPPR:"27.0",PHSPBETA:"27.0",ILST:"30.2",ILSTBETA:"30.2",ILSTPR:"30.2",PPRO:"25.6",PPROBETA:"25.6"},UNSUPPORTED_AFTER_VERSION:{},PARAMETERS_SCHEMA:{id:"psdk_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},LOG_PREFIX:"Survey",LABEL:"SURVEY",DIR:"survey/",VULCAN_TYPE:"Survey",PRIORITY_CHANNEL:x.NU.Survey,ANONYMOUS_RETRY_DISABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!0,SOPHIA_VERBOSE_FLAG_ENABLED:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,SUPPORTS_ON_DEMAND:!0,ACTIVE_VERSIONS:["V1"],V1:{PREFETCH_CLIENTS:{PHXS:"99.99",PHSP:"99.99",PHSPPR:"99.99",PHSPBETA:"99.99",ILST:"99.9",ILSTBETA:"99.9",ILSTPR:"99.9",PPRO:"99.9",PPROBETA:"99.9"},PRODUCT_ALIASES:{PHSP:"PHXS"},SURFACES:["NPS_SURVEY"],SURFACE_PRIORITY:{NPS_SURVEY:100},SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","en_AE","en_GB","en_IL","es_ES","es_MX","fi_FI","fr_FR","fr_CA","fr_MA","hu_HU","id_ID","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","th_TH","tr_TR","uk_UA","vi_VN","zh_CN","zh_TW"]},IGNORE_PERF_EVENTS_FOR_SURFACES:["NPS_SURVEY"],GSDK_DEFAULT_EXPIRY_TIME:2};function En(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(En=function(){return!!e})()}function Sn(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var vn=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[hn],r=B()(r),(e=H()(n,En()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new we(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new Le(e,this)}},{key:"updateParams",value:(n=a()(d().mark(function e(n){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Sn(t,"updateParams",this,3)([n]);case 1:return(r=e.sent).forEach(function(e){var t=a.getClientVersion(e);e.surfaceId=f.Z.get(t,a.type).SURFACES}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n}(ge);const gn={AJO_SUPPORTED:!0,LABEL:"GHOST",ANALYTICS_SUBCATEGORY:"Ghost",VULCAN_TYPE:"Ghost",LOG_PREFIX:"Ghost",LOOKUP_MAP_FILE_VERSION:1,LOOKUP_COLLECTION_FILE_VERSION:1,ACTIVE_VERSIONS:["V1"],DIR:"ghost/",FILE_ACCESSOR_WRITE_ENABLED:!1,SOPHIA_DISABLED:!0,SUPPORTED_PRODUCTS:{GHST:"2.0"},GC_ASSET_INFO:{EXCLUDE_GC_PATHS:["heroPath","thumbnailPath","playlistPath","tutorialPath","templatePath"],EXCLUDE_GC_MAP:["_assetPaths","_references"],PROCESS_JSON:["playlistPath","tutorialPath"]},UNSUPPORTED_AFTER_VERSION:{},CONTENT_PROCESSING_SUMMARY:"ContentProcessingSummary.json",PREFETCH_TEMPLATE_LIMIT:10,PARAMETERS_SCHEMA:{id:"ghost_parameters",type:"object",properties:{productCode:{type:"string"},productVersion:{type:"string"},productLanguage:{type:"string"}},required:["productCode","productVersion","productLanguage"]},V1:{SURFACES:["GHOST_CCD_ALL_APPS_BANNERS","GHOST_CCD_APPS_CATALOG","GHOST_CCD_APP_SKELETON","GHOST_CCD_PMP","GHOST_CCD_USER_FEEDBACK","GHOST_CCD_HOME_SKELETON","GHOST_CCD_FRAMEWORK","GHOST_CCD_QUICK_ACTIONS","GHOST_payment_notification_banner","GHOST_CCD_APPS_SKELETON","GHOST_CCD_APPS_CUSTOM_CARDS","GHOST_CCD_GENESIS","GHOST_CCD_FFE","GHOST_CCX_Start_5.11_Stock","GHOST_Discover_Panel","GHOST_DP_Tool_Techniques_v1","GHOST_in_app_contextual_notifications","GHOST_CCX_Start_4.0_Toast","GHOST_CCX_Start_4.0_Home","GHOST_CCX_Start_4.0_Whats_New","GHOST_CCX_Start_4.0_View_Plans","GHOST_PES_FEATURES","GHOST_illustrator_workspace","GHOST_illustrator_high_value_action","GHOST_illustrator_feature_flags","GHOST_illustrator_workspace_config","GHOST_PES_BROWSE_LEARN","GHOST_PES_ATLAS","GHOST_PES_WHATS_NEW","GHOST_CCX_Start_3.1_Tutorials","GHOST_LCM_LEARN_PANEL","GHOST_Ps_Feature_Flag"],PREFETCH_CLIENTS:{GHST:"999.999"},PRODUCT_ALIASES:{}},SUPPORTED_LOCALES:["cs_CZ","da_DK","de_DE","en_US","en_AE","en_GB","en_IL","es_ES","es_MX","fi_FI","fr_FR","fr_CA","fr_MA","hu_HU","id_ID","it_IT","ja_JP","ko_KR","nb_NO","nl_NL","pl_PL","pt_BR","ru_RU","sv_SE","th_TH","tr_TR","uk_UA","vi_VN","zh_CN","zh_TW"],PRIORITY_CHANNEL:x.NU.Ghost,NON_IDEMPOTENT_IMAGES:!0,SURFACE_PRIORITY:{},ANONYMOUS_RETRY_DISABLED:!0,DEFAULT_URLS_ENABLED:!1,MINOR_VERSION_SHOULD_UPDATE_CONTENT:!0,SOPHIA_VERBOSE_FLAG_ENABLED:!0,ASSET_DOWNLOAD_TIMEOUT:3e5,IGNORE_PERF_EVENTS_FOR_SURFACES:[],GSDK_DEFAULT_EXPIRY_TIME:2};function Tn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Tn=function(){return!!e})()}var mn=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,Tn()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"downloadCollectionDataRaw",value:(n=a()(d().mark(function e(t){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.params,t.priority,void 0===t.id&&T.v4(),t.skipAuth,(n=new Date).setDate(n.getDate()+1),e.next=1,_.Z.setTimeoutAsync(10);case 1:return e.abrupt("return",{expirationDTS:n.toISOString(),surfaces:{}});case 2:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(we);function yn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(yn=function(){return!!e})()}var On=function(e){function t(){return i()(this,t),e=this,n=t,r=arguments,n=B()(n),H()(e,yn()?Reflect.construct(n,r||[],B()(e).constructor):n.apply(e,r));var e,n,r}return X()(t,e),c()(t,[{key:"getReferencedTutorialsOrPlaylists",value:(r=a()(d().mark(function e(t){var n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},t.tutorials?null===(r=t.tutorials)||void 0===r||r.forEach(function(e){if(e&&e.metadata&&e.metadata.images){var t=e.metadata.images;t.heroPath&&(n[t.heroPath]=!0),t.thumbnailPath&&(n[t.thumbnailPath]=!0)}}):t.playlists&&(null===(a=t.playlists)||void 0===a||a.forEach(function(e){if(e&&e.images){var t=e.images;t.heroPath&&(n[t.heroPath]=!0),t.thumbnailPath&&(n[t.thumbnailPath]=!0)}})),e.abrupt("return",n);case 1:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"getReferencedAssets",value:(n=a()(d().mark(function e(){var t,n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=1,_.Z.waitAll(Object.keys(this._data.surfaces||{}).map(function(){var e=a()(d().mark(function e(r){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,_.Z.waitAll((n._data.surfaces[r].containers||[]).map(function(){var e=a()(d().mark(function e(s){var i,o,c,u,l,p,h,E,g,T;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.path&&(t[s.path]=!0),s.containerLabel!==f.Z.get("USER_INTENT_DIALOG")){e.next=3;break}return l=Object,p=t,e.next=1,n.dataManager.getReferencedAssets(r,s,n._lookupMap);case 1:return h=e.sent,l.assign.call(l,p,h),e.next=2,_.Z.waitAll((null===(u=s.content)||void 0===u||null===(u=u.data)||void 0===u||null===(u=u.userintentByPath)||void 0===u||null===(u=u.item)||void 0===u||null===(u=u.pages)||void 0===u||null===(u=u.recommendations)||void 0===u||null===(u=u.items)||void 0===u?void 0:u.map(function(){var e=a()(d().mark(function e(r){var a,s,i,o,c,u;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.path){e.next=3;break}return(a={})[r.path]=!0,e.next=1,S.readJson(n.assetsDir+"/"+v.basename(r.path)).catch(function(e){return delete a[r.path],{}});case 1:return s=e.sent,i=Object,o=t,c=a,e.next=2,n.getReferencedTutorialsOrPlaylists(s);case 2:u=e.sent,i.assign.call(i,o,c,u);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()))||[]);case 2:e.next=11;break;case 3:if(!Array.isArray(null===(i=s.content)||void 0===i?void 0:i.tutorials)){e.next=5;break}return e.next=4,_.Z.waitAll(s.content.tutorials.map(function(){var e=a()(d().mark(function e(n){var r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n&&n.metadata&&n.metadata.images&&(r=n.metadata.images).heroPath&&(t[r.heroPath]=!0);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 4:e.next=11;break;case 5:if(!Array.isArray(null===(o=s.content)||void 0===o?void 0:o.playlists)){e.next=7;break}return e.next=6,_.Z.waitAll(s.content.playlists.map(function(){var e=a()(d().mark(function e(r){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,_.Z.waitAll(Object.values(r.tutorial_paths||{}).map(function(){var e=a()(d().mark(function e(r){var a,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object,s=t,e.next=1,n._lookupMap.getTutorialAssets(r);case 1:i=e.sent,a.assign.call(a,s,i);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 6:e.next=11;break;case 7:if(!Array.isArray(null===(c=s.content)||void 0===c||null===(c=c.data)||void 0===c?void 0:c.recommendations)){e.next=9;break}return e.next=8,_.Z.waitAll(s.content.data.recommendations.map(function(){var e=a()(d().mark(function e(r){var s,i,o,c,u,l;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=Object,u=t,e.next=1,n._lookupMap.getTutorialAssets(null===(s=r.content)||void 0===s?void 0:s.path);case 1:l=e.sent,c.assign.call(c,u,l),"quickAction"===(null===(i=r.content)||void 0===i?void 0:i.type)&&null!==(o=r.content)&&void 0!==o&&o.assetPaths&&_.Z.waitAll(Object.keys(r.content.assetPaths).map(function(){var e=a()(d().mark(function e(n){var a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(a=r.content.assetPaths[n])&&(t[a]=!0);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 8:e.next=11;break;case 9:return t[s.path]=!0,E=Object,g=t,e.next=10,n.dataManager.getReferencedAssets(r,s,n._lookupMap);case 10:T=e.sent,E.assign.call(E,g,T);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:return e.abrupt("return",t);case 2:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]);var n,r}(Le);function An(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(An=function(){return!!e})()}function Cn(e,t,n,r){var a=W()(B()(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}var In=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,a=[gn],r=B()(r),(e=H()(n,An()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)))._downloadManager=new mn(e.type),e}return X()(t,e),c()(t,[{key:"_createCollectionData",value:function(e){return new On(e,this)}},{key:"updateParams",value:(r=a()(d().mark(function e(n){var r,a=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Cn(t,"updateParams",this,3)([n]);case 1:return(r=e.sent).forEach(function(e){var t=a.getClientVersion(e);e.surfaceId=f.Z.get(t,a.type).SURFACES}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getTutorialAssets",value:(n=a()(d().mark(function e(t){var n,r,a,s=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",{});case 1:return(r={})[t]=!0,e.next=2,S.readJson("".concat(this.getPath()).concat(t)).catch(function(e){s.log.error(new A.Z("filesystem",e))});case 2:return null==(a=e.sent)||null===(n=a.tutorials)||void 0===n||n.forEach(function(e){var t,n;null!==(t=e.metadata)&&void 0!==t&&null!==(t=t.images)&&void 0!==t&&t.heroPath&&(r[e.metadata.images.heroPath]=!0),null!==(n=e.metadata)&&void 0!==n&&null!==(n=n.images)&&void 0!==n&&n.thumbnailPath&&(r[e.metadata.images.thumbnailPath]=!0)}),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}(ge);function Rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Nn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rn(Object(n),!0).forEach(function(t){l()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function kn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(kn=function(){return!!e})()}var Pn=function(e){function t(e){var n,r,a,s;return i()(this,t),r=this,a=t,a=B()(a),n=H()(r,kn()?Reflect.construct(a,s||[],B()(r).constructor):a.apply(r,s)),l()(n,"log",void 0),l()(n,"maps",void 0),l()(n,"_downloadManager",void 0),l()(n,"exitCalled",void 0),n.log=new h.Z({prefix:"ServiceInterface > ",payload:{"event.subtype":b.Z.st_CLIENT},combineSubErrors:!0}),n.exitCalled=!1,n.maps=e,n}return X()(t,e),c()(t,[{key:"exit",value:(r=a()(d().mark(function e(){var t=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.exitCalled){e.next=3;break}return this.exitCalled=!0,this.log.disk("Beginning exit procedure from CCXP exit."),e.next=1,pe.Z.shutdown();case 1:return this.log.disk("Flushing ingest logs."),e.next=2,b.Z.flush(!0,function(){t.log.disk("Flush completed."),t.removeEventsListener(),setTimeout(function(){t.log.disk("Shutting down process."),process.exit()},1e3)});case 2:e.next=4;break;case 3:this.log.disk("CCXP exit procedure already running.");case 4:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"removeEventsListener",value:function(){null==this||this.removeAllListeners(),null===G.Z||void 0===G.Z||G.Z.removeAllListeners(),null===F.Z||void 0===F.Z||F.Z.removeAllListeners(),se.Z.removeAllListenersVulcan(),se.Z.releaseInstance(),E.Z.shutdown()}},{key:"init",value:(n=a()(d().mark(function e(){var t=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:se.Z.addListener(f.Z.get("VULCAN_PING_REQUEST"),function(e,t,n){se.Z.sendMessage(f.Z.get("VULCAN_PING_RESPONSE"),"",t,n)}),se.Z.addListener(f.Z.get("VULCAN_AVATAR_REQUEST"),function(e,n,r){var s=t.log.context({payload:{"event.subcategory":f.Z.analytics.sc_CCX_START}}),i=n,o=r;e=JSON.stringify({params:{productCode:n,productVersion:r,productLanguage:"en_US"}}),se.Z.once(f.Z.get("VULCAN_AVATAR_RESPONSE_V2"),function(){var e=a()(d().mark(function e(t,n,r){var c,u,l,p;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t=JSON.parse(t)).path){e.next=2;break}return e.next=1,S.readFile(t.path,{encoding:"utf-8"});case 1:u=e.sent,l=JSON.parse(u),c={path:"".concat(f.Z.get("ROOT_DIR")).concat(f.Z.get("DIR","AVATAR")).concat(l.path)};case 2:e.next=4;break;case 3:e.prev=3,p=e.catch(0),s.error(new A.Z(f.Z.analytics.INVALID_JSON,p),"Unable to parse avatar message: ".concat(t)),c={path:"",err:"Unable to parse avatar message: ".concat(t)};case 4:s.request(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:se.Z.sendMessage(f.Z.get("VULCAN_AVATAR_RESPONSE"),JSON.stringify(c),i,o);case 1:case"end":return e.stop()}},e)})));case 5:case"end":return e.stop()}},e,null,[[0,3]])}));return function(t,n,r){return e.apply(this,arguments)}}()),se.Z.sendMessage(f.Z.get("VULCAN_AVATAR_REQUEST_V2"),e,"CCXP","1.0.0")}),se.Z.addListener(f.Z.get("VULCAN_GET_USER_REQUEST"),function(){var e=a()(d().mark(function e(n,r,s){var i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.log.context({payload:{"event.subcategory":f.Z.analytics.sc_CCX_START}}),e.next=1,i.request(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:se.Z.sendMessage(f.Z.get("VULCAN_GET_USER_RESPONSE"),{userId:E.Z.getUserId()},r,s);case 1:case"end":return e.stop()}},e)})));case 1:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),se.Z.addListener(f.Z.get("VULCAN_START_SETTINGS_REQUEST"),function(){var e=a()(d().mark(function e(n,r,s){var i,o,c;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=null,o=null;try{o=JSON.parse(n)}catch(e){i=new Error("Unable to parse settings storage request from ".concat(r,"(").concat(s,"): ").concat(n))}return c=t.log.context({params:o,payload:{"event.subcategory":b.Z.sc_CCX_START}}),e.next=1,c.request(a()(d().mark(function e(){var t,n,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=1;break}throw i;case 1:if(E.Z.getUserId()){e.next=2;break}throw new Error("Discarding start settings storage - not logged in");case 2:if(E.Z.getUserId()===o.userId){e.next=3;break}throw new Error("Different user in request(".concat(o.userId,") than the one logged in(").concat(E.Z.getUserId(),")"));case 3:t="".concat(o.productCode,"_PSDK"),n="SETTINGS_".concat(E.Z.getUserId()),r=f.Z.get(t,n)||{},Object.keys(o.settings).forEach(function(e){r[e]?Object.assign(r[e],o.settings[e]):r[e]=o.settings[e]}),r.lastModified=(new Date).toISOString(),f.Z.set(t,r,n);case 4:case"end":return e.stop()}},e)}))).catch(function(e){return o=null});case 1:o&&se.Z.sendMessage(f.Z.get("VULCAN_START_SETTINGS_PATCH_UPDATE"),{settings:o.settings,userId:o.userId},o.productCode);case 2:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),se.Z.addListener(f.Z.get("VULCAN_START_SETTINGS_GET_REQUEST"),function(){var e=a()(d().mark(function e(n,r,a){var s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s={},i=t.log.context({params:{productCode:r,productVersion:a},payload:{"event.subcategory":b.Z.sc_CCX_START,"event.subtype":b.Z.st_SETTINGS}});try{s=JSON.parse(n)}catch(e){i.error(new Error("Unable to parse settings get request from ".concat(r,"(").concat(a,"): ").concat(n)))}se.Z.sendMessage(f.Z.get("VULCAN_START_SETTINGS_GET_RESPONSE"),{requestId:s.requestId,userId:E.Z.getUserId(),settings:f.Z.get("".concat(r,"_PSDK"),"SETTINGS_".concat(E.Z.getUserId()))||{}},r,a);case 1:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),se.Z.addListener(f.Z.get("VULCAN_CC_PHOTO_DOWNLOAD_REQUEST"),function(){var e=a()(d().mark(function e(n,r,s){var i,o,c,u,l,p;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o="OZ",c=f.Z.analytics.sc_LR_CONTENT,u=f.Z.analytics.sc_OZ,e.prev=1,(i=JSON.parse(n)).source&&i.source===f.Z.get("CC_SEARCH_IDENTIFIER")&&(o="CCSearch",c=f.Z.analytics.sc_CC_SEARCH,u=f.Z.analytics.sc_CC_SEARCH_STORAGE),i.source&&i.source===f.Z.get("CC_TOUT_DOWNLOAD_IDENTIFIER")&&(o="CCXFileDownload",c=f.Z.analytics.sc_CCX_FILE_DOWNLOAD,u=i.downloadSubcategory),e.next=3;break;case 2:return e.prev=2,p=e.catch(1),se.Z.sendMessage(f.Z.get("VULCAN_CC_PHOTO_DOWNLOAD_ERROR"),p.toString(),r,s),t.log.context({payload:{"event.subcategory":f.Z.analytics.sc_CC_PHOTO,"source.name":r,"source.version":s,"ccxp.mode":"download"}}).error(new A.Z(p)),e.abrupt("return");case 3:return e.next=4,t.log.context({payload:{"event.subcategory":c,"source.name":r,"source.version":s,"ccxp.mode":"download"}}).request(a()(d().mark(function e(){var n,c,l,p;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.join(y.tmpdir(),f.Z.get("TMP_PHOTOS_DOWNLOAD_DIRECTORY")),c="".concat(i.id,"-").concat(i.filename),l=n+c,p={id:i.id,path:l.replace(/\\/g,"/")},e.next=1,S.access(l,S.constants.R_OK).catch(function(){var e=a()(d().mark(function e(n){var c,p,_,h;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._downloadManager=t._downloadManager||new we(o),c=T.v4(),e.next=1,t.log.context({payload:{"event.subcategory":u,"event.subtype":f.Z.analytics.st_API,"source.name":r,"source.version":s,"ccxp.mode":"download"}}).request(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t._downloadManager.get({url:i.url,options:{headers:{"x-api-key":i.clientId}},auth:!0,id:c});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})));case 1:return p=e.sent,_=p.response,h=_.headers.get("content-length"),e.next=2,N.writeAtomic({response:_,target:l,progress:function(e){se.Z.sendMessage(f.Z.get("VULCAN_CC_PHOTO_DOWNLOAD_PROGRESS"),{id:i.id,percentage:100*e/h},r,s)}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.next=2,_.Z.deleteTempFiles(n,void 0).catch(function(e){return t.log.disk("Err deleting temp files - ".concat(e))});case 2:return e.abrupt("return",p);case 3:case"end":return e.stop()}},e)}))).catch(function(e){se.Z.sendMessage(f.Z.get("VULCAN_CC_PHOTO_DOWNLOAD_ERROR"),e.toString(),r,s)});case 4:(l=e.sent)&&se.Z.sendMessage(f.Z.get("VULCAN_CC_PHOTO_DOWNLOAD_RESPONSE"),l,r,s);case 5:case"end":return e.stop()}},e,null,[[1,2]])}));return function(t,n,r){return e.apply(this,arguments)}}()),this.maps.forEach(function(e){var n=f.Z.get("VULCAN_TYPE",e.type),r=function(){var r=a()(d().mark(function r(s,i,o,c){var u,l,p,h,S,v,g,T,m,y,O,C,I,R,N=arguments;return d().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:l=N.length>4&&void 0!==N[4]?N[4]:"client-request",h={};try{h=JSON.parse(s)}catch(e){p=new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,"Unable to parse ".concat(n," request:").concat(s))}if(S=void 0,v=null,g=h.params||{},T=h.analytics||{},h.force&&((m=h.force).delay?(l="delayed",S=m.delay):"always"===m.type?l="force-always":"stale"===m.type&&(l="expired")),y=t.log.context({params:g,payload:Nn(Nn(Nn({},T),{},{"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",e.type),"ccxp.mode":l},"client-request"!==l&&{"ccxp.force_depth":null===(u=h)||void 0===u||null===(u=u.force)||void 0===u?void 0:u.depth}),void 0!==S&&{"event.value":S})}),(O=function(){null!=v&&clearTimeout(v),v=c?setTimeout(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return y.error(new A.Z("CCX Process Hung. Quitting",void 0,"X_ERR_PROCESS_HUNG")),e.next=1,t.exit();case 1:case"end":return e.stop()}},e)})),f.Z.get("CLIENT_REQUEST_TIMEOUT")):null})(),Q.Z.status!==Q.Z.OFFLINE&&!k.Z.isWaitingForBackOff(k.E.NETWORK)){r.next=1;break}return t.log.disk("Incoming client Request while in Network Backoff or Offline - Doing network Check"),r.next=1,Q.Z.check(Q.S.CLIENT_REQUEST);case 1:return C=!1,I=_.Z.validateDataFields(h,f.Z.get("SERVICE_REQUEST_SCHEMA")),p||I||!e.isRequestPoisoned(g)||(C=!0),r.next=2,y.context({silence:!!C}).request(a()(d().mark(function t(){var r,a;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!p){t.next=1;break}throw p;case 1:if(E.Z.getUserId()){t.next=2;break}throw new A.Z(f.Z.analytics.SIGNED_OUT,f.Z.analytics.SIGNED_OUT,"X_ERR_USER_SIGNEDOUT");case 2:if(!Array.isArray(I)){t.next=3;break}throw new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,I[0]);case 3:if(!h.displayed){t.next=4;break}return t.next=4,e.updateDisplayedId(h);case 4:if(c){t.next=6;break}if(!h.updateLastUseTime){t.next=5;break}return t.next=5,e.getLatestPath(h);case 5:return t.abrupt("return");case 6:return r={requestId:h.requestId},t.next=7,e.addNewCollectionData({params:g,payload:T,priorityLevel:h.urgent?x.o7.UrgentRequest:x.o7.BackgroundRequest,force:Nn(Nn({type:"none"},h.force),{},{from:Date.now()}),fetchType:l,progress:function(e){e.requestId=h.requestId,se.Z.sendMessage("ccxprocess.".concat(n,"Progress"),e,i,o),O()}});case 7:if(a=t.sent,!S){t.next=8;break}r.scheduled=!0,t.next=10;break;case 8:return t.next=9,e.getLatestPath({params:g,updateLastUsedId:!0,updateLastUseTime:h.urgent?!1!==h.updateLastUseTime:h.updateLastUseTime});case 9:r.path=t.sent,r.contentId=null==a?void 0:a.id,r.expiry=a&&e.getExpiry(a.id)||(null==a?void 0:a.expiryTime);case 10:return t.abrupt("return",r);case 11:case"end":return t.stop()}},t)}))).catch(function(){var t=a()(d().mark(function t(n){var r,a,s,i,o,c;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=void 0,s=void 0,!(n instanceof A.Z&&null!==(r=n.supportData)&&void 0!==r&&r.id)){t.next=2;break}return t.next=1,e.updatePending({params:g,id:null===(i=n.supportData)||void 0===i?void 0:i.id,updateLastUseTime:h.urgent||h.updateLastUseTime||!1,err:n});case 1:a=null===(o=n.supportData)||void 0===o?void 0:o.path,s=n.subErrorJSON,t.next=4;break;case 2:return t.next=3,e.getPending({params:g,updateLastUseTime:h.urgent||h.updateLastUseTime||!1});case 3:c=t.sent,a=null==c?void 0:c.partial,s=null==c?void 0:c.failures;case 4:return a&&(a=e.getPath()+a),t.abrupt("return",Nn(Nn({requestId:h.requestId,err:n instanceof Error&&!(n instanceof A.Z)?{message:n.message}:n},void 0!==a&&{partial:a}),{},{failures:s}));case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:R=r.sent,c&&(null!=v&&clearTimeout(v),se.Z.sendMessage("ccxprocess.".concat(n,"Response"),R,i,o));case 3:case"end":return r.stop()}},r)}));return function(e,t,n,a){return r.apply(this,arguments)}}();se.Z.addListener("ccxprocess.".concat(n,"Request"),function(e,t,n){return r(e,t,n,!0)}),se.Z.addListener("ccxprocess.".concat(n,"UsageMarker"),function(e,t,n){return r(e,t,n,!1,"usage-marker")}),e.addListener("newCollection",function(){var t=a()(d().mark(function t(r,a){var s,i,o,c,u,l,p,f,_;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.targetDetails(r),i=se.Z,o="ccxprocess.".concat(n,"Broadcast"),c=r,t.next=1,e.getLatestPath({params:r});case 1:u=t.sent,l=a.id,p={params:c,path:u,contentId:l},f=s.productCode,_=s.productVersion,i.sendMessage.call(i,o,p,f,_);case 2:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()),e.addListener("queueGSDKUpdate",function(){var n=a()(d().mark(function n(r,a){var s,i,o,c,u;return d().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=1,e.updateParams([r]);case 1:return r=n.sent[0],r=e.sanitizeParams(r),s={"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",e.type),"content.type":f.Z.analytics.GSDK,"ccxp.mode":"gsdk-update","event.subtype":f.Z.analytics.st_GSDK_UPDATE},i=t.log.context({params:r,payload:s}),n.next=2,E.Z.getUserId();case 2:return o=n.sent,n.next=3,pe.Z.getUserIdFromGsdk();case 3:c=n.sent,o?o!==c?(i.disk("Logged in users do not match."),c?i.error(new A.Z(f.Z.analytics.USER_ID_MISMATCH,"Recieved gsdk userId ".concat(c),f.Z.analytics.CCXP_USER_DIFFERENT)):i.error(new A.Z(f.Z.analytics.USER_ID_MISMATCH,"Recieved gsdk userId ".concat(c),f.Z.analytics.GSDK_USER_LOGGED_OUT))):(u=e._getGSDKUpdateKeys(r),e._gsdkUpdateRunner[u]&&clearTimeout(e._gsdkUpdateRunner[u]),e._gsdkUpdateRunner[u]=setTimeout(function(){e.emit("updateGSDKCollection",r,a,i)},pe.Z.queueTimeout)):(i.disk("No logged in user, skipping GSDK update."),c&&i.error(new A.Z(f.Z.analytics.USER_ID_MISMATCH,"Recieved gsdk userId ".concat(c),f.Z.analytics.GSDK_USER_LOGGED_IN)));case 4:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()),e.addListener("updateGSDKCollection",function(){var t=a()(d().mark(function t(n,r,s){var i;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s.context({params:n}).disk("".concat(e.type," received update from GSDK")),i={"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",e.type),"content.type":f.Z.analytics.GSDK,"ccxp.mode":"gsdk-update","event.subtype":f.Z.analytics.st_GSDK_UPDATE},t.next=1,e.addNewGSDKCollectionData({params:n,payload:i,priorityLevel:x.o7.UrgentRequest,force:{type:"always",depth:0},fetchType:r,progress:function(e){},log:s}).then(function(){var t=a()(d().mark(function t(n){var r;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r={type:"none"},e.sync({force:r});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(e){});case 1:case"end":return t.stop()}},t)}));return function(e,n,r){return t.apply(this,arguments)}}()),f.Z.get("SUPPORTS_ON_DEMAND",e.type)&&(se.Z.addListener("ccxprocess.".concat(n,"OnDemandRequest"),function(){var r=a()(d().mark(function r(s,i,o){var c,u,l,p,h,S,g,T,m,y,O;return d().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:try{h=JSON.parse(s)}catch(e){S=new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,"Unable to parse ".concat(n," request:").concat(s))}if(g=(null===(c=h)||void 0===c?void 0:c.params)||{},T=(null===(u=h)||void 0===u?void 0:u.analytics)||{},m=t.log.context({params:g,payload:Nn(Nn({},T),{},{"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",e.type),"ccxp.mode":"on-demand","ccxp.request_type":null!==(l=null===(p=h)||void 0===p?void 0:p.action)&&void 0!==l?l:"get"})}),y=null,function(){null!=y&&clearTimeout(y),y=setTimeout(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m.error(new A.Z("CCX Process Hung. Quitting",void 0,"X_ERR_PROCESS_HUNG")),e.next=1,t.exit();case 1:case"end":return e.stop()}},e)})),f.Z.get("CLIENT_REQUEST_TIMEOUT"))}(),Q.Z.status!==Q.Z.OFFLINE&&!k.Z.isWaitingForBackOff(k.E.NETWORK)){r.next=1;break}return t.log.disk("Incoming On Demand Request while in Network Backoff or Offline - Doing network Check"),r.next=1,Q.Z.check(Q.S.ONDEMAND_REQUEST);case 1:return r.next=2,m.request(a()(d().mark(function t(){var r,a,s,c,u,l,p,T,m,y,O,A,C;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!S&&h){t.next=1;break}throw S;case 1:if(E.Z.getUserId()){t.next=2;break}throw new Error(f.Z.analytics.SIGNED_OUT);case 2:if(s=_.Z.validateDataFields(h,f.Z.get("ON_DEMAND_REQUEST_SCHEMA")),!Array.isArray(s)){t.next=3;break}throw s[0];case 3:c=null!==(r=null===(a=h)||void 0===a?void 0:a.action)&&void 0!==r?r:"get",u={requestId:h.requestId},m=c.toLowerCase(),t.next="get"===m?4:"pause"===m?6:"delete"===m?8:11;break;case 4:return l=e.paramsToOnDemandId(h.params||{}),p=function(e){var t;se.Z.sendMessage("ccxprocess.".concat(n,"OnDemandProgress"),Nn(Nn({},e),{},{requestId:null===(t=h)||void 0===t?void 0:t.requestId}),i,o)},l&&e.on(l,p),y=v,O=e.getPath(),t.next=5,e.getOnDemandData({params:h.params,force:h.force,updateLastUseTime:!0,priorityLevel:x.o7.UrgentRequest}).finally(function(){l&&e.off(l,p)});case 5:return A=t.sent,C=O+A,u.path=y.normalize.call(y,C),l&&e.off(l,p),t.abrupt("continue",11);case 6:return t.next=7,e.onDemandAbort(h.params);case 7:return t.abrupt("continue",11);case 8:return t.next=9,e.onDemandAbort(h.params);case 9:return t.next=10,e.clearOnDemandCollectionInfo(g,e.paramsToOnDemandId(g),!1);case 10:return T={type:"none"},e.sync({force:T}),t.abrupt("continue",11);case 11:return t.abrupt("return",u);case 12:case"end":return t.stop()}},t)}))).catch(function(e){var t;return{requestId:null===(t=h)||void 0===t?void 0:t.requestId,err:e instanceof Error&&!(e instanceof A.Z)?{message:e.message}:e}});case 2:O=r.sent,null!=y&&clearTimeout(y),se.Z.sendMessage("ccxprocess.".concat(n,"OnDemandResponse"),O,i,o);case 3:case"end":return r.stop()}},r)}));return function(e,t,n){return r.apply(this,arguments)}}()),se.Z.addListener("ccxprocess.".concat(n,"OnDemandListRequest"),function(){var r=a()(d().mark(function r(s,i,o){var c,u,l,p,h,E,S,g;return d().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:try{l=JSON.parse(s)}catch(e){p=new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,"Unable to parse ".concat(n," request:").concat(s))}return h=(null===(c=l)||void 0===c?void 0:c.params)||{},E=(null===(u=l)||void 0===u?void 0:u.analytics)||{},S=t.log.context({params:h,payload:Nn(Nn({},E),{},{"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",e.type),"ccxp.mode":"on-demand","ccxp.request_type":"list"})}),r.next=1,S.request(a()(d().mark(function t(){var n,r,a,s;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!p&&l){t.next=1;break}throw p;case 1:if(r=_.Z.validateDataFields(l,f.Z.get("ON_DEMAND_LIST_REQUEST_SCHEMA")),!Array.isArray(r)){t.next=2;break}throw r[0];case 2:if(l.params){t.next=3;break}throw new A.Z(f.Z.analytics.PARAM_VALIDATION_ERR,"Need params to get the list for");case 3:return a=e.getOnDemandCollection(l.params),s=[],a&&(s=Object.keys(a).map(function(t){var n,r={key:t,state:a[t]},s=null===(n=e.cachedAsset(t))||void 0===n?void 0:n.path;return s&&(r.path=v.normalize(e.getPath()+s)),r})),t.abrupt("return",{requestId:null===(n=l)||void 0===n?void 0:n.requestId,list:s});case 4:case"end":return t.stop()}},t)}))).catch(function(e){var t;return{requestId:null===(t=l)||void 0===t?void 0:t.requestId,err:e instanceof Error&&!(e instanceof A.Z)?{message:e.message}:e}});case 1:g=r.sent,se.Z.sendMessage("ccxprocess.".concat(n,"OnDemandListResponse"),g,i,o);case 2:case"end":return r.stop()}},r)}));return function(e,t,n){return r.apply(this,arguments)}}()))}),se.Z.sendMessage(f.Z.get("VULCAN_STARTUP_MESSAGE"),"","","");case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]);var n,r}(ee),Ln=n(2917),Dn=n(3105);const xn=new(function(){return c()(function e(){var t=this;i()(this,e),l()(this,"isKillSwitchEnabled",_.Z.memoize(function(){var e=a()(d().mark(function e(n){var r,a,s,i,o,c,u,l,p,h,E,S,v,g;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=f.Z.get("TEMP_STOCK_TEMPLATE_DOWNLOAD_LIMIT_REGISTRY_SETTING"),a=f.Z.get("TEMP_CCD_CONTENT_DOWNLOAD_REGISTRY_SETTING"),s=f.Z.get("TEMP_NETWORK_STATUS_REGISTRY_SETTING"),i=function(e,t){t&&(null!==t[r]&&void 0!==t[r]&&f.Z.set("TEMP_DEFAULT_TEMPLATES_DOWNLOADED",parseInt(t[r])),f.Z.set("TEMP_CCD_CONTENT_DOWNLOAD_DISABLED",!!parseInt(t[a])),f.Z.set("TEMP_NETWORK_STATUS_DISABLED",!!parseInt(t[s]))),n(e,t)},!_.Z.isWindows()){e.next=5;break}return o={},e.prev=1,u=null,l=null,p=null,e.next=2,t.getRegistryByKey(Dn.HKLM,f.Z.get("TEMP_KILL_SWITCH_REGISTRY_KEY"));case 2:if(h=e.sent)for(E=0;E<h.length;E++)h[E].name===r?u=h[E].value:h[E].name===a?l=h[E].value:h[E].name===s&&(p=h[E].value);o[r]=u,o[a]=l,o[s]=p,i(c,o),e.next=4;break;case 3:e.prev=3,g=e.catch(1),i(c=g,o);case 4:e.next=6;break;case 5:try{S=Ln.readFileSync(f.Z.get("TEMP_KILL_SWITCH_PLIST_PATH"))}catch(e){v=e}i(v,S);case 6:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}(),{timeout:f.Z.get("KILLSWITCH_MEMOIZE_TIMEOUT")}))},[{key:"getRegistryByKey",value:(e=a()(d().mark(function e(t,n){var r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Dn({hive:t,key:n}),a=function(){return new Promise(function(e){r.values(function(t,n){t?e(null):n&&n.length?e(n):e(null)})})},e.abrupt("return",a());case 1:case"end":return e.stop()}},e)})),function(t,n){return e.apply(this,arguments)})}]);var e}());var bn=n(4482);function wn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Un(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Un(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function Un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Mn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Mn=function(){return!!e})()}var Zn=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,r=B()(r),e=H()(n,Mn()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)),l()(e,"log",void 0),l()(e,"maps",void 0),e.log=new h.Z({prefix:"DebugInterface > ",payload:{"event.subcategory":f.Z.analytics.sc_PROCESS,"event.subtype":f.Z.analytics.st_ANS}}),e.maps=[],e}return X()(t,e),c()(t,[{key:"init",value:function(e){this.log.disk("**********Initializing DEBUG Interface*****"),this.addNetworkDebugListeners(),this.maps=e}},{key:"addNetworkDebugListeners",value:(n=a()(d().mark(function e(){var t=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,se.Z.addListener("TRIGGER_OS_NETWORK_NOTIFCATION",function(){t.log.disk("Triggering Reachability Notification: ",bn.ReachabilityChanged),Q.Z.emit(bn.ReachabilityChanged)});case 1:return e.next=2,se.Z.addListener("TOGGLE_NETWORK_STATUS",a()(d().mark(function e(){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="[DEBUG_INTERFACE]"+T.v4(),e.next=1,Q.Z.isOnline();case 1:if(e.sent){e.next=3;break}return t.log.disk("Current Network Status is OFFLINE. Moving to Online. ID ".concat(n)),e.next=2,Q.Z.emitAndSetStatus(Q.Z.ONLINE,Q.Z.OFFLINE,n);case 2:e.next=4;break;case 3:return t.log.disk("Current Network Status is ONLINE. Moving to Offline. ID ".concat(n)),e.next=4,Q.Z.emitAndSetStatus(Q.Z.OFFLINE,Q.Z.ONLINE,n);case 4:case"end":return e.stop()}},e)})));case 2:return e.next=3,se.Z.addListener("TRIGGER_CLIENT_SYNC",function(){var e=a()(d().mark(function e(n){var r,a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r={type:"none"},a=wn(t.maps),e.prev=1,i=d().mark(function e(){var a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=s.value).type!==n){e.next=1;break}return console.log("******** TRIGGERING Client SYNC: ",n),e.next=1,a.sync({force:r}).catch(function(e){t.log.disk("Failed to sync ".concat(a.type),e)});case 1:case"end":return e.stop()}},e)}),a.s();case 2:if((s=a.n()).done){e.next=4;break}return e.delegateYield(i(),"t0",3);case 3:e.next=2;break;case 4:e.next=6;break;case 5:e.prev=5,o=e.catch(1),a.e(o);case 6:return e.prev=6,a.f(),e.finish(6);case 7:case"end":return e.stop()}},e,null,[[1,5,6,7]])}));return function(t){return e.apply(this,arguments)}}());case 3:return e.next=4,se.Z.addListener("SET_ONLINE",a()(d().mark(function e(){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n="[DEBUG_INTERFACE]"+T.v4(),t.setOnline(n);case 1:case"end":return e.stop()}},e)})));case 4:return e.next=5,se.Z.addListener("SET_OFFLINE",a()(d().mark(function e(){var n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n="[DEBUG_INTERFACE]"+T.v4(),t.setOffline(n);case 1:case"end":return e.stop()}},e)})));case 5:return e.next=6,se.Z.addListener("NETWORK_STATUS",a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.log.disk("****** Current Network Status is: ",Q.Z.status);case 1:case"end":return e.stop()}},e)})));case 6:return e.next=7,se.Z.addListener("BPO_SET_NEXT_LAUNCH",function(e){t.log.disk("****** Setting BPO Next Launch Time to: ".concat(e)),f.Z.set("NEXT_LAUNCH_TIME",e)});case 7:se.Z.addListener("FORCE_REFRESH_TEST",function(e){t.log.disk("************ Force Refresh Test ************"),t.log.disk("payload: ",e),t.log.disk("********************************************"),G.Z.emit(G.Z.events.FORCE_REFRESH,void 0,JSON.parse(e))});case 8:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"setOnline",value:function(e){var t=Q.Z.status;this.log.disk("".concat(e," -- Current Network Status ").concat(t," . Changing status to ONLINE.")),Q.Z.status=Q.Z.ONLINE,Q.Z.emit(Q.Z.ONLINE,t,e)}},{key:"setOffline",value:function(e){var t=Q.Z.status;this.log.disk("".concat(e," -- Current Network Status ").concat(t," . Changing status to OFFLINE.")),Q.Z.status=Q.Z.OFFLINE,Q.Z.emit(Q.Z.OFFLINE,t,e)}}]);var n}(ee.EventEmitter);function Fn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Fn=function(){return!!e})()}var Gn={tag:fe.ContentRequestTarget.TargetType.tag,container:fe.ContentRequestTarget.TargetType.container,all:fe.ContentRequestTarget.TargetType.all,id:fe.ContentRequestTarget.TargetType.id},Vn=function(e){return e.VULCAN_CCXP_GSDK_CHECK_ENABLED_REQUEST="ccxprocess.gsdkdebug.in.request.checkCcxpGsdkEnabled",e.VULCAN_CCXP_GSDK_CHECK_INITIALIZED_REQUEST="ccxprocess.gsdkdebug.in.request.checkCcxpGsdkInitialized",e.VULCAN_CCXP_GSDK_SHUTDOWN_REQUEST="ccxprocess.gsdkdebug.in.request.ccxpGsdkShutdown",e.VULCAN_GSDK_STARTUP_REQUEST="ccxprocess.gsdkdebug.in.request.gsdkStartup",e.VULCAN_GSDK_LOGIN_REQUEST="ccxprocess.gsdkdebug.in.request.gsdkLogin",e.VULCAN_GSDK_GET_CACHED_CONTENT_REQUEST="ccxprocess.gsdkdebug.in.request.getCachedContent",e.VULCAN_GSDK_ANY_CONTENT_UPDATE_REQUEST="ccxprocess.gsdkdebug.in.request.onAnyContentUpdate",e}(Vn||{}),Hn=function(e){function t(){var e,n,r,a;return i()(this,t),n=this,r=t,r=B()(r),e=H()(n,Fn()?Reflect.construct(r,a||[],B()(n).constructor):r.apply(n,a)),l()(e,"log",void 0),l()(e,"ccxpGSDKWrapper",void 0),l()(e,"maps",void 0),e.log=new h.Z({prefix:"GSDKDebugInterface > ",payload:{"event.subcategory":f.Z.analytics.sc_PROCESS,"event.subtype":f.Z.analytics.st_ANS}}),e.maps=[],e}return X()(t,e),c()(t,[{key:"init",value:function(e,t){this.log.disk("********** Initializing GSDK DEBUG Interface *****"),this.ccxpGSDKWrapper=e,this.addListeners(),this.maps=t}},{key:"addListeners",value:function(){var e=this;se.Z.addListener(Vn.VULCAN_GSDK_STARTUP_REQUEST,function(){var t=a()(d().mark(function t(n){return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.log.disk("\n***********************************************************"),e.log.disk("Calling GSDK Startup.. with config: ".concat(JSON.parse(n))),t.next=1,e.gsdkStartup(JSON.parse(n));case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),se.Z.addListener(Vn.VULCAN_GSDK_LOGIN_REQUEST,function(){var t=a()(d().mark(function t(n){return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.log.disk("\n***********************************************************"),e.log.disk("Calling GSDK updateLiscenceProfile (AKA Login)"),t.next=1,e.updateLicenseProfileWrapper();case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),se.Z.addListener(Vn.VULCAN_GSDK_GET_CACHED_CONTENT_REQUEST,function(){var t=a()(d().mark(function t(n){var r,a,s,i,o;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=JSON.parse(n),a=r.contentRequestTarget,s=r.consumer,e.log.disk("\n********************************************************"),e.log.disk("Triggering GSDK GET CACHED CONTENT: target: ".concat(a.target," -- targetType: ").concat(a.targetType)),i=a.target,o=Gn[a.targetType],t.next=1,e.getCachedContentWrapper(i,o,s);case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),se.Z.addListener(Vn.VULCAN_GSDK_ANY_CONTENT_UPDATE_REQUEST,function(t,n){if(e.log.disk("\n********************************************************"),e.log.disk("Triggering GSDK Content Update Notification"),"string"==typeof t)try{t=JSON.parse(t)}catch(t){return void e.log.disk("Error parsing consumer JSON: ".concat(t))}e.maps.find(function(n){return t&&t.name?n.type===t.name:(e.log.disk("Consumer or consumer.name is undefined"),!1)});e.maps.forEach(function(n){var r="CCX_Start_4.0_Toast";e.log.disk("Will notify Lookupmap with type: ".concat(null==n?void 0:n.type," to updateGSDKCollection -- with consumer info: ").concat(JSON.stringify(t,null,2)," -- and surface ").concat(r)),null==n||n.emit("",{productCode:t.code,productVersion:t.version,productLanguage:_.Z.getSophiaLanguage(t.language),surfaceId:[r]},r,"gsdk-update")})}),se.Z.addListener(Vn.VULCAN_CCXP_GSDK_SHUTDOWN_REQUEST,function(){var t=a()(d().mark(function t(n){return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.log.disk("\n***********************************************************"),e.log.disk("Calling GSDK SHUTDOWN on CCXPs already running GSDK instance"),t.next=1,e.ccxpGSDKWrapper.shutdown();case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"gsdkStartup",value:(o=a()(d().mark(function e(t){var n=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.shutdownCcxpGsdkIfActive();case 1:return e.next=2,fe.core.startup(t).then(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.log.disk("\n\n*********************************************"),n.log.disk("Successfully launched GrowthSDK in Debug Interface with startup options: ",t),e.abrupt("return",!0);case 1:case"end":return e.stop()}},e)}))).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw n.log.disk("\nGSDK STARTUP ERROR: ".concat(t.message)),new A.Z("GSDK Debug Interface Startup failure",t,f.Z.analytics.STARTUP_ERROR);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.abrupt("return",!1);case 3:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"shutdownCcxpGsdkIfActive",value:(s=a()(d().mark(function e(){var t,n,r,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.ccxpGSDKWrapper.isEnabled,n=this.ccxpGSDKWrapper.isInitialized,r=!1,a="GSDK in CCXP is not running or initialized. No need to call shutdown...",t&&n?(a="GSDK is both enabled and initialized... Shutting down GSDK",r=!0):t?(a="GSDK is already enabled... Shutting down GSDK",r=!0):n&&(a="GSDK is already initialized... Shutting down GSDK",r=!0),this.log.disk("\n***********************************************************"),this.log.disk(a),!r){e.next=1;break}return e.next=1,this.ccxpGSDKWrapper.shutdown();case 1:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"updateLicenseProfileWrapper",value:(r=a()(d().mark(function e(){var t,n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,E.Z.getFullProfile();case 1:if(t=e.sent,this.log.disk("***********************************************************"),this.log.disk("updateLiscenceProfile with Profile: ".concat(JSON.stringify(t,null,2))),this.log.disk("***********************************************************"),e.prev=2,!t){e.next=3;break}return e.next=3,fe.identity.updateLicenseProfile(t);case 3:e.next=5;break;case 4:e.prev=4,n=e.catch(2),this.log.disk("Error updating license profile: ",n);case 5:case"end":return e.stop()}},e,this,[[2,4]])})),function(){return r.apply(this,arguments)})},{key:"getCachedContentWrapper",value:(n=a()(d().mark(function e(t,n,r){var a,s,i,o,c,u,l,p,_,h=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new fe.CachedContentRequest({contentRequestTarget:{targetType:n,target:t}}),this.log.disk("Calling getCachedContent with contentRequestTarget: ",a.contentRequestTarget," consumer: ",r," and target: ",t),e.next=1,fe.content.getCachedContent(a,r).catch(function(e){throw new A.Z("Failed getting cached content",e,f.Z.analytics.GSDK_CACHED_CONTENT_FAILURE).removeStack()});case 1:return s=e.sent,i=1e4,e.next=2,fe.content.getSyncStatus(i).then(function(e){return e}).catch(function(e){return h.log.disk("Error getting content sync status: ".concat(e.message)),{error:e.message}});case 2:return o=e.sent,e.next=3,fe.content.getContainers(r,i).then(function(e){return e}).catch(function(e){return h.log.disk("Error getting containers for consumer ".concat(JSON.stringify(r),": ").concat(e.message)),{error:e.message}});case 3:return c=e.sent,e.next=4,fe.content.getConsumers(i).then(function(e){return e}).catch(function(e){return h.log.disk("Error getting consumer:  ".concat(e.message)),{error:e.message}});case 4:u=e.sent;try{l=v.resolve(__dirname,"../spec/gsdk/response_files"),p=this.getUniqueFilePath(l),this.log.disk("Writing GSDK content to file: ".concat(p)),_={debug_content_request_summary:{description:"Request from GSDKDebugInterface (not from gsdk). Actual gsdk response in gsdk_response property",contentRequestTarget:t,targetType:n,consumer:r},gsdk_content_sync_status:o,gsdk_content_response:s,gsdk_consumer_container:c,gsdk_consumers:u},p?S.writeFileSync(p,JSON.stringify(_,null,2),"utf-8"):this.log.disk("No file path: [".concat(p,"] to write GSDK content to"))}catch(e){this.log.error(new A.Z("Failed to write GSDK content to file",e))}return e.abrupt("return",{cachedContentResponse:s});case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"getUniqueFilePath",value:function(e){var t,n=1,r=new Date,a=r.toLocaleString("default",{month:"short"}),s=r.getDate(),i="gsdkContent_".concat(a,"_").concat(s,".json"),o="".concat(n,"_").concat(i);try{for(t=v.join(e,o);S.existsSync(t);)n++,o="".concat(n,"_").concat(i),t=v.join(e,o)}catch(e){this.log.disk("************************************************"),this.log.disk("Error getting unique file path: ".concat(e)),this.log.disk("************************************************")}return t}}]);var n,r,s,o}(ee.EventEmitter);function Kn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Bn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function Bn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var jn=function(){return c()(function e(){var t,n=this;i()(this,e),l()(this,"log",void 0),l()(this,"initialHealthMetric",{MEMORY:void 0,TIME:void 0}),l()(this,"maps",[]),l()(this,"startProfileInfo",[]),l()(this,"maxStartProfilingInitStep",{}),l()(this,"ccxpStartupTime",-1),l()(this,"maxStepCompletionTime",-1),l()(this,"maxStepImpact",-1),l()(this,"metrics_flag_id","override_health_metrics_collection_frequency"),l()(this,"cpuViolationSummary",void 0),l()(this,"allMetrics",[]),l()(this,"rollingAverageSourceMetrics",[]),l()(this,"initStartTime",void 0),l()(this,"currentCpuMetricFlagInfo",{}),l()(this,"_cpuPollInterval",void 0),l()(this,"_startCPUPoll",a()(d().mark(function e(){var t,r,a,s,i,o;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.getElapsedTime(),r={},a=n.currentCpuMetricFlagInfo.CPU_ROLLING_AVERAGE_THRESHOLD_PERCENTAGE,s=n.currentCpuMetricFlagInfo.CPU_ROLLING_AVERAGE_BUCKET,e.next=1,n._measureCurrentCpu();case 1:i=e.sent,r.cpuThreshold=a,r.elapsedTime=t,r.violationCount=n.cpuViolationSummary.violationCount,r.avgCpu=n.cpuViolationSummary.avgCpu,r.avgCpuViolation=n.cpuViolationSummary.avgCpuViolation,r.currentCpu=i,r.isCpuAboveThreshold=!1,n.rollingAverageSourceMetrics.push(r),n.rollingAverageSourceMetrics.length==s&&(o=parseFloat(n._calcRollingAverage().toFixed(2)),r.rollingAverage=o,o>a&&(n.cpuViolationSummary.violationCount++,isNaN(parseFloat(i))?n.log.disk("Skipping updating cpuViolationAvg in ingest field ccxp.ccxp_cpu_violation_metrics since ".concat(parseFloat(i)," is not a number.")):n.updateAvgCpuViolation(parseFloat(i)),r.violationCount=n.cpuViolationSummary.violationCount,r.isCpuAboveThreshold=!0),_.Z.isDebugModeEnabled()&&n.log.disk("***************** Updated rolling average: ".concat(o)),n.rollingAverageSourceMetrics.shift()),_.Z.isDebugModeEnabled()&&n.log.disk("***************** CPU Measurement Completed: ".concat(JSON.stringify(r))),isNaN(parseFloat(i))?n.log.disk("Skipping updating avgCpu in ingest field ccxp.cpu_violation_metrics since ".concat(parseFloat(i)," is not a number.")):n.updateAvgCpu(parseFloat(i)),n.cpuViolationSummary.measurementCount++,_.Z.isDebugModeEnabled()&&n.allMetrics.push(r);case 2:case"end":return e.stop()}},e)}))),h.Z.init(),this.log=new h.Z({prefix:"HealthMonitor > ",payload:{"event.subcategory":f.Z.analytics.sc_PROCESS,"event.subtype":f.Z.analytics.st_PROCESS}}),this.currentCpuMetricFlagInfo=f.Z.get(this.metrics_flag_id),this.cpuViolationSummary={cpuThreshold:null===(t=this.currentCpuMetricFlagInfo)||void 0===t?void 0:t.CPU_ROLLING_AVERAGE_THRESHOLD_PERCENTAGE,elapsedTime:0,violationCount:0,avgCpu:0,avgCpuViolation:0,measurementCount:0},this.initStartTime=new Date},[{key:"start",value:(u=a()(d().mark(function e(t,n,r,s,i,o){var c,u,l,p=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setMaxStartProfileInitInfo(n,r,s,i,o),this.maps=t||[],null===(c=this.currentCpuMetricFlagInfo)||void 0===c||!c.enabled){e.next=2;break}if(l=null===(u=this.currentCpuMetricFlagInfo)||void 0===u?void 0:u.CPU_COLLECTION_INTERVAL,!isNaN(l)){e.next=1;break}return this.log.disk("Error Setting CPU Metric Collection Interval:".concat(JSON.stringify(l),"  --- metrics flag:").concat(JSON.stringify(this.currentCpuMetricFlagInfo))),e.abrupt("return");case 1:this._cpuPollInterval=setInterval(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p._startCPUPoll();case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),l);case 2:return this.checkFlagsEnabled(),setTimeout(a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p._getCurrentHealthMetric();case 1:p.initialHealthMetric=e.sent,t={"event.subcategory":"Metrics","ccxp.metric_ram":p.initialHealthMetric.MEMORY,"event.value":JSON.stringify(p.startProfileInfo),"ccxp.ccxp_init_done":p.ccxpStartupTime,"ccxp.max_init_step":Object.keys(p.maxStartProfilingInitStep)[0],"ccxp.max_init_step_time":p.maxStepCompletionTime,"ccxp.max_init_step_impact_perc":p.maxStepImpact},_.Z.isDebugModeEnabled()&&p.log.disk("Initial Health Metric Payload:",JSON.stringify(t)),p.log.context({payload:t}).info(f.Z.analytics.t_PERFORMANCE);case 2:case"end":return e.stop()}},e)})),f.Z.get("INITIAL_HEALTH_MEASUREMENT_DELAY")),e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n,r,a,s){return u.apply(this,arguments)})},{key:"checkFlagsEnabled",value:function(){var e=this;if(this.haveFlagsChanged()){if(_.Z.isDebugModeEnabled()&&this.log.disk("****** Flag ".concat(this.metrics_flag_id," changed to ").concat(JSON.stringify(this.currentCpuMetricFlagInfo))),this.stopCPUPoll(),this.currentCpuMetricFlagInfo.enabled){var t=this.currentCpuMetricFlagInfo.CPU_COLLECTION_INTERVAL;if(isNaN(t))return void this.log.disk("Error Setting CPU Metric Collection Interval:".concat(t,"  --- metrics flag: ").concat(this.currentCpuMetricFlagInfo));this._cpuPollInterval=setInterval(a()(d().mark(function t(){return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,e._startCPUPoll();case 1:return t.abrupt("return",t.sent);case 2:case"end":return t.stop()}},t)})),t),_.Z.isDebugModeEnabled()&&this.log.disk("***************** 1. Change in CPU Interval due to FG Scheduling Next CPU Poll in: ".concat(t/1e3," seconds***************"))}}else _.Z.isDebugModeEnabled()&&this.log.disk("*** CPU Metrics Flag unchanged since last checked");setTimeout(this.checkFlagsEnabled.bind(this),f.Z.get("FEATURE_FLAG_CONFIG_CHECK_INTERVAL"))}},{key:"haveFlagsChanged",value:function(){var e=f.Z.get(this.metrics_flag_id),t=this.currentCpuMetricFlagInfo;return!_.Z.compareValues(e,t)&&(this.currentCpuMetricFlagInfo=e,!0)}},{key:"stopCPUPoll",value:function(){_.Z.isDebugModeEnabled()&&this.log.disk("***************** 2. Stopping current CPU poll interval of ".concat(this._cpuPollInterval," ***************")),this.rollingAverageSourceMetrics.length=0,this._cpuPollInterval&&(clearInterval(this._cpuPollInterval),this._cpuPollInterval=void 0)}},{key:"setMaxStartProfileInitInfo",value:function(e,t,n,r,a){this.startProfileInfo=e||[],this.maxStartProfilingInitStep=t||{},this.ccxpStartupTime=n||f.Z.get("CCXP_DEFAULT_STARTUP_TIME"),this.maxStepCompletionTime=r||f.Z.get("MAX_STEP_DEFAULT_COMPLETION_TIME"),this.maxStepImpact=a||f.Z.get("MAX_STEP_DEFAULT_IMPACT")}},{key:"getFileCountViolators",value:(o=a()(d().mark(function e(){var t,n,r,a,s,i,o=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={},n=f.Z.get("FILE_ACCESSOR_WRITE_FOLDER"),r=Kn(this.maps),e.prev=1,s=d().mark(function e(){var r,s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.value,f.Z.get("FILE_ACCESSOR_WRITE_ENABLED",r.type)){e.next=1;break}return e.abrupt("return",1);case 1:return s=r.getPath()+"/"+n,e.next=2,S.readdir(s).catch(function(e){o.log.disk("Err reading contents of ".concat(s,": ").concat(e))});case 2:(i=e.sent)&&i.length>=f.Z.get("FILE_ACCESSOR_FILE_COUNT_LIMIT")&&(o.log.disk("".concat(r.type," has violated file count threshold of ").concat(f.Z.get("FILE_ACCESSOR_FILE_COUNT_LIMIT"))),t[r.type]=i.length);case 3:case"end":return e.stop()}},e)}),r.s();case 2:if((a=r.n()).done){e.next=5;break}return e.delegateYield(s(),"t0",3);case 3:if(!e.t0){e.next=4;break}return e.abrupt("continue",4);case 4:e.next=2;break;case 5:e.next=7;break;case 6:e.prev=6,i=e.catch(1),r.e(i);case 7:return e.prev=7,r.f(),e.finish(7);case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this,[[1,6,7,8]])})),function(){return o.apply(this,arguments)})},{key:"getHealthMetricPayload",value:(s=a()(d().mark(function e(){var t,n,r,a,s,i,o,c,u,l,p,h=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.Z.get(this.metrics_flag_id),e.next=1,this._measureCurrentCpu();case 1:return n=e.sent,e.next=2,_.Z.getDiskSize().catch(function(e){return h.log.error(new A.Z(e,"Error getting disk size")),-1});case 2:return p=e.sent,r=(p/1048576).toFixed(2),e.next=3,this.calcMemChange();case 3:return a=e.sent,s=a.elapsedTimeMs,i=a.percMemChange,o=a.normalizedMemChange,c=(process.memoryUsage().rss/1048576).toFixed(2),e.next=4,this.getFileCountViolators();case 4:if(u=e.sent,isNaN(o)&&isNaN(i)&&isNaN(s)){e.next=5;break}return l=Object.assign({"ccxp.metric_cpu":n,"ccxp.metric_disk":r,"ccxp.metric_ram":c,"ccxp.metric_perc_memdiff":null==i?void 0:i.toFixed(2),"ccxp.metric_perc_memdiff_normalized":null==o?void 0:o.toFixed(2),"ccxp.metric_elapsedms":s},0!==Object.keys(u).length?{"ccxp.client_filecount_violators":JSON.stringify(u)}:{},void 0!==t?this._getCpuViolationSummary():{}),this.log.disk("CPU: ".concat(n,"%, RAM: ").concat(c,"MB, Disk: ").concat(r,"MB,FileCountViolations: ").concat(JSON.stringify(u))),this.log.disk("RAM Change: ".concat(null==i?void 0:i.toFixed(2),"%, RAM Change/Hr: ").concat(null==o?void 0:o.toFixed(4),"%, Elapsed Time: ").concat(s&&(s/36e5).toFixed(2)," Hours")),_.Z.isDebugModeEnabled()&&(this.log.disk("************************ CPU Measurement Summary ************************"),this.log.disk("".concat(JSON.stringify(this._getCpuViolationSummary(),null,1))),this.log.disk("************************ All Metrics: ".concat(JSON.stringify(this.allMetrics,null,1)," ************************"))),e.abrupt("return",l);case 5:return this.log.disk("Mem metric not available due to -- Elapsed Time ".concat(s,", mem change per hour ").concat(o,", mem change per hour ").concat(i)),e.abrupt("return",{});case 6:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"_getCpuViolationSummary",value:function(){return this.cpuViolationSummary.elapsedTime=this.getElapsedTime(),{"ccxp.cpu_violation_metrics":this.cpuViolationSummary}}},{key:"_measureCurrentCpu",value:(r=a()(d().mark(function e(){var t,n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=process.cpuUsage(),n=process.hrtime(),e.next=1,_.Z.setTimeoutAsync(f.Z.get("CPU_POLL_DURATION"));case 1:return r=process.cpuUsage(t),a=process.hrtime(n),s=(100*(r.system+r.user)/(1e6*a[0]+a[1]/1e3)).toFixed(2),e.abrupt("return",s);case 2:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"calcMemChange",value:(n=a()(d().mark(function e(){var t,n,r,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getInitialMetric();case 1:return t=e.sent,e.next=2,this._getCurrentHealthMetric();case 2:n=e.sent,r=0,a=0,s=0;try{r=(n.MEMORY-t.MEMORY)/(t.MEMORY<=0?1:t.MEMORY)*100,a=n.TIME-t.TIME,s=r/(a/36e5)}catch(e){this.log.disk("Calculation Error: ".concat(e)),this.log.disk("Start: ".concat(JSON.stringify(t)," -- End: ").concat(JSON.stringify(n)))}return e.abrupt("return",{elapsedTimeMs:a,percMemChange:r,normalizedMemChange:s});case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"getInitialMetric",value:(t=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initialHealthMetric);case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_getCurrentHealthMetric",value:(e=a()(d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t={}).MEMORY=(process.memoryUsage().rss/1048576).toFixed(2),t.TIME=new Date,e.abrupt("return",t);case 1:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"updateAvgCpu",value:function(e){var t;t=0===this.cpuViolationSummary.measurementCount?e:(this.cpuViolationSummary.avgCpu*((this.cpuViolationSummary.measurementCount||1)-1)+e)/this.cpuViolationSummary.measurementCount,t=parseFloat(t.toFixed(2)),_.Z.isDebugModeEnabled()&&this.log.disk("***************** Updating CPU Avg with: ".concat(t," -- current CPU: ").concat(e," -- avg cpu in current cpuViolationSummary: ").concat(this.cpuViolationSummary.avgCpu," -- measurement count: ").concat(this.cpuViolationSummary.measurementCount)),this.cpuViolationSummary.avgCpu=t}},{key:"updateAvgCpuViolation",value:function(e){var t=(this.cpuViolationSummary.avgCpuViolation*(this.cpuViolationSummary.violationCount-1)+e)/this.cpuViolationSummary.violationCount;t=Math.round(100*t)/100,this.log.disk("**** Updating CPU Violation Avg: ".concat(t)),this.cpuViolationSummary.avgCpuViolation=t}},{key:"_calcRollingAverage",value:function(){var e,t=0,n=Kn(this.rollingAverageSourceMetrics);try{for(n.s();!(e=n.n()).done;){var r=e.value;t+=Number(r.currentCpu)}}catch(e){n.e(e)}finally{n.f()}return t/=this.rollingAverageSourceMetrics.length}},{key:"getElapsedTime",value:function(){return Date.now()-this.initStartTime.getTime()}}]);var e,t,n,r,s,o,u}();function Wn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Yn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function Yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Xn=function(){return c()(function e(){var t=this;i()(this,e),l()(this,"log",void 0),l()(this,"maps",void 0),l()(this,"ccxpFlagsLookupMap",void 0),l()(this,"firstMileLookupMap",void 0),l()(this,"stockLookupMap",void 0),l()(this,"learnLookupMap",void 0),l()(this,"ccdLookupMap",void 0),l()(this,"ilstFlagsLookupMap",void 0),l()(this,"idsnFlagsLookupMap",void 0),l()(this,"photoshopLookupMap",void 0),l()(this,"illustratorLookupMap",void 0),l()(this,"discoverPanelLookupMap",void 0),l()(this,"avatarLookupMap",void 0),l()(this,"collectionTemplatesLookupMap",void 0),l()(this,"surveyLookupMap",void 0),l()(this,"ghostLookupMap",void 0),l()(this,"lastKnownCredentials",void 0),l()(this,"serviceInterface",void 0),l()(this,"debugInterface",void 0),l()(this,"gsdkDebugInterface",void 0),l()(this,"healthMonitor",void 0),l()(this,"lifecycleManager",void 0),l()(this,"gsdk",void 0),l()(this,"initStartTime",void 0),l()(this,"profileInfo",void 0),l()(this,"maxInitMetric",void 0),l()(this,"addProductInfoToLookup",_.Z.memoize(function(){var e=a()(d().mark(function e(n,r,s){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,se.Z.clearInstalledAppsCache();case 1:return e.next=2,_.Z.waitAll(t.maps.map(function(){var e=a()(d().mark(function e(n){var i,o,c,u;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.Z.get("SUPPORTED_PRODUCTS",n.type),null==r||!r.productCode){e.next=2;break}if(!(o=n.getProductAlias(r))||!i[o]||1===_.Z.compareMajorMinorVersions(r.productVersion,i[o],n.patchEnabledClient(r))){e.next=2;break}return c=_.Z,e.next=1,n.updateParams([Object.assign({},r,{productCode:o})]);case 1:return u=e.sent.map(function(){var e=a()(d().mark(function e(a){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,n.addNewCollectionData({params:a,priorityLevel:s}).catch(function(e){t.log.context({params:Object.assign({},r,{productCode:o})}).disk(e,"Error adding new ".concat(n.type," product"))});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=2,c.waitAll.call(c,u);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}())),l()(this,"updateProductInfoToLookup",_.Z.memoize(function(){var e=a()(d().mark(function e(n,r,s){var i,o,c,u,l,p,f,h,E,S,v,g;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u={},e.next=1,se.Z.getInstalledApps();case 1:if(h=i=e.sent,f=null===h){e.next=2;break}f=void 0===i;case 2:if(!f){e.next=3;break}E=void 0,e.next=4;break;case 3:E=i[r.productCode];case 4:return l=E,u[r.productCode]=Object.assign(null!=l?l:{},null!==(o=u[r.productCode])&&void 0!==o?o:{}),e.next=5,_.Z.setTimeoutAsync(1e3);case 5:return e.next=6,se.Z.clearInstalledAppsCache();case 6:return e.next=7,se.Z.getInstalledApps();case 7:if(v=c=e.sent,S=null===v){e.next=8;break}S=void 0===c;case 8:if(!S){e.next=9;break}g=void 0,e.next=10;break;case 9:g=c[r.productCode];case 10:return p=g,e.next=11,_.Z.waitAll(Object.keys(u[r.productCode]).map(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p[n]){e.next=1;break}return e.next=1,_.Z.waitAll(t.maps.map(function(){var e=a()(d().mark(function e(t){var s,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=u[r.productCode][n],i={productCode:s.SAPCode,productVersion:s.CodexVersion,productLanguage:r.productLanguage,countryCode:r.countryCode},e.next=1,t.update(i,r);case 1:return e.next=2,_.Z.waitAll(s.InstallLanguage.split(",").map(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.productLanguage=t;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 11:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}())),l()(this,"uninstallProductInfoToLookup",_.Z.memoize(function(){var e=a()(d().mark(function e(n,r){var a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,_.Z.setTimeoutAsync(1e3);case 1:return e.next=2,se.Z.clearInstalledAppsCache();case 2:return e.next=3,se.Z.getInstalledApps();case 3:(a=e.sent)&&a[r.productCode]&&(a[r.productCode][r.productVersion]||a[r.productCode][r.productVersion+".0"])?t.log.disk("Ignoring uninstall as the version or alias is already installed."):(t.log.disk("Removing ".concat(r.productCode,"[").concat(r.productVersion,"]")),t.maps.forEach(function(e){return e.uninstall(r).catch(function(n){t.log.context({params:r}).error(new A.Z("Uninstall Error - Notification",n)).appendPayload({"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",e.type)})})}));case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())),l()(this,"_updateGSDKConsumers",_.Z.memoize(function(e,n,r){if(pe.Z.isEnabled&&(n.productCode&&t.maps.find(function(e){var t=f.Z.get("SUPPORTED_PRODUCTS",e.type),r=e.getProductAlias(n);return r&&t[r]&&1!==_.Z.compareMajorMinorVersions(n.productVersion,t[r],e.patchEnabledClient(n))}))){var a=t.gsdk.createConsumer(n);t.gsdk.updateConsumerActivity(a,r)}})),h.Z.init(),this.log=new h.Z({prefix:"Main > ",payload:{"event.subcategory":f.Z.analytics.sc_PROCESS,"event.subtype":f.Z.analytics.st_PROCESS}}),this.initStartTime=new Date,this.profileInfo=new Array;var n={constructor:this.getElapsedTime()};this.profileInfo.push(n),this.maxInitMetric=n,this.ccxpFlagsLookupMap=new xt,this.stockLookupMap=new nn,this.firstMileLookupMap=new Ve,this.learnLookupMap=new Je,this.ccdLookupMap=new st,this.ilstFlagsLookupMap=new At,this.idsnFlagsLookupMap=new Ht,this.discoverPanelLookupMap=new dt,this.avatarLookupMap=new ln,this.collectionTemplatesLookupMap=new _n,this.photoshopLookupMap=new Mt,this.illustratorLookupMap=new Wt,this.surveyLookupMap=new vn,this.ghostLookupMap=new In,this.maps=[this.ccxpFlagsLookupMap,this.firstMileLookupMap,this.stockLookupMap,this.learnLookupMap,this.ccdLookupMap,this.ilstFlagsLookupMap,this.ghostLookupMap,this.idsnFlagsLookupMap,this.discoverPanelLookupMap,this.avatarLookupMap,this.collectionTemplatesLookupMap,this.photoshopLookupMap,this.illustratorLookupMap,this.surveyLookupMap],this.lastKnownCredentials={},this.serviceInterface=new Pn(this.maps),this.debugInterface=_.Z.isDebugModeEnabled()?new Zn:void 0,this.gsdkDebugInterface=_.Z.isDebugModeEnabled()?new Hn:void 0,this.healthMonitor=new jn,this.lifecycleManager=de,this.gsdk=pe.Z},[{key:"sync",value:(v=a()(d().mark(function e(){var t,n,r,s=this,i=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:this.maps,n=i.length>1&&void 0!==i[1]?i[1]:{type:"none"},r=i.length>2&&void 0!==i[2]&&i[2],E.Z.getUserId()){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,_.Z.waitAll(t.map(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.sync({force:n,init:r}).catch(function(e){s.log.disk("Failed to sync ".concat(t.type),e)});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"updateLookupMapWithInstalledApps",value:(S=a()(d().mark(function e(){var t,n,r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Object,E.Z.getUserId()){e.next=1;break}return e.abrupt("return");case 1:return n={},e.next=2,_.Z.waitAll(this.maps.map(function(){var e=a()(d().mark(function e(s){var i,o,c,u;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Date.now(),e.next=1,Z.getMissingProductList(s);case 1:return o=e.sent,c=_.Z,e.next=2,s.updateParams(o);case 2:return u=e.sent.map(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,s.addNewCollectionData({params:t});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=3,c.waitAll.call(c,u);case 3:return e.next=4,Z.getExcessProductList(s);case 4:e.sent.forEach(function(e){s.uninstall(e).catch(function(t){r.log.context({params:e}).error(new A.Z("Uninstall Error - LookupUpdate",t)).appendPayload({"event.subcategory":f.Z.get("ANALYTICS_SUBCATEGORY",s.type)})})}),n[s.type]=(Date.now()-i).toString(),t[s.type]=r.getElapsedTime();case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})},{key:"setProxyCredentials",value:(p=a()(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||this.lastKnownCredentials.user===t||this.lastKnownCredentials.password===n){e.next=1;break}return this.lastKnownCredentials={user:t,password:n},F.Z.setProxyCredentials(t,n),e.next=1,this.sync();case 1:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"setUserAnalyticsFlag",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];b.Z.enable(e)}},{key:"prefetchData",value:(u=a()(d().mark(function e(t){var n,r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(E.Z.getUserId()){e.next=1;break}return e.abrupt("return");case 1:if(f.Z.get("CCXP_FEATURE_FLAGS_LOCAL_OVERRIDE")){e.next=3;break}return e.next=2,this.ccxpFlagsLookupMap.updateParams([{productVersion:_.Z.getProcessVersion(),productCode:"CCXP"}]);case 2:return n=e.sent[0],e.next=3,this.ccxpFlagsLookupMap.addNewCollectionData({params:n}).then(function(){var e=a()(d().mark(function e(t){var a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((a=t&&t.id&&r.ccxpFlagsLookupMap._data.metadata[t.id])&&f.Z.get("REFRESH_ON_STALE",r.ccxpFlagsLookupMap.type)&&a.lastUseTime)||_.Z.hasBeenUsedRecently(a.lastUseTime,f.Z.get("STALE_AFTER",r.ccxpFlagsLookupMap.type))){e.next=1;break}r.log.context({params:n}).disk("Stale content found. Resetting to default config."),r.ccxpFlagsLookupMap.resetSettings(),e.next=2;break;case 1:return e.next=2,null==t?void 0:t.restoreSettingsFromDisk().catch(function(e){throw e});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.log.context({params:n}).disk(t,"Error pre-fetching ccxp flags");case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"forceRefresh",value:(o=a()(d().mark(function e(t,n){var r,s,i,o,c,u,l,p,S=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=E.Z.getUserId()){e.next=1;break}return e.abrupt("return");case 1:if(s=new h.Z({prefix:"Force Refresh > ",payload:{"event.workflow":f.Z.analytics.w_NOTIFICATION,"event.subcategory":f.Z.analytics.sc_FORCE_REFRESH}}),!(i=_.Z.validateDataFields(n,f.Z.get("FORCE_REFRESH_SCHEMA")))){e.next=2;break}throw new A.Z(b.Z.DATA_VALIDATION_ERR,"Invalid data: ".concat(JSON.stringify(null===(o=i[0])||void 0===o?void 0:o.message)));case 2:if(e.prev=2,c=n.expire,u=void 0===c?{}:c,l=Object.keys(u).filter(function(e){return!!S.maps.find(function(t){return t.type===e})}),!((p=this.maps.filter(function(e){return l.includes(e.type)})).length<1)){e.next=3;break}return e.abrupt("return");case 3:return e.next=4,k.Z.updateBackOff({clear:!0,type:k.E.NETWORK,sync:!1});case 4:return e.next=5,k.Z.updateBackOff({clear:!0,type:k.E.AUTH,sync:!1});case 5:return s.context({payload:{"event.subtype":f.Z.analytics.t_REQUEST,"event.value":l.join(", ")}}).info(f.Z.analytics.st_RECEIVED),e.next=6,Promise.all(p.map(function(){var e=a()(d().mark(function e(n){var a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],t&&a.push(n.setLastTimeOfNotification(t)),!0!==u[n.type]){e.next=2;break}return e.next=1,n.expireAll(r);case 1:case 3:return e.abrupt("return",e.sent);case 2:if(s=u[n.type]||[],!Array.isArray(s)){e.next=4;break}return s.forEach(function(e){if(!e.productCode)throw new A.Z(b.Z.DATA_VALIDATION_ERR,"No product code provided: ".concat(JSON.stringify(s)));a.push(n.forceRefresh(e))}),e.next=3,Promise.all(a);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 6:return e.next=7,this.sync(p);case 7:s.context({payload:{"event.subtype":f.Z.analytics.t_REQUEST,"event.value":l.join(", ")}}).info(f.Z.analytics.st_FINISHED),e.next=9;break;case 8:throw e.prev=8,e.catch(2);case 9:case"end":return e.stop()}},e,this,[[2,8]])})),function(e,t){return o.apply(this,arguments)})},{key:"registerNotifications",value:(s=a()(d().mark(function e(){var n,r=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:E.Z.on("SIGN_OUT",a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,r.gsdk.logoutGSDK();case 1:r.setUserAnalyticsFlag(!1);case 2:case"end":return e.stop()}},e)}))),k.Z.on(k.Z.SYNC,_.Z.throttle(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.log.disk("Global backoff over, syncing data."),e.next=1,r.sync();case 1:case"end":return e.stop()}},e)})),f.Z.get("GLOBAL_BACKOFF_SYNC_THROTTLE"))),E.Z.on("SIGN_IN",a()(d().mark(function e(){var t,n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,G.Z.getUserAnalyticsEnabledFlag().catch(function(e){r.log.error(new A.Z("Could not enable analytics on sign in",e))});case 1:if(t=e.sent,n=t.enabled,r.setUserAnalyticsFlag(n),!E.Z.getUserId()){e.next=2;break}return e.next=2,r.gsdk.login();case 2:return e.next=3,r.prefetchData();case 3:return e.next=4,r.updateLookupMapWithInstalledApps().catch(function(e){r.log.error(new A.Z("Failed to update lookup map on sign in",e))});case 4:return e.next=5,r.sync();case 5:case"end":return e.stop()}},e)}))),G.Z.addListener(G.Z.events.PROXY_SETTINGS_CHANGED,function(){var e=a()(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,r.setProxyCredentials(t,n);case 1:r.markElapsedTime("setProxyCredentials");case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),G.Z.addListener(G.Z.events.FORCE_REFRESH,function(e,t){r.forceRefresh(e,t).catch(function(e){r.log.context({prefix:"Force Refresh > ",payload:{"event.workflow":f.Z.analytics.w_NOTIFICATION,"event.subcategory":f.Z.analytics.sc_FORCE_REFRESH,"event.value":t}}).error(e)})}),G.Z.addListener(G.Z.events.PROFILE_UPDATED,function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=1;break}return e.next=1,r.firstMileLookupMap.setLastTimeOfNotification(t);case 1:return e.next=2,r.sync([r.firstMileLookupMap],{type:"always"});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),G.Z.addListener(G.Z.events.SUBSCRIPTION_STATUS_CHANGED,function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.next=1,r.firstMileLookupMap.setLastTimeOfNotification(t);case 1:return e.next=2,r.stockLookupMap.setLastTimeOfNotification(t);case 2:return e.next=3,r.sync([r.firstMileLookupMap]);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),G.Z.addListener(G.Z.events.UPDATE_STOCK,function(){var e=a()(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=1;break}return e.next=1,r.stockLookupMap.setLastTimeOfNotification(t);case 1:return e.next=2,r.sync([r.stockLookupMap],{type:"always"});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),G.Z.addListener(G.Z.events.INSTALL_APPLICATION,function(e,t){var n=["install",e.productVersion,e.productCode,e.productLanguage].join("-"),a=Object.assign({},e,{sapCode:e.productCode});r.log.context({params:a}).disk("Handle installApplication"),r._updateGSDKConsumers(n,a,fe.ConsumerActivity.installed),r.addProductInfoToLookup(n,a,x.o7.Installation)}),G.Z.addListener(G.Z.events.UPDATE_APPLICATION,function(){var e=a()(d().mark(function e(t,n){var a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=["update",t.productVersion,t.productCode,t.productLanguage].join("-"),s=Object.assign({},t,{sapCode:t.productCode}),r.log.context({params:s}).disk("Handle updateApplication event"),r._updateGSDKConsumers(a,s,fe.ConsumerActivity.installed),r.addProductInfoToLookup(a,s,x.o7.Installation),r.updateProductInfoToLookup(a,s);case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),G.Z.addListener(G.Z.events.UNINSTALL_APPLICATION,function(){var e=a()(d().mark(function e(t){var n,a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=["uninstall",t.productVersion,t.productCode,t.productLanguage].join("-"),a=Object.assign({},t,{sapCode:t.productCode}),r.log.context({params:a}).disk("Handle uninstallApplication event"),r.uninstallProductInfoToLookup(n,a);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),F.Z.addListener("change",function(){var e=a()(d().mark(function e(t){var n,a,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.next=1,G.Z.getProxyCredentials();case 1:return n=e.sent,a=n.user,s=n.password,e.next=2,r.setProxyCredentials(a,s);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),G.Z.registerANSNotifications(),E.Z.getUserId()&&(n=this.maps.map(function(e){return e.getLastTimeOfNotification()}),G.Z.checkForMissedNotifications(n[0],n[1],Math.max.apply(Math,t()(n))));case 1:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"removeEventListeners",value:function(){var e;null===(e=this.serviceInterface)||void 0===e||e.removeAllListeners(),null===G.Z||void 0===G.Z||G.Z.removeAllListeners(),null===F.Z||void 0===F.Z||F.Z.removeAllListeners(),se.Z.removeAllListenersVulcan(),se.Z.releaseInstance(),E.Z.shutdown()}},{key:"onLoadHouseKeeping",value:(r=a()(d().mark(function e(){var t=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,N.obtainProcessLock("lockfile").catch(function(){var e=a()(d().mark(function e(n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"EAGAIN"===n.code||"EWOULDBLOCK"===n.code?t.log.disk("Unable to get lock. Process is already running"):t.log.error(new A.Z(n,"Failed to get Lockfile.")),t.removeEventListeners(),process.exit(1);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:Error.stackTraceLimit=1/0,process.on("uncaughtException",function(e){return t.log.error(new A.Z("Uncaught Exception",e,"X_ERR_UNCAUGHT_EXCEPTION"))}),process.on("unhandledRejection",function(e){return t.log.error(new A.Z("Unhandled Promise Rejection",e))});case 2:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"preventQuitting",value:function(){setTimeout(this.preventQuitting.bind(this),999999)}},{key:"initNetwork",value:(n=a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,we.requestLock.write(a()(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,F.Z.init();case 1:case"end":return e.stop()}},e)})));case 1:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"getElapsedTime",value:function(){return Date.now()-this.initStartTime.getTime()}},{key:"markElapsedTime",value:function(e,t){var n=new Object;t&&(n.data=t);var r=this.getElapsedTime();n[e]=r;var a=this.profileInfo[this.profileInfo.length-1];if(r-a[Object.keys(a)[0]]>a[Object.keys(a)[0]]){var s={};s[e]=r,this.maxInitMetric=s}this.profileInfo.push(n)}},{key:"getMaxStepCompletionTime",value:function(){var e=this,t=-1,n=0;return this.profileInfo.forEach(function(r){if(Object.keys(r)[0]===Object.keys(e.maxInitMetric)[0]){var a=r,s=e.profileInfo[n-1];s&&(t=a[Object.keys(a)[0]]-s[Object.keys(s)[0]])}n++}),t}},{key:"getMaxInitStepImpact",value:function(){var e=this.getMaxStepCompletionTime(),t=this.getElapsedTime(),n=-1;return 0!=t&&(n=Math.round(e/t*100)),n}},{key:"init",value:(e=a()(d().mark(function e(){var t,n,r,a,s,i,o,c,u,l=this;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,this.log.disk("-------------------------Startup------------------------------"),e.next=1,this.lifecycleManager.start(this.maps,t,this.healthMonitor,G.Z,F.Z,this.serviceInterface);case 1:return this.markElapsedTime("lifecycleManager-Start"),n=this.lifecycleManager.logAppLifecycleSummary(!1),this.log.disk("Build version is ".concat(_.Z.getProcessVersion(),", Environment: ").concat(f.Z.getEnvironment().LABEL)),e.next=2,this.onLoadHouseKeeping();case 2:this.gsdk.setMaps(this.maps),r=Wn(this.maps),e.prev=3,s=d().mark(function e(){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.value,e.next=1,t.load().catch(function(e){l.log.error(new A.Z("Failed to load lookup map ".concat(t.type),e)),l.markElapsedTime("loadLookupMapFailed-".concat(t.type))});case 1:return l.markElapsedTime("loadLookupMap-".concat(t.type)),e.next=2,t.createFAClientDir().catch(function(e){l.log.error(e)});case 2:return e.next=3,t.checkAssetsFolder().catch(function(e){l.log.error(new A.Z("Failed to ensure assets dir ".concat(t.type),e))});case 3:case"end":return e.stop()}},e)}),r.s();case 4:if((a=r.n()).done){e.next=6;break}return e.delegateYield(s(),"t0",5);case 5:e.next=4;break;case 6:e.next=8;break;case 7:e.prev=7,u=e.catch(3),r.e(u);case 8:return e.prev=8,r.f(),e.finish(8);case 9:return this.markElapsedTime("finishedAllLookupMaps"),_.Z.isDebugModeEnabled()&&(this.log.disk("******************************************************"),this.log.disk("CCXP Debug Mode Enabled"),void 0!==this.debugInterface&&(this.log.disk("Base Debug Interface Enabled...."),this.debugInterface.init(this.maps)),this.log.disk("******************************************************")),i=this.initNetwork(),e.next=10,E.Z.init();case 10:return this.markElapsedTime("Auth-init"),this.log.disk("CCXP Session GUID: ".concat(b.Z.session_guid)),this.log.disk("Event Session GUID: ".concat(b.Z.event_session_tracker)),e.next=11,Q.Z.check(Q.S.CCXPROCESS_INITIALIZED);case 11:return this.markElapsedTime("networkStatusCheck"),e.next=12,G.Z.getUserAnalyticsEnabledFlag().catch(function(e){l.log.error(new A.Z("Could not enable analytics on startup",e))});case 12:if(o=e.sent,c=o.enabled,this.setUserAnalyticsFlag(c),!pe.Z.isEnabled){e.next=14;break}return e.next=13,this.gsdk.startup().then(function(){if(f.Z.get("enable_gsdk_ghost_content")){l.log.disk("Notifying GSDK of GHST client installation.");var e={productCode:"GHST",productVersion:"2.0.0.0",productLanguage:"en_US"},t=["install",e.productVersion,e.productCode,e.productLanguage].join("-");l._updateGSDKConsumers(t,e,fe.ConsumerActivity.installed)}_.Z.isDebugModeEnabled()&&(l.log.disk("******************************************************"),void 0!==l.gsdkDebugInterface&&l.gsdkDebugInterface.init(l.gsdk,l.maps),l.log.disk("******************************************************"))});case 13:e.next=15;break;case 14:this.log.disk("GSDK is disabled - Skipping startup sequence.");case 15:return e.next=16,this.serviceInterface.init();case 16:return this.markElapsedTime("init-serviceInterface"),e.next=17,this.registerNotifications().catch(function(e){l.log.error(new A.Z("Failed to register for notifications",e))});case 17:return e.next=18,this.prefetchData();case 18:return e.next=19,this.updateLookupMapWithInstalledApps().catch(function(e){l.log.error(new A.Z("Failed to update lookup map on launch",e))});case 19:return e.next=20,this.sync(this.maps,{type:"none"},!0);case 20:return this.preventQuitting(),e.next=21,i.then(function(){l.markElapsedTime("networkPromise-resolved")}).catch(function(e){l.log.error(new A.Z("Failed to initialize network",e)),l.markElapsedTime("networkPromise-error")});case 21:return e.next=22,n.then(function(){l.markElapsedTime("logAppLifecycleSummary-resolved")}).catch(function(e){l.log.error(new A.Z("Failed to log summary event",e)),l.markElapsedTime("logAppLifecycleSummary-error")});case 22:return e.next=23,this.healthMonitor.start(this.maps,this.profileInfo,this.maxInitMetric,this.getElapsedTime(),this.getMaxStepCompletionTime(),this.getMaxInitStepImpact());case 23:return e.next=24,xn.isKillSwitchEnabled(function(e,t){e&&"ENOENT"!==e.code&&l.log.error(new A.Z("Failed to enable admin download blocking.",e)),t&&l.log.disk("Successfully updated admin settings: ".concat(JSON.stringify(t)))});case 24:return this.log.info(f.Z.analytics.t_INIT).appendPayload({"event.dts_start":t.toISOString()}),e.abrupt("return",this);case 25:case"end":return e.stop()}},e,this,[[3,7,8,9]])})),function(){return e.apply(this,arguments)})}]);var e,n,r,s,o,u,p,S,v}(),qn=n(8188).Module,Jn=qn._nodeModulePaths.bind(qn);qn._nodeModulePaths=function(e){return Jn(e).filter(function(e){return e.startsWith(__dirname)})};var Qn=n(4655),zn=n(6144);Qn.setFlagsFromString("--expose_gc"),Qn.setFlagsFromString("--max_heap_size=100"),Qn.setFlagsFromString("--optimize-for-size"),global.gc=zn.runInNewContext("gc"),setTimeout(function e(){global.gc(),setTimeout(e,3e4)},3e4);(new Xn).init()})()})();